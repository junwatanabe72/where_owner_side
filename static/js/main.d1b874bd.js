/*! For license information please see main.d1b874bd.js.LICENSE.txt */
(()=>{var e={4:(e,t,n)=>{"use strict";var i=n(853),r=n(43),o=n(950);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(l(e)!==e)throw Error(s(188))}function h(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=h(e)))return t;e=e.sibling}return null}var d=Object.assign,p=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),b=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope");var M=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var k=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var C=Symbol.iterator;function P(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=C&&e[C]||e["@@iterator"])?e:null}var I=Symbol.for("react.client.reference");function D(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===I?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case _:return"Profiler";case y:return"StrictMode";case S:return"Suspense";case T:return"SuspenseList";case M:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case m:return"Portal";case b:return(e.displayName||"Context")+".Provider";case x:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case E:return null!==(t=e.displayName||null)?t:D(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return D(e(t))}catch(n){}}return null}var z=Array.isArray,R=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},F=[],B=-1;function N(e){return{current:e}}function j(e){0>B||(e.current=F[B],F[B]=null,B--)}function V(e,t){B++,F[B]=e.current,e.current=t}var U=N(null),G=N(null),q=N(null),W=N(null);function Z(e,t){switch(V(q,t),V(G,e),V(U,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?rh(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=oh(t=rh(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}j(U),V(U,e)}function H(){j(U),j(G),j(q)}function X(e){null!==e.memoizedState&&V(W,e);var t=U.current,n=oh(t,e.type);t!==n&&(V(G,e),V(U,n))}function Y(e){G.current===e&&(j(U),j(G)),W.current===e&&(j(W),Xh._currentValue=O)}var K=Object.prototype.hasOwnProperty,J=i.unstable_scheduleCallback,$=i.unstable_cancelCallback,Q=i.unstable_shouldYield,ee=i.unstable_requestPaint,te=i.unstable_now,ne=i.unstable_getCurrentPriorityLevel,ie=i.unstable_ImmediatePriority,re=i.unstable_UserBlockingPriority,oe=i.unstable_NormalPriority,se=i.unstable_LowPriority,ae=i.unstable_IdlePriority,le=i.log,ce=i.unstable_setDisableYieldValue,ue=null,he=null;function de(e){if("function"===typeof le&&ce(e),he&&"function"===typeof he.setStrictMode)try{he.setStrictMode(ue,e)}catch(t){}}var pe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(fe(e)/me|0)|0},fe=Math.log,me=Math.LN2;var ge=256,ye=4194304;function _e(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ve(e,t,n){var i=e.pendingLanes;if(0===i)return 0;var r=0,o=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var a=134217727&i;return 0!==a?0!==(i=a&~o)?r=_e(i):0!==(s&=a)?r=_e(s):n||0!==(n=a&~e)&&(r=_e(n)):0!==(a=i&~o)?r=_e(a):0!==s?r=_e(s):n||0!==(n=i&~e)&&(r=_e(n)),0===r?0:0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(n=t&-t)||32===o&&0!==(4194048&n))?t:r}function xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function be(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function we(){var e=ge;return 0===(4194048&(ge<<=1))&&(ge=256),e}function Se(){var e=ye;return 0===(62914560&(ye<<=1))&&(ye=4194304),e}function Te(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ee(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ae(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-pe(t);e.entangledLanes|=t,e.entanglements[i]=1073741824|e.entanglements[i]|4194090&n}function Me(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-pe(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}function ke(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ce(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Pe(){var e=L.p;return 0!==e?e:void 0===(e=window.event)?32:cd(e.type)}var Ie=Math.random().toString(36).slice(2),De="__reactFiber$"+Ie,ze="__reactProps$"+Ie,Re="__reactContainer$"+Ie,Le="__reactEvents$"+Ie,Oe="__reactListeners$"+Ie,Fe="__reactHandles$"+Ie,Be="__reactResources$"+Ie,Ne="__reactMarker$"+Ie;function je(e){delete e[De],delete e[ze],delete e[Le],delete e[Oe],delete e[Fe]}function Ve(e){var t=e[De];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Re]||n[De]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=vh(e);null!==e;){if(n=e[De])return n;e=vh(e)}return t}n=(e=n).parentNode}return null}function Ue(e){if(e=e[De]||e[Re]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ge(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function qe(e){var t=e[Be];return t||(t=e[Be]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[Ne]=!0}var Ze=new Set,He={};function Xe(e,t){Ye(e,t),Ye(e+"Capture",t)}function Ye(e,t){for(He[e]=t,e=0;e<t.length;e++)Ze.add(t[e])}var Ke,Je,$e=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qe={},et={};function tt(e,t,n){if(r=t,K.call(et,r)||!K.call(Qe,r)&&($e.test(r)?et[r]=!0:(Qe[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function it(e,t,n,i){if(null===i)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+i)}}function rt(e){if(void 0===Ke)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ke=t&&t[1]||"",Je=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ke+e+Je}var ot=!1;function st(e,t){if(!e||ot)return"";ot=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var i=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(o){i=o}e.call(n.prototype)}}else{try{throw Error()}catch(s){i=s}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(a){if(a&&i&&"string"===typeof a.stack)return[a.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=i.DetermineComponentFrameRoot(),s=o[0],a=o[1];if(s&&a){var l=s.split("\n"),c=a.split("\n");for(r=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(i===l.length||r===c.length)for(i=l.length-1,r=c.length-1;1<=i&&0<=r&&l[i]!==c[r];)r--;for(;1<=i&&0<=r;i--,r--)if(l[i]!==c[r]){if(1!==i||1!==r)do{if(i--,0>--r||l[i]!==c[r]){var u="\n"+l[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=r);break}}}finally{ot=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?rt(n):""}function at(e){switch(e.tag){case 26:case 27:case 5:return rt(e.type);case 16:return rt("Lazy");case 13:return rt("Suspense");case 19:return rt("SuspenseList");case 0:case 15:return st(e.type,!1);case 11:return st(e.type.render,!1);case 1:return st(e.type,!0);case 31:return rt("Activity");default:return""}}function lt(e){try{var t="";do{t+=at(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ht(e){e._valueTracker||(e._valueTracker=function(e){var t=ut(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function dt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=ut(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function pt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function mt(e){return e.replace(ft,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,i,r,o,s,a){e.name="",null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?_t(e,s,ct(t)):null!=n?_t(e,s,ct(n)):null!=i&&e.removeAttribute("value"),null==r&&null!=o&&(e.defaultChecked=!!o),null!=r&&(e.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.name=""+ct(a):e.removeAttribute("name")}function yt(e,t,n,i,r,o,s,a){if(null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.type=o),null!=t||null!=n){if(!("submit"!==o&&"reset"!==o||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,a||t===e.value||(e.value=t),e.defaultValue=t}i="function"!==typeof(i=null!=i?i:r)&&"symbol"!==typeof i&&!!i,e.checked=a?e.checked:!!i,e.defaultChecked=!!i,null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.name=s)}function _t(e,t,n){"number"===t&&pt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function vt(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function bt(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(s(92));if(z(i)){if(1<i.length)throw Error(s(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i)}function wt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var St=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tt(e,t,n){var i=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,n):"number"!==typeof n||0===n||St.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Et(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(s(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var r in t)i=t[r],t.hasOwnProperty(r)&&n[r]!==i&&Tt(e,r,i)}else for(var o in t)t.hasOwnProperty(o)&&Tt(e,o,t[o])}function At(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ct(e){return kt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Pt=null;function It(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Dt=null,zt=null;function Rt(e){var t=Ue(e);if(t&&(e=t.stateNode)){var n=e[ze]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+mt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=i[ze]||null;if(!r)throw Error(s(90));gt(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&dt(i)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&vt(e,!!n.multiple,t,!1)}}}var Lt=!1;function Ot(e,t,n){if(Lt)return e(t,n);Lt=!0;try{return e(t)}finally{if(Lt=!1,(null!==Dt||null!==zt)&&(Vc(),Dt&&(t=Dt,e=zt,zt=Dt=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function Ft(e,t){var n=e.stateNode;if(null===n)return null;var i=n[ze]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Bt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Nt=!1;if(Bt)try{var jt={};Object.defineProperty(jt,"passive",{get:function(){Nt=!0}}),window.addEventListener("test",jt,jt),window.removeEventListener("test",jt,jt)}catch(zd){Nt=!1}var Vt=null,Ut=null,Gt=null;function qt(){if(Gt)return Gt;var e,t,n=Ut,i=n.length,r="value"in Vt?Vt.value:Vt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return Gt=r.slice(e,1<t?1-t:void 0)}function Wt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Zt(){return!0}function Ht(){return!1}function Xt(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?Zt:Ht,this.isPropagationStopped=Ht,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Zt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Zt)},persist:function(){},isPersistent:Zt}),t}var Yt,Kt,Jt,$t={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qt=Xt($t),en=d({},$t,{view:0,detail:0}),tn=Xt(en),nn=d({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Yt=e.screenX-Jt.screenX,Kt=e.screenY-Jt.screenY):Kt=Yt=0,Jt=e),Yt)},movementY:function(e){return"movementY"in e?e.movementY:Kt}}),rn=Xt(nn),on=Xt(d({},nn,{dataTransfer:0})),sn=Xt(d({},en,{relatedTarget:0})),an=Xt(d({},$t,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=Xt(d({},$t,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=Xt(d({},$t,{data:0})),un={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=dn[e])&&!!t[e]}function fn(){return pn}var mn=Xt(d({},en,{key:function(e){if(e.key){var t=un[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Wt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fn,charCode:function(e){return"keypress"===e.type?Wt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Wt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=Xt(d({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),yn=Xt(d({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fn})),_n=Xt(d({},$t,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=Xt(d({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=Xt(d({},$t,{newState:0,oldState:0})),bn=[9,13,27,32],wn=Bt&&"CompositionEvent"in window,Sn=null;Bt&&"documentMode"in document&&(Sn=document.documentMode);var Tn=Bt&&"TextEvent"in window&&!Sn,En=Bt&&(!wn||Sn&&8<Sn&&11>=Sn),An=String.fromCharCode(32),Mn=!1;function kn(e,t){switch(e){case"keyup":return-1!==bn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Pn=!1;var In={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!In[e.type]:"textarea"===t}function zn(e,t,n,i){Dt?zt?zt.push(i):zt=[i]:Dt=i,0<(t=qu(t,"onChange")).length&&(n=new Qt("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Rn=null,Ln=null;function On(e){Ou(e,0)}function Fn(e){if(dt(Ge(e)))return e}function Bn(e,t){if("change"===e)return t}var Nn=!1;if(Bt){var jn;if(Bt){var Vn="oninput"in document;if(!Vn){var Un=document.createElement("div");Un.setAttribute("oninput","return;"),Vn="function"===typeof Un.oninput}jn=Vn}else jn=!1;Nn=jn&&(!document.documentMode||9<document.documentMode)}function Gn(){Rn&&(Rn.detachEvent("onpropertychange",qn),Ln=Rn=null)}function qn(e){if("value"===e.propertyName&&Fn(Ln)){var t=[];zn(t,Ln,e,It(e)),Ot(On,t)}}function Wn(e,t,n){"focusin"===e?(Gn(),Ln=n,(Rn=t).attachEvent("onpropertychange",qn)):"focusout"===e&&Gn()}function Zn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Fn(Ln)}function Hn(e,t){if("click"===e)return Fn(t)}function Xn(e,t){if("input"===e||"change"===e)return Fn(t)}var Yn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Kn(e,t){if(Yn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!K.call(t,r)||!Yn(e[r],t[r]))return!1}return!0}function Jn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function $n(e,t){var n,i=Jn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Jn(i)}}function Qn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Qn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ei(e){for(var t=pt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=pt((e=t.contentWindow).document)}return t}function ti(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ni=Bt&&"documentMode"in document&&11>=document.documentMode,ii=null,ri=null,oi=null,si=!1;function ai(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;si||null==ii||ii!==pt(i)||("selectionStart"in(i=ii)&&ti(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},oi&&Kn(oi,i)||(oi=i,0<(i=qu(ri,"onSelect")).length&&(t=new Qt("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=ii)))}function li(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ci={animationend:li("Animation","AnimationEnd"),animationiteration:li("Animation","AnimationIteration"),animationstart:li("Animation","AnimationStart"),transitionrun:li("Transition","TransitionRun"),transitionstart:li("Transition","TransitionStart"),transitioncancel:li("Transition","TransitionCancel"),transitionend:li("Transition","TransitionEnd")},ui={},hi={};function di(e){if(ui[e])return ui[e];if(!ci[e])return e;var t,n=ci[e];for(t in n)if(n.hasOwnProperty(t)&&t in hi)return ui[e]=n[t];return e}Bt&&(hi=document.createElement("div").style,"AnimationEvent"in window||(delete ci.animationend.animation,delete ci.animationiteration.animation,delete ci.animationstart.animation),"TransitionEvent"in window||delete ci.transitionend.transition);var pi=di("animationend"),fi=di("animationiteration"),mi=di("animationstart"),gi=di("transitionrun"),yi=di("transitionstart"),_i=di("transitioncancel"),vi=di("transitionend"),xi=new Map,bi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(e,t){xi.set(e,t),Xe(t,[e])}bi.push("scrollEnd");var Si=new WeakMap;function Ti(e,t){if("object"===typeof e&&null!==e){var n=Si.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},Si.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var Ei=[],Ai=0,Mi=0;function ki(){for(var e=Ai,t=Mi=Ai=0;t<e;){var n=Ei[t];Ei[t++]=null;var i=Ei[t];Ei[t++]=null;var r=Ei[t];Ei[t++]=null;var o=Ei[t];if(Ei[t++]=null,null!==i&&null!==r){var s=i.pending;null===s?r.next=r:(r.next=s.next,s.next=r),i.pending=r}0!==o&&Di(n,r,o)}}function Ci(e,t,n,i){Ei[Ai++]=e,Ei[Ai++]=t,Ei[Ai++]=n,Ei[Ai++]=i,Mi|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function Pi(e,t,n,i){return Ci(e,t,n,i),zi(e)}function Ii(e,t){return Ci(e,null,null,t),zi(e)}function Di(e,t,n){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n);for(var r=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(i=o.alternate)&&(i.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(r=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,r&&null!==t&&(r=31-pe(n),null===(i=(e=o.hiddenUpdates)[r])?e[r]=[t]:i.push(t),t.lane=536870912|n),o):null}function zi(e){if(50<Dc)throw Dc=0,zc=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ri={};function Li(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oi(e,t,n,i){return new Li(e,t,n,i)}function Fi(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bi(e,t){var n=e.alternate;return null===n?((n=Oi(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Ni(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function ji(e,t,n,i,r,o){var a=0;if(i=e,"function"===typeof e)Fi(e)&&(a=1);else if("string"===typeof e)a=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,U.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case M:return(e=Oi(31,n,t,r)).elementType=M,e.lanes=o,e;case g:return Vi(n.children,r,o,t);case y:a=8,r|=24;break;case _:return(e=Oi(12,n,t,2|r)).elementType=_,e.lanes=o,e;case S:return(e=Oi(13,n,t,r)).elementType=S,e.lanes=o,e;case T:return(e=Oi(19,n,t,r)).elementType=T,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case v:case b:a=10;break e;case x:a=9;break e;case w:a=11;break e;case E:a=14;break e;case A:a=16,i=null;break e}a=29,n=Error(s(130,null===e?"null":typeof e,"")),i=null}return(t=Oi(a,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Vi(e,t,n,i){return(e=Oi(7,e,i,t)).lanes=n,e}function Ui(e,t,n){return(e=Oi(6,e,null,t)).lanes=n,e}function Gi(e,t,n){return(t=Oi(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var qi=[],Wi=0,Zi=null,Hi=0,Xi=[],Yi=0,Ki=null,Ji=1,$i="";function Qi(e,t){qi[Wi++]=Hi,qi[Wi++]=Zi,Zi=e,Hi=t}function er(e,t,n){Xi[Yi++]=Ji,Xi[Yi++]=$i,Xi[Yi++]=Ki,Ki=e;var i=Ji;e=$i;var r=32-pe(i)-1;i&=~(1<<r),n+=1;var o=32-pe(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Ji=1<<32-pe(t)+r|n<<r|i,$i=o+e}else Ji=1<<o|n<<r|i,$i=e}function tr(e){null!==e.return&&(Qi(e,1),er(e,1,0))}function nr(e){for(;e===Zi;)Zi=qi[--Wi],qi[Wi]=null,Hi=qi[--Wi],qi[Wi]=null;for(;e===Ki;)Ki=Xi[--Yi],Xi[Yi]=null,$i=Xi[--Yi],Xi[Yi]=null,Ji=Xi[--Yi],Xi[Yi]=null}var ir=null,rr=null,or=!1,sr=null,ar=!1,lr=Error(s(519));function cr(e){throw mr(Ti(Error(s(418,"")),e)),lr}function ur(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[De]=e,t[ze]=i,n){case"dialog":Fu("cancel",t),Fu("close",t);break;case"iframe":case"object":case"embed":Fu("load",t);break;case"video":case"audio":for(n=0;n<Ru.length;n++)Fu(Ru[n],t);break;case"source":Fu("error",t);break;case"img":case"image":case"link":Fu("error",t),Fu("load",t);break;case"details":Fu("toggle",t);break;case"input":Fu("invalid",t),yt(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),ht(t);break;case"select":Fu("invalid",t);break;case"textarea":Fu("invalid",t),bt(t,i.value,i.defaultValue,i.children),ht(t)}"string"!==typeof(n=i.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===i.suppressHydrationWarning||Ku(t.textContent,n)?(null!=i.popover&&(Fu("beforetoggle",t),Fu("toggle",t)),null!=i.onScroll&&Fu("scroll",t),null!=i.onScrollEnd&&Fu("scrollend",t),null!=i.onClick&&(t.onclick=Ju),t=!0):t=!1,t||cr(e)}function hr(e){for(ir=e.return;ir;)switch(ir.tag){case 5:case 13:return void(ar=!1);case 27:case 3:return void(ar=!0);default:ir=ir.return}}function dr(e){if(e!==ir)return!1;if(!or)return hr(e),or=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||sh(e.type,e.memoizedProps)),t=!t),t&&rr&&cr(e),hr(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){rr=yh(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}rr=null}}else 27===n?(n=rr,ph(e.type)?(e=_h,_h=null,rr=e):rr=n):rr=ir?yh(e.stateNode.nextSibling):null;return!0}function pr(){rr=ir=null,or=!1}function fr(){var e=sr;return null!==e&&(null===vc?vc=e:vc.push.apply(vc,e),sr=null),e}function mr(e){null===sr?sr=[e]:sr.push(e)}var gr=N(null),yr=null,_r=null;function vr(e,t,n){V(gr,t._currentValue),t._currentValue=n}function xr(e){e._currentValue=gr.current,j(gr)}function br(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function wr(e,t,n,i){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var o=r.dependencies;if(null!==o){var a=r.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),br(o.return,n,e),i||(a=null);break e}o=l.next}}else if(18===r.tag){if(null===(a=r.return))throw Error(s(341));a.lanes|=n,null!==(o=a.alternate)&&(o.lanes|=n),br(a,n,e),a=null}else a=r.child;if(null!==a)a.return=r;else for(a=r;null!==a;){if(a===e){a=null;break}if(null!==(r=a.sibling)){r.return=a.return,a=r;break}a=a.return}r=a}}function Sr(e,t,n,i){e=null;for(var r=t,o=!1;null!==r;){if(!o)if(0!==(524288&r.flags))o=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var a=r.alternate;if(null===a)throw Error(s(387));if(null!==(a=a.memoizedProps)){var l=r.type;Yn(r.pendingProps.value,a.value)||(null!==e?e.push(l):e=[l])}}else if(r===W.current){if(null===(a=r.alternate))throw Error(s(387));a.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(Xh):e=[Xh])}r=r.return}null!==e&&wr(t,e,n,i),t.flags|=262144}function Tr(e){for(e=e.firstContext;null!==e;){if(!Yn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Er(e){yr=e,_r=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ar(e){return kr(yr,e)}function Mr(e,t){return null===yr&&Er(e),kr(e,t)}function kr(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===_r){if(null===e)throw Error(s(308));_r=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else _r=_r.next=t;return n}var Cr="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Pr=i.unstable_scheduleCallback,Ir=i.unstable_NormalPriority,Dr={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zr(){return{controller:new Cr,data:new Map,refCount:0}}function Rr(e){e.refCount--,0===e.refCount&&Pr(Ir,function(){e.controller.abort()})}var Lr=null,Or=0,Fr=0,Br=null;function Nr(){if(0===--Or&&null!==Lr){null!==Br&&(Br.status="fulfilled");var e=Lr;Lr=null,Fr=0,Br=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var jr=R.S;R.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Lr){var n=Lr=[];Or=0,Fr=Cu(),Br={status:"pending",value:void 0,then:function(e){n.push(e)}}}Or++,t.then(Nr,Nr)}(0,t),null!==jr&&jr(e,t)};var Vr=N(null);function Ur(){var e=Vr.current;return null!==e?e:ic.pooledCache}function Gr(e,t){V(Vr,null===t?Vr.current:t.pool)}function qr(){var e=Ur();return null===e?null:{parent:Dr._currentValue,pool:e}}var Wr=Error(s(460)),Zr=Error(s(474)),Hr=Error(s(542)),Xr={then:function(){}};function Yr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Kr(){}function Jr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Kr,Kr),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e;default:if("string"===typeof t.status)t.then(Kr,Kr);else{if(null!==(e=ic)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw eo(e=t.reason),e}throw $r=t,Wr}}var $r=null;function Qr(){if(null===$r)throw Error(s(459));var e=$r;return $r=null,e}function eo(e){if(e===Wr||e===Hr)throw Error(s(483))}var to=!1;function no(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function io(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ro(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function oo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&nc)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,t=zi(e),Di(e,null,n),t}return Ci(e,i,t,n),zi(e)}function so(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Me(e,n)}}function ao(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,callbacks:i.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var lo=!1;function co(){if(lo){if(null!==Br)throw Br}}function uo(e,t,n,i){lo=!1;var r=e.updateQueue;to=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(s=0,u=c=l=null,a=o;;){var p=-536870913&a.lane,f=p!==a.lane;if(f?(oc&p)===p:(i&p)===p){0!==p&&p===Fr&&(lo=!0),null!==u&&(u=u.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var m=e,g=a;p=t;var y=n;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){h=m.call(y,h,p);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(p="function"===typeof(m=g.payload)?m.call(y,h,p):m)||void 0===p)break e;h=d({},h,p);break e;case 2:to=!0}}null!==(p=a.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=r.callbacks)?r.callbacks=[p]:f.push(p))}else f={lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=f,l=h):u=u.next=f,s|=p;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(f=a).next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null===o&&(r.shared.lanes=0),pc|=s,e.lanes=s,e.memoizedState=h}}function ho(e,t){if("function"!==typeof e)throw Error(s(191,e));e.call(t)}function po(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ho(n[e],t)}var fo=N(null),mo=N(0);function go(e,t){V(mo,e=hc),V(fo,t),hc=e|t.baseLanes}function yo(){V(mo,hc),V(fo,fo.current)}function _o(){hc=mo.current,j(fo),j(mo)}var vo=0,xo=null,bo=null,wo=null,So=!1,To=!1,Eo=!1,Ao=0,Mo=0,ko=null,Co=0;function Po(){throw Error(s(321))}function Io(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Yn(e[n],t[n]))return!1;return!0}function Do(e,t,n,i,r,o){return vo=o,xo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,R.H=null===e||null===e.memoizedState?Zs:Hs,Eo=!1,o=n(i,r),Eo=!1,To&&(o=Ro(t,n,i,r)),zo(e),o}function zo(e){R.H=Ws;var t=null!==bo&&null!==bo.next;if(vo=0,wo=bo=xo=null,So=!1,Mo=0,ko=null,t)throw Error(s(300));null===e||Ma||null!==(e=e.dependencies)&&Tr(e)&&(Ma=!0)}function Ro(e,t,n,i){xo=e;var r=0;do{if(To&&(ko=null),Mo=0,To=!1,25<=r)throw Error(s(301));if(r+=1,wo=bo=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}R.H=Xs,o=t(n,i)}while(To);return o}function Lo(){var e=R.H,t=e.useState()[0];return t="function"===typeof t.then?Vo(t):t,e=e.useState()[0],(null!==bo?bo.memoizedState:null)!==e&&(xo.flags|=1024),t}function Oo(){var e=0!==Ao;return Ao=0,e}function Fo(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Bo(e){if(So){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}So=!1}vo=0,wo=bo=xo=null,To=!1,Mo=Ao=0,ko=null}function No(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wo?xo.memoizedState=wo=e:wo=wo.next=e,wo}function jo(){if(null===bo){var e=xo.alternate;e=null!==e?e.memoizedState:null}else e=bo.next;var t=null===wo?xo.memoizedState:wo.next;if(null!==t)wo=t,bo=e;else{if(null===e){if(null===xo.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(bo=e).memoizedState,baseState:bo.baseState,baseQueue:bo.baseQueue,queue:bo.queue,next:null},null===wo?xo.memoizedState=wo=e:wo=wo.next=e}return wo}function Vo(e){var t=Mo;return Mo+=1,null===ko&&(ko=[]),e=Jr(ko,e,t),t=xo,null===(null===wo?t.memoizedState:wo.next)&&(t=t.alternate,R.H=null===t||null===t.memoizedState?Zs:Hs),e}function Uo(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Vo(e);if(e.$$typeof===b)return Ar(e)}throw Error(s(438,String(e)))}function Go(e){var t=null,n=xo.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var i=xo.alternate;null!==i&&(null!==(i=i.updateQueue)&&(null!=(i=i.memoCache)&&(t={data:i.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=k;return t.index++,n}function qo(e,t){return"function"===typeof t?t(e):t}function Wo(e){return Zo(jo(),bo,e)}function Zo(e,t,n){var i=e.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=n;var r=e.baseQueue,o=i.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}t.baseQueue=r=o,i.pending=null}if(o=e.baseState,null===r)e.memoizedState=o;else{var l=a=null,c=null,u=t=r.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(oc&d)===d:(vo&d)===d){var p=u.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===Fr&&(h=!0);else{if((vo&p)===p){u=u.next,p===Fr&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=d,a=o):c=c.next=d,xo.lanes|=p,pc|=p}d=u.action,Eo&&n(o,d),o=u.hasEagerState?u.eagerState:n(o,d)}else p={lane:d,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,a=o):c=c.next=p,xo.lanes|=d,pc|=d;u=u.next}while(null!==u&&u!==t);if(null===c?a=o:c.next=l,!Yn(o,e.memoizedState)&&(Ma=!0,h&&null!==(n=Br)))throw n;e.memoizedState=o,e.baseState=a,e.baseQueue=c,i.lastRenderedState=o}return null===r&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Ho(e){var t=jo(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);Yn(o,t.memoizedState)||(Ma=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Xo(e,t,n){var i=xo,r=jo(),o=or;if(o){if(void 0===n)throw Error(s(407));n=n()}else n=t();var a=!Yn((bo||r).memoizedState,n);if(a&&(r.memoizedState=n,Ma=!0),r=r.queue,ys(2048,8,Jo.bind(null,i,r,e),[e]),r.getSnapshot!==t||a||null!==wo&&1&wo.memoizedState.tag){if(i.flags|=2048,fs(9,{destroy:void 0,resource:void 0},Ko.bind(null,i,r,n,t),null),null===ic)throw Error(s(349));o||0!==(124&vo)||Yo(i,t,n)}return n}function Yo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=xo.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ko(e,t,n,i){t.value=n,t.getSnapshot=i,$o(t)&&Qo(e)}function Jo(e,t,n){return n(function(){$o(t)&&Qo(e)})}function $o(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Yn(e,n)}catch(i){return!0}}function Qo(e){var t=Ii(e,2);null!==t&&Oc(t,e,2)}function es(e){var t=No();if("function"===typeof e){var n=e;if(e=n(),Eo){de(!0);try{n()}finally{de(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qo,lastRenderedState:e},t}function ts(e,t,n,i){return e.baseState=n,Zo(e,bo,"function"===typeof i?i:qo)}function ns(e,t,n,i,r){if(Us(e))throw Error(s(485));if(null!==(e=t.action)){var o={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==R.T?n(!0):o.isTransition=!1,i(o),null===(n=t.pending)?(o.next=t.pending=o,is(t,o)):(o.next=n.next,t.pending=n.next=o)}}function is(e,t){var n=t.action,i=t.payload,r=e.state;if(t.isTransition){var o=R.T,s={};R.T=s;try{var a=n(r,i),l=R.S;null!==l&&l(s,a),rs(e,t,a)}catch(c){ss(e,t,c)}finally{R.T=o}}else try{rs(e,t,o=n(r,i))}catch(u){ss(e,t,u)}}function rs(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){os(e,t,n)},function(n){return ss(e,t,n)}):os(e,t,n)}function os(e,t,n){t.status="fulfilled",t.value=n,as(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,is(e,n)))}function ss(e,t,n){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do{t.status="rejected",t.reason=n,as(t),t=t.next}while(t!==i)}e.action=null}function as(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ls(e,t){return t}function cs(e,t){if(or){var n=ic.formState;if(null!==n){e:{var i=xo;if(or){if(rr){t:{for(var r=rr,o=ar;8!==r.nodeType;){if(!o){r=null;break t}if(null===(r=yh(r.nextSibling))){r=null;break t}}r="F!"===(o=r.data)||"F"===o?r:null}if(r){rr=yh(r.nextSibling),i="F!"===r.data;break e}}cr(i)}i=!1}i&&(t=n[0])}}return(n=No()).memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ls,lastRenderedState:t},n.queue=i,n=Ns.bind(null,xo,i),i.dispatch=n,i=es(!1),o=Vs.bind(null,xo,!1,i.queue),r={state:t,dispatch:null,action:e,pending:null},(i=No()).queue=r,n=ns.bind(null,xo,r,o,n),r.dispatch=n,i.memoizedState=e,[t,n,!1]}function us(e){return hs(jo(),bo,e)}function hs(e,t,n){if(t=Zo(e,t,ls)[0],e=Wo(qo)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var i=Vo(t)}catch(s){if(s===Wr)throw Hr;throw s}else i=t;var r=(t=jo()).queue,o=r.dispatch;return n!==t.memoizedState&&(xo.flags|=2048,fs(9,{destroy:void 0,resource:void 0},ds.bind(null,r,n),null)),[i,o,e]}function ds(e,t){e.action=t}function ps(e){var t=jo(),n=bo;if(null!==n)return hs(t,n,e);jo(),t=t.memoizedState;var i=(n=jo()).queue.dispatch;return n.memoizedState=e,[t,i,!1]}function fs(e,t,n,i){return e={tag:e,create:n,deps:i,inst:t,next:null},null===(t=xo.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},xo.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function ms(){return jo().memoizedState}function gs(e,t,n,i){var r=No();i=void 0===i?null:i,xo.flags|=e,r.memoizedState=fs(1|t,{destroy:void 0,resource:void 0},n,i)}function ys(e,t,n,i){var r=jo();i=void 0===i?null:i;var o=r.memoizedState.inst;null!==bo&&null!==i&&Io(i,bo.memoizedState.deps)?r.memoizedState=fs(t,o,n,i):(xo.flags|=e,r.memoizedState=fs(1|t,o,n,i))}function _s(e,t){gs(8390656,8,e,t)}function vs(e,t){ys(2048,8,e,t)}function xs(e,t){return ys(4,2,e,t)}function bs(e,t){return ys(4,4,e,t)}function ws(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ss(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,ys(4,4,ws.bind(null,t,e),n)}function Ts(){}function Es(e,t){var n=jo();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&Io(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function As(e,t){var n=jo();t=void 0===t?null:t;var i=n.memoizedState;if(null!==t&&Io(t,i[1]))return i[0];if(i=e(),Eo){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[i,t],i}function Ms(e,t,n){return void 0===n||0!==(1073741824&vo)?e.memoizedState=t:(e.memoizedState=n,e=Lc(),xo.lanes|=e,pc|=e,n)}function ks(e,t,n,i){return Yn(n,t)?n:null!==fo.current?(e=Ms(e,n,i),Yn(e,t)||(Ma=!0),e):0===(42&vo)?(Ma=!0,e.memoizedState=n):(e=Lc(),xo.lanes|=e,pc|=e,t)}function Cs(e,t,n,i,r){var o=L.p;L.p=0!==o&&8>o?o:8;var s=R.T,a={};R.T=a,Vs(e,!1,t,n);try{var l=r(),c=R.S;if(null!==c&&c(a,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)js(e,t,function(e,t){var n=[],i={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){i.status="fulfilled",i.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(i.status="rejected",i.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),i}(l,i),Rc());else js(e,t,i,Rc())}catch(u){js(e,t,{then:function(){},status:"rejected",reason:u},Rc())}finally{L.p=o,R.T=s}}function Ps(){}function Is(e,t,n,i){if(5!==e.tag)throw Error(s(476));var r=Ds(e).queue;Cs(e,r,t,O,null===n?Ps:function(){return zs(e),n(i)})}function Ds(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qo,lastRenderedState:O},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qo,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function zs(e){js(e,Ds(e).next.queue,{},Rc())}function Rs(){return Ar(Xh)}function Ls(){return jo().memoizedState}function Os(){return jo().memoizedState}function Fs(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Rc(),i=oo(t,e=ro(n),n);return null!==i&&(Oc(i,t,n),so(i,t,n)),t={cache:zr()},void(e.payload=t)}t=t.return}}function Bs(e,t,n){var i=Rc();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Us(e)?Gs(t,n):null!==(n=Pi(e,t,n,i))&&(Oc(n,e,i),qs(n,t,i))}function Ns(e,t,n){js(e,t,n,Rc())}function js(e,t,n,i){var r={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Us(e))Gs(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,Yn(a,s))return Ci(e,t,r,0),null===ic&&ki(),!1}catch(l){}if(null!==(n=Pi(e,t,r,i)))return Oc(n,e,i),qs(n,t,i),!0}return!1}function Vs(e,t,n,i){if(i={lane:2,revertLane:Cu(),action:i,hasEagerState:!1,eagerState:null,next:null},Us(e)){if(t)throw Error(s(479))}else null!==(t=Pi(e,n,i,2))&&Oc(t,e,2)}function Us(e){var t=e.alternate;return e===xo||null!==t&&t===xo}function Gs(e,t){To=So=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function qs(e,t,n){if(0!==(4194048&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Me(e,n)}}var Ws={readContext:Ar,use:Uo,useCallback:Po,useContext:Po,useEffect:Po,useImperativeHandle:Po,useLayoutEffect:Po,useInsertionEffect:Po,useMemo:Po,useReducer:Po,useRef:Po,useState:Po,useDebugValue:Po,useDeferredValue:Po,useTransition:Po,useSyncExternalStore:Po,useId:Po,useHostTransitionStatus:Po,useFormState:Po,useActionState:Po,useOptimistic:Po,useMemoCache:Po,useCacheRefresh:Po},Zs={readContext:Ar,use:Uo,useCallback:function(e,t){return No().memoizedState=[e,void 0===t?null:t],e},useContext:Ar,useEffect:_s,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,gs(4194308,4,ws.bind(null,t,e),n)},useLayoutEffect:function(e,t){return gs(4194308,4,e,t)},useInsertionEffect:function(e,t){gs(4,2,e,t)},useMemo:function(e,t){var n=No();t=void 0===t?null:t;var i=e();if(Eo){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=No();if(void 0!==n){var r=n(t);if(Eo){de(!0);try{n(t)}finally{de(!1)}}}else r=t;return i.memoizedState=i.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},i.queue=e,e=e.dispatch=Bs.bind(null,xo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},No().memoizedState=e},useState:function(e){var t=(e=es(e)).queue,n=Ns.bind(null,xo,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Ts,useDeferredValue:function(e,t){return Ms(No(),e,t)},useTransition:function(){var e=es(!1);return e=Cs.bind(null,xo,e.queue,!0,!1),No().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=xo,r=No();if(or){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===ic)throw Error(s(349));0!==(124&oc)||Yo(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,_s(Jo.bind(null,i,o,e),[e]),i.flags|=2048,fs(9,{destroy:void 0,resource:void 0},Ko.bind(null,i,o,n,t),null),n},useId:function(){var e=No(),t=ic.identifierPrefix;if(or){var n=$i;t="\xab"+t+"R"+(n=(Ji&~(1<<32-pe(Ji)-1)).toString(32)+n),0<(n=Ao++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Co++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Rs,useFormState:cs,useActionState:cs,useOptimistic:function(e){var t=No();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Vs.bind(null,xo,!0,n),n.dispatch=t,[e,t]},useMemoCache:Go,useCacheRefresh:function(){return No().memoizedState=Fs.bind(null,xo)}},Hs={readContext:Ar,use:Uo,useCallback:Es,useContext:Ar,useEffect:vs,useImperativeHandle:Ss,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:As,useReducer:Wo,useRef:ms,useState:function(){return Wo(qo)},useDebugValue:Ts,useDeferredValue:function(e,t){return ks(jo(),bo.memoizedState,e,t)},useTransition:function(){var e=Wo(qo)[0],t=jo().memoizedState;return["boolean"===typeof e?e:Vo(e),t]},useSyncExternalStore:Xo,useId:Ls,useHostTransitionStatus:Rs,useFormState:us,useActionState:us,useOptimistic:function(e,t){return ts(jo(),0,e,t)},useMemoCache:Go,useCacheRefresh:Os},Xs={readContext:Ar,use:Uo,useCallback:Es,useContext:Ar,useEffect:vs,useImperativeHandle:Ss,useInsertionEffect:xs,useLayoutEffect:bs,useMemo:As,useReducer:Ho,useRef:ms,useState:function(){return Ho(qo)},useDebugValue:Ts,useDeferredValue:function(e,t){var n=jo();return null===bo?Ms(n,e,t):ks(n,bo.memoizedState,e,t)},useTransition:function(){var e=Ho(qo)[0],t=jo().memoizedState;return["boolean"===typeof e?e:Vo(e),t]},useSyncExternalStore:Xo,useId:Ls,useHostTransitionStatus:Rs,useFormState:ps,useActionState:ps,useOptimistic:function(e,t){var n=jo();return null!==bo?ts(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Go,useCacheRefresh:Os},Ys=null,Ks=0;function Js(e){var t=Ks;return Ks+=1,null===Ys&&(Ys=[]),Jr(Ys,e,t)}function $s(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Qs(e,t){if(t.$$typeof===p)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ea(e){return(0,e._init)(e._payload)}function ta(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Bi(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=67108866,n):i:(t.flags|=67108866,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Ui(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===g?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===A&&ea(o)===t.type)?($s(t=r(t,n.props),n),t.return=e,t):($s(t=ji(n.type,n.key,n.props,null,e.mode,i),n),t.return=e,t)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gi(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,o){return null===t||7!==t.tag?((t=Vi(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Ui(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case f:return $s(n=ji(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case m:return(t=Gi(t,e.mode,n)).return=e,t;case A:return d(e,t=(0,t._init)(t._payload),n)}if(z(t)||P(t))return(t=Vi(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return d(e,Js(t),n);if(t.$$typeof===b)return d(e,Mr(e,t),n);Qs(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===r?c(e,t,n,i):null;case m:return n.key===r?u(e,t,n,i):null;case A:return p(e,t,n=(r=n._init)(n._payload),i)}if(z(n)||P(n))return null!==r?null:h(e,t,n,i,null);if("function"===typeof n.then)return p(e,t,Js(n),i);if(n.$$typeof===b)return p(e,t,Mr(e,n),i);Qs(e,n)}return null}function y(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case f:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case m:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case A:return y(e,t,n,i=(0,i._init)(i._payload),r)}if(z(i)||P(i))return h(t,e=e.get(n)||null,i,r,null);if("function"===typeof i.then)return y(e,t,n,Js(i),r);if(i.$$typeof===b)return y(e,t,n,Mr(t,i),r);Qs(t,i)}return null}function _(l,c,u,h){if("object"===typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===g){if(7===c.tag){n(l,c.sibling),(h=r(c,u.props.children)).return=l,l=h;break e}}else if(c.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===A&&ea(v)===c.type){n(l,c.sibling),$s(h=r(c,u.props),u),h.return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===g?((h=Vi(u.props.children,l.mode,h,u.key)).return=l,l=h):($s(h=ji(u.type,u.key,u.props,null,l.mode,h),u),h.return=l,l=h)}return a(l);case m:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(h=r(c,u.children||[])).return=l,l=h;break e}n(l,c);break}t(l,c),c=c.sibling}(h=Gi(u,l.mode,h)).return=l,l=h}return a(l);case A:return _(l,c,u=(v=u._init)(u._payload),h)}if(z(u))return function(r,s,a,l){for(var c=null,u=null,h=s,f=s=0,m=null;null!==h&&f<a.length;f++){h.index>f?(m=h,h=null):m=h.sibling;var g=p(r,h,a[f],l);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(r,h),s=o(g,s,f),null===u?c=g:u.sibling=g,u=g,h=m}if(f===a.length)return n(r,h),or&&Qi(r,f),c;if(null===h){for(;f<a.length;f++)null!==(h=d(r,a[f],l))&&(s=o(h,s,f),null===u?c=h:u.sibling=h,u=h);return or&&Qi(r,f),c}for(h=i(h);f<a.length;f++)null!==(m=y(h,r,f,a[f],l))&&(e&&null!==m.alternate&&h.delete(null===m.key?f:m.key),s=o(m,s,f),null===u?c=m:u.sibling=m,u=m);return e&&h.forEach(function(e){return t(r,e)}),or&&Qi(r,f),c}(l,c,u,h);if(P(u)){if("function"!==typeof(v=P(u)))throw Error(s(150));return function(r,a,l,c){if(null==l)throw Error(s(151));for(var u=null,h=null,f=a,m=a=0,g=null,_=l.next();null!==f&&!_.done;m++,_=l.next()){f.index>m?(g=f,f=null):g=f.sibling;var v=p(r,f,_.value,c);if(null===v){null===f&&(f=g);break}e&&f&&null===v.alternate&&t(r,f),a=o(v,a,m),null===h?u=v:h.sibling=v,h=v,f=g}if(_.done)return n(r,f),or&&Qi(r,m),u;if(null===f){for(;!_.done;m++,_=l.next())null!==(_=d(r,_.value,c))&&(a=o(_,a,m),null===h?u=_:h.sibling=_,h=_);return or&&Qi(r,m),u}for(f=i(f);!_.done;m++,_=l.next())null!==(_=y(f,r,m,_.value,c))&&(e&&null!==_.alternate&&f.delete(null===_.key?m:_.key),a=o(_,a,m),null===h?u=_:h.sibling=_,h=_);return e&&f.forEach(function(e){return t(r,e)}),or&&Qi(r,m),u}(l,c,u=v.call(u),h)}if("function"===typeof u.then)return _(l,c,Js(u),h);if(u.$$typeof===b)return _(l,c,Mr(l,u),h);Qs(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(h=r(c,u)).return=l,l=h):(n(l,c),(h=Ui(u,l.mode,h)).return=l,l=h),a(l)):n(l,c)}return function(e,t,n,i){try{Ks=0;var r=_(e,t,n,i);return Ys=null,r}catch(s){if(s===Wr||s===Hr)throw s;var o=Oi(29,s,null,e.mode);return o.lanes=i,o.return=e,o}}}var na=ta(!0),ia=ta(!1),ra=N(null),oa=null;function sa(e){var t=e.alternate;V(ua,1&ua.current),V(ra,e),null===oa&&(null===t||null!==fo.current||null!==t.memoizedState)&&(oa=e)}function aa(e){if(22===e.tag){if(V(ua,ua.current),V(ra,e),null===oa){var t=e.alternate;null!==t&&null!==t.memoizedState&&(oa=e)}}else la()}function la(){V(ua,ua.current),V(ra,ra.current)}function ca(e){j(ra),oa===e&&(oa=null),j(ua)}var ua=N(0);function ha(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gh(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function da(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:d({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var pa={enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Rc(),r=ro(i);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oo(e,r,i))&&(Oc(t,e,i),so(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Rc(),r=ro(i);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oo(e,r,i))&&(Oc(t,e,i),so(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Rc(),i=ro(n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=oo(e,i,n))&&(Oc(t,e,n),so(t,e,n))}};function fa(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!Kn(n,i)||!Kn(r,o))}function ma(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&pa.enqueueReplaceState(t,t.state,null)}function ga(e,t){var n=t;if("ref"in t)for(var i in n={},t)"ref"!==i&&(n[i]=t[i]);if(e=e.defaultProps)for(var r in n===t&&(n=d({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var ya="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function _a(e){ya(e)}function va(e){console.error(e)}function xa(e){ya(e)}function ba(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function wa(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function Sa(e,t,n){return(n=ro(n)).tag=3,n.payload={element:null},n.callback=function(){ba(e,t)},n}function Ta(e){return(e=ro(e)).tag=3,e}function Ea(e,t,n,i){var r=n.type.getDerivedStateFromError;if("function"===typeof r){var o=i.value;e.payload=function(){return r(o)},e.callback=function(){wa(t,n,i)}}var s=n.stateNode;null!==s&&"function"===typeof s.componentDidCatch&&(e.callback=function(){wa(t,n,i),"function"!==typeof r&&(null===Tc?Tc=new Set([this]):Tc.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var Aa=Error(s(461)),Ma=!1;function ka(e,t,n,i){t.child=null===e?ia(t,null,n,i):na(t,e.child,n,i)}function Ca(e,t,n,i,r){n=n.render;var o=t.ref;if("ref"in i){var s={};for(var a in i)"ref"!==a&&(s[a]=i[a])}else s=i;return Er(t),i=Do(e,t,n,s,o,r),a=Oo(),null===e||Ma?(or&&a&&tr(t),t.flags|=1,ka(e,t,i,r),t.child):(Fo(e,t,r),Ya(e,t,r))}function Pa(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Fi(o)||void 0!==o.defaultProps||null!==n.compare?((e=ji(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ia(e,t,o,i,r))}if(o=e.child,!Ka(e,r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:Kn)(s,i)&&e.ref===t.ref)return Ya(e,t,r)}return t.flags|=1,(e=Bi(o,i)).ref=t.ref,e.return=t,t.child=e}function Ia(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(Kn(o,i)&&e.ref===t.ref){if(Ma=!1,t.pendingProps=i=o,!Ka(e,r))return t.lanes=e.lanes,Ya(e,t,r);0!==(131072&e.flags)&&(Ma=!0)}}return La(e,t,n,i,r)}function Da(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode){if(0!==(128&t.flags)){if(i=null!==o?o.baseLanes|n:n,null!==e){for(r=t.child=e.child,o=0;null!==r;)o=o|r.lanes|r.childLanes,r=r.sibling;t.childLanes=o&~i}else t.childLanes=0,t.child=null;return za(e,t,i,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,za(e,t,null!==o?o.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Gr(0,null!==o?o.cachePool:null),null!==o?go(t,o):yo(),aa(t)}else null!==o?(Gr(0,o.cachePool),go(t,o),la(),t.memoizedState=null):(null!==e&&Gr(0,null),yo(),la());return ka(e,t,r,n),t.child}function za(e,t,n,i){var r=Ur();return r=null===r?null:{parent:Dr._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Gr(0,null),yo(),aa(t),null!==e&&Sr(e,t,i,!0),null}function Ra(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(s(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function La(e,t,n,i,r){return Er(t),n=Do(e,t,n,i,void 0,r),i=Oo(),null===e||Ma?(or&&i&&tr(t),t.flags|=1,ka(e,t,n,r),t.child):(Fo(e,t,r),Ya(e,t,r))}function Oa(e,t,n,i,r,o){return Er(t),t.updateQueue=null,n=Ro(t,i,n,r),zo(e),i=Oo(),null===e||Ma?(or&&i&&tr(t),t.flags|=1,ka(e,t,n,o),t.child):(Fo(e,t,o),Ya(e,t,o))}function Fa(e,t,n,i,r){if(Er(t),null===t.stateNode){var o=Ri,s=n.contextType;"object"===typeof s&&null!==s&&(o=Ar(s)),o=new n(i,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=pa,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=i,o.state=t.memoizedState,o.refs={},no(t),s=n.contextType,o.context="object"===typeof s&&null!==s?Ar(s):Ri,o.state=t.memoizedState,"function"===typeof(s=n.getDerivedStateFromProps)&&(da(t,n,s,i),o.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(s=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),s!==o.state&&pa.enqueueReplaceState(o,o.state,null),uo(t,i,o,r),co(),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){o=t.stateNode;var a=t.memoizedProps,l=ga(n,a);o.props=l;var c=o.context,u=n.contextType;s=Ri,"object"===typeof u&&null!==u&&(s=Ar(u));var h=n.getDerivedStateFromProps;u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate,a=t.pendingProps!==a,u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a||c!==s)&&ma(t,o,i,s),to=!1;var d=t.memoizedState;o.state=d,uo(t,i,o,r),co(),c=t.memoizedState,a||d!==c||to?("function"===typeof h&&(da(t,n,h,i),c=t.memoizedState),(l=to||fa(t,n,l,i,d,c,s))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),o.props=i,o.state=c,o.context=s,i=l):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,io(e,t),u=ga(n,s=t.memoizedProps),o.props=u,h=t.pendingProps,d=o.context,c=n.contextType,l=Ri,"object"===typeof c&&null!==c&&(l=Ar(c)),(c="function"===typeof(a=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&ma(t,o,i,l),to=!1,d=t.memoizedState,o.state=d,uo(t,i,o,r),co();var p=t.memoizedState;s!==h||d!==p||to||null!==e&&null!==e.dependencies&&Tr(e.dependencies)?("function"===typeof a&&(da(t,n,a,i),p=t.memoizedState),(u=to||fa(t,n,u,i,d,p,l)||null!==e&&null!==e.dependencies&&Tr(e.dependencies))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),o.props=i,o.state=p,o.context=l,i=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return o=i,Ra(e,t),i=0!==(128&t.flags),o||i?(o=t.stateNode,n=i&&"function"!==typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&i?(t.child=na(t,e.child,null,r),t.child=na(t,null,n,r)):ka(e,t,n,r),t.memoizedState=o.state,e=t.child):e=Ya(e,t,r),e}function Ba(e,t,n,i){return pr(),t.flags|=256,ka(e,t,n,i),t.child}var Na={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ja(e){return{baseLanes:e,cachePool:qr()}}function Va(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=gc),e}function Ua(e,t,n){var i,r=t.pendingProps,o=!1,a=0!==(128&t.flags);if((i=a)||(i=(null===e||null!==e.memoizedState)&&0!==(2&ua.current)),i&&(o=!0,t.flags&=-129),i=0!==(32&t.flags),t.flags&=-33,null===e){if(or){if(o?sa(t):la(),or){var l,c=rr;if(l=c){e:{for(l=c,c=ar;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=yh(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Ki?{id:Ji,overflow:$i}:null,retryLane:536870912,hydrationErrors:null},(l=Oi(18,null,null,0)).stateNode=c,l.return=t,t.child=l,ir=t,rr=null,l=!0):l=!1}l||cr(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return gh(c)?t.lanes=32:t.lanes=536870912,null;ca(t)}return c=r.children,r=r.fallback,o?(la(),c=qa({mode:"hidden",children:c},o=t.mode),r=Vi(r,o,n,null),c.return=t,r.return=t,c.sibling=r,t.child=c,(o=t.child).memoizedState=ja(n),o.childLanes=Va(e,i,n),t.memoizedState=Na,r):(sa(t),Ga(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(a)256&t.flags?(sa(t),t.flags&=-257,t=Wa(e,t,n)):null!==t.memoizedState?(la(),t.child=e.child,t.flags|=128,t=null):(la(),o=r.fallback,c=t.mode,r=qa({mode:"visible",children:r.children},c),(o=Vi(o,c,n,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,na(t,e.child,null,n),(r=t.child).memoizedState=ja(n),r.childLanes=Va(e,i,n),t.memoizedState=Na,t=o);else if(sa(t),gh(c)){if(i=c.nextSibling&&c.nextSibling.dataset)var u=i.dgst;i=u,(r=Error(s(419))).stack="",r.digest=i,mr({value:r,source:null,stack:null}),t=Wa(e,t,n)}else if(Ma||Sr(e,t,n,!1),i=0!==(n&e.childLanes),Ma||i){if(null!==(i=ic)&&(0!==(r=0!==((r=0!==(42&(r=n&-n))?1:ke(r))&(i.suspendedLanes|n))?0:r)&&r!==l.retryLane))throw l.retryLane=r,Ii(e,r),Oc(i,e,r),Aa;"$?"===c.data||Hc(),t=Wa(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,rr=yh(c.nextSibling),ir=t,or=!0,sr=null,ar=!1,null!==e&&(Xi[Yi++]=Ji,Xi[Yi++]=$i,Xi[Yi++]=Ki,Ji=e.id,$i=e.overflow,Ki=t),(t=Ga(t,r.children)).flags|=4096);return t}return o?(la(),o=r.fallback,c=t.mode,u=(l=e.child).sibling,(r=Bi(l,{mode:"hidden",children:r.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?o=Bi(u,o):(o=Vi(o,c,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,null===(c=e.child.memoizedState)?c=ja(n):(null!==(l=c.cachePool)?(u=Dr._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=qr(),c={baseLanes:c.baseLanes|n,cachePool:l}),o.memoizedState=c,o.childLanes=Va(e,i,n),t.memoizedState=Na,r):(sa(t),e=(n=e.child).sibling,(n=Bi(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function Ga(e,t){return(t=qa({mode:"visible",children:t},e.mode)).return=e,e.child=t}function qa(e,t){return(e=Oi(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Wa(e,t,n){return na(t,e.child,null,n),(e=Ga(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Za(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),br(e.return,t,n)}function Ha(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Xa(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(ka(e,t,i.children,n),0!==(2&(i=ua.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Za(e,n,t);else if(19===e.tag)Za(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(V(ua,i),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ha(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ha(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ha(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ha(t,!0,n,null,o);break;case"together":Ha(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ya(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),pc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Sr(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Bi(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Bi(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ka(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Tr(e))}function Ja(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ma=!0;else{if(!Ka(e,n)&&0===(128&t.flags))return Ma=!1,function(e,t,n){switch(t.tag){case 3:Z(t,t.stateNode.containerInfo),vr(0,Dr,e.memoizedState.cache),pr();break;case 27:case 5:X(t);break;case 4:Z(t,t.stateNode.containerInfo);break;case 10:vr(0,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(sa(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Ua(e,t,n):(sa(t),null!==(e=Ya(e,t,n))?e.sibling:null);sa(t);break;case 19:var r=0!==(128&e.flags);if((i=0!==(n&t.childLanes))||(Sr(e,t,n,!1),i=0!==(n&t.childLanes)),r){if(i)return Xa(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),V(ua,ua.current),i)break;return null;case 22:case 23:return t.lanes=0,Da(e,t,n);case 24:vr(0,Dr,e.memoizedState.cache)}return Ya(e,t,n)}(e,t,n);Ma=0!==(131072&e.flags)}else Ma=!1,or&&0!==(1048576&t.flags)&&er(t,Hi,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,r=i._init;if(i=r(i._payload),t.type=i,"function"!==typeof i){if(void 0!==i&&null!==i){if((r=i.$$typeof)===w){t.tag=11,t=Ca(null,t,i,e,n);break e}if(r===E){t.tag=14,t=Pa(null,t,i,e,n);break e}}throw t=D(i)||i,Error(s(306,t,""))}Fi(i)?(e=ga(i,e),t.tag=1,t=Fa(null,t,i,e,n)):(t.tag=0,t=La(null,t,i,e,n))}return t;case 0:return La(e,t,t.type,t.pendingProps,n);case 1:return Fa(e,t,i=t.type,r=ga(i,t.pendingProps),n);case 3:e:{if(Z(t,t.stateNode.containerInfo),null===e)throw Error(s(387));i=t.pendingProps;var o=t.memoizedState;r=o.element,io(e,t),uo(t,i,null,n);var a=t.memoizedState;if(i=a.cache,vr(0,Dr,i),i!==o.cache&&wr(t,[Dr],n,!0),co(),i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ba(e,t,i,n);break e}if(i!==r){mr(r=Ti(Error(s(424)),t)),t=Ba(e,t,i,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(rr=yh(e.firstChild),ir=t,or=!0,sr=null,ar=!0,n=ia(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pr(),i===r){t=Ya(e,t,n);break e}ka(e,t,i,n)}t=t.child}return t;case 26:return Ra(e,t),null===e?(n=kh(t.type,null,t.pendingProps,null))?t.memoizedState=n:or||(n=t.type,e=t.pendingProps,(i=ih(q.current).createElement(n))[De]=t,i[ze]=e,eh(i,n,e),We(i),t.stateNode=i):t.memoizedState=kh(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&or&&(i=t.stateNode=xh(t.type,t.pendingProps,q.current),ir=t,ar=!0,r=rr,ph(t.type)?(_h=r,rr=yh(i.firstChild)):rr=r),ka(e,t,t.pendingProps.children,n),Ra(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&or&&((r=i=rr)&&(null!==(i=function(e,t,n,i){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[Ne])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==r.rel||e.getAttribute("href")!==(null==r.href||""===r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===o)return e}if(null===(e=yh(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,ar))?(t.stateNode=i,ir=t,rr=yh(i.firstChild),ar=!1,r=!0):r=!1),r||cr(t)),X(t),r=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,i=o.children,sh(r,o)?i=null:null!==a&&sh(r,a)&&(t.flags|=32),null!==t.memoizedState&&(r=Do(e,t,Lo,null,null,n),Xh._currentValue=r),Ra(e,t),ka(e,t,i,n),t.child;case 6:return null===e&&or&&((e=n=rr)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=yh(e.nextSibling)))return null}return e}(n,t.pendingProps,ar))?(t.stateNode=n,ir=t,rr=null,e=!0):e=!1),e||cr(t)),null;case 13:return Ua(e,t,n);case 4:return Z(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=na(t,null,i,n):ka(e,t,i,n),t.child;case 11:return Ca(e,t,t.type,t.pendingProps,n);case 7:return ka(e,t,t.pendingProps,n),t.child;case 8:case 12:return ka(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,vr(0,t.type,i.value),ka(e,t,i.children,n),t.child;case 9:return r=t.type._context,i=t.pendingProps.children,Er(t),i=i(r=Ar(r)),t.flags|=1,ka(e,t,i,n),t.child;case 14:return Pa(e,t,t.type,t.pendingProps,n);case 15:return Ia(e,t,t.type,t.pendingProps,n);case 19:return Xa(e,t,n);case 31:return i=t.pendingProps,n=t.mode,i={mode:i.mode,children:i.children},null===e?((n=qa(i,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Bi(e.child,i)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Da(e,t,n);case 24:return Er(t),i=Ar(Dr),null===e?(null===(r=Ur())&&(r=ic,o=zr(),r.pooledCache=o,o.refCount++,null!==o&&(r.pooledCacheLanes|=n),r=o),t.memoizedState={parent:i,cache:r},no(t),vr(0,Dr,r)):(0!==(e.lanes&n)&&(io(e,t),uo(t,null,null,n),co()),r=e.memoizedState,o=t.memoizedState,r.parent!==i?(r={parent:i,cache:i},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),vr(0,Dr,i)):(i=o.cache,vr(0,Dr,i),i!==r.cache&&wr(t,[Dr],n,!0))),ka(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function $a(e){e.flags|=4}function Qa(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Vh(t)){if(null!==(t=ra.current)&&((4194048&oc)===oc?null!==oa:(62914560&oc)!==oc&&0===(536870912&oc)||t!==oa))throw $r=Xr,Zr;e.flags|=8192}}function el(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Se():536870912,e.lanes|=t,yc|=t)}function tl(e,t){if(!or)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function nl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=65011712&r.subtreeFlags,i|=65011712&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function il(e,t,n){var i=t.pendingProps;switch(nr(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),xr(Dr),H(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(dr(t)?$a(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,fr())),nl(t),null;case 26:return n=t.memoizedState,null===e?($a(t),null!==n?(nl(t),Qa(t,n)):(nl(t),t.flags&=-16777217)):n?n!==e.memoizedState?($a(t),nl(t),Qa(t,n)):(nl(t),t.flags&=-16777217):(e.memoizedProps!==i&&$a(t),nl(t),t.flags&=-16777217),null;case 27:Y(t),n=q.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&$a(t);else{if(!i){if(null===t.stateNode)throw Error(s(166));return nl(t),null}e=U.current,dr(t)?ur(t):(e=xh(r,i,n),t.stateNode=e,$a(t))}return nl(t),null;case 5:if(Y(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&$a(t);else{if(!i){if(null===t.stateNode)throw Error(s(166));return nl(t),null}if(e=U.current,dr(t))ur(t);else{switch(r=ih(q.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof i.is?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"===typeof i.is?r.createElement(n,{is:i.is}):r.createElement(n)}}e[De]=t,e[ze]=i;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(eh(e,n,i),n){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&$a(t)}}return nl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&$a(t);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(e=q.current,dr(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(r=ir))switch(r.tag){case 27:case 5:i=r.memoizedProps}e[De]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Ku(e.nodeValue,n)))||cr(t)}else(e=ih(e).createTextNode(i))[De]=t,t.stateNode=e}return nl(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=dr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!r)throw Error(s(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(s(317));r[De]=t}else pr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nl(t),r=!1}else r=fr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(ca(t),t):(ca(t),null)}if(ca(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){r=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(r=i.alternate.memoizedState.cachePool.pool);var o=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(o=i.memoizedState.cachePool.pool),o!==r&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),el(t,t.updateQueue),nl(t),null;case 4:return H(),null===e&&ju(t.stateNode.containerInfo),nl(t),null;case 10:return xr(t.type),nl(t),null;case 19:if(j(ua),null===(r=t.memoizedState))return nl(t),null;if(i=0!==(128&t.flags),null===(o=r.rendering))if(i)tl(r,!1);else{if(0!==dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=ha(e))){for(t.flags|=128,tl(r,!1),e=o.updateQueue,t.updateQueue=e,el(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ni(n,e),n=n.sibling;return V(ua,1&ua.current|2),t.child}e=e.sibling}null!==r.tail&&te()>wc&&(t.flags|=128,i=!0,tl(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ha(o))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,el(t,e),tl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!or)return nl(t),null}else 2*te()-r.renderingStartTime>wc&&536870912!==n&&(t.flags|=128,i=!0,tl(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=r.last)?e.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=te(),t.sibling=null,e=ua.current,V(ua,i?1&e|2:1&e),t):(nl(t),null);case 22:case 23:return ca(t),_o(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?0!==(536870912&n)&&0===(128&t.flags)&&(nl(t),6&t.subtreeFlags&&(t.flags|=8192)):nl(t),null!==(n=t.updateQueue)&&el(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&j(Vr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),xr(Dr),nl(t),null;case 25:case 30:return null}throw Error(s(156,t.tag))}function rl(e,t){switch(nr(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return xr(Dr),H(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Y(t),null;case 13:if(ca(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));pr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return j(ua),null;case 4:return H(),null;case 10:return xr(t.type),null;case 22:case 23:return ca(t),_o(),null!==e&&j(Vr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return xr(Dr),null;default:return null}}function ol(e,t){switch(nr(t),t.tag){case 3:xr(Dr),H();break;case 26:case 27:case 5:Y(t);break;case 4:H();break;case 13:ca(t);break;case 19:j(ua);break;case 10:xr(t.type);break;case 22:case 23:ca(t),_o(),null!==e&&j(Vr);break;case 24:xr(Dr)}}function sl(e,t){try{var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next;n=r;do{if((n.tag&e)===e){i=void 0;var o=n.create,s=n.inst;i=o(),s.destroy=i}n=n.next}while(n!==r)}}catch(a){uu(t,t.return,a)}}function al(e,t,n){try{var i=t.updateQueue,r=null!==i?i.lastEffect:null;if(null!==r){var o=r.next;i=o;do{if((i.tag&e)===e){var s=i.inst,a=s.destroy;if(void 0!==a){s.destroy=void 0,r=t;var l=n,c=a;try{c()}catch(u){uu(r,l,u)}}}i=i.next}while(i!==o)}}catch(u){uu(t,t.return,u)}}function ll(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{po(t,n)}catch(i){uu(e,e.return,i)}}}function cl(e,t,n){n.props=ga(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(i){uu(e,t,i)}}function ul(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;default:i=e.stateNode}"function"===typeof n?e.refCleanup=n(i):n.current=i}}catch(r){uu(e,t,r)}}function hl(e,t){var n=e.ref,i=e.refCleanup;if(null!==n)if("function"===typeof i)try{i()}catch(r){uu(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(o){uu(e,t,o)}else n.current=null}function dl(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(r){uu(e,e.return,r)}}function pl(e,t,n){try{var i=e.stateNode;!function(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,o=null,a=null,l=null,c=null,u=null,h=null;for(f in n){var d=n[f];if(n.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":c=d;default:i.hasOwnProperty(f)||$u(e,t,f,null,i,d)}}for(var p in i){var f=i[p];if(d=n[p],i.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":o=f;break;case"name":r=f;break;case"checked":u=f;break;case"defaultChecked":h=f;break;case"value":a=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(s(137,t));break;default:f!==d&&$u(e,t,p,f,i,d)}}return void gt(e,a,l,c,u,h,o,r);case"select":for(o in f=a=l=p=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":f=c;default:i.hasOwnProperty(o)||$u(e,t,o,null,i,c)}for(r in i)if(o=i[r],c=n[r],i.hasOwnProperty(r)&&(null!=o||null!=c))switch(r){case"value":p=o;break;case"defaultValue":l=o;break;case"multiple":a=o;default:o!==c&&$u(e,t,r,o,i,c)}return t=l,n=a,i=f,void(null!=p?vt(e,!!n,p,!1):!!i!==!!n&&(null!=t?vt(e,!!n,t,!0):vt(e,!!n,n?[]:"",!1)));case"textarea":for(l in f=p=null,n)if(r=n[l],n.hasOwnProperty(l)&&null!=r&&!i.hasOwnProperty(l))switch(l){case"value":case"children":break;default:$u(e,t,l,null,i,r)}for(a in i)if(r=i[a],o=n[a],i.hasOwnProperty(a)&&(null!=r||null!=o))switch(a){case"value":p=r;break;case"defaultValue":f=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(s(91));break;default:r!==o&&$u(e,t,a,r,i,o)}return void xt(e,p,f);case"option":for(var m in n)if(p=n[m],n.hasOwnProperty(m)&&null!=p&&!i.hasOwnProperty(m))if("selected"===m)e.selected=!1;else $u(e,t,m,null,i,p);for(c in i)if(p=i[c],f=n[c],i.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))if("selected"===c)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else $u(e,t,c,p,i,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!i.hasOwnProperty(g)&&$u(e,t,g,null,i,p);for(u in i)if(p=i[u],f=n[u],i.hasOwnProperty(u)&&p!==f&&(null!=p||null!=f))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(s(137,t));break;default:$u(e,t,u,p,i,f)}return;default:if(At(t)){for(var y in n)p=n[y],n.hasOwnProperty(y)&&void 0!==p&&!i.hasOwnProperty(y)&&Qu(e,t,y,void 0,i,p);for(h in i)p=i[h],f=n[h],!i.hasOwnProperty(h)||p===f||void 0===p&&void 0===f||Qu(e,t,h,p,i,f);return}}for(var _ in n)p=n[_],n.hasOwnProperty(_)&&null!=p&&!i.hasOwnProperty(_)&&$u(e,t,_,null,i,p);for(d in i)p=i[d],f=n[d],!i.hasOwnProperty(d)||p===f||null==p&&null==f||$u(e,t,d,p,i,f)}(i,e.type,n,t),i[ze]=t}catch(r){uu(e,e.return,r)}}function fl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&ph(e.type)||4===e.tag}function ml(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||fl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&ph(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Ju));else if(4!==i&&(27===i&&ph(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(gl(e,t,n),e=e.sibling;null!==e;)gl(e,t,n),e=e.sibling}function yl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&(27===i&&ph(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(yl(e,t,n),e=e.sibling;null!==e;)yl(e,t,n),e=e.sibling}function _l(e){var t=e.stateNode,n=e.memoizedProps;try{for(var i=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);eh(t,i,n),t[De]=e,t[ze]=n}catch(o){uu(e,e.return,o)}}var vl=!1,xl=!1,bl=!1,wl="function"===typeof WeakSet?WeakSet:Set,Sl=null;function Tl(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:Fl(e,n),4&i&&sl(5,n);break;case 1:if(Fl(e,n),4&i)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){uu(n,n.return,s)}else{var r=ga(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(a){uu(n,n.return,a)}}64&i&&ll(n),512&i&&ul(n,n.return);break;case 3:if(Fl(e,n),64&i&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{po(e,t)}catch(s){uu(n,n.return,s)}}break;case 27:null===t&&4&i&&_l(n);case 26:case 5:Fl(e,n),null===t&&4&i&&dl(n),512&i&&ul(n,n.return);break;case 12:Fl(e,n);break;case 13:Fl(e,n),4&i&&Pl(e,n),64&i&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var i=function(){t(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}(e,n=fu.bind(null,n))));break;case 22:if(!(i=null!==n.memoizedState||vl)){t=null!==t&&null!==t.memoizedState||xl,r=vl;var o=xl;vl=i,(xl=t)&&!o?Nl(e,n,0!==(8772&n.subtreeFlags)):Fl(e,n),vl=r,xl=o}break;case 30:break;default:Fl(e,n)}}function El(e){var t=e.alternate;null!==t&&(e.alternate=null,El(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&je(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Al=null,Ml=!1;function kl(e,t,n){for(n=n.child;null!==n;)Cl(e,t,n),n=n.sibling}function Cl(e,t,n){if(he&&"function"===typeof he.onCommitFiberUnmount)try{he.onCommitFiberUnmount(ue,n)}catch(o){}switch(n.tag){case 26:xl||hl(n,t),kl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:xl||hl(n,t);var i=Al,r=Ml;ph(n.type)&&(Al=n.stateNode,Ml=!1),kl(e,t,n),bh(n.stateNode),Al=i,Ml=r;break;case 5:xl||hl(n,t);case 6:if(i=Al,r=Ml,Al=null,kl(e,t,n),Ml=r,null!==(Al=i))if(Ml)try{(9===Al.nodeType?Al.body:"HTML"===Al.nodeName?Al.ownerDocument.body:Al).removeChild(n.stateNode)}catch(s){uu(n,t,s)}else try{Al.removeChild(n.stateNode)}catch(s){uu(n,t,s)}break;case 18:null!==Al&&(Ml?(fh(9===(e=Al).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Md(e)):fh(Al,n.stateNode));break;case 4:i=Al,r=Ml,Al=n.stateNode.containerInfo,Ml=!0,kl(e,t,n),Al=i,Ml=r;break;case 0:case 11:case 14:case 15:xl||al(2,n,t),xl||al(4,n,t),kl(e,t,n);break;case 1:xl||(hl(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount&&cl(n,t,i)),kl(e,t,n);break;case 21:kl(e,t,n);break;case 22:xl=(i=xl)||null!==n.memoizedState,kl(e,t,n),xl=i;break;default:kl(e,t,n)}}function Pl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Md(e)}catch(n){uu(t,t.return,n)}}function Il(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new wl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new wl),t;default:throw Error(s(435,e.tag))}}(e);t.forEach(function(t){var i=mu.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}function Dl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i],o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 27:if(ph(l.type)){Al=l.stateNode,Ml=!1;break e}break;case 5:Al=l.stateNode,Ml=!1;break e;case 3:case 4:Al=l.stateNode.containerInfo,Ml=!0;break e}l=l.return}if(null===Al)throw Error(s(160));Cl(o,a,r),Al=null,Ml=!1,null!==(o=r.alternate)&&(o.return=null),r.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Rl(t,e),t=t.sibling}var zl=null;function Rl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Dl(t,e),Ll(e),4&i&&(al(3,e,e.return),sl(3,e),al(5,e,e.return));break;case 1:Dl(t,e),Ll(e),512&i&&(xl||null===n||hl(n,n.return)),64&i&&vl&&(null!==(e=e.updateQueue)&&(null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i))));break;case 26:var r=zl;if(Dl(t,e),Ll(e),512&i&&(xl||null===n||hl(n,n.return)),4&i){var o=null!==n?n.memoizedState:null;if(i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(i){case"title":(!(o=r.getElementsByTagName("title")[0])||o[Ne]||o[De]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=r.createElement(i),r.head.insertBefore(o,r.querySelector("head > title"))),eh(o,i,n),o[De]=e,We(o),i=o;break e;case"link":var a=Nh("link","href",r).get(i+(n.href||""));if(a)for(var l=0;l<a.length;l++)if((o=a[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){a.splice(l,1);break t}eh(o=r.createElement(i),i,n),r.head.appendChild(o);break;case"meta":if(a=Nh("meta","content",r).get(i+(n.content||"")))for(l=0;l<a.length;l++)if((o=a[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){a.splice(l,1);break t}eh(o=r.createElement(i),i,n),r.head.appendChild(o);break;default:throw Error(s(468,i))}o[De]=e,We(o),i=o}e.stateNode=i}else jh(r,e.type,e.stateNode);else e.stateNode=Rh(r,i,e.memoizedProps);else o!==i?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===i?jh(r,e.type,e.stateNode):Rh(r,i,e.memoizedProps)):null===i&&null!==e.stateNode&&pl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Dl(t,e),Ll(e),512&i&&(xl||null===n||hl(n,n.return)),null!==n&&4&i&&pl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Dl(t,e),Ll(e),512&i&&(xl||null===n||hl(n,n.return)),32&e.flags){r=e.stateNode;try{wt(r,"")}catch(f){uu(e,e.return,f)}}4&i&&null!=e.stateNode&&pl(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&i&&(bl=!0);break;case 6:if(Dl(t,e),Ll(e),4&i){if(null===e.stateNode)throw Error(s(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(f){uu(e,e.return,f)}}break;case 3:if(Bh=null,r=zl,zl=Th(t.containerInfo),Dl(t,e),zl=r,Ll(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Md(t.containerInfo)}catch(f){uu(e,e.return,f)}bl&&(bl=!1,Ol(e));break;case 4:i=zl,zl=Th(e.stateNode.containerInfo),Dl(t,e),Ll(e),zl=i;break;case 12:default:Dl(t,e),Ll(e);break;case 13:Dl(t,e),Ll(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(bc=te()),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Il(e,i)));break;case 22:r=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=vl,h=xl;if(vl=u||r,xl=h||c,Dl(t,e),xl=h,vl=u,Ll(e),8192&i)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===n||c||vl||xl||Bl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,r)"function"===typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,p=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(f){uu(c,c.return,f)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=r?"":c.memoizedProps}catch(f){uu(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&(null!==(i=e.updateQueue)&&(null!==(n=i.retryQueue)&&(i.retryQueue=null,Il(e,n))));break;case 19:Dl(t,e),Ll(e),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Il(e,i)));case 30:case 21:}}function Ll(e){var t=e.flags;if(2&t){try{for(var n,i=e.return;null!==i;){if(fl(i)){n=i;break}i=i.return}if(null==n)throw Error(s(160));switch(n.tag){case 27:var r=n.stateNode;yl(e,ml(e),r);break;case 5:var o=n.stateNode;32&n.flags&&(wt(o,""),n.flags&=-33),yl(e,ml(e),o);break;case 3:case 4:var a=n.stateNode.containerInfo;gl(e,ml(e),a);break;default:throw Error(s(161))}}catch(l){uu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ol(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ol(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Fl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Tl(e,t.alternate,t),t=t.sibling}function Bl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:al(4,t,t.return),Bl(t);break;case 1:hl(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&cl(t,t.return,n),Bl(t);break;case 27:bh(t.stateNode);case 26:case 5:hl(t,t.return),Bl(t);break;case 22:null===t.memoizedState&&Bl(t);break;default:Bl(t)}e=e.sibling}}function Nl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var i=t.alternate,r=e,o=t,s=o.flags;switch(o.tag){case 0:case 11:case 15:Nl(r,o,n),sl(4,o);break;case 1:if(Nl(r,o,n),"function"===typeof(r=(i=o).stateNode).componentDidMount)try{r.componentDidMount()}catch(c){uu(i,i.return,c)}if(null!==(r=(i=o).updateQueue)){var a=i.stateNode;try{var l=r.shared.hiddenCallbacks;if(null!==l)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)ho(l[r],a)}catch(c){uu(i,i.return,c)}}n&&64&s&&ll(o),ul(o,o.return);break;case 27:_l(o);case 26:case 5:Nl(r,o,n),n&&null===i&&4&s&&dl(o),ul(o,o.return);break;case 12:Nl(r,o,n);break;case 13:Nl(r,o,n),n&&4&s&&Pl(r,o);break;case 22:null===o.memoizedState&&Nl(r,o,n),ul(o,o.return);break;case 30:break;default:Nl(r,o,n)}t=t.sibling}}function jl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Rr(n))}function Vl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Rr(e))}function Ul(e,t,n,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Gl(e,t,n,i),t=t.sibling}function Gl(e,t,n,i){var r=t.flags;switch(t.tag){case 0:case 11:case 15:Ul(e,t,n,i),2048&r&&sl(9,t);break;case 1:case 13:default:Ul(e,t,n,i);break;case 3:Ul(e,t,n,i),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Rr(e)));break;case 12:if(2048&r){Ul(e,t,n,i),e=t.stateNode;try{var o=t.memoizedProps,s=o.id,a=o.onPostCommit;"function"===typeof a&&a(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){uu(t,t.return,l)}}else Ul(e,t,n,i);break;case 23:break;case 22:o=t.stateNode,s=t.alternate,null!==t.memoizedState?2&o._visibility?Ul(e,t,n,i):Wl(e,t):2&o._visibility?Ul(e,t,n,i):(o._visibility|=2,ql(e,t,n,i,0!==(10256&t.subtreeFlags))),2048&r&&jl(s,t);break;case 24:Ul(e,t,n,i),2048&r&&Vl(t.alternate,t)}}function ql(e,t,n,i,r){for(r=r&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var o=e,s=t,a=n,l=i,c=s.flags;switch(s.tag){case 0:case 11:case 15:ql(o,s,a,l,r),sl(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?ql(o,s,a,l,r):Wl(o,s):(u._visibility|=2,ql(o,s,a,l,r)),r&&2048&c&&jl(s.alternate,s);break;case 24:ql(o,s,a,l,r),r&&2048&c&&Vl(s.alternate,s);break;default:ql(o,s,a,l,r)}t=t.sibling}}function Wl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,i=t,r=i.flags;switch(i.tag){case 22:Wl(n,i),2048&r&&jl(i.alternate,i);break;case 24:Wl(n,i),2048&r&&Vl(i.alternate,i);break;default:Wl(n,i)}t=t.sibling}}var Zl=8192;function Hl(e){if(e.subtreeFlags&Zl)for(e=e.child;null!==e;)Xl(e),e=e.sibling}function Xl(e){switch(e.tag){case 26:Hl(e),e.flags&Zl&&null!==e.memoizedState&&function(e,t,n){if(null===Uh)throw Error(s(475));var i=Uh;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var r=Ch(n.href),o=e.querySelector(Ph(r));if(o)return null!==(e=o._p)&&"object"===typeof e&&"function"===typeof e.then&&(i.count++,i=qh.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=o,void We(o);o=e.ownerDocument||e,n=Ih(n),(r=wh.get(r))&&Oh(n,r),We(o=o.createElement("link"));var a=o;a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),eh(o,"link",n),t.instance=o}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(i.count++,t=qh.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(zl,e.memoizedState,e.memoizedProps);break;case 5:default:Hl(e);break;case 3:case 4:var t=zl;zl=Th(e.stateNode.containerInfo),Hl(e),zl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Zl,Zl=16777216,Hl(e),Zl=t):Hl(e))}}function Yl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Kl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];Sl=i,Ql(i,e)}Yl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Jl(e),e=e.sibling}function Jl(e){switch(e.tag){case 0:case 11:case 15:Kl(e),2048&e.flags&&al(9,e,e.return);break;case 3:case 12:default:Kl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,$l(e)):Kl(e)}}function $l(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];Sl=i,Ql(i,e)}Yl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:al(8,t,t.return),$l(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,$l(t));break;default:$l(t)}e=e.sibling}}function Ql(e,t){for(;null!==Sl;){var n=Sl;switch(n.tag){case 0:case 11:case 15:al(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:Rr(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,Sl=i;else e:for(n=e;null!==Sl;){var r=(i=Sl).sibling,o=i.return;if(El(i),i===n){Sl=null;break e}if(null!==r){r.return=o,Sl=r;break e}Sl=o}}}var ec={getCacheForType:function(e){var t=Ar(Dr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tc="function"===typeof WeakMap?WeakMap:Map,nc=0,ic=null,rc=null,oc=0,sc=0,ac=null,lc=!1,cc=!1,uc=!1,hc=0,dc=0,pc=0,fc=0,mc=0,gc=0,yc=0,_c=null,vc=null,xc=!1,bc=0,wc=1/0,Sc=null,Tc=null,Ec=0,Ac=null,Mc=null,kc=0,Cc=0,Pc=null,Ic=null,Dc=0,zc=null;function Rc(){if(0!==(2&nc)&&0!==oc)return oc&-oc;if(null!==R.T){return 0!==Fr?Fr:Cu()}return Pe()}function Lc(){0===gc&&(gc=0===(536870912&oc)||or?we():536870912);var e=ra.current;return null!==e&&(e.flags|=32),gc}function Oc(e,t,n){(e!==ic||2!==sc&&9!==sc)&&null===e.cancelPendingCommit||(Gc(e,0),jc(e,oc,gc,!1)),Ee(e,n),0!==(2&nc)&&e===ic||(e===ic&&(0===(2&nc)&&(fc|=n),4===dc&&jc(e,oc,gc,!1)),wu(e))}function Fc(e,t,n){if(0!==(6&nc))throw Error(s(327));for(var i=!n&&0===(124&t)&&0===(t&e.expiredLanes)||xe(e,t),r=i?function(e,t){var n=nc;nc|=2;var i=Wc(),r=Zc();ic!==e||oc!==t?(Sc=null,wc=te()+500,Gc(e,t)):cc=xe(e,t);e:for(;;)try{if(0!==sc&&null!==rc){t=rc;var o=ac;t:switch(sc){case 1:sc=0,ac=null,Qc(e,t,o,1);break;case 2:case 9:if(Yr(o)){sc=0,ac=null,$c(t);break}t=function(){2!==sc&&9!==sc||ic!==e||(sc=7),wu(e)},o.then(t,t);break e;case 3:sc=7;break e;case 4:sc=5;break e;case 7:Yr(o)?(sc=0,ac=null,$c(t)):(sc=0,ac=null,Qc(e,t,o,7));break;case 5:var a=null;switch(rc.tag){case 26:a=rc.memoizedState;case 5:case 27:var l=rc;if(!a||Vh(a)){sc=0,ac=null;var c=l.sibling;if(null!==c)rc=c;else{var u=l.return;null!==u?(rc=u,eu(u)):rc=null}break t}}sc=0,ac=null,Qc(e,t,o,5);break;case 6:sc=0,ac=null,Qc(e,t,o,6);break;case 8:Uc(),dc=6;break e;default:throw Error(s(462))}}Kc();break}catch(h){qc(e,h)}return _r=yr=null,R.H=i,R.A=r,nc=n,null!==rc?0:(ic=null,oc=0,ki(),dc)}(e,t):Xc(e,t,!0),o=i;;){if(0===r){cc&&!i&&jc(e,t,0,!1);break}if(n=e.current.alternate,!o||Nc(n)){if(2===r){if(o=t,e.errorRecoveryDisabledLanes&o)var a=0;else a=0!==(a=-536870913&e.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){t=a;e:{var l=e;r=_c;var c=l.current.memoizedState.isDehydrated;if(c&&(Gc(l,a).flags|=256),2!==(a=Xc(l,a,!1))){if(uc&&!c){l.errorRecoveryDisabledLanes|=o,fc|=o,r=4;break e}o=vc,vc=r,null!==o&&(null===vc?vc=o:vc.push.apply(vc,o))}r=a}if(o=!1,2!==r)continue}}if(1===r){Gc(e,0),jc(e,t,0,!0);break}e:{switch(i=e,o=r){case 0:case 1:throw Error(s(345));case 4:if((4194048&t)!==t)break;case 6:jc(i,t,gc,!lc);break e;case 2:vc=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&t)===t&&10<(r=bc+300-te())){if(jc(i,t,gc,!lc),0!==ve(i,0,!0))break e;i.timeoutHandle=lh(Bc.bind(null,i,n,vc,Sc,xc,t,gc,fc,yc,lc,o,2,-0,0),r)}else Bc(i,n,vc,Sc,xc,t,gc,fc,yc,lc,o,0,-0,0)}break}r=Xc(e,t,!1),o=!1}wu(e)}function Bc(e,t,n,i,r,o,a,l,c,u,h,d,p,f){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||16785408===(16785408&d))&&(Uh={stylesheets:null,count:0,unsuspend:Gh},Xl(t),null!==(d=function(){if(null===Uh)throw Error(s(475));var e=Uh;return e.stylesheets&&0===e.count&&Zh(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Zh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(nu.bind(null,e,t,o,n,i,r,a,l,c,h,1,p,f)),void jc(e,o,a,!u);nu(e,t,o,n,i,r,a,l,c)}function Nc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!Yn(o(),r))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function jc(e,t,n,i){t&=~mc,t&=~fc,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var r=t;0<r;){var o=31-pe(r),s=1<<o;i[o]=-1,r&=~s}0!==n&&Ae(e,n,t)}function Vc(){return 0!==(6&nc)||(Su(0,!1),!1)}function Uc(){if(null!==rc){if(0===sc)var e=rc.return;else _r=yr=null,Bo(e=rc),Ys=null,Ks=0,e=rc;for(;null!==e;)ol(e.alternate,e),e=e.return;rc=null}}function Gc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,ch(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Uc(),ic=e,rc=n=Bi(e.current,null),oc=t,sc=0,ac=null,lc=!1,cc=xe(e,t),uc=!1,yc=gc=mc=fc=pc=dc=0,vc=_c=null,xc=!1,0!==(8&t)&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var r=31-pe(i),o=1<<r;t|=e[r],i&=~o}return hc=t,ki(),n}function qc(e,t){xo=null,R.H=Ws,t===Wr||t===Hr?(t=Qr(),sc=3):t===Zr?(t=Qr(),sc=4):sc=t===Aa?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,ac=t,null===rc&&(dc=1,ba(e,Ti(t,e.current)))}function Wc(){var e=R.H;return R.H=Ws,null===e?Ws:e}function Zc(){var e=R.A;return R.A=ec,e}function Hc(){dc=4,lc||(4194048&oc)!==oc&&null!==ra.current||(cc=!0),0===(134217727&pc)&&0===(134217727&fc)||null===ic||jc(ic,oc,gc,!1)}function Xc(e,t,n){var i=nc;nc|=2;var r=Wc(),o=Zc();ic===e&&oc===t||(Sc=null,Gc(e,t)),t=!1;var s=dc;e:for(;;)try{if(0!==sc&&null!==rc){var a=rc,l=ac;switch(sc){case 8:Uc(),s=6;break e;case 3:case 2:case 9:case 6:null===ra.current&&(t=!0);var c=sc;if(sc=0,ac=null,Qc(e,a,l,c),n&&cc){s=0;break e}break;default:c=sc,sc=0,ac=null,Qc(e,a,l,c)}}Yc(),s=dc;break}catch(u){qc(e,u)}return t&&e.shellSuspendCounter++,_r=yr=null,nc=i,R.H=r,R.A=o,null===rc&&(ic=null,oc=0,ki()),s}function Yc(){for(;null!==rc;)Jc(rc)}function Kc(){for(;null!==rc&&!Q();)Jc(rc)}function Jc(e){var t=Ja(e.alternate,e,hc);e.memoizedProps=e.pendingProps,null===t?eu(e):rc=t}function $c(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Oa(n,t,t.pendingProps,t.type,void 0,oc);break;case 11:t=Oa(n,t,t.pendingProps,t.type.render,t.ref,oc);break;case 5:Bo(t);default:ol(n,t),t=Ja(n,t=rc=Ni(t,hc),hc)}e.memoizedProps=e.pendingProps,null===t?eu(e):rc=t}function Qc(e,t,n,i){_r=yr=null,Bo(t),Ys=null,Ks=0;var r=t.return;try{if(function(e,t,n,i,r){if(n.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){if(null!==(t=n.alternate)&&Sr(t,n,r,!0),null!==(n=ra.current)){switch(n.tag){case 13:return null===oa?Hc():null===n.alternate&&0===dc&&(dc=3),n.flags&=-257,n.flags|=65536,n.lanes=r,i===Xr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),hu(e,i,r)),!1;case 22:return n.flags|=65536,i===Xr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),hu(e,i,r)),!1}throw Error(s(435,n.tag))}return hu(e,i,r),Hc(),!1}if(or)return null!==(t=ra.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,i!==lr&&mr(Ti(e=Error(s(422),{cause:i}),n))):(i!==lr&&mr(Ti(t=Error(s(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,i=Ti(i,n),ao(e,r=Sa(e.stateNode,i,r)),4!==dc&&(dc=2)),!1;var o=Error(s(520),{cause:i});if(o=Ti(o,n),null===_c?_c=[o]:_c.push(o),4!==dc&&(dc=2),null===t)return!0;i=Ti(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,ao(n,e=Sa(n.stateNode,i,e)),!1;case 1:if(t=n.type,o=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==o&&"function"===typeof o.componentDidCatch&&(null===Tc||!Tc.has(o))))return n.flags|=65536,r&=-r,n.lanes|=r,Ea(r=Ta(r),e,n,i),ao(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,oc))return dc=1,ba(e,Ti(n,e.current)),void(rc=null)}catch(o){if(null!==r)throw rc=r,o;return dc=1,ba(e,Ti(n,e.current)),void(rc=null)}32768&t.flags?(or||1===i?e=!0:cc||0!==(536870912&oc)?e=!1:(lc=e=!0,(2===i||9===i||3===i||6===i)&&(null!==(i=ra.current)&&13===i.tag&&(i.flags|=16384))),tu(t,e)):eu(t)}function eu(e){var t=e;do{if(0!==(32768&t.flags))return void tu(t,lc);e=t.return;var n=il(t.alternate,t,hc);if(null!==n)return void(rc=n);if(null!==(t=t.sibling))return void(rc=t);rc=t=e}while(null!==t);0===dc&&(dc=5)}function tu(e,t){do{var n=rl(e.alternate,e);if(null!==n)return n.flags&=32767,void(rc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(rc=e);rc=e=n}while(null!==e);dc=6,rc=null}function nu(e,t,n,i,r,o,a,l,c){e.cancelPendingCommit=null;do{au()}while(0!==Ec);if(0!==(6&nc))throw Error(s(327));if(null!==t){if(t===e.current)throw Error(s(177));if(o=t.lanes|t.childLanes,function(e,t,n,i,r,o){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-pe(n),h=1<<u;a[u]=0,l[u]=-1;var d=c[u];if(null!==d)for(c[u]=null,u=0;u<d.length;u++){var p=d[u];null!==p&&(p.lane&=-536870913)}n&=~h}0!==i&&Ae(e,i,0),0!==o&&0===r&&0!==e.tag&&(e.suspendedLanes|=o&~(s&~t))}(e,n,o|=Mi,a,l,c),e===ic&&(rc=ic=null,oc=0),Mc=t,Ac=e,kc=n,Cc=o,Pc=r,Ic=i,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,J(oe,function(){return lu(),null})):(e.callbackNode=null,e.callbackPriority=0),i=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||i){i=R.T,R.T=null,r=L.p,L.p=2,a=nc,nc|=4;try{!function(e,t){if(e=e.containerInfo,th=nd,ti(e=ei(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(g){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=a+r),d!==o||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===r&&(l=a),p===o&&++h===i&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nh={focusedElem:e,selectionRange:n},nd=!1,Sl=t;null!==Sl;)if(e=(t=Sl).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,Sl=e;else for(;null!==Sl;){switch(o=(t=Sl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==o){e=void 0,n=t,r=o.memoizedProps,o=o.memoizedState,i=n.stateNode;try{var m=ga(n.type,r,(n.elementType,n.type));e=i.getSnapshotBeforeUpdate(m,o),i.__reactInternalSnapshotBeforeUpdate=e}catch(y){uu(n,n.return,y)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))mh(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":mh(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,Sl=e;break}Sl=t.return}}(e,t)}finally{nc=a,L.p=r,R.T=i}}Ec=1,iu(),ru(),ou()}}function iu(){if(1===Ec){Ec=0;var e=Ac,t=Mc,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=R.T,R.T=null;var i=L.p;L.p=2;var r=nc;nc|=4;try{Rl(t,e);var o=nh,s=ei(e.containerInfo),a=o.focusedElem,l=o.selectionRange;if(s!==a&&a&&a.ownerDocument&&Qn(a.ownerDocument.documentElement,a)){if(null!==l&&ti(a)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(u,a.value.length);else{var h=a.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var p=d.getSelection(),f=a.textContent.length,m=Math.min(l.start,f),g=void 0===l.end?m:Math.min(l.end,f);!p.extend&&m>g&&(s=g,g=m,m=s);var y=$n(a,m),_=$n(a,g);if(y&&_&&(1!==p.rangeCount||p.anchorNode!==y.node||p.anchorOffset!==y.offset||p.focusNode!==_.node||p.focusOffset!==_.offset)){var v=h.createRange();v.setStart(y.node,y.offset),p.removeAllRanges(),m>g?(p.addRange(v),p.extend(_.node,_.offset)):(v.setEnd(_.node,_.offset),p.addRange(v))}}}}for(h=[],p=a;p=p.parentNode;)1===p.nodeType&&h.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof a.focus&&a.focus(),a=0;a<h.length;a++){var x=h[a];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}nd=!!th,nh=th=null}finally{nc=r,L.p=i,R.T=n}}e.current=t,Ec=2}}function ru(){if(2===Ec){Ec=0;var e=Ac,t=Mc,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=R.T,R.T=null;var i=L.p;L.p=2;var r=nc;nc|=4;try{Tl(e,t.alternate,t)}finally{nc=r,L.p=i,R.T=n}}Ec=3}}function ou(){if(4===Ec||3===Ec){Ec=0,ee();var e=Ac,t=Mc,n=kc,i=Ic;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Ec=5:(Ec=0,Mc=Ac=null,su(e,e.pendingLanes));var r=e.pendingLanes;if(0===r&&(Tc=null),Ce(n),t=t.stateNode,he&&"function"===typeof he.onCommitFiberRoot)try{he.onCommitFiberRoot(ue,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==i){t=R.T,r=L.p,L.p=2,R.T=null;try{for(var o=e.onRecoverableError,s=0;s<i.length;s++){var a=i[s];o(a.value,{componentStack:a.stack})}}finally{R.T=t,L.p=r}}0!==(3&kc)&&au(),wu(e),r=e.pendingLanes,0!==(4194090&n)&&0!==(42&r)?e===zc?Dc++:(Dc=0,zc=e):Dc=0,Su(0,!1)}}function su(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Rr(t)))}function au(e){return iu(),ru(),ou(),lu()}function lu(){if(5!==Ec)return!1;var e=Ac,t=Cc;Cc=0;var n=Ce(kc),i=R.T,r=L.p;try{L.p=32>n?32:n,R.T=null,n=Pc,Pc=null;var o=Ac,a=kc;if(Ec=0,Mc=Ac=null,kc=0,0!==(6&nc))throw Error(s(331));var l=nc;if(nc|=4,Jl(o.current),Gl(o,o.current,a,n),nc=l,Su(0,!1),he&&"function"===typeof he.onPostCommitFiberRoot)try{he.onPostCommitFiberRoot(ue,o)}catch(c){}return!0}finally{L.p=r,R.T=i,su(e,t)}}function cu(e,t,n){t=Ti(n,t),null!==(e=oo(e,t=Sa(e.stateNode,t,2),2))&&(Ee(e,2),wu(e))}function uu(e,t,n){if(3===e.tag)cu(e,e,n);else for(;null!==t;){if(3===t.tag){cu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Tc||!Tc.has(i))){e=Ti(n,e),null!==(i=oo(t,n=Ta(2),2))&&(Ea(n,i,t,e),Ee(i,2),wu(i));break}}t=t.return}}function hu(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new tc;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(uc=!0,r.add(n),e=du.bind(null,e,t,n),t.then(e,e))}function du(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,ic===e&&(oc&n)===n&&(4===dc||3===dc&&(62914560&oc)===oc&&300>te()-bc?0===(2&nc)&&Gc(e,0):mc|=n,yc===oc&&(yc=0)),wu(e)}function pu(e,t){0===t&&(t=Se()),null!==(e=Ii(e,t))&&(Ee(e,t),wu(e))}function fu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),pu(e,n)}function mu(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==i&&i.delete(t),pu(e,n)}var gu=null,yu=null,_u=!1,vu=!1,xu=!1,bu=0;function wu(e){e!==yu&&null===e.next&&(null===yu?gu=yu=e:yu=yu.next=e),vu=!0,_u||(_u=!0,hh(function(){0!==(6&nc)?J(ie,Tu):Eu()}))}function Su(e,t){if(!xu&&vu){xu=!0;do{for(var n=!1,i=gu;null!==i;){if(!t)if(0!==e){var r=i.pendingLanes;if(0===r)var o=0;else{var s=i.suspendedLanes,a=i.pingedLanes;o=(1<<31-pe(42|e)+1)-1,o=201326741&(o&=r&~(s&~a))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,ku(i,o))}else o=oc,0===(3&(o=ve(i,i===ic?o:0,null!==i.cancelPendingCommit||-1!==i.timeoutHandle)))||xe(i,o)||(n=!0,ku(i,o));i=i.next}}while(n);xu=!1}}function Tu(){Eu()}function Eu(){vu=_u=!1;var e=0;0!==bu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ah&&(ah=e,!0);return ah=null,!1}()&&(e=bu),bu=0);for(var t=te(),n=null,i=gu;null!==i;){var r=i.next,o=Au(i,t);0===o?(i.next=null,null===n?gu=r:n.next=r,null===r&&(yu=n)):(n=i,(0!==e||0!==(3&o))&&(vu=!0)),i=r}Su(e,!1)}function Au(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var s=31-pe(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=be(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}if(n=oc,n=ve(e,e===(t=ic)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),i=e.callbackNode,0===n||e===t&&(2===sc||9===sc)||null!==e.cancelPendingCommit)return null!==i&&null!==i&&$(i),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==i&&$(i),Ce(n)){case 2:case 8:n=re;break;case 32:default:n=oe;break;case 268435456:n=ae}return i=Mu.bind(null,e),n=J(n,i),e.callbackPriority=t,e.callbackNode=n,t}return null!==i&&null!==i&&$(i),e.callbackPriority=2,e.callbackNode=null,2}function Mu(e,t){if(0!==Ec&&5!==Ec)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(au()&&e.callbackNode!==n)return null;var i=oc;return 0===(i=ve(e,e===ic?i:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Fc(e,i,t),Au(e,te()),null!=e.callbackNode&&e.callbackNode===n?Mu.bind(null,e):null)}function ku(e,t){if(au())return null;Fc(e,t,!0)}function Cu(){return 0===bu&&(bu=we()),bu}function Pu(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Ct(""+e)}function Iu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Du=0;Du<bi.length;Du++){var zu=bi[Du];wi(zu.toLowerCase(),"on"+(zu[0].toUpperCase()+zu.slice(1)))}wi(pi,"onAnimationEnd"),wi(fi,"onAnimationIteration"),wi(mi,"onAnimationStart"),wi("dblclick","onDoubleClick"),wi("focusin","onFocus"),wi("focusout","onBlur"),wi(gi,"onTransitionRun"),wi(yi,"onTransitionStart"),wi(_i,"onTransitionCancel"),wi(vi,"onTransitionEnd"),Ye("onMouseEnter",["mouseout","mouseover"]),Ye("onMouseLeave",["mouseout","mouseover"]),Ye("onPointerEnter",["pointerout","pointerover"]),Ye("onPointerLeave",["pointerout","pointerover"]),Xe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xe("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ru="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ru));function Ou(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;o=a,r.currentTarget=c;try{o(r)}catch(u){ya(u)}r.currentTarget=null,o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;o=a,r.currentTarget=c;try{o(r)}catch(u){ya(u)}r.currentTarget=null,o=l}}}}function Fu(e,t){var n=t[Le];void 0===n&&(n=t[Le]=new Set);var i=e+"__bubble";n.has(i)||(Vu(t,e,2,!1),n.add(i))}function Bu(e,t,n){var i=0;t&&(i|=4),Vu(n,e,i,t)}var Nu="_reactListening"+Math.random().toString(36).slice(2);function ju(e){if(!e[Nu]){e[Nu]=!0,Ze.forEach(function(t){"selectionchange"!==t&&(Lu.has(t)||Bu(t,!1,e),Bu(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Nu]||(t[Nu]=!0,Bu("selectionchange",!1,t))}}function Vu(e,t,n,i){switch(cd(t)){case 2:var r=id;break;case 8:r=rd;break;default:r=od}n=r.bind(null,t,n,e),r=void 0,!Nt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Uu(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r)break;if(4===s)for(s=i.return;null!==s;){var c=s.tag;if((3===c||4===c)&&s.stateNode.containerInfo===r)return;s=s.return}for(;null!==a;){if(null===(s=Ve(a)))return;if(5===(c=s.tag)||6===c||26===c||27===c){i=o=s;continue e}a=a.parentNode}}i=i.return}Ot(function(){var i=o,r=It(n),s=[];e:{var a=xi.get(e);if(void 0!==a){var c=Qt,u=e;switch(e){case"keypress":if(0===Wt(n))break e;case"keydown":case"keyup":c=mn;break;case"focusin":u="focus",c=sn;break;case"focusout":u="blur",c=sn;break;case"beforeblur":case"afterblur":c=sn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=yn;break;case pi:case fi:case mi:c=an;break;case vi:c=_n;break;case"scroll":case"scrollend":c=tn;break;case"wheel":c=vn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=gn;break;case"toggle":case"beforetoggle":c=xn}var h=0!==(4&t),d=!h&&("scroll"===e||"scrollend"===e),p=h?null!==a?a+"Capture":null:a;h=[];for(var f,m=i;null!==m;){var g=m;if(f=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===f||null===p||null!=(g=Ft(m,p))&&h.push(Gu(m,g,f)),d)break;m=m.return}0<h.length&&(a=new c(a,u,null,n,r),s.push({event:a,listeners:h}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===Pt||!(u=n.relatedTarget||n.fromElement)||!Ve(u)&&!u[Re])&&(c||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=i,null!==(u=(u=n.relatedTarget||n.toElement)?Ve(u):null)&&(d=l(u),h=u.tag,u!==d||5!==h&&27!==h&&6!==h)&&(u=null)):(c=null,u=i),c!==u)){if(h=rn,g="onMouseLeave",p="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(h=gn,g="onPointerLeave",p="onPointerEnter",m="pointer"),d=null==c?a:Ge(c),f=null==u?a:Ge(u),(a=new h(g,m+"leave",c,n,r)).target=d,a.relatedTarget=f,g=null,Ve(r)===i&&((h=new h(p,m+"enter",u,n,r)).target=f,h.relatedTarget=d,g=h),d=g,c&&u)e:{for(p=u,m=0,f=h=c;f;f=Wu(f))m++;for(f=0,g=p;g;g=Wu(g))f++;for(;0<m-f;)h=Wu(h),m--;for(;0<f-m;)p=Wu(p),f--;for(;m--;){if(h===p||null!==p&&h===p.alternate)break e;h=Wu(h),p=Wu(p)}h=null}else h=null;null!==c&&Zu(s,a,c,h,!1),null!==u&&null!==d&&Zu(s,d,u,h,!0)}if("select"===(c=(a=i?Ge(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var y=Bn;else if(Dn(a))if(Nn)y=Xn;else{y=Zn;var _=Wn}else!(c=a.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type?i&&At(i.elementType)&&(y=Bn):y=Hn;switch(y&&(y=y(e,i))?zn(s,y,n,r):(_&&_(e,a,i),"focusout"===e&&i&&"number"===a.type&&null!=i.memoizedProps.value&&_t(a,"number",a.value)),_=i?Ge(i):window,e){case"focusin":(Dn(_)||"true"===_.contentEditable)&&(ii=_,ri=i,oi=null);break;case"focusout":oi=ri=ii=null;break;case"mousedown":si=!0;break;case"contextmenu":case"mouseup":case"dragend":si=!1,ai(s,n,r);break;case"selectionchange":if(ni)break;case"keydown":case"keyup":ai(s,n,r)}var v;if(wn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Pn?kn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(En&&"ko"!==n.locale&&(Pn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Pn&&(v=qt()):(Ut="value"in(Vt=r)?Vt.value:Vt.textContent,Pn=!0)),0<(_=qu(i,x)).length&&(x=new cn(x,e,null,n,r),s.push({event:x,listeners:_}),v?x.data=v:null!==(v=Cn(n))&&(x.data=v))),(v=Tn?function(e,t){switch(e){case"compositionend":return Cn(t);case"keypress":return 32!==t.which?null:(Mn=!0,An);case"textInput":return(e=t.data)===An&&Mn?null:e;default:return null}}(e,n):function(e,t){if(Pn)return"compositionend"===e||!wn&&kn(e,t)?(e=qt(),Gt=Ut=Vt=null,Pn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return En&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=qu(i,"onBeforeInput")).length&&(_=new cn("onBeforeInput","beforeinput",null,n,r),s.push({event:_,listeners:x}),_.data=v)),function(e,t,n,i,r){if("submit"===t&&n&&n.stateNode===r){var o=Pu((r[ze]||null).action),s=i.submitter;s&&null!==(t=(t=s[ze]||null)?Pu(t.formAction):s.getAttribute("formAction"))&&(o=t,s=null);var a=new Qt("action","action",null,i,r);e.push({event:a,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==bu){var e=s?Iu(r,s):new FormData(r);Is(n,{pending:!0,data:e,method:r.method,action:o},null,e)}}else"function"===typeof o&&(a.preventDefault(),e=s?Iu(r,s):new FormData(r),Is(n,{pending:!0,data:e,method:r.method,action:o},o,e))},currentTarget:r}]})}}(s,e,i,n,r)}Ou(s,t)})}function Gu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qu(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;if(5!==(r=r.tag)&&26!==r&&27!==r||null===o||(null!=(r=Ft(e,n))&&i.unshift(Gu(e,r,o)),null!=(r=Ft(e,t))&&i.push(Gu(e,r,o))),3===e.tag)return i;e=e.return}return[]}function Wu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Zu(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===i)break;5!==a&&26!==a&&27!==a||null===c||(l=c,r?null!=(c=Ft(n,o))&&s.unshift(Gu(n,c,l)):r||null!=(c=Ft(n,o))&&s.push(Gu(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Hu=/\r\n?/g,Xu=/\u0000|\uFFFD/g;function Yu(e){return("string"===typeof e?e:""+e).replace(Hu,"\n").replace(Xu,"")}function Ku(e,t){return t=Yu(t),Yu(e)===t}function Ju(){}function $u(e,t,n,i,r,o){switch(n){case"children":"string"===typeof i?"body"===t||"textarea"===t&&""===i||wt(e,i):("number"===typeof i||"bigint"===typeof i)&&"body"!==t&&wt(e,""+i);break;case"className":nt(e,"class",i);break;case"tabIndex":nt(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,i);break;case"style":Et(e,i,o);break;case"data":if("object"!==t){nt(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"===typeof i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=Ct(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"===typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof o&&("formAction"===n?("input"!==t&&$u(e,t,"name",r.name,r,null),$u(e,t,"formEncType",r.formEncType,r,null),$u(e,t,"formMethod",r.formMethod,r,null),$u(e,t,"formTarget",r.formTarget,r,null)):($u(e,t,"encType",r.encType,r,null),$u(e,t,"method",r.method,r,null),$u(e,t,"target",r.target,r,null))),null==i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=Ct(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=Ju);break;case"onScroll":null!=i&&Fu("scroll",e);break;case"onScrollEnd":null!=i&&Fu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(s(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(s(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"muted":e.muted=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"===typeof i||"boolean"===typeof i||"symbol"===typeof i){e.removeAttribute("xlink:href");break}n=Ct(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"===typeof i||"symbol"===typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":Fu("beforetoggle",e),Fu("toggle",e),tt(e,"popover",i);break;case"xlinkActuate":it(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":it(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":it(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":it(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":it(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":it(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":it(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":it(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":it(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":tt(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Mt.get(n)||n,i)}}function Qu(e,t,n,i,r,o){switch(n){case"style":Et(e,i,o);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(s(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(s(60));e.innerHTML=n}}break;case"children":"string"===typeof i?wt(e,i):("number"===typeof i||"bigint"===typeof i)&&wt(e,""+i);break;case"onScroll":null!=i&&Fu("scroll",e);break;case"onScrollEnd":null!=i&&Fu("scrollend",e);break;case"onClick":null!=i&&(e.onclick=Ju);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:He.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"===typeof(o=null!=(o=e[ze]||null)?o[n]:null)&&e.removeEventListener(t,o,r),"function"!==typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):tt(e,n,i):("function"!==typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,r)))}}function eh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Fu("error",e),Fu("load",e);var i,r=!1,o=!1;for(i in n)if(n.hasOwnProperty(i)){var a=n[i];if(null!=a)switch(i){case"src":r=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:$u(e,t,i,a,n,null)}}return o&&$u(e,t,"srcSet",n.srcSet,n,null),void(r&&$u(e,t,"src",n.src,n,null));case"input":Fu("invalid",e);var l=i=a=o=null,c=null,u=null;for(r in n)if(n.hasOwnProperty(r)){var h=n[r];if(null!=h)switch(r){case"name":o=h;break;case"type":a=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":i=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(s(137,t));break;default:$u(e,t,r,h,n,null)}}return yt(e,i,l,c,u,a,o,!1),void ht(e);case"select":for(o in Fu("invalid",e),r=a=i=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":i=l;break;case"defaultValue":a=l;break;case"multiple":r=l;default:$u(e,t,o,l,n,null)}return t=i,n=a,e.multiple=!!r,void(null!=t?vt(e,!!r,t,!1):null!=n&&vt(e,!!r,n,!0));case"textarea":for(a in Fu("invalid",e),i=o=r=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":r=l;break;case"defaultValue":o=l;break;case"children":i=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(s(91));break;default:$u(e,t,a,l,n,null)}return bt(e,r,o,i),void ht(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(r=n[c]))if("selected"===c)e.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else $u(e,t,c,r,n,null);return;case"dialog":Fu("beforetoggle",e),Fu("toggle",e),Fu("cancel",e),Fu("close",e);break;case"iframe":case"object":Fu("load",e);break;case"video":case"audio":for(r=0;r<Ru.length;r++)Fu(Ru[r],e);break;case"image":Fu("error",e),Fu("load",e);break;case"details":Fu("toggle",e);break;case"embed":case"source":case"link":Fu("error",e),Fu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(r=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:$u(e,t,u,r,n,null)}return;default:if(At(t)){for(h in n)n.hasOwnProperty(h)&&(void 0!==(r=n[h])&&Qu(e,t,h,r,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(r=n[l])&&$u(e,t,l,r,n,null))}var th=null,nh=null;function ih(e){return 9===e.nodeType?e:e.ownerDocument}function rh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oh(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function sh(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ah=null;var lh="function"===typeof setTimeout?setTimeout:void 0,ch="function"===typeof clearTimeout?clearTimeout:void 0,uh="function"===typeof Promise?Promise:void 0,hh="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof uh?function(e){return uh.resolve(null).then(e).catch(dh)}:lh;function dh(e){setTimeout(function(){throw e})}function ph(e){return"head"===e}function fh(e,t){var n=t,i=0,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0<i&&8>i){n=i;var s=e.ownerDocument;if(1&n&&bh(s.documentElement),2&n&&bh(s.body),4&n)for(bh(n=s.head),s=n.firstChild;s;){var a=s.nextSibling,l=s.nodeName;s[Ne]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===s.rel.toLowerCase()||n.removeChild(s),s=a}}if(0===r)return e.removeChild(o),void Md(t);r--}else"$"===n||"$?"===n||"$!"===n?r++:i=n.charCodeAt(0)-48;else i=0;n=o}while(n);Md(t)}function mh(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":mh(n),je(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gh(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function yh(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var _h=null;function vh(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function xh(e,t,n){switch(t=ih(n),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}function bh(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);je(e)}var wh=new Map,Sh=new Set;function Th(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Eh=L.d;L.d={f:function(){var e=Eh.f(),t=Vc();return e||t},r:function(e){var t=Ue(e);null!==t&&5===t.tag&&"form"===t.type?zs(t):Eh.r(e)},D:function(e){Eh.D(e),Mh("dns-prefetch",e,null)},C:function(e,t){Eh.C(e,t),Mh("preconnect",e,t)},L:function(e,t,n){Eh.L(e,t,n);var i=Ah;if(i&&e&&t){var r='link[rel="preload"][as="'+mt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+mt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(r+='[imagesizes="'+mt(n.imageSizes)+'"]')):r+='[href="'+mt(e)+'"]';var o=r;switch(t){case"style":o=Ch(e);break;case"script":o=Dh(e)}wh.has(o)||(e=d({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),wh.set(o,e),null!==i.querySelector(r)||"style"===t&&i.querySelector(Ph(o))||"script"===t&&i.querySelector(zh(o))||(eh(t=i.createElement("link"),"link",e),We(t),i.head.appendChild(t)))}},m:function(e,t){Eh.m(e,t);var n=Ah;if(n&&e){var i=t&&"string"===typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+mt(i)+'"][href="'+mt(e)+'"]',o=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Dh(e)}if(!wh.has(o)&&(e=d({rel:"modulepreload",href:e},t),wh.set(o,e),null===n.querySelector(r))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(zh(o)))return}eh(i=n.createElement("link"),"link",e),We(i),n.head.appendChild(i)}}},X:function(e,t){Eh.X(e,t);var n=Ah;if(n&&e){var i=qe(n).hoistableScripts,r=Dh(e),o=i.get(r);o||((o=n.querySelector(zh(r)))||(e=d({src:e,async:!0},t),(t=wh.get(r))&&Fh(e,t),We(o=n.createElement("script")),eh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},i.set(r,o))}},S:function(e,t,n){Eh.S(e,t,n);var i=Ah;if(i&&e){var r=qe(i).hoistableStyles,o=Ch(e);t=t||"default";var s=r.get(o);if(!s){var a={loading:0,preload:null};if(s=i.querySelector(Ph(o)))a.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},n),(n=wh.get(o))&&Oh(e,n);var l=s=i.createElement("link");We(l),eh(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,Lh(s,t,i)}s={type:"stylesheet",instance:s,count:1,state:a},r.set(o,s)}}},M:function(e,t){Eh.M(e,t);var n=Ah;if(n&&e){var i=qe(n).hoistableScripts,r=Dh(e),o=i.get(r);o||((o=n.querySelector(zh(r)))||(e=d({src:e,async:!0,type:"module"},t),(t=wh.get(r))&&Fh(e,t),We(o=n.createElement("script")),eh(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},i.set(r,o))}}};var Ah="undefined"===typeof document?null:document;function Mh(e,t,n){var i=Ah;if(i&&"string"===typeof t&&t){var r=mt(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"===typeof n&&(r+='[crossorigin="'+n+'"]'),Sh.has(r)||(Sh.add(r),e={rel:e,crossOrigin:n,href:t},null===i.querySelector(r)&&(eh(t=i.createElement("link"),"link",e),We(t),i.head.appendChild(t)))}}function kh(e,t,n,i){var r,o,a,l,c=(c=q.current)?Th(c):null;if(!c)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Ch(n.href),(i=(n=qe(c).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Ch(n.href);var u=qe(c).hoistableStyles,h=u.get(e);if(h||(c=c.ownerDocument||c,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,h),(u=c.querySelector(Ph(e)))&&!u._p&&(h.instance=u,h.state.loading=5),wh.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},wh.set(e,n),u||(r=c,o=e,a=n,l=h.state,r.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=r.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),eh(o,"link",a),We(o),r.head.appendChild(o))))),t&&null===i)throw Error(s(528,""));return h}if(t&&null!==i)throw Error(s(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Dh(n),(i=(n=qe(c).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Ch(e){return'href="'+mt(e)+'"'}function Ph(e){return'link[rel="stylesheet"]['+e+"]"}function Ih(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Dh(e){return'[src="'+mt(e)+'"]'}function zh(e){return"script[async]"+e}function Rh(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+mt(n.href)+'"]');if(i)return t.instance=i,We(i),i;var r=d({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return We(i=(e.ownerDocument||e).createElement("style")),eh(i,"style",r),Lh(i,n.precedence,e),t.instance=i;case"stylesheet":r=Ch(n.href);var o=e.querySelector(Ph(r));if(o)return t.state.loading|=4,t.instance=o,We(o),o;i=Ih(n),(r=wh.get(r))&&Oh(i,r),We(o=(e.ownerDocument||e).createElement("link"));var a=o;return a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),eh(o,"link",i),t.state.loading|=4,Lh(o,n.precedence,e),t.instance=o;case"script":return o=Dh(n.src),(r=e.querySelector(zh(o)))?(t.instance=r,We(r),r):(i=n,(r=wh.get(o))&&Fh(i=d({},n),r),We(r=(e=e.ownerDocument||e).createElement("script")),eh(r,"link",i),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,Lh(i,n.precedence,e));return t.instance}function Lh(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,o=r,s=0;s<i.length;s++){var a=i[s];if(a.dataset.precedence===t)o=a;else if(o!==r)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Oh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Fh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Bh=null;function Nh(e,t,n){if(null===Bh){var i=new Map,r=Bh=new Map;r.set(n,i)}else(i=(r=Bh).get(n))||(i=new Map,r.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var o=n[r];if(!(o[Ne]||o[De]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var s=o.getAttribute(t)||"";s=e+s;var a=i.get(s);a?a.push(o):i.set(s,[o])}}return i}function jh(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Vh(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Uh=null;function Gh(){}function qh(){if(this.count--,0===this.count)if(this.stylesheets)Zh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Wh=null;function Zh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Wh=new Map,t.forEach(Hh,e),Wh=null,qh.call(e))}function Hh(e,t){if(!(4&t.state.loading)){var n=Wh.get(e);if(n)var i=n.get(null);else{n=new Map,Wh.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<r.length;o++){var s=r[o];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(n.set(s.dataset.precedence,s),i=s)}i&&n.set(null,i)}s=(r=t.instance).getAttribute("data-precedence"),(o=n.get(s)||i)===i&&n.set(null,r),n.set(s,r),this.count++,i=qh.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),o?o.parentNode.insertBefore(r,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Xh={$$typeof:b,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0};function Yh(e,t,n,i,r,o,s,a){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Te(0),this.hiddenUpdates=Te(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=o,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function Kh(e,t,n,i,r,o,s,a,l,c,u,h){return e=new Yh(e,t,n,s,a,l,c,h),t=1,!0===o&&(t|=24),o=Oi(3,null,null,t),e.current=o,o.stateNode=e,(t=zr()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:i,isDehydrated:n,cache:t},no(o),e}function Jh(e){return e?e=Ri:Ri}function $h(e,t,n,i,r,o){r=Jh(r),null===i.context?i.context=r:i.pendingContext=r,(i=ro(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(i.callback=o),null!==(n=oo(e,i,t))&&(Oc(n,0,t),so(n,e,t))}function Qh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ed(e,t){Qh(e,t),(e=e.alternate)&&Qh(e,t)}function td(e){if(13===e.tag){var t=Ii(e,67108864);null!==t&&Oc(t,0,67108864),ed(e,67108864)}}var nd=!0;function id(e,t,n,i){var r=R.T;R.T=null;var o=L.p;try{L.p=2,od(e,t,n,i)}finally{L.p=o,R.T=r}}function rd(e,t,n,i){var r=R.T;R.T=null;var o=L.p;try{L.p=8,od(e,t,n,i)}finally{L.p=o,R.T=r}}function od(e,t,n,i){if(nd){var r=sd(i);if(null===r)Uu(e,t,i,ad,n),_d(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return hd=vd(hd,e,t,n,i,r),!0;case"dragenter":return dd=vd(dd,e,t,n,i,r),!0;case"mouseover":return pd=vd(pd,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return fd.set(o,vd(fd.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,md.set(o,vd(md.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(_d(e,i),4&t&&-1<yd.indexOf(e)){for(;null!==r;){var o=Ue(r);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var s=_e(o.pendingLanes);if(0!==s){var a=o;for(a.pendingLanes|=2,a.entangledLanes|=2;s;){var l=1<<31-pe(s);a.entanglements[1]|=l,s&=~l}wu(o),0===(6&nc)&&(wc=te()+500,Su(0,!1))}}break;case 13:null!==(a=Ii(o,2))&&Oc(a,0,2),Vc(),ed(o,2)}if(null===(o=sd(i))&&Uu(e,t,i,ad,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Uu(e,t,i,null,n)}}function sd(e){return ld(e=It(e))}var ad=null;function ld(e){if(ad=null,null!==(e=Ve(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return ad=e,null}function cd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case ie:return 2;case re:return 8;case oe:case se:return 32;case ae:return 268435456;default:return 32}default:return 32}}var ud=!1,hd=null,dd=null,pd=null,fd=new Map,md=new Map,gd=[],yd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _d(e,t){switch(e){case"focusin":case"focusout":hd=null;break;case"dragenter":case"dragleave":dd=null;break;case"mouseover":case"mouseout":pd=null;break;case"pointerover":case"pointerout":fd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":md.delete(t.pointerId)}}function vd(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=Ue(t))&&td(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function xd(e){var t=Ve(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void function(e,t){var n=L.p;try{return L.p=e,t()}finally{L.p=n}}(e.priority,function(){if(13===n.tag){var e=Rc();e=ke(e);var t=Ii(n,e);null!==t&&Oc(t,0,e),ed(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function bd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=sd(e.nativeEvent);if(null!==n)return null!==(t=Ue(n))&&td(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);Pt=i,n.target.dispatchEvent(i),Pt=null,t.shift()}return!0}function wd(e,t,n){bd(e)&&n.delete(t)}function Sd(){ud=!1,null!==hd&&bd(hd)&&(hd=null),null!==dd&&bd(dd)&&(dd=null),null!==pd&&bd(pd)&&(pd=null),fd.forEach(wd),md.forEach(wd)}function Td(e,t){e.blockedOn===t&&(e.blockedOn=null,ud||(ud=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Sd)))}var Ed=null;function Ad(e){Ed!==e&&(Ed=e,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Ed===e&&(Ed=null);for(var t=0;t<e.length;t+=3){var n=e[t],i=e[t+1],r=e[t+2];if("function"!==typeof i){if(null===ld(i||n))continue;break}var o=Ue(n);null!==o&&(e.splice(t,3),t-=3,Is(o,{pending:!0,data:r,method:n.method,action:i},i,r))}}))}function Md(e){function t(t){return Td(t,e)}null!==hd&&Td(hd,e),null!==dd&&Td(dd,e),null!==pd&&Td(pd,e),fd.forEach(t),md.forEach(t);for(var n=0;n<gd.length;n++){var i=gd[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<gd.length&&null===(n=gd[0]).blockedOn;)xd(n),null===n.blockedOn&&gd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<n.length;i+=3){var r=n[i],o=n[i+1],s=r[ze]||null;if("function"===typeof o)s||Ad(n);else if(s){var a=null;if(o&&o.hasAttribute("formAction")){if(r=o,s=o[ze]||null)a=s.formAction;else if(null!==ld(r))continue}else a=s.action;"function"===typeof a?n[i+1]=a:(n.splice(i,3),i-=3),Ad(n)}}}function kd(e){this._internalRoot=e}function Cd(e){this._internalRoot=e}Cd.prototype.render=kd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));$h(t.current,Rc(),e,t,null,null)},Cd.prototype.unmount=kd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;$h(e.current,2,null,e,null,null),Vc(),t[Re]=null}},Cd.prototype.unstable_scheduleHydration=function(e){if(e){var t=Pe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<gd.length&&0!==t&&t<gd[n].priority;n++);gd.splice(n,0,e),0===n&&xd(e)}};var Pd=r.version;if("19.1.1"!==Pd)throw Error(s(527,Pd,"19.1.1"));L.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return u(r),e;if(o===i)return u(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,c=r.child;c;){if(c===n){a=!0,n=r,i=o;break}if(c===i){a=!0,i=r,n=o;break}c=c.sibling}if(!a){for(c=o.child;c;){if(c===n){a=!0,n=o,i=r;break}if(c===i){a=!0,i=o,n=r;break}c=c.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?h(e):null)?null:e.stateNode};var Id={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.1.1"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Dd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dd.isDisabled&&Dd.supportsFiber)try{ue=Dd.inject(Id),he=Dd}catch(Rd){}}t.createRoot=function(e,t){if(!a(e))throw Error(s(299));var n=!1,i="",r=_a,o=va,l=xa;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onUncaughtError&&(r=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Kh(e,1,!1,null,0,n,i,r,o,l,0,null),e[Re]=t.current,ju(e),new kd(t)},t.hydrateRoot=function(e,t,n){if(!a(e))throw Error(s(299));var i=!1,r="",o=_a,l=va,c=xa,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onUncaughtError&&(o=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Kh(e,1,!0,t,0,i,r,o,l,c,0,u)).context=Jh(null),n=t.current,(r=ro(i=ke(i=Rc()))).callback=null,oo(n,r,i),n=i,t.current.lanes=n,Ee(t,n),wu(t),e[Re]=t.current,ju(e),new Cd(t)},t.version="19.1.1"},43:(e,t,n)=>{"use strict";e.exports=n(288)},45:(e,t,n)=>{var i=n(738).default;e.exports=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},142:e=>{function t(e){if(e=Object.assign({},e),!(this instanceof t))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=e.defaultLanguage,this._isLanguageField=e.languageField||/^name_/,this._getLanguageField=e.getLanguageField||function(e){return"mul"===e?"name":"name_".concat(e)},this._languageSource=e.languageSource||null,this._languageTransform=e.languageTransform,this._excludedLayerIds=e.excludedLayerIds||[],this.supportedLanguages=e.supportedLanguages||["ar","de","en","es","fr","it","ja","ko","mul","pt","ru","vi","zh-Hans","zh-Hant"]}const n=/^\{name/;function i(e,t){const i=Array.isArray(t)&&"get"===t[0];return i&&n.test(t[1])&&console.warn("This plugin no longer supports the use of token syntax (e.g. {name}). Please use a get expression. See https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/ for more details."),i&&e.test(t[1])}function r(e,t,n){if(Array.isArray(t))for(let o=1;o<t.length;o++)Array.isArray(t[o])&&(i(e,t[o])&&(t[o][1]=n),r(e,t[o],n))}function o(e,t,n){if(i(e,t)&&(t[1]=n),r(e,t,n),"get"===t[0]&&"name"===t[1]){const e=t.slice();t=["coalesce",["get",n],e]}return t}t.prototype.setLanguage=function(e,t){if(this.supportedLanguages.indexOf(t)<0)throw new Error("Language ".concat(t," is not supported"));const n=this._languageSource||function(e){const t=Object.keys(e.sources).filter(t=>{const n=e.sources[t].url;return n&&n.indexOf("mapbox.mapbox-streets-v8")>-1||/mapbox-streets-v[1-9][1-9]/.test(n)});if(!t.length)throw new Error('If using MapboxLanguage with a Mapbox style, the style must be based on vector tile version 8, e.g. "streets-v11"');return t[0]}(e);if(!n)return e;const i=this._getLanguageField(t),r=this._isLanguageField,s=this._excludedLayerIds,a=e.layers.map(e=>e.source===n?function(e,t,n,i){return t.layout&&t.layout["text-field"]&&-1===i.indexOf(t.id)?Object.assign({},t,{layout:Object.assign({},t.layout,{"text-field":o(e,t.layout["text-field"],n)})}):t}(r,e,i,s):e),l=Object.assign({},e,{layers:a});return this._languageTransform?this._languageTransform(l,t):l},t.prototype._initialStyleUpdate=function(){const e=this._map.getStyle(),t=this._defaultLanguage||function(e){const t=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,n=t&&t.split("-");let i=t;n.length>1&&(i=n[0]);if(e.indexOf(i)>-1)return i;return null}(this.supportedLanguages);this._map.setStyle(this.setLanguage(e,t))},t.prototype.onAdd=function(e){return this._map=e,this._map.on("style.load",this._initialStyleUpdate),this._container=document.createElement("div"),this._container},t.prototype.onRemove=function(){this._map.off("style.load",this._initialStyleUpdate),this._map=void 0},"undefined"!==typeof e.exports?e.exports=t:window.MapboxLanguage=t},191:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler");Symbol.for("react.provider");var a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.for("react.view_transition"),m=Symbol.for("react.client.reference");function g(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case r:case s:case o:case u:case h:case f:return e;default:switch(e=e&&e.$$typeof){case l:case c:case p:case d:case a:return e;default:return t}}case i:return t}}}t.Hy=function(e){return"string"===typeof e||"function"===typeof e||e===r||e===s||e===o||e===u||e===h||"object"===typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===d||e.$$typeof===l||e.$$typeof===a||e.$$typeof===c||e.$$typeof===m||void 0!==e.getModuleId)}},219:(e,t,n)=>{"use strict";var i=n(763),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return i.isMemo(e)?s:a[e.$$typeof]||r}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[i.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,i){if("string"!==typeof n){if(f){var r=p(n);r&&r!==f&&e(t,r,i)}var s=u(n);h&&(s=s.concat(h(n)));for(var a=l(t),m=l(n),g=0;g<s.length;++g){var y=s[g];if(!o[y]&&(!i||!i[y])&&(!m||!m[y])&&(!a||!a[y])){var _=d(n,y);try{c(t,y,_)}catch(v){}}}}return t}},288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function _(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=y.prototype;var x=v.prototype=new _;x.constructor=v,m(x,y.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},S=Object.prototype.hasOwnProperty;function T(e,t,i,r,o,s){return i=s.ref,{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:s}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function k(){}function C(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(a){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case i:u=!0;break;case d:return C((u=e._init)(e._payload),t,r,o,s)}}if(u)return s=s(e),u=""===o?"."+M(e,0):o,b(s)?(r="",null!=u&&(r=u.replace(A,"$&/")+"/"),C(s,t,r,"",function(e){return e})):null!=s&&(E(s)&&(l=s,c=r+(null==s.key||e&&e.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+u,s=T(l.type,c,void 0,0,0,l.props)),t.push(s)),1;u=0;var h,f=""===o?".":o+":";if(b(e))for(var m=0;m<e.length;m++)u+=C(o=e[m],t,r,a=f+M(o,m),s);else if("function"===typeof(m=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=p&&h[p]||h["@@iterator"])?h:null))for(e=m.call(e),m=0;!(o=e.next()).done;)u+=C(o=o.value,t,r,a=f+M(o,m++),s);else if("object"===a){if("function"===typeof e.then)return C(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(k,k):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,o,s);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function P(e,t,n){if(null==e)return e;var i=[],r=0;return C(e,i,"","",function(e){return t.call(n,e,r++)}),i}function I(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function z(){}t.Children={map:P,forEach:function(e,t,n){P(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return P(e,function(){t++}),t},toArray:function(e){return P(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=r,t.Profiler=s,t.PureComponent=v,t.StrictMode=o,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var i=m({},e.props),r=e.key;if(null!=t)for(o in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!S.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(i[o]=t[o]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var s=Array(o),a=0;a<o;a++)s[a]=arguments[a+2];i.children=s}return T(e.type,r,void 0,0,0,i)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,n){var i,r={},o=null;if(null!=t)for(i in void 0!==t.key&&(o=""+t.key),t)S.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];r.children=a}if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===r[i]&&(r[i]=s[i]);return T(e,o,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.T,n={};w.T=n;try{var i=e(),r=w.S;null!==r&&r(n,i),"object"===typeof i&&null!==i&&"function"===typeof i.then&&i.then(z,D)}catch(o){D(o)}finally{w.T=t}},t.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},t.use=function(e){return w.H.use(e)},t.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},t.useCallback=function(e,t){return w.H.useCallback(e,t)},t.useContext=function(e){return w.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var i=w.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return i.useEffect(e,t)},t.useId=function(){return w.H.useId()},t.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.H.useMemo(e,t)},t.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},t.useRef=function(e){return w.H.useRef(e)},t.useState=function(e){return w.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return w.H.useTransition()},t.version="19.1.1"},391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},579:(e,t,n)=>{"use strict";e.exports=n(799)},672:(e,t,n)=>{"use strict";var i=n(43);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var s={d:{f:o,r:function(){throw Error(r(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(r(299));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=s.p;try{if(l.T=null,s.p=2,e)return e()}finally{l.T=t,s.p=n,s.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,i=c(n,t.crossOrigin),r="string"===typeof t.integrity?t.integrity:void 0,o="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:o}):"script"===n&&s.d.X(e,{crossOrigin:i,integrity:r,fetchPriority:o,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,i=c(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:i,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);s.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.1"},693:(e,t,n)=>{var i=n(736);e.exports=function(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,n)=>{var i=n(738).default,r=n(45);e.exports=function(e){var t=r(e,"string");return"symbol"==i(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},763:(e,t,n)=>{"use strict";e.exports=n(983)},799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function r(e,t,i){var r=null;if(void 0!==i&&(r=""+i),void 0!==t.key&&(r=""+t.key),"key"in t)for(var o in i={},t)"key"!==o&&(i[o]=t[o]);else i=t;return t=i.ref,{$$typeof:n,type:e,key:r,ref:void 0!==t?t:null,props:i}}t.Fragment=i,t.jsx=r,t.jsxs=r},847:(e,t,n)=>{var i=n(893);e.exports=function(e,t){if(null==e)return{};var n,r,o=i(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports},853:(e,t,n)=>{"use strict";e.exports=n(896)},879:function(e,t,n){var i=n(897).default,r=n(847).default;const o=["data"];e.exports=function(){"use strict";var e,t,n;function s(i,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),n=r(s),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return s(["exports"],function(e){var t="undefined"!=typeof self?self:{},n="3.1.0";let s;const a={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==s){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{s=null!={NODE_ENV:"production",PUBLIC_URL:"/where_owner_side",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoianVud2F0YW5hYmU3MiIsImEiOiJjbDZkOHdtMTMyM3puM2NvNTNxcHg2M3JmIn0.jwl5M3oBS5p4ZAeDsFPnXw"}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"/where_owner_side",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoianVud2F0YW5hYmU3MiIsImEiOiJjbDZkOHdtMTMyM3puM2NvNTNxcHg2M3JmIn0.jwl5M3oBS5p4ZAeDsFPnXw"}.API_URL_REGEX):e}catch(t){s=e}}return s},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!a.API_URL)return null;try{const e=new URL(a.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},l={supported:!1,testSupport:function(e){!h&&u&&(d?p(e):c=e)}};let c,u,h=!1,d=!1;function p(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.isContextLost())return;l.supported=!0}catch(e){}e.deleteTexture(t),h=!0}t.document&&(u=t.document.createElement("img"),u.onload=function(){c&&p(c),c=null,d=!0},u.onerror=function(){h=!0,c=null},u.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const f="01";function m(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var g=y;function y(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}y.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var _=m(g),v=x;function x(e,t){this.x=e,this.y=t}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(e){return e instanceof x?e:Array.isArray(e)?new x(e[0],e[1]):e};var b=m(v);function w(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!w(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!w(e[n],t[n]))return!1;return!0}return e===t}const S=Math.PI/180,T=180/Math.PI;function E(e){return e*S}function A(e){return e*T}const M=[[0,0],[1,0],[1,1],[0,1]];function k(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function C(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return{min:new b(t,n),max:new b(i,r)}}function P(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=new b(n,n),o=e.sub(r),s=t.add(r),a=[o,new b(s.x,o.y),s,new b(o.x,s.y)];return i&&a.push(o.clone()),a}function I(e,t,n,i){const r=new _(e,t,n,i);return function(e){return r.solve(e)}}const D=I(.25,.1,.25,1);function z(e,t,n){return Math.min(n,Math.max(t,e))}function R(e,t,n){return(n=z((n-e)/(t-e),0,1))*n*(3-2*n)}function L(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function O(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const r=new Array(e.length);let o=null;e.forEach((e,s)=>{t(e,(e,t)=>{e&&(o=e),r[s]=t,0==--i&&n(o,r)})})}function F(e){const t=[];for(const n in e)t.push(e[n]);return t}function B(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}function N(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n}let j=1;function V(){return j++}function U(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function G(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function q(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function W(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function Z(e,t){return-1!==e.indexOf(t,e.length-t.length)}function H(e,t,n){const i={};for(const r in e)i[r]=t.call(n||this,e[r],r,e);return i}function X(e,t,n){const i={};for(const r in e)t.call(n||this,e[r],r,e)&&(i[r]=e[r]);return i}function Y(e){return Array.isArray(e)?e.map(Y):"object"==typeof e&&e?H(e,Y):e}const K={};function J(e){K[e]||("undefined"!=typeof console&&console.warn(e),K[e]=!0)}function $(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Q(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}function ee(e){let[t,n,i]=e;const r=E(n+90),o=E(i);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:n,polar:i}}function te(e,t,n){const i=Math.sqrt(e*e+t*t+n*n),r=i>0?Math.acos(n/i)*T:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*T+90:0;return o<0&&(o+=360),[i,o,r]}function ne(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ie(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,n,i,r)=>{const o=i||r;return t[n]=!o||o.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let re=null;function oe(){return!!t.document.fullscreenElement||!!t.document.webkitFullscreenElement}function se(e){try{const n=t[e];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function ae(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function le(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function ce(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function ue(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const he="mapbox-tiles";let de,pe,fe=500,me=50;function ge(){try{return t.caches}catch(e){}}function ye(){ge()&&!de&&(de=t.caches.open(he))}function _e(e){const t=e.indexOf("?");if(t<0)return e;const n=function(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),i=n.filter(e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]});return i.length?"".concat(e.slice(0,t),"?").concat(i.join("&")):e.slice(0,t)}let ve=1/0;function xe(e){ve++,ve>me&&(e.getActor().send("enforceCacheSizeLimit",fe),ve=0)}const be={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(be);class we extends Error{constructor(e,t,n){401===t&&Le(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const Se=ne()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,Te=function(e,n){if(!(/^file:/.test(i=e.url)||/^file:/.test(Se())&&!/^\w+:/.test(i))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,n){const i=new t.AbortController,r=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Se(),referrerPolicy:e.referrerPolicy,signal:i.signal});let o=!1,s=!1;const a=(l=r.url).indexOf("sku=")>0&&Le(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(i,o,l)=>{if(s)return;if(i&&"SecurityError"!==i.message&&J(i.toString()),o&&l)return u(o);const c=Date.now();t.fetch(r).then(t=>{if(t.ok){const e=a?t.clone():null;return u(t,e,c)}return n(new we(t.statusText,t.status,e.url))}).catch(t=>{"AbortError"!==t.name&&n(new Error("".concat(t.message," ").concat(e.url)))})},u=(i,a,l)=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then(e=>{s||(a&&l&&function(e,n,i){if(ye(),!de)return;const r={status:n.status,statusText:n.statusText,headers:new t.Headers};n.headers.forEach((e,t)=>r.headers.set(t,e));const o=ie(n.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&r.headers.set("Expires",new Date(i+1e3*o["max-age"]).toUTCString());const s=r.headers.get("Expires");s&&(new Date(s).getTime()-i<42e4||function(e,t){if(void 0===pe)try{new Response(new ReadableStream),pe=!0}catch(e){pe=!1}pe?t(e.body):e.blob().then(t)}(n,n=>{const i=new t.Response(n,r);ye(),de&&de.then(t=>t.put(_e(e.url),i)).catch(e=>J(e.message))}))}(r,a,l),o=!0,n(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))}).catch(e=>{s||n(new Error(e.message))})};return a?function(e,t){if(ye(),!de)return t(null);const n=_e(e.url);de.then(e=>{e.match(n).then(i=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=ie(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(i);e.delete(n),r&&e.put(n,i.clone()),t(null,i,r)}).catch(t)}).catch(t)}(r,c):c(null,null),{cancel:()=>{s=!0,o||i.abort()}}}(e,n);if(ne()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,n,void 0,!0)}var i;return function(e,n){const i=new t.XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{n(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let t=i.response;if("json"===e.type)try{t=JSON.parse(i.response)}catch(e){return n(e)}n(null,t,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else n(new we(i.statusText,i.status,e.url))},i.send(e.body),{cancel:()=>i.abort()}}(e,n)},Ee=function(e,t){return Te(B(e,{type:"json"}),t)},Ae=function(e,t){return Te(B(e,{type:"arrayBuffer"}),t)};function Me(e){const n=t.document.createElement("a");return n.href=e,n.protocol===t.document.location.protocol&&n.host===t.document.location.host}const ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ce,Pe;Ce=[],Pe=0;const Ie=function(e,n){if(l.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Pe>=a.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Ce.push(t),t}Pe++;let i=!1;const r=()=>{if(!i)for(i=!0,Pe--;Ce.length&&Pe<a.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Ce.shift(),{requestParameters:t,callback:n,cancelled:i}=e;i||(e.cancel=Ie(t,n).cancel)}},o=Ae(e,(e,i,o,s)=>{r(),e?n(e):i&&(t.createImageBitmap?function(e,n){const i=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(i).then(e=>{n(null,e)}).catch(e=>{n(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}(i,(e,t)=>n(e,t,o,s)):function(e,n){const i=new t.Image,r=t.URL;i.onload=()=>{n(null,i),r.revokeObjectURL(i.src),i.onload=null,t.requestAnimationFrame(()=>{i.src=ke})},i.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new t.Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?r.createObjectURL(o):ke}(i,(e,t)=>n(e,t,o,s)))});return{cancel:()=>{o.cancel(),r()}}},De="NO_ACCESS_TOKEN";class ze{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",f,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Re(e))return e;const i=je(e);return i.params.push("sdk=js-".concat(n)),i.path="/styles/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Re(e))return e;const n=je(e);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}normalizeModelURL(e,t){if(!Re(e))return e;const n=je(e);return n.path="/models/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t,n,i){if(!Re(e))return e;const r=je(e);return r.path="/v4/".concat(r.authority,".json"),r.params.push("secure"),n&&r.params.push("language=".concat(n)),i&&r.params.push("worldview=".concat(i)),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,i){const r=je(e);return Re(e)?(r.path="/styles/v1".concat(r.path,"/sprite").concat(t).concat(n),this._makeAPIURL(r,this._customAccessToken||i)):(r.path+="".concat(t).concat(n),Ve(r))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Re(e))return e;const i=je(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(t||n&&"raster"!==i.authority&&512===n?"@2x":"").concat(l.supported?".webp":"$1")),"raster"===i.authority?i.path="/".concat(a.RASTER_URL_PREFIX).concat(i.path):(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/".concat(a.TILE_URL_VERSION).concat(i.path));const r=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||a.ACCESS_TOKEN;return a.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(i,r)}canonicalizeTileURL(e,t){const n=je(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+="raster/".concat(n.path.replace("/".concat(a.RASTER_URL_PREFIX,"/"),"")):i+="tiles/".concat(n.path.replace("/".concat(a.TILE_URL_VERSION,"/"),""));let r=n.params;return t&&(r=r.filter(e=>!e.match(/^access_token=/))),r.length&&(i+="?".concat(r.join("&"))),i}canonicalizeTileset(e,t){const n=!!t&&Re(t),i=[];for(const r of e.tiles||[])Le(r)?i.push(this.canonicalizeTileURL(r,n)):i.push(r);return i}_makeAPIURL(e,t){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=je(a.API_URL);if(e.protocol=i.protocol,e.authority=i.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==i.path&&(e.path="".concat(i.path).concat(e.path)),!a.REQUIRE_ACCESS_TOKEN)return Ve(e);if(t=t||a.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n))}return e.params=e.params.filter(e=>-1===e.indexOf("access_token")),e.params.push("access_token=".concat(t||"")),Ve(e)}}function Re(e){return 0===e.indexOf("mapbox:")}function Le(e){return a.API_URL_REGEX.test(e)}function Oe(e){return a.API_CDN_URL_REGEX.test(e)}function Fe(e){return a.API_STYLE_REGEX.test(e)&&!Be(e)}function Be(e){return a.API_SPRITE_REGEX.test(e)}const Ne=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function je(e){const t=e.match(Ne);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ve(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const Ue="mapbox.eventData";function Ge(e){if(!e)return null;const n=e.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(n[1]).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(e){return null}}class qe{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Ge(a.ACCESS_TOKEN);let i="";return i=n&&n.u?t.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t)))):a.ACCESS_TOKEN||"",e?"".concat(Ue,".").concat(e,":").concat(i):"".concat(Ue,":").concat(i)}fetchEventData(){const e=se("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(n);e&&(this.eventData=JSON.parse(e));const r=t.localStorage.getItem(i);r&&(this.anonId=r)}catch(e){J("Unable to read from LocalStorage")}}saveEventData(){const e=se("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(n,JSON.stringify(this.eventData))}catch(e){J("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,i){if(!a.EVENTS_URL)return;const r=je(a.EVENTS_URL);r.params.push("access_token=".concat(i||a.ACCESS_TOKEN||""));const o={event:this.type,created:new Date(e).toISOString()},s=t?B(o,t):o,l={url:Ve(r),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return Te(B(e,{method:"POST"}),t)}(l,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const We=new class extends qe{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){a.EVENTS_URL&&a.ACCESS_TOKEN&&Array.isArray(e)&&e.some(e=>Re(e)||Le(e))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ge(a.ACCESS_TOKEN),i=t?t.u:a.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;q(this.anonId)||(this.anonId=U(),r=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(o),n=(o-this.eventData.lastSuccess)/864e5;r=r||n>=1||n<-1||e.getDate()!==t.getDate()}else r=!0;r?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:n,skuId:f,"enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=o,this.eventData.tokenU=i)},e):this.processRequests()}},Ze=We.postTurnstileEvent.bind(We),He=new class extends qe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,i){this.skuToken=t,this.errorCb=i,a.EVENTS_URL&&(n||a.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(De)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),q(this.anonId)||(this.anonId=U()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:n,skuId:f,skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e))}},Xe=He.postMapLoadEvent.bind(He),Ye=new class extends qe{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){a.EVENTS_URL&&(e||a.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:r}=this.queue.shift(),o=function(e){const i=t.performance.getEntriesByType("resource"),r=t.performance.getEntriesByType("mark"),o=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const i of e[n]){const e="".concat(n,"ResolveRangeMin"),r="".concat(n,"ResolveRangeMax"),o="".concat(n,"RequestCount"),s="".concat(n,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,i.startTime),t[r]=Math.max(t[r]||-1/0,i.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==i.transferSize&&0===i.transferSize&&a(s),a(o)}return t}(function(e,t){const n={};if(e)for(const i of e){const e=t(i);void 0===n[e]&&(n[e]=[]),n[e].push(i)}return n}(i,it)),s=t.devicePixelRatio,a=t.navigator.connection||t.navigator.mozConnection||t.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},c=(e,t,n)=>{null!=n&&e.push({name:t,value:n.toString()})};for(const t in o)c(l.counters,t,o[t]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",e.interactionRange[0]),c(l.counters,"interactionRangeMax",e.interactionRange[1])),r)for(const t of Object.keys(tt)){const e=tt[t],n=r.find(t=>t.name===e);n&&c(l.counters,e,n.startTime)}return c(l.counters,"visibilityHidden",e.visibilityHidden),c(l.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(Fe(e)){const t=e.split("/").slice(-2);if(2===t.length)return"mapbox://styles/".concat(t[0],"/").concat(t[1])}}}(i)),c(l.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",e.fogEnabled?"true":"false"),c(l.attributes,"projection",e.projection),c(l.attributes,"zoom",e.zoom),c(l.metadata,"devicePixelRatio",s),c(l.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),c(l.metadata,"navigatorUserAgent",t.navigator.userAgent),c(l.metadata,"screenWidth",t.screen.width),c(l.metadata,"screenHeight",t.screen.height),c(l.metadata,"windowWidth",t.innerWidth),c(l.metadata,"windowHeight",t.innerHeight),c(l.metadata,"mapWidth",e.width/s),c(l.metadata,"mapHeight",e.height/s),c(l.metadata,"webglRenderer",e.renderer),c(l.metadata,"webglVendor",e.vendor),c(l.metadata,"sdkVersion",n),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(r);for(const t of o.metadata);for(const t of o.counters);for(const t of o.attributes);this.postEvent(i,o,()=>{},e)}},Ke=Ye.postPerformanceEvent.bind(Ye),Je=new class extends qe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,i){if(!a.API_URL||!a.SESSION_PATH)return;const r=je(a.API_URL+a.SESSION_PATH);r.params.push("sku=".concat(t||"")),r.params.push("access_token=".concat(i||a.ACCESS_TOKEN||""));const o={url:Ve(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return Te(B(e,{method:"GET"}),t)}(o,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)})}getSessionAPI(e,t,n,i){this.skuToken=t,this.errorCb=i,a.SESSION_PATH&&a.API_URL&&(n||a.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(De)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}},$e=Je.getSessionAPI.bind(Je),Qe=new Set;function et(e,t){t?Qe.add(e):Qe.delete(e)}const tt={create:"create",load:"load",fullLoad:"fullLoad"},nt={mark(e){t.performance.mark(e)},measure(e,n,i){t.performance.measure(e,n,i)}};function it(e){const t=e.name.split("?")[0];return Oe(t)&&t.includes("mapbox-gl.js")?"javascript":Oe(t)&&t.includes("mapbox-gl.css")?"css":function(e){return a.API_FONTS_REGEX.test(e)}(t)?"fontRange":Be(t)?"sprite":Fe(t)?"style":function(e){return a.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}const rt=t.performance;function ot(e){const t=e?e.url.toString():void 0;return rt.getEntriesByName(t)}var st=at;function at(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===lt[t=e&&e.failIfMajorPerformanceCaveat]&&(lt[t]=function(e){var t,n=function(e){var t=document.createElement("canvas"),n=Object.create(at.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=e,t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}(e);if(!n)return!1;try{t=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!t||n.isContextLost())&&(n.shaderSource(t,"void main() {}"),n.compileShader(t),!0===n.getShaderParameter(t,n.COMPILE_STATUS))}(t)),lt[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var lt={};let ct,ut,ht,dt,pt;function ft(){return null==ct&&(ct=t.OffscreenCanvas&&new t.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.createImageBitmap),ct}at.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const mt={now:()=>void 0!==dt?dt:t.performance.now(),setNow(e){dt=e},restoreNow(){dt=void 0},frame(e){const n=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(n)}},getImageData(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:i,height:r}=e;pt||(pt=t.document.createElement("canvas"));const o=pt.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(i>pt.width||r>pt.height)&&(pt.width=i,pt.height=r),o.clearRect(-n,-n,i+2*n,r+2*n),o.drawImage(e,0,0,i,r),o.getImageData(-n,-n,i+2*n,r+2*n)},resolveURL:e=>(ut||(ut=t.document.createElement("a")),ut.href=e,ut.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==ht&&(ht=t.matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)},hasCanvasFingerprintNoise(){if(!ft())return!1;const e=new t.OffscreenCanvas(85,1),n=e.getContext("2d",{willReadFrequently:!0});let i=0;for(let t=0;t<e.width;++t)n.fillStyle="rgba(".concat(i++,",").concat(i++,",").concat(i++,", 255)"),n.fillRect(t,0,1,1);const r=n.getImageData(0,0,e.width,e.height);i=0;for(let t=0;t<r.data.length;++t)if(t%4!=3&&i++!==r.data[t])return!0;return!1}};function gt(e,n,i){const r=t.document.createElement(e);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r}function yt(e,n,i){const r=t.document.createElementNS("http://www.w3.org/2000/svg",e);for(const t of Object.keys(n))r.setAttributeNS(null,t,n[t]);return i&&i.appendChild(r),r}const _t=t.document&&t.document.documentElement.style,vt=_t&&void 0!==_t.userSelect?"userSelect":"WebkitUserSelect";let xt;function bt(){_t&&vt&&(xt=_t[vt],_t[vt]="none")}function wt(){_t&&vt&&(_t[vt]=xt)}function St(e){e.preventDefault(),e.stopPropagation(),t.removeEventListener("click",St,!0)}function Tt(){t.addEventListener("click",St,!0),t.setTimeout(()=>{t.removeEventListener("click",St,!0)},0)}function Et(e,t){const n=e.getBoundingClientRect();return kt(e,n,t)}function At(e,t){const n=e.getBoundingClientRect(),i=[];for(let r=0;r<t.length;r++)i.push(kt(e,n,t[r]));return i}function Mt(e){return void 0!==t.InstallTrigger&&2===e.button&&e.ctrlKey&&t.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function kt(e,t,n){const i=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new b((n.clientX-t.left)*i,(n.clientY-t.top)*i)}function Ct(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Pt(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class It{constructor(e){B(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=e}}class Dt extends It{constructor(e){super("error",B({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class zt{on(e,t){return this._listeners=this._listeners||{},Ct(e,t,this._listeners),this}off(e,t){return Pt(e,t,this._listeners),Pt(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Ct(e,t,this._oneTimeListeners),this):new Promise(t=>this.once(e,t))}fire(e,t){"string"==typeof e&&(e=new It(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of i)Pt(n,o,this._oneTimeListeners),o.call(this,e);const r=this._eventedParent;r&&(B(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof Dt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Lt{constructor(e,t,n,i){this.message=(e?"".concat(e,": "):"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}class Ot extends Lt{}function Ft(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}function Bt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Nt(e){if(Array.isArray(e))return e.map(Nt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Nt(e[n]);return t}return Bt(e)}class jt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Vt=jt;class Ut{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new Ut(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Gt=Ut;const qt={kind:"null"},Wt={kind:"number"},Zt={kind:"string"},Ht={kind:"boolean"},Xt={kind:"color"},Yt={kind:"object"},Kt={kind:"value"},Jt={kind:"collator"},$t={kind:"formatted"},Qt={kind:"resolvedImage"};function en(e,t){return{kind:"array",itemType:e,N:t}}function tn(e){if("array"===e.kind){const t=tn(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const nn=[qt,Wt,Zt,Ht,Xt,$t,Yt,en(Kt),Qt];function rn(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!rn(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of nn)if(!rn(e,t))return null}return"Expected ".concat(tn(e)," but found ").concat(tn(t)," instead.")}function on(e,t){return t.some(t=>t.kind===e.kind)}function sn(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}var an,ln={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function cn(e){return(e=Math.round(e))<0?0:e>255?255:e}function un(e){return cn("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function hn(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function dn(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{an={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in ln)return ln[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var o=n.substr(0,i),s=n.substr(i+1,r-(i+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=hn(s.pop());case"rgb":return 3!==s.length?null:[un(s[0]),un(s[1]),un(s[2]),a];case"hsla":if(4!==s.length)return null;a=hn(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=hn(s[1]),u=hn(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[cn(255*dn(d,h,l+1/3)),cn(255*dn(d,h,l)),cn(255*dn(d,h,l-1/3)),a];default:return null}}return null}}catch(e){}class pn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof pn)return e;if("string"!=typeof e)return;const t=an(e);return t?new pn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,i]=this.toArray();return"rgba(".concat(Math.round(e),",").concat(Math.round(t),",").concat(Math.round(n),",").concat(i,")")}toArray(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}toArray01(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[e/i,t/i,n/i,i]}toArray01Scaled(e){const{r:t,g:n,b:i,a:r}=this;return 0===r?[0,0,0]:[t/r*e,n/r*e,i/r*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:i}=this;return[e,t,n,i]}toArray01Linear(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[Math.pow(e/i,2.2),Math.pow(t/i,2.2),Math.pow(n/i,2.2),i]}}pn.black=new pn(0,0,0,1),pn.white=new pn(1,1,1,1),pn.transparent=new pn(0,0,0,0),pn.red=new pn(1,0,0,1),pn.blue=new pn(0,0,1,1);var fn=pn;class mn{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gn{constructor(e,t,n,i,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class yn{constructor(e){this.sections=e}static fromString(e){return new yn([new gn(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof yn?e:yn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class _n{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?"[".concat(this.namePrimary,",").concat(this.nameSecondary,"]"):this.namePrimary}static fromString(e,t){return e?new _n({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function vn(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function xn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof fn)return!0;if(e instanceof mn)return!0;if(e instanceof yn)return!0;if(e instanceof _n)return!0;if(Array.isArray(e)){for(const t of e)if(!xn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!xn(e[t]))return!1;return!0}return!1}function bn(e){if(null===e)return qt;if("string"==typeof e)return Zt;if("boolean"==typeof e)return Ht;if("number"==typeof e)return Wt;if(e instanceof fn)return Xt;if(e instanceof mn)return Jt;if(e instanceof yn)return $t;if(e instanceof _n)return Qt;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const e=bn(i);if(n){if(n===e)continue;n=Kt;break}n=e}return en(n||Kt,t)}return Yt}function wn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof fn||e instanceof yn||e instanceof _n?e.toString():JSON.stringify(e)}class Sn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!xn(e[1]))return t.error("invalid value");const n=e[1];let i=bn(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new Sn(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof fn?["rgba"].concat(this.value.toArray()):this.value instanceof yn?this.value.serialize():this.value}}var Tn=Sn,En=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const An={string:Zt,number:Wt,boolean:Ht,object:Yt};class Mn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in An)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=An[n],i++}else r=Kt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}n=en(r,o)}else n=An[r];const o=[];for(;i<e.length;i++){const n=t.parse(e[i],i,Kt);if(!n)return null;o.push(n)}return new Mn(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!rn(this.type,bn(n)))return n;if(t===this.args.length-1)throw new En("Expected value to be of type ".concat(tn(this.type),", but found ").concat(tn(bn(n))," instead."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map(e=>e.serialize()))}}var kn=Mn;class Cn{constructor(e){this.type=$t,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let o=1;o<=e.length-1;++o){const n=e[o];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let e=null;if(n["font-scale"]&&(e=t.parse(n["font-scale"],1,Wt),!e))return null;let o=null;if(n["text-font"]&&(o=t.parse(n["text-font"],1,en(Zt)),!o))return null;let s=null;if(n["text-color"]&&(s=t.parse(n["text-color"],1,Xt),!s))return null;const a=i[i.length-1];a.scale=e,a.font=o,a.textColor=s}else{const n=t.parse(e[o],1,Kt);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new Cn(i)}evaluate(e){return new yn(this.sections.map(t=>{const n=t.content.evaluate(e);return bn(n)===Qt?new gn("",n,null,null,null):new gn(wn(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Pn{constructor(e,t){this.type=Qt,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const n=t.parse(e[1],1,Zt);if(!n)return t.error("No image name provided.");if(2===e.length)return new Pn(n);const i=t.parse(e[2],1,Zt);return i?new Pn(n,i):t.error("Secondary image variant is not a string.")}evaluate(e){const t=_n.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function In(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Dn={"to-boolean":Ht,"to-color":Xt,"to-number":Wt,"to-string":Zt};class zn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0],i=[];let r=qt;if("to-array"===n){if(!Array.isArray(e[1]))return null;const n=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));r=en(t.expectedType.itemType,n)}else{if(!(n>0&&xn(e[1][0])))return null;r=en(bn(e[1][0]),n)}for(let o=0;o<n;o++){const n=e[1][o];let s;if("array"===In(n))s=t.parse(n,void 0,r.itemType);else{const e=In(n);if(e!==r.itemType.kind)return t.error("Expected ".concat(r.itemType.kind," but found ").concat(e,"."));s=t.registry.literal.parse(["literal",void 0===n?null:n],t)}if(!s)return null;i.push(s)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");r=Dn[n];for(let n=1;n<e.length;n++){const r=t.parse(e[n],n,Kt);if(!r)return null;i.push(r)}}return new zn(r,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof fn)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):vn(t[0],t[1],t[2],t[3]),!n))return new fn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new En(n||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new En("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?yn.fromString(wn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?_n.fromString(wn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(t=>t.evaluate(e)):wn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Cn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Pn(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Rn=zn;const Ln=["Unknown","Point","LineString","Polygon"];var On=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ln[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=fn.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Fn{constructor(e,t,n,i,r){this.name=e,this.type=t,this._evaluate=n,this.args=i,this._overloadIndex=r}evaluate(e){if(!this._evaluate){const e=Fn.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],i=Fn.definitions[n];if(!i)return t.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=[];let a=null,l=-1;for(const[c,u]of o){if(Array.isArray(c)&&c.length!==e.length-1)continue;s.push(c),l++,a=new Ki(t.registry,t.path,null,t.scope,void 0,t.options);const i=[];let o=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(c)?c[t-1]:c.type,s=a.parse(n,1+i.length,r);if(!s){o=!0;break}i.push(s)}if(!o)if(Array.isArray(c)&&c.length!==i.length)a.error("Expected ".concat(c.length," arguments, but found ").concat(i.length," instead."));else{for(let e=0;e<i.length;e++){const t=Array.isArray(c)?c[e]:c.type,n=i[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new Fn(n,r,u,i,l)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o.map(e=>{let[t]=e;return t})).map(Bn).join(" | "),i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],1+i.length);if(!n)return null;i.push(tn(n.type))}t.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(e,t){Fn.definitions=t;for(const n in t)e[n]=Fn}}function Bn(e){return Array.isArray(e)?"(".concat(e.map(tn).join(", "),")"):"(".concat(tn(e.type),"...)")}var Nn=Fn;class jn{constructor(e,t,n){this.type=Jt,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Ht);if(!i)return null;const r=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Ht);if(!r)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,Zt),!o)?null:new jn(i,r,o)}evaluate(e){return new mn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Vn={exports:{}};Vn.exports=function(){function e(n,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=i-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,i,Math.max(r,Math.floor(i-l*u/a+h)),Math.min(o,Math.floor(i+(a-l)*u/a+h)),s)}var d=n[i],p=r,f=o;for(t(n,r,i),s(n[o],d)>0&&t(n,r,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[r],d)?t(n,r,f):t(n,++f,o),f<=i&&(r=f+1),i<=f&&(o=f-1)}}function t(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function n(e,t){return e<t?-1:e>t?1:0}return function(t,i,r,o,s){e(t,i,r||0,o||t.length-1,s||n)}}();var Un=m(Vn.exports);function Gn(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}function qn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Wn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Zn(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function Hn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(Zn(e,a,u))return n;(o=a)[1]>(r=e)[1]!=(s=u)[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(i=!i)}}var r,o,s;return i}function Xn(e,t,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(e[0]-n[0])*o-r*(e[1]-n[1]),a=(t[0]-n[0])*o-r*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function Yn(e,t,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*o[0]&&!(!Xn(e,t,n,i)||!Xn(n,i,e,t));var r,o}const Kn=8192;function Jn(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*Kn),Math.round(i*r*Kn)]}function $n(e,t){for(let n=0;n<t.length;n++)if(Hn(e,t[n]))return!0;return!1}function Qn(e,t,n){for(const i of n)for(let n=0,r=i.length,o=r-1;n<r;o=n++)if(Yn(e,t,i[o],i[n]))return!0;return!1}function ei(e,t){for(let n=0;n<e.length;++n)if(!Hn(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Qn(e[n],e[n+1],t))return!1;return!0}function ti(e,t){for(let n=0;n<t.length;n++)if(ei(e,t[n]))return!0;return!1}function ni(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=[];for(let i=0;i<e[r].length;i++){const s=Jn(e[r][i],n);qn(t,s),o.push(s)}i.push(o)}return i}function ii(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=ni(e[r],t,n);i.push(o)}return i}function ri(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}qn(t,e)}function oi(e,t,n,i){const r=Math.pow(2,i.z)*Kn,o=[i.x*Kn,i.y*Kn],s=[];if(!e)return s;for(const a of e)for(const e of a){const i=[e.x+o[0],e.y+o[1]];ri(i,t,n,r),s.push(i)}return s}function si(e,t,n,i){const r=Math.pow(2,i.z)*Kn,o=[i.x*Kn,i.y*Kn],s=[];if(!e)return s;for(const l of e){const e=[];for(const n of l){const i=[n.x+o[0],n.y+o[1]];qn(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const i of e)ri(i,t,n,r)}var a;return s}class ai{constructor(e,t){this.type=Ht,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(xn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new ai(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ai(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ai(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=ni(t.coordinates,i,r),s=oi(e.geometry(),n,i,r);if(!Wn(n,i))return!1;for(const e of s)if(!Hn(e,o))return!1}if("MultiPolygon"===t.type){const o=ii(t.coordinates,i,r),s=oi(e.geometry(),n,i,r);if(!Wn(n,i))return!1;for(const e of s)if(!$n(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=ni(t.coordinates,i,r),s=si(e.geometry(),n,i,r);if(!Wn(n,i))return!1;for(const e of s)if(!ei(e,o))return!1}if("MultiPolygon"===t.type){const o=ii(t.coordinates,i,r),s=si(e.geometry(),n,i,r);if(!Wn(n,i))return!1;for(const e of s)if(!ti(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var li=ai,ci={exports:{}};ci.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,n=t*(2-t),i=Math.PI/180,r=function(t,r){if(void 0===t)throw new Error("No latitude given.");if(r&&!e[r])throw new Error("Unknown unit "+r+". Use one of: "+Object.keys(e).join(", "));var o=6378.137*i*(r?e[r]:1),s=Math.cos(t*i),a=1/(1-n*(1-s*s)),l=Math.sqrt(a);this.kx=o*l*s,this.ky=o*l*a*(1-n)},o={units:{configurable:!0}};function s(e,t){return e[0]===t[0]&&e[1]===t[1]}function a(e,t,n){var i=l(t[0]-e[0]);return[e[0]+i*n,e[1]+(t[1]-e[1])*n]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return r.fromTile=function(e,t,n){var o=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),s=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/i;return new r(s,n)},o.units.get=function(){return e},r.prototype.distance=function(e,t){var n=l(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)},r.prototype.bearing=function(e,t){var n=l(t[0]-e[0])*this.kx;return Math.atan2(n,(t[1]-e[1])*this.ky)/i},r.prototype.destination=function(e,t,n){var r=n*i;return this.offset(e,Math.sin(r)*t,Math.cos(r)*t)},r.prototype.offset=function(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]},r.prototype.lineDistance=function(e){for(var t=0,n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t},r.prototype.area=function(e){for(var t=0,n=0;n<e.length;n++)for(var i=e[n],r=0,o=i.length,s=o-1;r<o;s=r++)t+=l(i[r][0]-i[s][0])*(i[r][1]+i[s][1])*(n?-1:1);return Math.abs(t)/2*this.kx*this.ky},r.prototype.along=function(e,t){var n=0;if(t<=0)return e[0];for(var i=0;i<e.length-1;i++){var r=e[i],o=e[i+1],s=this.distance(r,o);if((n+=s)>t)return a(r,o,(t-(n-s))/s)}return e[e.length-1]},r.prototype.pointToSegmentDistance=function(e,t,n){var i=t[0],r=t[1],o=l(n[0]-i)*this.kx,s=(n[1]-r)*this.ky,a=0;return 0===o&&0===s||((a=(l(e[0]-i)*this.kx*o+(e[1]-r)*this.ky*s)/(o*o+s*s))>1?(i=n[0],r=n[1]):a>0&&(i+=o/this.kx*a,r+=s/this.ky*a)),o=l(e[0]-i)*this.kx,s=(e[1]-r)*this.ky,Math.sqrt(o*o+s*s)},r.prototype.pointOnLine=function(e,t){for(var n,i,r,o,s=1/0,a=0;a<e.length-1;a++){var c=e[a][0],u=e[a][1],h=l(e[a+1][0]-c)*this.kx,d=(e[a+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(t[0]-c)*this.kx*h+(t[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=e[a+1][0],u=e[a+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(t[0]-c)*this.kx)*h+(d=(t[1]-u)*this.ky)*d;f<s&&(s=f,n=c,i=u,r=a,o=p)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,o))}},r.prototype.lineSlice=function(e,t,n){var i=this.pointOnLine(n,e),r=this.pointOnLine(n,t);if(i.index>r.index||i.index===r.index&&i.t>r.t){var o=i;i=r,r=o}var a=[i.point],l=i.index+1,c=r.index;!s(n[l],a[0])&&l<=c&&a.push(n[l]);for(var u=l+1;u<=c;u++)a.push(n[u]);return s(n[c],r.point)||a.push(r.point),a},r.prototype.lineSliceAlong=function(e,t,n){for(var i=0,r=[],o=0;o<n.length-1;o++){var s=n[o],l=n[o+1],c=this.distance(s,l);if((i+=c)>e&&0===r.length&&r.push(a(s,l,(e-(i-c))/c)),i>=t)return r.push(a(s,l,(t-(i-c))/c)),r;i>e&&r.push(l)}return r},r.prototype.bufferPoint=function(e,t){var n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[0]+i,e[1]+n]},r.prototype.bufferBBox=function(e,t){var n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[2]+i,e[3]+n]},r.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(r,o),r}();var ui=m(ci.exports),hi={exports:{}};hi.exports=function(){var e=function(e,n){if(void 0===e&&(e=[]),void 0===n&&(n=t),this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i},e.prototype._down=function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var o=1+(e<<1),s=t[o],a=o+1;if(a<this.length&&n(t[a],s)<0&&(o=a,s=t[a]),n(s,r)>=0)break;t[e]=s,e=o}t[e]=r},e}();var di=m(hi.exports),pi=8192;function fi(e,t){return t.dist-e.dist}const mi=100,gi=50;function yi(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function _i(e){return e[1]-e[0]+1}function vi(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function xi(e,t){if(e[0]>e[1])return[null,null];const n=_i(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===n)return[e,null];const t=Math.floor(n/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function bi(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!vi(t,e.length))return n;for(let i=t[0];i<=t[1];++i)qn(n,e[i]);return n}function wi(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)qn(t,e[n][i]);return t}function Si(e,t,n){if(yi(e)||yi(t))return NaN;let i=0,r=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),n.distance([0,0],[i,r])}function Ti(e,t){const n=Math.pow(2,t.z);return[(r=(e.x/pi+t.x)/n,360*r-180),(i=(e.y/pi+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function Ei(e,t){const n=[];for(let i=0;i<e.length;++i)n.push(Ti(e[i],t));return n}function Ai(e,t,n){const i=n.pointOnLine(t,e).point;return n.distance(e,i)}function Mi(e,t,n,i,r){const o=n.slice(i[0],i[1]+1);let s=1/0;for(let a=t[0];a<=t[1];++a)if(0===(s=Math.min(s,Ai(e[a],o,r))))return 0;return s}function ki(e,t,n,i,r){const o=Math.min(r.pointToSegmentDistance(e,n,i),r.pointToSegmentDistance(t,n,i)),s=Math.min(r.pointToSegmentDistance(n,e,t),r.pointToSegmentDistance(i,e,t));return Math.min(o,s)}function Ci(e,t,n,i,r){if(!vi(t,e.length)||!vi(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let t=i[0];t<i[1];++t){if(Yn(e[s],e[s+1],n[t],n[t+1]))return 0;o=Math.min(o,ki(e[s],e[s+1],n[t],n[t+1],r))}return o}function Pi(e,t,n,i,r){if(!vi(t,e.length)||!vi(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=i[0];t<=i[1];++t)if(0===(o=Math.min(o,r.distance(e[s],n[t]))))return o;return o}function Ii(e,t,n){if(Hn(e,t,!0))return 0;let i=1/0;for(const r of t){const t=r.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[t-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(e,r[t-1],r[0]))))return i;if(0===(i=Math.min(i,Ai(e,r,n))))return i}return i}function Di(e,t,n,i){if(!vi(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(Hn(e[o],n,!0))return 0;let r=1/0;for(let o=t[0];o<t[1];++o)for(const t of n)for(let n=0,s=t.length,a=s-1;n<s;a=n++){if(Yn(e[o],e[o+1],t[a],t[n]))return 0;r=Math.min(r,ki(e[o],e[o+1],t[a],t[n],i))}return r}function zi(e,t){for(const n of e)for(let e=0;e<=n.length-1;++e)if(Hn(n[e],t,!0))return!0;return!1}function Ri(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=wi(e),o=wi(t);if(i!==1/0&&Si(r,o,n)>=i)return i;if(Wn(r,o)){if(zi(e,t))return 0}else if(zi(t,e))return 0;let s=i;for(const a of e)for(let e=0,i=a.length,r=i-1;e<i;r=e++)for(const o of t)for(let t=0,i=o.length,l=i-1;t<i;l=t++){if(Yn(a[r],a[e],o[l],o[t]))return 0;s=Math.min(s,ki(a[r],a[e],o[l],o[t],n))}return s}function Li(e,t,n,i,r,o,s){if(null===o||null===s)return;const a=Si(bi(i,o),bi(r,s),n);a<t&&e.push({dist:a,range1:o,range2:s})}function Oi(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=Math.min(i.distance(e[0],n[0][0]),r);if(0===o)return o;const s=new di([{dist:0,range1:[0,e.length-1],range2:[0,0]}],fi),a=t?gi:mi,l=wi(n);for(;s.length;){const r=s.pop();if(r.dist>=o)continue;const c=r.range1;if(_i(c)<=a){if(!vi(c,e.length))return NaN;if(t){const t=Di(e,c,n,i);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const r=Ii(e[t],n,i);if(0===(o=Math.min(o,r)))return o}}else{const n=xi(c,t);if(null!==n[0]){const t=Si(bi(e,n[0]),l,i);t<o&&s.push({dist:t,range1:n[0],range2:[0,0]})}if(null!==n[1]){const t=Si(bi(e,n[1]),l,i);t<o&&s.push({dist:t,range1:n[1],range2:[0,0]})}}}return o}function Fi(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,s=Math.min(o,r.distance(e[0],n[0]));if(0===s)return s;const a=new di([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],fi),l=t?gi:mi,c=i?gi:mi;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(_i(u)<=l&&_i(h)<=c){if(!vi(u,e.length)||!vi(h,n.length))return NaN;if(t&&i?s=Math.min(s,Ci(e,u,n,h,r)):t||i?t&&!i?s=Math.min(s,Mi(n,h,e,u,r)):!t&&i&&(s=Math.min(s,Mi(e,u,n,h,r))):s=Math.min(s,Pi(e,u,n,h,r)),0===s)return s}else{const o=xi(u,t),l=xi(h,i);Li(a,s,r,e,n,o[0],l[0]),Li(a,s,r,e,n,o[0],l[1]),Li(a,s,r,e,n,o[1],l[0]),Li(a,s,r,e,n,o[1],l[1])}}return s}function Bi(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=bi(e,[0,e.length-1]);for(const s of n)if(!(r!==1/0&&Si(o,bi(s,[0,s.length-1]),i)>=r)&&(r=Math.min(r,Fi(e,t,s,!0,i,r)),0===r))return r;return r}function Ni(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=bi(e,[0,e.length-1]);for(const s of n){if(r!==1/0&&Si(o,wi(s),i)>=r)continue;const n=Oi(e,t,s,i,r);if(isNaN(n))return n;if(0===(r=Math.min(r,n)))return r}return r}function ji(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class Vi{constructor(e,t){this.type=Wt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(xn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(ji(t.features[e].geometry.type))return new Vi(t,t.features[e].geometry)}else if("Feature"===t.type){if(ji(t.geometry.type))return new Vi(t,t.geometry)}else if(ji(t.type))return new Vi(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),n=e.canonicalID();if(null!=t&&null!=n){if("Point"===e.geometryType())return function(e,t,n){const i=[];for(const o of e)for(const e of o)i.push(Ti(e,t));const r=new ui(i[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?Fi(i,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r):"MultiLineString"===n.type?Bi(i,!1,n.coordinates,r):"Polygon"===n.type||"MultiPolygon"===n.type?Ni(i,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,r):null}(t,n,this.geometries);if("LineString"===e.geometryType())return function(e,t,n){const i=[];for(const o of e){const e=[];for(const n of o)e.push(Ti(n,t));i.push(e)}const r=new ui(i[0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return Bi("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=Bi(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===n.type||"MultiPolygon"===n.type){let e=1/0;for(let t=0;t<i.length;t++){const o=Ni(i[t],!0,"Polygon"===n.type?[n.coordinates]:n.coordinates,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,n,this.geometries);if("Polygon"===e.geometryType())return function(e,t,n){const i=[];for(const o of function(e){const t=e.length;if(t<=1)return[e];const n=[];let i,r;for(let o=0;o<t;o++){const t=Gn(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}return i&&n.push(i),n}(e)){const e=[];for(let n=0;n<o.length;++n)e.push(Ei(o[n],t));i.push(e)}const r=new ui(i[0][0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return Ni("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=Ni(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===n.type||"MultiPolygon"===n.type?function(e,t,n){let i=1/0;for(const r of e)for(const e of t){const t=Ri(r,e,n,i);if(isNaN(t))return t;if(0===(i=Math.min(i,t)))return i}return i}("Polygon"===n.type?[n.coordinates]:n.coordinates,i,r):null}(t,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Ui=Vi;function Gi(e){if(e instanceof Nn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof li)return!1;if(e instanceof Ui)return!1;let t=!0;return e.eachChild(e=>{t&&!Gi(e)&&(t=!1)}),t}function qi(e){if(e instanceof Nn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!qi(e)&&(t=!1)}),t}function Wi(e){if(e instanceof Nn&&"config"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!Wi(e)&&(t=!1)}),t}function Zi(e,t){if(e instanceof Nn&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(e=>{n&&!Zi(e,t)&&(n=!1)}),n}class Hi{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Hi(n,t.scope.get(n)):t.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Xi=Hi;class Yi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Gt,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0;this.registry=e,this.path=t,this.key=t.map(e=>"[".concat(e,"]")).join(""),this.scope=i,this.errors=r,this.expectedType=n,this.options=o}parse(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||n?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}_parse(e,t){function n(e,t,n){return"assert"===n?new kn(t,[e]):"coerce"===n?new Rn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i="string"==typeof e[0]?this.registry[e[0]]:void 0;if(i){let r=i.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,i=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else r=n(r,e,t.typeAnnotation||"coerce");else r=n(r,e,t.typeAnnotation||"assert")}if(!(r instanceof Tn)&&"resolvedImage"!==r.type.kind&&Ji(r)){const t=new On(this.options);try{r=new Tn(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return Rn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new Yi(this.registry,i,t||null,r,this.errors,this.options)}error(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map(e=>"[".concat(e,"]")).join(""));this.errors.push(new Vt(r,e))}checkSubtype(e,t){const n=rn(e,t);return n&&this.error(n),n}}var Ki=Yi;function Ji(e){if(e instanceof Xi)return Ji(e.boundExpression);if(e instanceof Nn&&"error"===e.name)return!1;if(e instanceof Nn&&"config"===e.name)return!1;if(e instanceof jn)return!1;if(e instanceof li)return!1;if(e instanceof Ui)return!1;const t=e instanceof Rn||e instanceof kn;let n=!0;return e.eachChild(e=>{n=t?n&&Ji(e):n&&e instanceof Tn}),!!n&&Gi(e)&&Zi(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function $i(e,t){const n=e.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=e[a],r=e[a+1],i<=t){if(a===n||t<r)return a;o=a+1}else{if(!(i>t))throw new En("Input is not a number.");s=a-1}return 0}class Qi{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,Wt);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let o=1;o<e.length;o+=2){const n=1===o?-1/0:e[o],s=e[o+1],a=o,l=o+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new Qi(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[$i(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var er=Qi;function tr(e,t,n){return e*(1-n)+t*n}function nr(e,t,n){return e.map((e,i)=>tr(e,t[i],n))}var ir=Object.freeze({__proto__:null,array:nr,color:function(e,t,n){return new fn(tr(e.r,t.r,n),tr(e.g,t.g,n),tr(e.b,t.b,n),tr(e.a,t.a,n))},number:tr});const rr=.95047,or=1.08883,sr=4/29,ar=6/29,lr=3*ar*ar,cr=ar*ar*ar,ur=Math.PI/180,hr=180/Math.PI;function dr(e){return e>cr?Math.pow(e,1/3):e/lr+sr}function pr(e){return e>ar?e*e*e:lr*(e-sr)}function fr(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function mr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function gr(e){const t=mr(e.r),n=mr(e.g),i=mr(e.b),r=dr((.4124564*t+.3575761*n+.1804375*i)/rr),o=dr((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-dr((.0193339*t+.119192*n+.9503041*i)/or)),alpha:e.a}}function yr(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*pr(t),n=rr*pr(n),i=or*pr(i),new fn(fr(3.2404542*n-1.5371385*t-.4985314*i),fr(-.969266*n+1.8760108*t+.041556*i),fr(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function _r(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const vr={forward:gr,reverse:yr,interpolate:function(e,t,n){return{l:tr(e.l,t.l,n),a:tr(e.a,t.a,n),b:tr(e.b,t.b,n),alpha:tr(e.alpha,t.alpha,n)}}},xr={forward:function(e){const{l:t,a:n,b:i}=gr(e),r=Math.atan2(i,n)*hr;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ur,n=e.c;return yr({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:_r(e.h,t.h,n),c:tr(e.c,t.c,n),l:tr(e.l,t.l,n),alpha:tr(e.alpha,t.alpha,n)}}};var br=Object.freeze({__proto__:null,hcl:xr,lab:vr});class wr{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,s]of r)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(e,t,n,i){let r=0;if("exponential"===e.name)r=Sr(t,e.base,n,i);else if("linear"===e.name)r=Sr(t,1,n,i);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new _(o[0],o[1],o[2],o[3]).solve(Sr(t,1,n,i))}return r}static parse(e,t){let[n,i,r,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const e=i.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,Wt),!r)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=Xt:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],n=o[l+1],i=l+3,r=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(s.length&&s[s.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,r,a);if(!c)return null;a=a||c.type,s.push([e,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new wr(a,n,i,r,s):t.error("Type ".concat(tn(a)," is not interpolatable."))}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const o=$i(t,i),s=wr.interpolationFactor(this.interpolation,i,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);return"interpolate"===this.operator?ir[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?xr.reverse(xr.interpolate(xr.forward(a),xr.forward(l),s)):vr.reverse(vr.interpolate(vr.forward(a),vr.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function Sr(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var Tr=wr;class Er{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const s of e.slice(1)){const e=t.parse(s,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}const o=i&&r.some(e=>rn(i,e.type));return new Er(o?Kt:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args){if(i++,n=r.evaluate(e),n&&n instanceof _n&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Ar=Er;class Mr{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const n=[];for(let r=1;r<e.length-1;r+=2){const i=e[r];if("string"!=typeof i)return t.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;n.push([i,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Mr(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var kr=Mr;class Cr{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Wt),i=t.parse(e[2],2,en(t.expectedType||Kt));return n&&i?new Cr(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new En("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new En("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new En("Array index must be an integer, but found ".concat(t," instead."));return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Pr=Cr;class Ir{constructor(e,t){this.type=Ht,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Kt),i=t.parse(e[2],2,Kt);return n&&i?on(n.type,[Ht,Zt,Wt,qt,Kt])?new Ir(n,i):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(tn(n.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!sn(t,["boolean","string","number","null"]))throw new En("Expected first argument to be of type boolean, string, number or null, but found ".concat(tn(bn(t))," instead."));if(!sn(n,["string","array"]))throw new En("Expected second argument to be of type array or string, but found ".concat(tn(bn(n))," instead."));return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Dr=Ir;class zr{constructor(e,t,n){this.type=Wt,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Kt),i=t.parse(e[2],2,Kt);if(!n||!i)return null;if(!on(n.type,[Ht,Zt,Wt,qt,Kt]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(tn(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,Wt);return r?new zr(n,i,r):null}return new zr(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!sn(t,["boolean","string","number","null"]))throw new En("Expected first argument to be of type boolean, string, number or null, but found ".concat(tn(bn(t))," instead."));if(!sn(n,["string","array"]))throw new En("Expected second argument to be of type array or string, but found ".concat(tn(bn(n))," instead."));if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Rr=zr;class Lr{constructor(e,t,n,i,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},o=[];for(let l=2;l<e.length-1;l+=2){let s=e[l];const a=e[l+1];Array.isArray(s)||(s=[s]);const c=t.concat(l);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,bn(e)))return null}else n=bn(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(a,l,i);if(!u)return null;i=i||u.type,o.push(u)}const s=t.parse(e[1],1,Kt);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,i);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new Lr(n,i,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(bn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const o of t){const e=i[this.cases[o]];void 0===e?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[e][1].push(o)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,s]of n)e.push(1===s.length?r(s[0]):s.map(r)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var Or=Lr;class Fr{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const r=t.parse(e[o],o,Ht);if(!r)return null;const s=t.parse(e[o+1],o+1,n);if(!s)return null;i.push([r,s]),n=n||s.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new Fr(n,i,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(e=>{let[t,n]=e;return n.outputDefined()})&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Br=Fr;class Nr{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,Kt),i=t.parse(e[2],2,Wt);if(!n||!i)return null;if(!on(n.type,[en(Kt),Zt,Kt]))return t.error("Expected first argument to be of type array or string, but found ".concat(tn(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,Wt);return r?new Nr(n.type,n,i,r):null}return new Nr(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!sn(t,["string","array"]))throw new En("Expected first argument to be of type array or string, but found ".concat(tn(bn(t))," instead."));if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var jr=Nr;function Vr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Ur(e,t,n,i){return 0===i.compare(t,n)}function Gr(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=Ht,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,Kt);if(!o)return null;if(!Vr(n,o.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(tn(o.type),"'."));let s=t.parse(e[2],2,Kt);if(!s)return null;if(!Vr(n,s.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(tn(s.type),"'."));if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot compare types '".concat(tn(o.type),"' and '").concat(tn(s.type),"'."));i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new kn(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new kn(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Jt),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=bn(o),n=bn(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new En('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const e=bn(o),n=bn(s);if("string"!==e.kind||"string"!==n.kind)return t(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild(e=>{t.push(e.serialize())}),t}}}const qr=Gr("==",function(e,t,n){return t===n},Ur),Wr=Gr("!=",function(e,t,n){return t!==n},function(e,t,n,i){return!Ur(0,t,n,i)}),Zr=Gr("<",function(e,t,n){return t<n},function(e,t,n,i){return i.compare(t,n)<0}),Hr=Gr(">",function(e,t,n){return t>n},function(e,t,n,i){return i.compare(t,n)>0}),Xr=Gr("<=",function(e,t,n){return t<=n},function(e,t,n,i){return i.compare(t,n)<=0}),Yr=Gr(">=",function(e,t,n){return t>=n},function(e,t,n,i){return i.compare(t,n)>=0});class Kr{constructor(e,t,n,i,r,o){this.type=Zt,this.number=e,this.locale=t,this.currency=n,this.unit=i,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Wt);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parse(i.locale,1,Zt),!r))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,Zt),!o))return null;let s=null;if(i.unit&&(s=t.parse(i.unit,1,Zt),!s))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,Wt),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,Wt),!l)?null:new Kr(n,r,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Jr{constructor(e){this.type=Wt,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error("Expected argument of type string or array, but found ".concat(tn(n.type)," instead.")):new Jr(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new En("Expected value to be of type string or array, but found ".concat(tn(bn(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}function $r(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Qr={"==":qr,"!=":Wr,">":Hr,"<":Zr,">=":Yr,"<=":Xr,array:kn,at:Pr,boolean:kn,case:Br,coalesce:Ar,collator:jn,format:Cn,image:Pn,in:Dr,"index-of":Rr,interpolate:Tr,"interpolate-hcl":Tr,"interpolate-lab":Tr,length:Jr,let:kr,literal:Tn,match:Or,number:kn,"number-format":Kr,object:kn,slice:jr,step:er,string:kn,"to-boolean":Rn,"to-color":Rn,"to-number":Rn,"to-string":Rn,var:Xi,within:li,distance:Ui};function eo(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const s=o?o.evaluate(e):1,a=vn(n,i,r,s);if(a)throw new En(a);return new fn(n/255*s,i/255*s,r/255*s,s)}function to(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const s=o?o.evaluate(e):1,a=function(e,t,n,i){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof n&&n>=0&&n<=100?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid hsla value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'h' must be between 0 and 360.")}(n,i,r,s);if(a)throw new En(a);const l="hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(s,")"),c=fn.parse(l);if(!c)throw new En("Failed to parse HSLA color: ".concat(l));return c}function no(e,t){return e in t}function io(e,t){const n=t[e];return void 0===n?null:n}function ro(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return fn.parse(t)}return t}function oo(e,t,n,i){return void 0!==i&&(e=i*Math.round(e/i)),void 0!==t&&e<t&&(e=t),void 0!==n&&e>n&&(e=n),e}function so(e,t,n){n.length&&(t+="\x1f".concat(n));const i=e.getConfig(t);if(!i)return null;const{type:r,value:o,values:s,minValue:a,maxValue:l,stepValue:c}=i,u=i.default.evaluate(e);let h=o?o.evaluate(e):u;return r&&(h=ro(r,h)),void 0!==o&&void 0!==h&&s&&!s.includes(h)&&(h=u,r&&(h=ro(r,h))),void 0===h||void 0===a&&void 0===l&&void 0===c||("number"==typeof h?h=oo(h,a,l,c):Array.isArray(h)&&(h=h.map(e=>"number"==typeof e?oo(e,a,l,c):e))),h}function ao(e){return{type:e}}Nn.register(Qr,{error:[{kind:"error"},[Zt],(e,t)=>{let[n]=t;throw new En(n.evaluate(e))}],typeof:[Zt,[Kt],(e,t)=>{let[n]=t;return tn(bn(n.evaluate(e)))}],"to-rgba":[en(Wt,4),[Xt],(e,t)=>{let[n]=t;return n.evaluate(e).toArray()}],rgb:[Xt,[Wt,Wt,Wt],eo],rgba:[Xt,[Wt,Wt,Wt,Wt],eo],hsl:[Xt,[Wt,Wt,Wt],to],hsla:[Xt,[Wt,Wt,Wt,Wt],to],has:{type:Ht,overloads:[[[Zt],(e,t)=>{let[n]=t;return no(n.evaluate(e),e.properties())}],[[Zt,Yt],(e,t)=>{let[n,i]=t;return no(n.evaluate(e),i.evaluate(e))}]]},get:{type:Kt,overloads:[[[Zt],(e,t)=>{let[n]=t;return io(n.evaluate(e),e.properties())}],[[Zt,Yt],(e,t)=>{let[n,i]=t;return io(n.evaluate(e),i.evaluate(e))}]]},config:{type:Kt,overloads:[[[Zt],(e,t)=>{let[n]=t;return so(e,n.evaluate(e),"")}],[[Zt,Zt],(e,t)=>{let[n,i]=t;return so(e,n.evaluate(e),i.evaluate(e))}]]},"feature-state":[Kt,[Zt],(e,t)=>{let[n]=t;return io(n.evaluate(e),e.featureState||{})}],properties:[Yt,[],e=>e.properties()],"geometry-type":[Zt,[],e=>e.geometryType()],id:[Kt,[],e=>e.id()],zoom:[Wt,[],e=>e.globals.zoom],pitch:[Wt,[],e=>e.globals.pitch||0],"distance-from-center":[Wt,[],e=>e.distanceFromCenter()],"measure-light":[Wt,[Zt],(e,t)=>{let[n]=t;return e.measureLight(n.evaluate(e))}],"heatmap-density":[Wt,[],e=>e.globals.heatmapDensity||0],"line-progress":[Wt,[],e=>e.globals.lineProgress||0],"raster-value":[Wt,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[Wt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Kt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Wt,ao(Wt),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[Wt,ao(Wt),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:Wt,overloads:[[[Wt,Wt],(e,t)=>{let[n,i]=t;return n.evaluate(e)-i.evaluate(e)}],[[Wt],(e,t)=>{let[n]=t;return-n.evaluate(e)}]]},"/":[Wt,[Wt,Wt],(e,t)=>{let[n,i]=t;return n.evaluate(e)/i.evaluate(e)}],"%":[Wt,[Wt,Wt],(e,t)=>{let[n,i]=t;return n.evaluate(e)%i.evaluate(e)}],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(e,t)=>{let[n,i]=t;return Math.pow(n.evaluate(e),i.evaluate(e))}],sqrt:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.sqrt(n.evaluate(e))}],log10:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN10}],ln:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))}],log2:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN2}],sin:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.sin(n.evaluate(e))}],cos:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.cos(n.evaluate(e))}],tan:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.tan(n.evaluate(e))}],asin:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.asin(n.evaluate(e))}],acos:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.acos(n.evaluate(e))}],atan:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.atan(n.evaluate(e))}],min:[Wt,ao(Wt),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[Wt,ao(Wt),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.abs(n.evaluate(e))}],round:[Wt,[Wt],(e,t)=>{let[n]=t;const i=n.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.floor(n.evaluate(e))}],ceil:[Wt,[Wt],(e,t)=>{let[n]=t;return Math.ceil(n.evaluate(e))}],"filter-==":[Ht,[Zt,Kt],(e,t)=>{let[n,i]=t;return e.properties()[n.value]===i.value}],"filter-id-==":[Ht,[Kt],(e,t)=>{let[n]=t;return e.id()===n.value}],"filter-type-==":[Ht,[Zt],(e,t)=>{let[n]=t;return e.geometryType()===n.value}],"filter-<":[Ht,[Zt,Kt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[Ht,[Kt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Ht,[Zt,Kt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>o}],"filter-id->":[Ht,[Kt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Ht,[Zt,Kt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[Ht,[Kt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Ht,[Zt,Kt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[Ht,[Kt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Ht,[Kt],(e,t)=>{let[n]=t;return n.value in e.properties()}],"filter-has-id":[Ht,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Ht,[en(Zt)],(e,t)=>{let[n]=t;return n.value.indexOf(e.geometryType())>=0}],"filter-id-in":[Ht,[en(Kt)],(e,t)=>{let[n]=t;return n.value.indexOf(e.id())>=0}],"filter-in-small":[Ht,[Zt,en(Kt)],(e,t)=>{let[n,i]=t;return i.value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[Ht,[Zt,en(Kt)],(e,t)=>{let[n,i]=t;return function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:Ht,overloads:[[[Ht,Ht],(e,t)=>{let[n,i]=t;return n.evaluate(e)&&i.evaluate(e)}],[ao(Ht),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],(e,t)=>{let[n,i]=t;return n.evaluate(e)||i.evaluate(e)}],[ao(Ht),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Ht,[Ht],(e,t)=>{let[n]=t;return!n.evaluate(e)}],"is-supported-script":[Ht,[Zt],(e,t)=>{let[n]=t;const i=e.globals&&e.globals.isSupportedScript;return!i||i(n.evaluate(e))}],upcase:[Zt,[Zt],(e,t)=>{let[n]=t;return n.evaluate(e).toUpperCase()}],downcase:[Zt,[Zt],(e,t)=>{let[n]=t;return n.evaluate(e).toLowerCase()}],concat:[Zt,ao(Kt),(e,t)=>t.map(t=>wn(t.evaluate(e))).join("")],"resolved-locale":[Zt,[Jt],(e,t)=>{let[n]=t;return n.evaluate(e).resolvedLocale()}],random:[Wt,[Wt,Wt,Kt],(e,t)=>{const[n,i,r]=t.map(t=>t.evaluate(e));if(n>i)return n;if(n===i)return n;let o;if("string"==typeof r)o=function(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(r);else{if("number"!=typeof r)throw new En("Invalid seed input: ".concat(r));o=r}return n+$r(o)()*(i-n)}]});var lo=Qr;function co(e){return{result:"success",value:e}}function uo(e){return{result:"error",value:e}}function ho(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function po(e){return"data-driven"===e["property-type"]}function fo(e){return ho(e.expression,"measure-light")}function mo(e){return ho(e.expression,"zoom")}function go(e){return!!e.expression&&e.expression.interpolated}function yo(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function _o(e){return e}function vo(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),o=e.type||(go(t)?"exponential":"interval");if(n&&((e=Ft({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],fn.parse(e[1])])),e.default=fn.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!br[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let s,a,l;if("exponential"===o)s=So;else if("interval"===o)s=wo;else if("categorical"===o){s=bo,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error('Unknown function type "'.concat(o,'"'));s=To}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,vo(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Tr.interpolationFactor.bind(void 0,o),zoomStops:r.map(e=>e[0]),evaluate:(n,i)=>{let{zoom:o}=n;return So({stops:r,base:e.base},t,o).evaluate(o,i)}}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:Tr.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map(e=>e[0]),evaluate:n=>{let{zoom:i}=n;return s(e,t,i,a,l)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?xo(e.default,t.default):s(e,t,r,a,l)}}}function xo(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function bo(e,t,n,i,r){return xo(typeof n===r?i[n]:void 0,e.default,t.default)}function wo(e,t,n){if("number"!==In(n))return xo(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=$i(e.stops.map(e=>e[0]),n);return e.stops[r][1]}function So(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==In(n))return xo(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const o=$i(e.stops.map(e=>e[0]),n),s=function(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=ir[t.type]||_o;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=br[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=a.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return c(i,r,s)}}:c(a,l,s)}function To(e,t,n){return"color"===t.type?n=fn.parse(n):"formatted"===t.type?n=yn.fromString(n.toString()):"resolvedImage"===t.type?n=_n.fromString(n.toString()):In(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),xo(n,e.default,t.default)}class Eo{constructor(e,t,n){this.expression=e,this._warningHistory={},this._evaluator=new On(n),this._defaultValue=t?function(e){return"color"===e.type&&(yo(e.default)||Array.isArray(e.default))?new fn(0,0,0,0):"color"===e.type?fn.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,r,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new En("Expected value to be one of ".concat(Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Ao(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in lo}function Mo(e,t,n){const i=new Ki(lo,[],t?function(e){const t={color:Xt,string:Zt,number:Wt,enum:Zt,boolean:Ht,formatted:$t,resolvedImage:Qt};return"array"===e.type?en(t[e.value]||Kt,e.length):t[e.type]}(t):void 0,void 0,void 0,n),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?co(new Eo(r,t,n)):uo(i.errors)}class ko{constructor(e,t,n){this.kind=e,this._styleExpression=t,this.isLightConstant=n,this.isStateDependent="constant"!==e&&!qi(t.expression),this.isConfigDependent=!Wi(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}}class Co{constructor(e,t,n,i,r){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!qi(t.expression),this.isLightConstant=r,this.isConfigDependent=!Wi(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}interpolationFactor(e,t,n){return this.interpolationType?Tr.interpolationFactor(this.interpolationType,e,t,n):0}}function Po(e,t,n){if("error"===(e=Mo(e,t,n)).result)return e;const i=e.value.expression,r=Gi(i);if(!r&&!po(t))return uo([new Vt("","data expressions not supported")]);const o=Zi(i,["zoom","pitch","distance-from-center"]);if(!o&&!mo(t))return uo([new Vt("","zoom expressions not supported")]);const s=Zi(i,["measure-light"]);if(!s&&!fo(t))return uo([new Vt("","measure-light expression not supported")]);const a=t.expression&&t.expression.relaxZoomRestriction,l=Do(i);return l||o||a?l instanceof Vt?uo([l]):l instanceof Tr&&!go(t)?uo([new Vt("",'"interpolate" expressions cannot be used with this property')]):co(l?new Co(r?"camera":"composite",e.value,l.labels,l instanceof Tr?l.interpolation:void 0,s):new ko(r?"constant":"source",e.value,s)):uo([new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Io{constructor(e,t){this._parameters=e,this._specification=t,Ft(this,vo(this._parameters,this._specification))}static deserialize(e){return new Io(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Do(e){let t=null;if(e instanceof kr)t=Do(e.result);else if(e instanceof Ar){for(const n of e.args)if(t=Do(n),t)break}else(e instanceof er||e instanceof Tr)&&e.input instanceof Nn&&"zoom"===e.input.name&&(t=e);return t instanceof Vt||e.eachChild(e=>{const n=Do(e);n instanceof Vt?t=n:t&&n&&t!==n&&(t=new Vt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function zo(e){const t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=In(n);if("object"!==l)return[new Lt(t,n,"object expected, ".concat(l," found"))];for(const c in n){const e=c.split(".")[0];let l;r[e]?l=r[e]:i[e]?l=ms:r["*"]?l=r["*"]:i["*"]&&(l=ms),l?a=a.concat(l({key:(t?"".concat(t,"."):t)+c,value:n[c],valueSpec:i[e]||i["*"],style:o,styleSpec:s,object:n,objectKey:c},n)):a.push(new Ot(t,n[c],'unknown property "'.concat(c,'"')))}for(const c in i)r[c]||i[c].required&&void 0===i[c].default&&void 0===n[c]&&a.push(new Lt(t,n,'missing required property "'.concat(c,'"')));return a}function Ro(e){const t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||ms;if("array"!==In(t))return[new Lt(o,t,"array expected, ".concat(In(t)," found"))];if(n.length&&t.length!==n.length)return[new Lt(o,t,"array length ".concat(n.length," expected, length ").concat(t.length," found"))];if(n["min-length"]&&t.length<n["min-length"])return[new Lt(o,t,"array length at least ".concat(n["min-length"]," expected, length ").concat(t.length," found"))];let a={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};r.$version<7&&(a.function=n.function),"object"===In(n.value)&&(a=n.value);let l=[];for(let c=0;c<t.length;c++)l=l.concat(s({array:t,arrayIndex:c,value:t[c],valueSpec:a,style:i,styleSpec:r,key:"".concat(o,"[").concat(c,"]")},!0));return l}function Lo(e){const t=e.key,n=e.value,i=e.valueSpec;let r=In(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new Lt(t,n,"number expected, ".concat(r," found"))];if("minimum"in i){let r=i.minimum;if("array"===In(i.minimum)&&(r=i.minimum[e.arrayIndex]),n<r)return[new Lt(t,n,"".concat(n," is less than the minimum value ").concat(r))]}if("maximum"in i){let r=i.maximum;if("array"===In(i.maximum)&&(r=i.maximum[e.arrayIndex]),n>r)return[new Lt(t,n,"".concat(n," is greater than the maximum value ").concat(r))]}return[]}function Oo(e){const t=e.valueSpec,n=Bt(e.value.type);let i,r,o,s={};const a="categorical"!==n&&void 0===e.value.property,l=!a,c="array"===In(e.value.stops)&&"array"===In(e.value.stops[0])&&"object"===In(e.value.stops[0][0]),u=zo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new Lt(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const i=e.value;return t=t.concat(Ro({key:e.key,value:i,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===In(i)&&0===i.length&&t.push(new Lt(e.key,i,"array must have at least one stop")),t},default:function(e){return ms({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&a&&u.push(new Lt(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new Lt(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!go(e.valueSpec)&&u.push(new Lt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!po(e.valueSpec)?u.push(new Lt(e.key,e.value,"property functions not supported")):a&&!mo(e.valueSpec)&&u.push(new Lt(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new Lt(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const i=e.value,a=e.key;if("array"!==In(i))return[new Lt(a,i,"array expected, ".concat(In(i)," found"))];if(2!==i.length)return[new Lt(a,i,"array length 2 expected, length ".concat(i.length," found"))];if(c){if("object"!==In(i[0]))return[new Lt(a,i,"object expected, ".concat(In(i[0])," found"))];if(void 0===i[0].zoom)return[new Lt(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Lt(a,i,"object stop key must have value")];const t=Bt(i[0].zoom);if("number"!=typeof t)return[new Lt(a,i[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new Lt(a,i[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,r=void 0,s={}),n=n.concat(zo({key:"".concat(a,"[0]"),value:i[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Lo,value:d}}))}else n=n.concat(d({key:"".concat(a,"[0]"),value:i[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},i));return Ao(Nt(i[1]))?n.concat([new Lt("".concat(a,"[1]"),i[1],"expressions are not allowed in function stops.")]):n.concat(ms({key:"".concat(a,"[1]"),value:i[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=In(e.value),l=Bt(e.value),c=null!==e.value?e.value:o;if(i){if(a!==i)return[new Lt(e.key,c,"".concat(a," stop domain type must match previous stop domain type ").concat(i))]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Lt(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i="number expected, ".concat(a," found");return po(t)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Lt(e.key,c,i)]}return"categorical"!==n||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new Lt(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in s?[new Lt(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Lt(e.key,c,"integer expected, found ".concat(String(l)))]}}function Fo(e){const t=("property"===e.expressionContext?Po:Mo)(Nt(e.value),e.valueSpec);if("error"===t.result)return t.value.map(t=>new Lt("".concat(e.key).concat(t.key),e.value,t.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Lt(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===e.expressionContext&&"layout"===e.propertyType&&!qi(n))return[new Lt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Bo(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Zi(n,["zoom","feature-state"]))return[new Lt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Gi(n))return[new Lt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bo(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const r of t.valueSpec.expression.parameters)n.delete(r);if(0===n.size)return[];const i=[];return e instanceof Nn&&n.has(e.name)?[new Lt(t.key,t.value,'["'.concat(e.name,'"] expression is not supported in a filter for a ').concat(t.object.type," layer with id: ").concat(t.object.id))]:(e.eachChild(e=>{i.push(...Bo(e,t))}),i)}function No(e){const t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Bt(n))&&r.push(new Lt(t,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(Bt(n))&&r.push(new Lt(t,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function jo(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!jo(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Vo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};jo(e)||(e=Xo(e));const n=e;let i=!0;try{i=function(e){if(!qo(e))return e;let t=Nt(e);return Go(t),t=Uo(t),t}(n)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(n,null,2),"\n        "))}const r=Rt["filter_".concat(t)],o=Mo(i,r);let s=null;if("error"===o.result)throw new Error(o.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));s=(e,t,n)=>o.value.evaluate(e,t,{},n);let a=null,l=null;if(i!==n){const e=Mo(n,r);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));a=(t,n,i,r,o)=>e.value.evaluate(t,n,{},i,void 0,void 0,r,o),l=!Gi(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Ho(i),needFeature:!!l}}function Uo(e){if(!Array.isArray(e))return e;const t=function(e){if(Wo.has(e[0]))for(let t=1;t<e.length;t++)if(qo(e[t]))return!0;return e}(e);return!0===t?t:t.map(e=>Uo(e))}function Go(e){let t=!1;const n=[];if("case"===e[0]){for(let i=1;i<e.length-1;i+=2)t=t||qo(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||qo(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||qo(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}t&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)Go(e[i])}function qo(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(qo(e[n]))return!0;return!1}const Wo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Zo(e,t){return e<t?-1:e>t?1:0}function Ho(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Ho(e[t]))return!0;return!1}function Xo(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Yo(e[1],e[2],"=="):"!="===t?$o(Yo(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Yo(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(Xo))):"all"===t?["all"].concat(e.slice(1).map(Xo)):"none"===t?["all"].concat(e.slice(1).map(Xo).map($o)):"in"===t?Ko(e[1],e.slice(2)):"!in"===t?$o(Ko(e[1],e.slice(2))):"has"===t?Jo(e[1]):"!has"!==t||$o(Jo(e[1]));var n}function Yo(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function Ko(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Zo)]]:["filter-in-small",e,["literal",t]]}}function Jo(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function $o(e){return["!",e]}function Qo(e){return jo(Nt(e.value))?Fo(Ft({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_".concat(e.layerType||"fill")]})):es(e)}function es(e){const t=e.value,n=e.key;if("array"!==In(t))return[new Lt(n,t,"array expected, ".concat(In(t)," found"))];const i=e.styleSpec;let r,o=[];if(t.length<1)return[new Lt(n,t,"filter array must have at least 1 element")];switch(o=o.concat(No({key:"".concat(n,"[0]"),value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),Bt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Bt(t[1])&&o.push(new Lt(n,t,'"$type" cannot be use with operator "'.concat(t[0],'"')));case"==":case"!=":3!==t.length&&o.push(new Lt(n,t,'filter array for operator "'.concat(t[0],'" must have 3 elements')));case"in":case"!in":t.length>=2&&(r=In(t[1]),"string"!==r&&o.push(new Lt("".concat(n,"[1]"),t[1],"string expected, ".concat(r," found"))));for(let s=2;s<t.length;s++)r=In(t[s]),"$type"===Bt(t[1])?o=o.concat(No({key:"".concat(n,"[").concat(s,"]"),value:t[s],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Lt("".concat(n,"[").concat(s,"]"),t[s],"string, number, or boolean expected, ".concat(r," found")));break;case"any":case"all":case"none":for(let i=1;i<t.length;i++)o=o.concat(es({key:"".concat(n,"[").concat(i,"]"),value:t[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=In(t[1]),2!==t.length?o.push(new Lt(n,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"string"!==r&&o.push(new Lt("".concat(n,"[1]"),t[1],"string expected, ".concat(r," found")))}return o}function ts(e,t){const n=e.key,i=e.style,r=e.layer,o=e.styleSpec,s=e.value,a=e.objectKey,l=o["".concat(t,"_").concat(e.layerType)];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return ms({key:n,value:s,valueSpec:o.transition,style:i,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new Ot(n,s,'unknown property "'.concat(a,'"'))];let h;if("string"===In(s)&&po(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s))){const e='`{ "type": "identity", "property": '.concat(h?JSON.stringify(h[1]):'"_"'," }`");return[new Lt(n,s,'"'.concat(a,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(e,"."))]}const d=[];if("symbol"===e.layerType)"text-field"!==a||!i||i.glyphs||i.imports||d.push(new Lt(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&yo(Nt(s))&&"identity"===Bt(s.type)&&d.push(new Lt(n,s,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&r&&r.layout&&r.layout.hasOwnProperty("model-id")&&po(u)&&(fo(u)||mo(u))){const e=Po(Nt(s),u),t=e.value.expression||e.value._styleExpression.expression;t&&!Zi(t,["measure-light"])&&("model-emissive-strength"===a&&Gi(t)&&qi(t)||d.push(new Lt(n,s,"".concat(a," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return d.concat(ms({key:e.key,value:s,valueSpec:u,style:i,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function ns(e){return ts(e,"paint")}function is(e){return ts(e,"layout")}function rs(e){let t=[];const n=e.value,i=e.key,r=e.style,o=e.styleSpec;n.type||n.ref||t.push(new Lt(i,n,'either "type" or "ref" is required'));let s=Bt(n.type);const a=Bt(n.ref);if(n.id){const o=Bt(n.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];Bt(e.id)===o&&t.push(new Lt(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(e.id.__line__)))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach(e=>{e in n&&t.push(new Lt(i,n[e],'"'.concat(e,'" is prohibited for ref layers')))}),r.layers.forEach(t=>{Bt(t.id)===a&&(e=t)}),e?e.ref?t.push(new Lt(i,n.ref,"ref cannot reference another ref layer")):s=Bt(e.type):"string"==typeof a&&t.push(new Lt(i,n.ref,'ref layer "'.concat(a,'" not found')))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(n.source){const e=r.sources&&r.sources[n.source],o=e&&Bt(e.type);e?"vector"===o&&"raster"===s?t.push(new Lt(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster"===o&&"raster"!==s?t.push(new Lt(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Lt(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new Lt(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new Lt(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):t.push(new Lt(i,n.source,'source "'.concat(n.source,'" not found')))}else t.push(new Lt(i,n,'missing required property "source"'));return t=t.concat(zo({key:i,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ms({key:"".concat(i,".type"),value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:e=>Qo(Ft({layerType:s},e)),layout:e=>zo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>is(Ft({layerType:s},e))}}),paint:e=>zo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ns(Ft({layerType:s,layer:n},e))}})}})),t}function os(e){const t=e.value,n=e.key,i=In(t);return"string"!==i?[new Lt(n,t,"string expected, ".concat(i," found"))]:[]}const ss={promoteId:function(e){let{key:t,value:n}=e;if("string"===In(n))return os({key:t,value:n});{const e=[];for(const i in n)e.push(...os({key:"".concat(t,".").concat(i),value:n[i]}));return e}}};function as(e){const t=e.value,n=e.key,i=e.styleSpec,r=e.style;if(!t.type)return[new Lt(n,t,'"type" is required')];const o=Bt(t.type);let s=[];switch(["vector","raster","raster-dem"].includes(o)&&(t.url||t.tiles||s.push(new Lt(n,t,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":return s=s.concat(zo({key:n,value:t,valueSpec:i["source_".concat(o.replace("-","_"))],style:e.style,styleSpec:i,objectElementValidators:ss})),s;case"geojson":if(s=zo({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:ss}),t.cluster)for(const e in t.clusterProperties){const[i,r]=t.clusterProperties[e],o="string"==typeof i?[i,["accumulated"],["get",e]]:i;s.push(...Fo({key:"".concat(n,".").concat(e,".map"),value:r,expressionContext:"cluster-map"})),s.push(...Fo({key:"".concat(n,".").concat(e,".reduce"),value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return zo({key:n,value:t,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return zo({key:n,value:t,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new Lt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return No({key:"".concat(n,".type"),value:t.type,valueSpec:{values:ls(i)},style:r,styleSpec:i})}}function ls(e){return e.source.reduce((t,n)=>{const i=e[n];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t},[])}function cs(e){const t=e.value;let n=[];if(!t)return n;const i=In(t);return"string"!==i?(n=n.concat([new Lt(e.key,t,'string expected, "'.concat(i,'" found'))]),n):(function(e){const t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),!0}catch(e){return!1}}(t)||(n=n.concat([new Lt(e.key,t,'invalid url "'.concat(t,'"'))])),n)}function us(e){const t=e.value,n=e.styleSpec,i=n.light,r=e.style;let o=[];const s=In(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Lt("light",t,"object expected, ".concat(s," found"))]),o;for(const a in t){const e=a.match(/^(.*)-transition$/);o=o.concat(e&&i[e[1]]&&i[e[1]].transition?ms({key:a,value:t[a],valueSpec:n.transition,style:r,styleSpec:n}):i[a]?ms({key:a,value:t[a],valueSpec:i[a],style:r,styleSpec:n}):[new Lt(a,t[a],'unknown property "'.concat(a,'"'))])}return o}function hs(e){const t=e.value;let n=[];if(!t)return n;const i=In(t);if("object"!==i)return n=n.concat([new Lt("light-3d",t,"object expected, ".concat(i," found"))]),n;const r=e.styleSpec,o=r["light-3d"],s=e.key,a=e.style,l=e.style.lights;for(const h of["type","id"])if(!(h in t))return n=n.concat([new Lt("light-3d",t,"missing property ".concat(h," on light"))]),n;if(t.type&&l)for(let h=0;h<e.arrayIndex;h++){const e=Bt(t.type),i=l[h];Bt(i.type)===e&&n.push(new Lt(s,t.id,'duplicate light type "'.concat(t.type,'", previously defined at line ').concat(i.id.__line__)))}const c="properties_light_".concat(t.type);if(!(c in r))return n=n.concat([new Lt("light-3d",t,"Invalid light type ".concat(t.type))]),n;const u=r[c];for(const h in t)if("properties"===h){const i=t[h],o=In(i);if("object"!==o)return n=n.concat([new Lt("properties",i,"object expected, ".concat(o," found"))]),n;for(const t in i)n=n.concat(u[t]?ms({key:t,value:i[t],valueSpec:u[t],style:a,styleSpec:r}):[new Ot(e.key,i[t],'unknown property "'.concat(t,'"'))])}else{const e=h.match(/^(.*)-transition$/);n=n.concat(e&&o[e[1]]&&o[e[1]].transition?ms({key:h,value:t[h],valueSpec:r.transition,style:a,styleSpec:r}):o[h]?ms({key:h,value:t[h],valueSpec:o[h],style:a,styleSpec:r}):[new Ot(h,t[h],'unknown property "'.concat(h,'"'))])}return n}function ds(e){const t=e.value,n=e.key,i=e.style,r=e.styleSpec,o=r.terrain;let s=[];const a=In(t);if(void 0===t)return s;if("null"===a)return s;if("object"!==a)return s=s.concat([new Lt("terrain",t,"object expected, ".concat(a," found"))]),s;for(const l in t){const e=l.match(/^(.*)-transition$/);s=s.concat(e&&o[e[1]]&&o[e[1]].transition?ms({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r}):o[l]?ms({key:l,value:t[l],valueSpec:o[l],style:i,styleSpec:r}):[new Ot(l,t[l],'unknown property "'.concat(l,'"'))])}if(t.source){const e=i.sources&&i.sources[t.source],r=e&&Bt(e.type);e?"raster-dem"!==r&&s.push(new Lt(n,t.source,"terrain cannot be used with a source of type ".concat(String(r),', it only be used with a "raster-dem" source type'))):s.push(new Lt(n,t.source,'source "'.concat(t.source,'" not found')))}else s.push(new Lt(n,t,'terrain is missing required property "source"'));return s}function ps(e){const t=e.value,n=e.style,i=e.styleSpec,r=i.fog;let o=[];const s=In(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Lt("fog",t,"object expected, ".concat(s," found"))]),o;for(const a in t){const e=a.match(/^(.*)-transition$/);o=o.concat(e&&r[e[1]]&&r[e[1]].transition?ms({key:a,value:t[a],valueSpec:i.transition,style:n,styleSpec:i}):r[a]?ms({key:a,value:t[a],valueSpec:r[a],style:n,styleSpec:i}):[new Ot(a,t[a],'unknown property "'.concat(a,'"'))])}return o}const fs={"*":()=>[],array:Ro,boolean:function(e){const t=e.value,n=e.key,i=In(t);return"boolean"!==i?[new Lt(n,t,"boolean expected, ".concat(i," found"))]:[]},number:Lo,color:function(e){const t=e.key,n=e.value,i=In(n);return"string"!==i?[new Lt(t,n,"color expected, ".concat(i," found"))]:null===an(n)?[new Lt(t,n,'color expected, "'.concat(n,'" found'))]:[]},enum:No,filter:Qo,function:Oo,layer:rs,object:zo,source:as,model:cs,light:us,"light-3d":hs,terrain:ds,fog:ps,string:os,formatted:function(e){return 0===os(e).length?[]:Fo(e)},resolvedImage:function(e){return 0===os(e).length?[]:Fo(e)},projection:function(e){const t=e.value,n=e.styleSpec,i=n.projection,r=e.style;let o=[];const s=In(t);if("object"===s)for(const a in t)o=o.concat(ms({key:a,value:t[a],valueSpec:i[a],style:r,styleSpec:n}));else"string"!==s&&(o=o.concat([new Lt("projection",t,"object or string expected, ".concat(s," found"))]));return o},import:function(e){const{value:t,styleSpec:n}=e,{data:i}=t,s=r(t,o);Object.defineProperty(s,"__line__",{value:t.__line__,enumerable:!1});let a=zo(Ft({},e,{value:s,valueSpec:n.import}));return""===Bt(s.id)&&a.push(new Lt("".concat(e.key,".id"),s,"import id can't be an empty string")),i&&(a=a.concat(ys(i,n,{key:"".concat(e.key,".data")}))),a}};function ms(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.value,i=e.valueSpec,r=e.styleSpec;if(i.expression&&yo(Bt(n)))return Oo(e);if(i.expression&&Ao(Nt(n)))return Fo(e);if(i.type&&fs[i.type]){const n=fs[i.type](e);return!0===t&&n.length>0&&"array"===In(e.value)?Fo(e):n}return zo(Ft({},e,{valueSpec:i.type?r[i.type]:i}))}function gs(e){const t=e.value,n=e.key,i=os(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new Lt(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new Lt(n,t,'"glyphs" url must include a "{range}" token'))),i}function ys(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rt;return ms({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:gs,"*":()=>[]}})}function _s(e){return Cs(ys(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rt))}const vs=e=>Cs(as(e)),xs=e=>Cs(us(e)),bs=e=>Cs(hs(e)),ws=e=>Cs(ds(e)),Ss=e=>Cs(ps(e)),Ts=e=>Cs(rs(e)),Es=e=>Cs(Qo(e)),As=e=>Cs(ns(e)),Ms=e=>Cs(is(e)),ks=e=>Cs(cs(e));function Cs(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Ps(e,t){let n=!1;if(t&&t.length)for(const i of t)i instanceof Ot?J(i.message):(e.fire(new Dt(new Error(i.message))),n=!0);return n}var Is=zs,Ds=3;function zs(e,t,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[Ds+o],a=r[Ds+o+1];i.push(s===a?null:r.subarray(s,a))}var l=r[Ds+i.length+1];this.keys=r.subarray(r[Ds+i.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var u=n/t*e;this.min=-u,this.max=e+u}zs.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},zs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},zs.prototype._insertCell=function(e,t,n,i,r,o){this.cells[r].push(o)},zs.prototype.query=function(e,t,n,i,r){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=i&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,n,i,this._queryCell,a,{},r),a},zs.prototype._queryCell=function(e,t,n,i,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&n>=u[p+0]&&i>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},zs.prototype._forEachCell=function(e,t,n,i,r,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,n,i,f,o,s,a))return}},zs.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},zs.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},zs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ds+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];r[Ds+s]=o,r.set(a,o),o+=a.length}return r[Ds+e.length]=o,r.set(this.keys,o),r[Ds+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var Rs=m(Is);const Ls={};function Os(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Ls[t]={klass:e,omit:n.omit||[]}}Os(Object,"Object"),Rs.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},Rs.deserialize=function(e){return new Rs(e.buffer)},Object.defineProperty(Rs,"name",{value:"Grid"}),Os(Rs,"Grid"),Os(fn,"Color"),Os(Error,"Error"),Os(we,"AJAXError"),Os(_n,"ResolvedImage"),Os(Io,"StylePropertyFunction"),Os(Eo,"StyleExpression",{omit:["_evaluator"]}),Os(Co,"ZoomDependentExpression"),Os(ko,"ZoomConstantExpression"),Os(Nn,"CompoundExpression",{omit:["_evaluate"]});for(const i in lo)Ls[lo[i]._classRegistryKey]||Os(lo[i],"Expression".concat(i));function Fs(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Bs(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function Ns(e,n){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Fs(e)||Bs(e))return n&&n.add(e),e;if(ArrayBuffer.isView(e)){const t=e;return n&&n.add(t.buffer),t}if(e instanceof t.ImageData)return n&&n.add(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const i of e)t.push(Ns(i,n));return t}if(e instanceof Map){const t={$name:"Map"};for(const[n,i]of e.entries())t[n]=Ns(i);return t}if("object"==typeof e){const t=e.constructor,i=t._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class ".concat(i));const r=t.serialize?t.serialize(e,n):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(Ls[i].omit.indexOf(t)>=0||(r[t]=Ns(e[t],n)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function js(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Fs(e)||Bs(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(js);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const n of Object.keys(e))"$name"!==n&&t.set(n,js(e[n]));return t}const{klass:n}=Ls[t];if(!n)throw new Error("can't deserialize unregistered class ".concat(t));if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const r of Object.keys(e))"$name"!==r&&(i[r]=js(e[r]));return i}throw new Error("can't deserialize object of type "+typeof e)}const Vs={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function Us(e){for(const t of e)if(Ws(t.charCodeAt(0)))return!0;return!1}function Gs(e){for(const t of e)if(!qs(t.charCodeAt(0)))return!1;return!0}function qs(e){return!(Vs.Arabic(e)||Vs["Arabic Supplement"](e)||Vs["Arabic Extended-A"](e)||Vs["Arabic Presentation Forms-A"](e)||Vs["Arabic Presentation Forms-B"](e))}function Ws(e){return!(746!==e&&747!==e&&(e<4352||!(Vs["Bopomofo Extended"](e)||Vs.Bopomofo(e)||Vs["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Vs["CJK Compatibility Ideographs"](e)||Vs["CJK Compatibility"](e)||Vs["CJK Radicals Supplement"](e)||Vs["CJK Strokes"](e)||!(!Vs["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Vs["CJK Unified Ideographs Extension A"](e)||Vs["CJK Unified Ideographs"](e)||Vs["Enclosed CJK Letters and Months"](e)||Vs["Hangul Compatibility Jamo"](e)||Vs["Hangul Jamo Extended-A"](e)||Vs["Hangul Jamo Extended-B"](e)||Vs["Hangul Jamo"](e)||Vs["Hangul Syllables"](e)||Vs.Hiragana(e)||Vs["Ideographic Description Characters"](e)||Vs.Kanbun(e)||Vs["Kangxi Radicals"](e)||Vs["Katakana Phonetic Extensions"](e)||Vs.Katakana(e)&&12540!==e||!(!Vs["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Vs["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Vs["Unified Canadian Aboriginal Syllabics"](e)||Vs["Unified Canadian Aboriginal Syllabics Extended"](e)||Vs["Vertical Forms"](e)||Vs["Yijing Hexagram Symbols"](e)||Vs["Yi Syllables"](e)||Vs["Yi Radicals"](e))))}function Zs(e){return!(Ws(e)||function(e){return!!(Vs["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Vs["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Vs["Letterlike Symbols"](e)||Vs["Number Forms"](e)||Vs["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Vs["Control Pictures"](e)&&9251!==e||Vs["Optical Character Recognition"](e)||Vs["Enclosed Alphanumerics"](e)||Vs["Geometric Shapes"](e)||Vs["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Vs["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Vs["CJK Symbols and Punctuation"](e)||Vs.Katakana(e)||Vs["Private Use Area"](e)||Vs["CJK Compatibility Forms"](e)||Vs["Small Form Variants"](e)||Vs["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Hs(e){return e>=1424&&e<=2303||Vs["Arabic Presentation Forms-A"](e)||Vs["Arabic Presentation Forms-B"](e)}function Xs(e,t){return!(!t&&Hs(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Vs.Khmer(e))}function Ys(e){for(const t of e)if(Hs(t.charCodeAt(0)))return!0;return!1}const Ks="deferred",Js="loading",$s="loaded";let Qs=null,ea="unavailable",ta=null;const na=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(ea="error"),Qs&&Qs(e)};function ia(){ra.fire(new It("pluginStateChange",{pluginStatus:ea,pluginURL:ta}))}const ra=new zt,oa=function(){return ea},sa=function(){if(ea!==Ks||!ta)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ea=Js,ia(),ta&&Ae({url:ta},e=>{e?na(e):(ea=$s,ia())})},aa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ea===$s||null!=aa.applyArabicShaping,isLoading:()=>ea===Js,setState(e){ea=e.pluginStatus,ta=e.pluginURL},isParsed:()=>null!=aa.applyArabicShaping&&null!=aa.processBidirectionalText&&null!=aa.processStyledBidirectionalText,getPluginURL:()=>ta};class la{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(!Xs(n.charCodeAt(0),t))return!1;return!0}(e,aa.isLoaded())}}class ca{constructor(e,t,n){this.property=e,this.value=t,this.expression=function(e,t,n){if(yo(e))return new Io(e,t);if(Ao(e)||Array.isArray(e)&&e.length>0){const i=Po(e,t,n);if("error"===i.result)throw new Error(i.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));return i.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=fn.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class ua{constructor(e,t){this.property=e,this.value=new ca(e,void 0,t)}transitioned(e,t){return new da(this.property,this.value,t,B({},e.transition,this.transition),e.now)}untransitioned(){return new da(this.property,this.value,null,{},0)}}class ha{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return Y(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ua(this._values[e].property,this._options)),this._values[e].value=new ca(this._values[e].property,null===t?void 0:Y(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const n=this._properties.properties;if(e)for(const i in e){const t=e[i];if(Z(i,"-transition")){const e=i.slice(0,-11);n[e]&&this.setTransition(e,t)}else n[i]&&this.setValue(i,t)}}getTransition(e){return Y(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ua(this._values[e].property)),this._values[e].transition=Y(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e["".concat(t,"-transition")]=i)}return e}transitioned(e,t){const n=new pa(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new pa(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class da{constructor(e,t,n,i,r){const o=i.delay||0,s=i.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+s,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),r,k(s))}}return r}}class pa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new ga(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fa{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return Y(this._values[e].value)}setValue(e,t){this._values[e]=new ca(this._values[e].property,null===t?void 0:Y(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new ga(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class ma{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class ga{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ya{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=ir[this.specification.type];return i?i(e,t,n):e}}class _a{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new ma(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new ma(this,{kind:"constant",value:void 0},e.parameters);const i=ir[this.specification.type];return i?new ma(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,r,o){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,o)}}class va{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class xa{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new la(0,{});for(const n in e){const i=e[n];i.specification.overridable&&this.overridableProperties.push(n);const r=this.defaultPropertyValues[n]=new ca(i,void 0),o=this.defaultTransitionablePropertyValues[n]=new ua(i);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=r.possiblyEvaluate(t)}}}Os(_a,"DataDrivenProperty"),Os(ya,"DataConstantProperty"),Os(va,"ColorRampProperty");const ba="\x1f";function wa(e){return e.indexOf(ba)>=0}function Sa(e,t){return t?"".concat(e).concat(ba).concat(t):e}function Ta(e){const t=e.indexOf(ba);return t>=0?e.slice(0,t):e}const Ea="-transition";class Aa extends zt{constructor(e,t,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=n,e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new fa(t.layout,n),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new ha(t.paint,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ga(t.paint)}}setScope(e){this.scope=e,this.fqid=Sa(this.id,e)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(Ms,"layers.".concat(this.id,".layout.").concat(e),e,t,n))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Z(e,Ea)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(As,"layers.".concat(this.id,".paint.").concat(e),e,t,n))return!1;const i=this._transitionablePaint,r=i._properties.properties;if(Z(e,Ea)){const n=e.slice(0,-11);return r[n]&&i.setTransition(n,t||void 0),!1}if(!r[e])return!1;const o=i._values[e],s=o.value.isDataDriven(),a=o.value;i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const l=i._values[e].value,c=l.isDataDriven(),u=Z(e,"pattern")||"line-dasharray"===e;return c||s||u||this._handleOverridablePaintPropertyUpdate(e,a,l)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return X({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!r||!1!==r.validate)&&Ps(this,e.call(_s,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:Rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ma&&po(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class Ma{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const ka={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ca{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pa{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ia(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:e.map(e=>{const r=ka[e.type].BYTES_PER_ELEMENT,o=n=Da(n,Math.max(t,r)),s=e.components||1;return i=Math.max(i,r),n+=r*s,{name:e.name,type:e.type,components:s,offset:o}}),size:Da(n,Math.max(i,t)),alignment:t}}function Da(e,t){return Math.ceil(e/t)*t}class za extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}za.prototype.bytesPerElement=4,Os(za,"StructArrayLayout2i4");class Ra extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}Ra.prototype.bytesPerElement=6,Os(Ra,"StructArrayLayout3i6");class La extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,e}}La.prototype.bytesPerElement=8,Os(La,"StructArrayLayout4i8");class Oa extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=5*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=o,e}}Oa.prototype.bytesPerElement=10,Os(Oa,"StructArrayLayout5i10");class Fa extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}Fa.prototype.bytesPerElement=12,Os(Fa,"StructArrayLayout2i4ub1f12");class Ba extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,e}}Ba.prototype.bytesPerElement=16,Os(Ba,"StructArrayLayout4f16");class Na extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=i,this.uint16[s+3]=r,this.float32[a+2]=o,e}}Na.prototype.bytesPerElement=12,Os(Na,"StructArrayLayout4ui1f12");class ja extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=i,this.uint16[o+3]=r,e}}ja.prototype.bytesPerElement=8,Os(ja,"StructArrayLayout4ui8");class Va extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}Va.prototype.bytesPerElement=12,Os(Va,"StructArrayLayout6i12");class Ua extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,r,o,s,a,l,c,u,h)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}Ua.prototype.bytesPerElement=24,Os(Ua,"StructArrayLayout4i4ui4i24");class Ga extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,e}}Ga.prototype.bytesPerElement=20,Os(Ga,"StructArrayLayout3i3f20");class qa extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}qa.prototype.bytesPerElement=4,Os(qa,"StructArrayLayout1ul4");class Wa extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}Wa.prototype.bytesPerElement=4,Os(Wa,"StructArrayLayout2ui4");class Za extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,i,r,o,s,a,l,c,u,h,d)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Za.prototype.bytesPerElement=40,Os(Za,"StructArrayLayout5i4f1i1ul2ui40");class Ha extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}Ha.prototype.bytesPerElement=16,Os(Ha,"StructArrayLayout3i2i2i16");class Xa extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.int16[a+6]=r,this.int16[a+7]=o,e}}Xa.prototype.bytesPerElement=16,Os(Xa,"StructArrayLayout2f1f2i16");class Ya extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[s+1]=i,this.float32[s+2]=r,e}}Ya.prototype.bytesPerElement=12,Os(Ya,"StructArrayLayout2ub2f12");class Ka extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}Ka.prototype.bytesPerElement=6,Os(Ka,"StructArrayLayout3ui6");class Ja extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b){const w=30*e,S=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=i,this.float32[S+2]=r,this.float32[S+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[S+5]=l,this.uint32[S+6]=c,this.uint32[S+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[S+10]=f,this.float32[S+11]=m,this.uint8[T+48]=g,this.uint8[T+49]=y,this.uint8[T+50]=_,this.uint32[S+13]=v,this.int16[w+28]=x,this.uint8[T+58]=b,e}}Ja.prototype.bytesPerElement=60,Os(Ja,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class $a extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,E,A,M,k,C,P,I){const D=this.length;return this.resize(D+1),this.emplace(D,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,E,A,M,k,C,P,I)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,E,A,M,k,C,P,I,D){const z=20*e,R=40*e,L=80*e;return this.float32[z+0]=t,this.float32[z+1]=n,this.int16[R+4]=i,this.int16[R+5]=r,this.int16[R+6]=o,this.int16[R+7]=s,this.int16[R+8]=a,this.int16[R+9]=l,this.int16[R+10]=c,this.int16[R+11]=u,this.int16[R+12]=h,this.uint16[R+13]=d,this.uint16[R+14]=p,this.uint16[R+15]=f,this.uint16[R+16]=m,this.uint16[R+17]=g,this.uint16[R+18]=y,this.uint16[R+19]=_,this.uint16[R+20]=v,this.uint16[R+21]=x,this.uint16[R+22]=b,this.uint16[R+23]=w,this.uint16[R+24]=S,this.uint16[R+25]=T,this.uint16[R+26]=E,this.uint16[R+27]=A,this.uint32[z+14]=M,this.float32[z+15]=k,this.float32[z+16]=C,this.float32[z+17]=P,this.float32[z+18]=I,this.uint8[L+76]=D,e}}$a.prototype.bytesPerElement=80,Os($a,"StructArrayLayout2f9i15ui1ul4f1ub80");class Qa extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Qa.prototype.bytesPerElement=4,Os(Qa,"StructArrayLayout1f4");class el extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.float32[s+3]=r,this.float32[s+4]=o,e}}el.prototype.bytesPerElement=20,Os(el,"StructArrayLayout5f20");class tl extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}tl.prototype.bytesPerElement=28,Os(tl,"StructArrayLayout7f28");class nl extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=n,this.uint16[o+3]=i,this.uint16[o+4]=r,e}}nl.prototype.bytesPerElement=12,Os(nl,"StructArrayLayout1ul3ui12");class il extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}il.prototype.bytesPerElement=2,Os(il,"StructArrayLayout1ui2");class rl extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}rl.prototype.bytesPerElement=12,Os(rl,"StructArrayLayout3f12");class ol extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}ol.prototype.bytesPerElement=8,Os(ol,"StructArrayLayout2f8");class sl extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){const y=16*e;return this.float32[y+0]=t,this.float32[y+1]=n,this.float32[y+2]=i,this.float32[y+3]=r,this.float32[y+4]=o,this.float32[y+5]=s,this.float32[y+6]=a,this.float32[y+7]=l,this.float32[y+8]=c,this.float32[y+9]=u,this.float32[y+10]=h,this.float32[y+11]=d,this.float32[y+12]=p,this.float32[y+13]=f,this.float32[y+14]=m,this.float32[y+15]=g,e}}sl.prototype.bytesPerElement=64,Os(sl,"StructArrayLayout16f64");class al extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,this.uint16[l+2]=i,this.uint16[l+3]=r,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,e}}al.prototype.bytesPerElement=20,Os(al,"StructArrayLayout4ui3f20");class ll extends Pa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}ll.prototype.bytesPerElement=1,Os(ll,"StructArrayLayout1ub1");class cl extends Ca{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}cl.prototype.size=40;class ul extends Za{get(e){return new cl(this,e)}}Os(ul,"CollisionBoxArray");class hl extends Ca{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}hl.prototype.size=60;class dl extends Ja{get(e){return new hl(this,e)}}Os(dl,"PlacedSymbolArray");class pl extends Ca{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}pl.prototype.size=80;class fl extends $a{get(e){return new pl(this,e)}}Os(fl,"SymbolInstanceArray");class ml extends Qa{getoffsetX(e){return this.float32[1*e+0]}}Os(ml,"GlyphOffsetArray");class gl extends za{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Os(gl,"SymbolLineVertexArray");class yl extends Ca{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}yl.prototype.size=12;class _l extends nl{get(e){return new yl(this,e)}}Os(_l,"FeatureIndexArray");class vl extends Wa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Os(vl,"FillExtrusionCentroidArray");const xl=Ia([{name:"a_pos",components:2,type:"Int16"}],4),bl=Ia([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class wl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>wl.MAX_VERTEX_ARRAY_LENGTH&&J("Max vertices per segment is ".concat(wl.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!r||r.vertexLength+e>wl.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t,primitiveOffset:n,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}prepareSegment(e,t,n,i){return this._prepareSegment(e,t.length,n.length,i)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new wl([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function Sl(e,t){return 256*(e=z(Math.floor(e),0,255))+z(Math.floor(t),0,255)}wl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Os(wl,"SegmentVector");const Tl=Ia([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),El=Ia([{name:"a_dash",components:4,type:"Uint16"}]);var Al={exports:{}},Ml={exports:{}};!function(e){e.exports=function(e,t){var n,i,r,o,s,a,l,c;for(i=e.length-(n=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}(Ml);var kl=Ml.exports,Cl={exports:{}};!function(e){e.exports=function(e,t){for(var n,i=e.length,r=t^i,o=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}(Cl);var Pl=kl,Il=Cl.exports;Al.exports=Pl,Al.exports.murmur3=Pl,Al.exports.murmur2=Il;var Dl=m(Al.exports);class zl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(Rl(e)),this.positions.push(t,n,i)}eachPosition(e,t){const n=Rl(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=n?r=e:i=e+1}for(;this.ids[i]===n;)t(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return Ll(n,i,0,n.length-1),t&&(t.add(n.buffer),t.add(i.buffer)),{ids:n,positions:i}}static deserialize(e){const t=new zl;let n;t.ids=e.ids,t.positions=e.positions;for(const i of t.ids)i!==n&&t.uniqueIds.push(i),n=i;return t.indexed=!0,t}}function Rl(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Dl(String(e))}function Ll(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let o=n-1,s=i+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;Ol(e,o,s),Ol(t,3*o,3*s),Ol(t,3*o+1,3*s+1),Ol(t,3*o+2,3*s+2)}s-n<i-s?(Ll(e,t,n,s),n=s+1):(Ll(e,t,s+1,i),i=s)}}function Ol(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Os(zl,"FeaturePositionMap");class Fl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Bl extends Fl{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class Nl extends Fl{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class jl extends Fl{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class Vl extends Fl{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class Ul extends Fl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Gl extends Fl{constructor(e){super(e),this.current=fn.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const ql=new Float32Array(16);class Wl extends Fl{constructor(e){super(e),this.current=ql}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const Zl=new Float32Array(9);class Hl extends Fl{constructor(e){super(e),this.current=Zl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}const Xl=new Float32Array(4);class Yl extends Fl{constructor(e){super(e),this.current=Xl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<4;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}function Kl(e){return[Sl(255*e.r,255*e.g),Sl(255*e.b,255*e.a)]}class Jl{constructor(e,t,n){this.value=e,this.uniformNames=t.map(e=>"u_".concat(e)),this.type=n}setUniform(e,t,n,i,r){t.set(e,r,i.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Gl(e):new Nl(e)}}class $l{constructor(e,t){this.uniformNames=t.map(e=>"u_".concat(e)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,n,i,r){const o="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;o&&t.set(e,r,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Ul(e):new Nl(e)}}class Ql{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r,o,s){const a=this.paintVertexArray.length,l=this.expression.evaluate(new la(0,{brightness:o}),t,{},r,i,s);this.paintVertexArray.resize(e),this._setPaintValue(a,e,l)}updatePaintArray(e,t,n,i,r,o,s){const a=this.expression.evaluate({zoom:0,brightness:s},n,i,void 0,r);this._setPaintValue(e,t,a)}_setPaintValue(e,t,n){if("color"===this.type){const i=Kl(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ec{constructor(e,t,n,i,r,o){this.expression=e,this.uniformNames=t.map(e=>"u_".concat(e,"_t")),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,r,o,s){const a=this.expression.evaluate(new la(this.zoom,{brightness:o}),t,{},r,i,s),l=this.expression.evaluate(new la(this.zoom+1,{brightness:o}),t,{},r,i,s),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,a,l)}updatePaintArray(e,t,n,i,r,o,s){const a=this.expression.evaluate({zoom:this.zoom,brightness:s},n,i,void 0,r),l=this.expression.evaluate({zoom:this.zoom+1,brightness:s},n,i,void 0,r);this._setPaintValue(e,t,a,l)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=Kl(n),o=Kl(i);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,i,r){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,s=z(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,r,s)}getBinding(e,t){return new Nl(e)}}class tc{constructor(e,t,n,i,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===n?El:Tl).members;for(let o=0;o<t.length;++o);this.paintVertexArray=new i}populatePaintArray(e,t,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r,o,s){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(e,t,n,i){if(!i||!n)return;const r=i[n];if(!r)return;const{tl:o,br:s,pixelRatio:a}=r;for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,o[0],o[1],s[0],s[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class nc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[];const i=[];for(const r in e.paint._values){const o=e.paint.get(r);if(!n(r))continue;if(!(o instanceof ma&&po(o.property.specification)))continue;const s=oc(r,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const t=lc(r,l,"source");this.binders[r]=u?new tc(a,s,l,t,e.id):new Ql(a,s,l,t),i.push("/a_".concat(r))}else{const e=lc(r,l,"composite");this.binders[r]=new ec(a,s,l,c,t,e),i.push("/z_".concat(r))}else this.binders[r]=u?new $l(a.value,s):new Jl(a.value,s,l),i.push("/u_".concat(r))}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Ql||t instanceof ec?t.maxValue:0}populatePaintArrays(e,t,n,i,r,o,s){for(const a in this.binders){const l=this.binders[a];(l instanceof Ql||l instanceof ec||l instanceof tc)&&l.populatePaintArray(e,t,n,i,r,o,s)}}setConstantPatternPositions(e){for(const t in this.binders){const n=this.binders[t];n instanceof $l&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,t,n,i,r,o,s,a){let l=!1;const c=Object.keys(e),u=0!==c.length,h=u?c:t.uniqueIds;for(const d in this.binders){const c=this.binders[d];if((c instanceof Ql||c instanceof ec||c instanceof tc)&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){const p=r.paint.get(d);c.expression=p.value;for(const n of h){const r=e[n.toString()];t.eachPosition(n,(e,t,n)=>{const l=i.feature(e);c.updatePaintArray(t,n,l,r,o,s,a)})}if(!u)for(const t of n.uniqueIds){const r=e[t.toString()];n.eachPosition(t,(e,t,n)=>{const l=i.feature(e);c.updatePaintArray(t,n,l,r,o,s,a)})}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Jl||n instanceof $l)&&e.push(...n.uniformNames.map(e=>"#define HAS_UNIFORM_".concat(e)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Ql||n instanceof ec||n instanceof tc)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Jl||n instanceof $l||n instanceof ec)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof Jl||i instanceof $l||i instanceof ec)for(const r of i.uniformNames)t.push({name:r,property:n,binding:i.getBinding(e,r)})}return t}setUniforms(e,t,n,i,r){for(const{name:o,property:s,binding:a}of n)this.binders[s].setUniform(e,a,r,i.get(s),o)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Ql||t instanceof ec||t instanceof tc)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Ql||n instanceof ec||n instanceof tc)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Ql||t instanceof ec||t instanceof tc)&&t.destroy()}}}class ic{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new nc(i,t,n);this.needsUpload=!1,this._featureMap=new zl,this._featureMapWithoutIds=new zl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,n,i,r,o,s,a){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,i,r,o,s,a);void 0!==t.id?this._featureMap.add(t.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i,r,o){for(const s of n)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,s,i,r,o||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const rc={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function oc(e,t){return rc[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const sc={"line-pattern":{source:Na,composite:Na},"fill-pattern":{source:Na,composite:Na},"fill-extrusion-pattern":{source:Na,composite:Na},"line-dasharray":{source:ja,composite:ja}},ac={color:{source:ol,composite:Ba},number:{source:Qa,composite:ol}};function lc(e,t,n){const i=sc[e];return i&&i[n]||ac[t][n]}Os(Jl,"ConstantBinder"),Os($l,"PatternConstantBinder"),Os(Ql,"SourceExpressionBinder"),Os(tc,"PatternCompositeBinder"),Os(ec,"CompositeExpressionBinder"),Os(nc,"ProgramConfiguration",{omit:["_buffers"]}),Os(ic,"ProgramConfigurationSet");class cc{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Kd?new Kd(e.lng,e.lat):Kd.convert(e),this}setSouthWest(e){return this._sw=e instanceof Kd?new Kd(e.lng,e.lat):Kd.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,r;if(e instanceof Kd)i=e,r=e;else{if(!(e instanceof cc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(cc.convert(e)):this.extend(Kd.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Kd.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Kd(i.lng,i.lat),this._ne=new Kd(r.lng,r.lat)),this}getCenter(){return new Kd((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kd(this.getWest(),this.getNorth())}getSouthEast(){return new Kd(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Kd.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){return!e||e instanceof cc?e:new cc(e)}}var uc={},hc={};Object.defineProperty(hc,"__esModule",{value:!0}),hc.setMatrixArrayType=function(e){hc.ARRAY_TYPE=pc=e},hc.toRadian=function(e){return e*mc},hc.equals=function(e,t){return Math.abs(e-t)<=dc*Math.max(1,Math.abs(e),Math.abs(t))},hc.RANDOM=hc.ARRAY_TYPE=hc.EPSILON=void 0;var dc=1e-6;hc.EPSILON=dc;var pc="undefined"!=typeof Float32Array?Float32Array:Array;hc.ARRAY_TYPE=pc;var fc=Math.random;hc.RANDOM=fc;var mc=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var gc={};function yc(e){return yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yc(e)}Object.defineProperty(gc,"__esModule",{value:!0}),gc.create=function(){var e=new _c.ARRAY_TYPE(4);return _c.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},gc.clone=function(e){var t=new _c.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},gc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},gc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},gc.fromValues=function(e,t,n,i){var r=new _c.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},gc.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},gc.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},gc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*o-r*i;return s?(e[0]=o*(s=1/s),e[1]=-i*s,e[2]=-r*s,e[3]=n*s,e):null},gc.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},gc.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},gc.multiply=xc,gc.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=i*-a+o*l,e[3]=r*-a+s*l,e},gc.scale=function(e,t,n){var i=t[1],r=t[2],o=t[3],s=n[0],a=n[1];return e[0]=t[0]*s,e[1]=i*s,e[2]=r*a,e[3]=o*a,e},gc.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e},gc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},gc.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},gc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},gc.LDU=function(e,t,n,i){return e[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-e[2]*n[1],[e,t,n]},gc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},gc.subtract=bc,gc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},gc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=_c.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=_c.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=_c.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=_c.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},gc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},gc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},gc.sub=gc.mul=void 0;var _c=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==yc(e)&&"function"!=typeof e)return{default:e};var t=vc(void 0);if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}(hc);function vc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(vc=function(e){return e?n:t})(e)}function xc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*a+o*l,e[1]=r*a+s*l,e[2]=i*c+o*u,e[3]=r*c+s*u,e}function bc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}gc.mul=xc,gc.sub=bc;var wc={};function Sc(e){return Sc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sc(e)}Object.defineProperty(wc,"__esModule",{value:!0}),wc.create=function(){var e=new Tc.ARRAY_TYPE(6);return Tc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},wc.clone=function(e){var t=new Tc.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},wc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},wc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},wc.fromValues=function(e,t,n,i,r,o){var s=new Tc.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s[4]=r,s[5]=o,s},wc.set=function(e,t,n,i,r,o,s){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e},wc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=n*o-i*r;return l?(e[0]=o*(l=1/l),e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*a-o*s)*l,e[5]=(i*s-n*a)*l,e):null},wc.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},wc.multiply=Ac,wc.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(n),u=Math.cos(n);return e[0]=i*u+o*c,e[1]=r*u+s*c,e[2]=i*-c+o*u,e[3]=r*-c+s*u,e[4]=a,e[5]=l,e},wc.scale=function(e,t,n){var i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=n[0],c=n[1];return e[0]=t[0]*l,e[1]=i*l,e[2]=r*c,e[3]=o*c,e[4]=s,e[5]=a,e},wc.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=i*c+o*u+a,e[5]=r*c+s*u+l,e},wc.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e},wc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},wc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},wc.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},wc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},wc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},wc.subtract=Mc,wc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},wc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},wc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},wc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(n-l)<=Tc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=Tc.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-u)<=Tc.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-h)<=Tc.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=Tc.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=Tc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},wc.sub=wc.mul=void 0;var Tc=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Sc(e)&&"function"!=typeof e)return{default:e};var t=Ec(void 0);if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}(hc);function Ec(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ec=function(e){return e?n:t})(e)}function Ac(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=i*c+o*u,e[1]=r*c+s*u,e[2]=i*h+o*d,e[3]=r*h+s*d,e[4]=i*p+o*f+a,e[5]=r*p+s*f+l,e}function Mc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}wc.mul=Ac,wc.sub=Mc;var kc={};function Cc(e){return Cc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cc(e)}Object.defineProperty(kc,"__esModule",{value:!0}),kc.create=function(){var e=new Pc.ARRAY_TYPE(9);return Pc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},kc.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},kc.clone=function(e){var t=new Pc.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},kc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},kc.fromValues=function(e,t,n,i,r,o,s,a,l){var c=new Pc.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=r,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c},kc.set=function(e,t,n,i,r,o,s,a,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e},kc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},kc.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},kc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=n*h+i*d+r*p;return f?(e[0]=h*(f=1/f),e[1]=(-u*i+r*c)*f,e[2]=(a*i-r*s)*f,e[3]=d*f,e[4]=(u*n-r*l)*f,e[5]=(-a*n+r*o)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(s*n-i*o)*f,e):null},kc.adjoint=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=r*c-i*u,e[2]=i*a-r*s,e[3]=a*l-o*u,e[4]=n*u-r*l,e[5]=r*o-n*a,e[6]=o*c-s*l,e[7]=i*l-n*c,e[8]=n*s-i*o,e},kc.determinant=function(e){var t=e[3],n=e[4],i=e[5],r=e[6],o=e[7],s=e[8];return e[0]*(s*n-i*o)+e[1]*(-s*t+i*r)+e[2]*(o*t-n*r)},kc.multiply=Dc,kc.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*i+p*s+c,e[7]=d*r+p*a+u,e[8]=d*o+p*l+h,e},kc.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*i+d*s,e[1]=p*r+d*a,e[2]=p*o+d*l,e[3]=p*s-d*i,e[4]=p*a-d*r,e[5]=p*l-d*o,e[6]=c,e[7]=u,e[8]=h,e},kc.scale=function(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},kc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},kc.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},kc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},kc.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},kc.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,y=o*l;return e[0]=1-h-f,e[3]=u-y,e[6]=d+g,e[1]=u+y,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e},kc.normalFromMat4=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=n*a-i*s,v=n*l-r*s,x=n*c-o*s,b=i*l-r*a,w=i*c-o*a,S=r*c-o*l,T=u*m-h*f,E=u*g-d*f,A=u*y-p*f,M=h*g-d*m,k=h*y-p*m,C=d*y-p*g,P=_*C-v*k+x*M+b*A-w*E+S*T;return P?(e[0]=(a*C-l*k+c*M)*(P=1/P),e[1]=(l*A-s*C-c*E)*P,e[2]=(s*k-a*A+c*T)*P,e[3]=(r*k-i*C-o*M)*P,e[4]=(n*C-r*A+o*E)*P,e[5]=(i*A-n*k-o*T)*P,e[6]=(m*S-g*w+y*b)*P,e[7]=(g*x-f*S-y*v)*P,e[8]=(f*w-m*x+y*_)*P,e):null},kc.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},kc.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},kc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},kc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},kc.subtract=zc,kc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},kc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e},kc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},kc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],g=t[5],y=t[6],_=t[7],v=t[8];return Math.abs(n-h)<=Pc.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-d)<=Pc.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-p)<=Pc.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-f)<=Pc.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=Pc.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=Pc.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-y)<=Pc.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=Pc.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-v)<=Pc.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},kc.sub=kc.mul=void 0;var Pc=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Cc(e)&&"function"!=typeof e)return{default:e};var t=Ic(void 0);if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}(hc);function Ic(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ic=function(e){return e?n:t})(e)}function Dc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],y=n[5],_=n[6],v=n[7],x=n[8];return e[0]=d*i+p*s+f*c,e[1]=d*r+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=m*i+g*s+y*c,e[4]=m*r+g*a+y*u,e[5]=m*o+g*l+y*h,e[6]=_*i+v*s+x*c,e[7]=_*r+v*a+x*u,e[8]=_*o+v*l+x*h,e}function zc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}kc.mul=Dc,kc.sub=zc;var Rc={};function Lc(e){return Lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lc(e)}Object.defineProperty(Rc,"__esModule",{value:!0}),Rc.create=function(){var e=new Oc.ARRAY_TYPE(16);return Oc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Rc.clone=function(e){var t=new Oc.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Rc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Rc.fromValues=function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){var g=new Oc.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=i,g[4]=r,g[5]=o,g[6]=s,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},Rc.set=function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},Rc.identity=Bc,Rc.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Rc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=n*a-i*s,v=n*l-r*s,x=n*c-o*s,b=i*l-r*a,w=i*c-o*a,S=r*c-o*l,T=u*m-h*f,E=u*g-d*f,A=u*y-p*f,M=h*g-d*m,k=h*y-p*m,C=d*y-p*g,P=_*C-v*k+x*M+b*A-w*E+S*T;return P?(e[0]=(a*C-l*k+c*M)*(P=1/P),e[1]=(r*k-i*C-o*M)*P,e[2]=(m*S-g*w+y*b)*P,e[3]=(d*w-h*S-p*b)*P,e[4]=(l*A-s*C-c*E)*P,e[5]=(n*C-r*A+o*E)*P,e[6]=(g*x-f*S-y*v)*P,e[7]=(u*S-d*x+p*v)*P,e[8]=(s*k-a*A+c*T)*P,e[9]=(i*A-n*k-o*T)*P,e[10]=(f*w-m*x+y*_)*P,e[11]=(h*x-u*w-p*_)*P,e[12]=(a*E-s*M-l*T)*P,e[13]=(n*M-i*E+r*T)*P,e[14]=(m*v-f*b-g*_)*P,e[15]=(u*b-h*v+d*_)*P,e):null},Rc.adjoint=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15];return e[0]=a*(d*y-p*g)-h*(l*y-c*g)+m*(l*p-c*d),e[1]=-(i*(d*y-p*g)-h*(r*y-o*g)+m*(r*p-o*d)),e[2]=i*(l*y-c*g)-a*(r*y-o*g)+m*(r*c-o*l),e[3]=-(i*(l*p-c*d)-a*(r*p-o*d)+h*(r*c-o*l)),e[4]=-(s*(d*y-p*g)-u*(l*y-c*g)+f*(l*p-c*d)),e[5]=n*(d*y-p*g)-u*(r*y-o*g)+f*(r*p-o*d),e[6]=-(n*(l*y-c*g)-s*(r*y-o*g)+f*(r*c-o*l)),e[7]=n*(l*p-c*d)-s*(r*p-o*d)+u*(r*c-o*l),e[8]=s*(h*y-p*m)-u*(a*y-c*m)+f*(a*p-c*h),e[9]=-(n*(h*y-p*m)-u*(i*y-o*m)+f*(i*p-o*h)),e[10]=n*(a*y-c*m)-s*(i*y-o*m)+f*(i*c-o*a),e[11]=-(n*(a*p-c*h)-s*(i*p-o*h)+u*(i*c-o*a)),e[12]=-(s*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),e[13]=n*(h*g-d*m)-u*(i*g-r*m)+f*(i*d-r*h),e[14]=-(n*(a*g-l*m)-s*(i*g-r*m)+f*(i*l-r*a)),e[15]=n*(a*d-l*h)-s*(i*d-r*h)+u*(i*l-r*a),e},Rc.determinant=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*s-n*o)*(h*g-d*m)-(t*a-i*o)*(u*g-d*f)+(t*l-r*o)*(u*m-h*f)+(n*a-i*s)*(c*g-d*p)-(n*l-r*s)*(c*m-h*p)+(i*l-r*a)*(c*f-u*p)},Rc.multiply=Nc,Rc.translate=function(e,t,n){var i,r,o,s,a,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+a*g+h*y+t[12],e[13]=r*m+l*g+d*y+t[13],e[14]=o*m+c*g+p*y+t[14],e[15]=s*m+u*g+f*y+t[15]),e},Rc.scale=function(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Rc.rotate=function(e,t,n,i){var r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,E,A,M,k=i[0],C=i[1],P=i[2],I=Math.hypot(k,C,P);return I<Oc.EPSILON?null:(k*=I=1/I,C*=I,P*=I,r=Math.sin(n),o=Math.cos(n),l=t[1],c=t[2],u=t[3],d=t[5],p=t[6],f=t[7],g=t[9],y=t[10],_=t[11],w=k*C*(s=1-o)-P*r,S=C*C*s+o,T=P*C*s+k*r,E=k*P*s+C*r,A=C*P*s-k*r,M=P*P*s+o,e[0]=(a=t[0])*(v=k*k*s+o)+(h=t[4])*(x=C*k*s+P*r)+(m=t[8])*(b=P*k*s-C*r),e[1]=l*v+d*x+g*b,e[2]=c*v+p*x+y*b,e[3]=u*v+f*x+_*b,e[4]=a*w+h*S+m*T,e[5]=l*w+d*S+g*T,e[6]=c*w+p*S+y*T,e[7]=u*w+f*S+_*T,e[8]=a*E+h*A+m*M,e[9]=l*E+d*A+g*M,e[10]=c*E+p*A+y*M,e[11]=u*E+f*A+_*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Rc.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e},Rc.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r,e},Rc.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e},Rc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Rc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Rc.fromRotation=function(e,t,n){var i,r,o,s=n[0],a=n[1],l=n[2],c=Math.hypot(s,a,l);return c<Oc.EPSILON?null:(s*=c=1/c,a*=c,l*=c,i=Math.sin(t),r=Math.cos(t),e[0]=s*s*(o=1-r)+r,e[1]=a*s*o+l*i,e[2]=l*s*o-a*i,e[3]=0,e[4]=s*a*o-l*i,e[5]=a*a*o+r,e[6]=l*a*o+s*i,e[7]=0,e[8]=s*l*o+a*i,e[9]=a*l*o-s*i,e[10]=l*l*o+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Rc.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Rc.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Rc.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Rc.fromRotationTranslation=jc,Rc.fromQuat2=function(e,t){var n=new Oc.ARRAY_TYPE(3),i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=i*i+r*r+o*o+s*s;return h>0?(n[0]=2*(a*s+u*i+l*o-c*r)/h,n[1]=2*(l*s+u*r+c*i-a*o)/h,n[2]=2*(c*s+u*o+a*r-l*i)/h):(n[0]=2*(a*s+u*i+l*o-c*r),n[1]=2*(l*s+u*r+c*i-a*o),n[2]=2*(c*s+u*o+a*r-l*i)),jc(e,t,n),e},Rc.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Rc.getScaling=Vc,Rc.getRotation=function(e,t){var n=new Oc.ARRAY_TYPE(3);Vc(n,t);var i=1/n[0],r=1/n[1],o=1/n[2],s=t[0]*i,a=t[1]*r,l=t[2]*o,c=t[4]*i,u=t[5]*r,h=t[6]*o,d=t[8]*i,p=t[9]*r,f=t[10]*o,m=s+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(d-l)/g,e[2]=(a-c)/g):s>u&&s>f?(g=2*Math.sqrt(1+s-u-f),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(d+l)/g):u>f?(g=2*Math.sqrt(1+u-s-f),e[3]=(d-l)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+f-s-u),e[3]=(a-c)/g,e[0]=(d+l)/g,e[1]=(h+p)/g,e[2]=.25*g),e},Rc.fromRotationTranslationScale=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3],l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,y=a*l,_=a*c,v=a*u,x=i[0],b=i[1],w=i[2];return e[0]=(1-(f+g))*x,e[1]=(d+v)*x,e[2]=(p-_)*x,e[3]=0,e[4]=(d-v)*b,e[5]=(1-(h+g))*b,e[6]=(m+y)*b,e[7]=0,e[8]=(p+_)*w,e[9]=(m-y)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},Rc.fromRotationTranslationScaleOrigin=function(e,t,n,i,r){var o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,f=o*h,m=s*u,g=s*h,y=a*h,_=l*c,v=l*u,x=l*h,b=i[0],w=i[1],S=i[2],T=r[0],E=r[1],A=r[2],M=(1-(m+y))*b,k=(p+x)*b,C=(f-v)*b,P=(p-x)*w,I=(1-(d+y))*w,D=(g+_)*w,z=(f+v)*S,R=(g-_)*S,L=(1-(d+m))*S;return e[0]=M,e[1]=k,e[2]=C,e[3]=0,e[4]=P,e[5]=I,e[6]=D,e[7]=0,e[8]=z,e[9]=R,e[10]=L,e[11]=0,e[12]=n[0]+T-(M*T+P*E+z*A),e[13]=n[1]+E-(k*T+I*E+R*A),e[14]=n[2]+A-(C*T+D*E+L*A),e[15]=1,e},Rc.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,y=o*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Rc.frustum=function(e,t,n,i,r,o,s){var a=1/(n-t),l=1/(r-i),c=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e},Rc.perspectiveNO=Uc,Rc.perspectiveZO=function(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=r*(o=1/(i-r)),e[14]=r*i*o):(e[10]=-1,e[14]=-i),e},Rc.perspectiveFromFieldOfView=function(e,t,n,i){var r=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(r+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*l*.5,e[9]=(r-o)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},Rc.orthoNO=Gc,Rc.orthoZO=function(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=o*c,e[15]=1,e},Rc.lookAt=function(e,t,n,i){var r,o,s,a,l,c,u,h,d,p,f=t[0],m=t[1],g=t[2],y=i[0],_=i[1],v=i[2],x=n[0],b=n[1],w=n[2];return Math.abs(f-x)<Oc.EPSILON&&Math.abs(m-b)<Oc.EPSILON&&Math.abs(g-w)<Oc.EPSILON?Bc(e):(u=f-x,h=m-b,d=g-w,r=_*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),o=v*(u*=p)-y*d,s=y*h-_*u,(p=Math.hypot(r,o,s))?(r*=p=1/p,o*=p,s*=p):(r=0,o=0,s=0),a=h*s-d*o,l=d*r-u*s,c=u*o-h*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=r,e[1]=a,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*f+o*m+s*g),e[13]=-(a*f+l*m+c*g),e[14]=-(u*f+h*m+d*g),e[15]=1,e)},Rc.targetTo=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=i[0],l=i[1],c=i[2],u=r-n[0],h=o-n[1],d=s-n[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=r,e[13]=o,e[14]=s,e[15]=1,e},Rc.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Rc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Rc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},Rc.subtract=qc,Rc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},Rc.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e},Rc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Rc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=t[0],v=t[1],x=t[2],b=t[3],w=t[4],S=t[5],T=t[6],E=t[7],A=t[8],M=t[9],k=t[10],C=t[11],P=t[12],I=t[13],D=t[14],z=t[15];return Math.abs(n-_)<=Oc.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-v)<=Oc.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-x)<=Oc.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-b)<=Oc.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=Oc.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-S)<=Oc.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-T)<=Oc.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-E)<=Oc.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-A)<=Oc.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-M)<=Oc.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(d-k)<=Oc.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(p-C)<=Oc.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(f-P)<=Oc.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-I)<=Oc.EPSILON*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(g-D)<=Oc.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(y-z)<=Oc.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))},Rc.sub=Rc.mul=Rc.ortho=Rc.perspective=void 0;var Oc=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Lc(e)&&"function"!=typeof e)return{default:e};var t=Fc(void 0);if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}(hc);function Fc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Fc=function(e){return e?n:t})(e)}function Bc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Nc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15],v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*i+x*a+b*h+w*m,e[1]=v*r+x*l+b*d+w*g,e[2]=v*o+x*c+b*p+w*y,e[3]=v*s+x*u+b*f+w*_,e[4]=(v=n[4])*i+(x=n[5])*a+(b=n[6])*h+(w=n[7])*m,e[5]=v*r+x*l+b*d+w*g,e[6]=v*o+x*c+b*p+w*y,e[7]=v*s+x*u+b*f+w*_,e[8]=(v=n[8])*i+(x=n[9])*a+(b=n[10])*h+(w=n[11])*m,e[9]=v*r+x*l+b*d+w*g,e[10]=v*o+x*c+b*p+w*y,e[11]=v*s+x*u+b*f+w*_,e[12]=(v=n[12])*i+(x=n[13])*a+(b=n[14])*h+(w=n[15])*m,e[13]=v*r+x*l+b*d+w*g,e[14]=v*o+x*c+b*p+w*y,e[15]=v*s+x*u+b*f+w*_,e}function jc(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=i+i,l=r+r,c=o+o,u=i*a,h=i*l,d=i*c,p=r*l,f=r*c,m=o*c,g=s*a,y=s*l,_=s*c;return e[0]=1-(p+m),e[1]=h+_,e[2]=d-y,e[3]=0,e[4]=h-_,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Vc(e,t){var n=t[4],i=t[5],r=t[6],o=t[8],s=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,i,r),e[2]=Math.hypot(o,s,a),e}function Uc(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(o=1/(i-r)),e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e}function Gc(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e}function qc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}Rc.perspective=Uc,Rc.ortho=Gc,Rc.mul=Nc,Rc.sub=qc;var Wc={},Zc={};function Hc(e){return Hc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hc(e)}Object.defineProperty(Zc,"__esModule",{value:!0}),Zc.create=Kc,Zc.clone=function(e){var t=new Xc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Zc.length=Jc,Zc.fromValues=function(e,t,n){var i=new Xc.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=n,i},Zc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Zc.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},Zc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},Zc.subtract=$c,Zc.multiply=Qc,Zc.divide=eu,Zc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Zc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Zc.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},Zc.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},Zc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Zc.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},Zc.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},Zc.distance=tu,Zc.squaredDistance=nu,Zc.squaredLength=iu,Zc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Zc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Zc.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},Zc.dot=ru,Zc.cross=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e},Zc.lerp=function(e,t,n,i){var r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e},Zc.hermite=function(e,t,n,i,r,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+n[0]*l+i[0]*c+r[0]*u,e[1]=t[1]*a+n[1]*l+i[1]*c+r[1]*u,e[2]=t[2]*a+n[2]*l+i[2]*c+r[2]*u,e},Zc.bezier=function(e,t,n,i,r,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return e[0]=t[0]*c+n[0]*u+i[0]*h+r[0]*d,e[1]=t[1]*c+n[1]*u+i[1]*h+r[1]*d,e[2]=t[2]*c+n[2]*u+i[2]*h+r[2]*d,e},Zc.random=function(e,t){t=t||1;var n=2*Xc.RANDOM()*Math.PI,i=2*Xc.RANDOM()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e},Zc.transformMat4=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e},Zc.transformMat3=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e},Zc.transformQuat=function(e,t,n){var i=n[0],r=n[1],o=n[2],s=t[0],a=t[1],l=t[2],c=r*l-o*a,u=o*s-i*l,h=i*a-r*s,d=r*h-o*u,p=o*c-i*h,f=i*u-r*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e},Zc.rotateX=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Zc.rotateY=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Zc.rotateZ=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Zc.angle=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(o*o+s*s+a*a),c=l&&ru(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},Zc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Zc.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Zc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Zc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(n-o)<=Xc.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=Xc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=Xc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},Zc.forEach=Zc.sqrLen=Zc.len=Zc.sqrDist=Zc.dist=Zc.div=Zc.mul=Zc.sub=void 0;var Xc=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Hc(e)&&"function"!=typeof e)return{default:e};var t=Yc(void 0);if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}(hc);function Yc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Yc=function(e){return e?n:t})(e)}function Kc(){var e=new Xc.ARRAY_TYPE(3);return Xc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Jc(e){return Math.hypot(e[0],e[1],e[2])}function $c(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Qc(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function eu(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function tu(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function nu(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function iu(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function ru(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Zc.sub=$c,Zc.mul=Qc,Zc.div=eu,Zc.dist=tu,Zc.sqrDist=nu,Zc.len=Jc,Zc.sqrLen=iu;var ou,su=(ou=Kc(),function(e,t,n,i,r,o){var s,a;for(t||(t=3),n||(n=0),a=i?Math.min(i*t+n,e.length):e.length,s=n;s<a;s+=t)ou[0]=e[s],ou[1]=e[s+1],ou[2]=e[s+2],r(ou,ou,o),e[s]=ou[0],e[s+1]=ou[1],e[s+2]=ou[2];return e});Zc.forEach=su;var au={};function lu(e){return lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lu(e)}Object.defineProperty(au,"__esModule",{value:!0}),au.create=hu,au.clone=function(e){var t=new cu.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},au.fromValues=function(e,t,n,i){var r=new cu.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},au.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},au.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},au.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},au.subtract=du,au.multiply=pu,au.divide=fu,au.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},au.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},au.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},au.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},au.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},au.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},au.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},au.distance=mu,au.squaredDistance=gu,au.length=yu,au.squaredLength=_u,au.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},au.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},au.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=o*s,e},au.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},au.cross=function(e,t,n,i){var r=n[0]*i[1]-n[1]*i[0],o=n[0]*i[2]-n[2]*i[0],s=n[0]*i[3]-n[3]*i[0],a=n[1]*i[2]-n[2]*i[1],l=n[1]*i[3]-n[3]*i[1],c=n[2]*i[3]-n[3]*i[2],u=t[0],h=t[1],d=t[2],p=t[3];return e[0]=h*c-d*l+p*a,e[1]=-u*c+d*s-p*o,e[2]=u*l-h*s+p*r,e[3]=-u*a+h*o-d*r,e},au.lerp=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e[3]=a+i*(n[3]-a),e},au.random=function(e,t){var n,i,r,o,s,a;t=t||1;do{s=(n=2*cu.RANDOM()-1)*n+(i=2*cu.RANDOM()-1)*i}while(s>=1);do{a=(r=2*cu.RANDOM()-1)*r+(o=2*cu.RANDOM()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return e[0]=t*n,e[1]=t*i,e[2]=t*r*l,e[3]=t*o*l,e},au.transformMat4=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e},au.transformQuat=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*o-l*r,h=c*r+l*i-s*o,d=c*o+s*r-a*i,p=-s*i-a*r-l*o;return e[0]=u*c+p*-s+h*-l-d*-a,e[1]=h*c+p*-a+d*-s-u*-l,e[2]=d*c+p*-l+u*-a-h*-s,e[3]=t[3],e},au.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},au.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},au.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},au.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=cu.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=cu.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-l)<=cu.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=cu.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},au.forEach=au.sqrLen=au.len=au.sqrDist=au.dist=au.div=au.mul=au.sub=void 0;var cu=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==lu(e)&&"function"!=typeof e)return{default:e};var t=uu(void 0);if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}(hc);function uu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(uu=function(e){return e?n:t})(e)}function hu(){var e=new cu.ARRAY_TYPE(4);return cu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function du(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function pu(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function fu(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function mu(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function gu(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return n*n+i*i+r*r+o*o}function yu(e){return Math.hypot(e[0],e[1],e[2],e[3])}function _u(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r}au.sub=du,au.mul=pu,au.div=fu,au.dist=mu,au.sqrDist=gu,au.len=yu,au.sqrLen=_u;var vu=function(){var e=hu();return function(t,n,i,r,o,s){var a,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function xu(e){return xu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xu(e)}au.forEach=vu,Object.defineProperty(Wc,"__esModule",{value:!0}),Wc.create=Mu,Wc.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Wc.setAxisAngle=ku,Wc.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>bu.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},Wc.getAngle=function(e,t){var n=Lu(e,t);return Math.acos(2*n*n-1)},Wc.multiply=Cu,Wc.rotateX=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-i*a,e},Wc.rotateY=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-o*a,e[1]=r*l+s*a,e[2]=o*l+i*a,e[3]=s*l-r*a,e},Wc.rotateZ=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},Wc.calculateW=function(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e},Wc.exp=Pu,Wc.ln=Iu,Wc.pow=function(e,t,n){return Iu(e,t),Ru(e,e,n),Pu(e,e),e},Wc.slerp=Du,Wc.random=function(e){var t=bu.RANDOM(),n=bu.RANDOM(),i=bu.RANDOM(),r=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*n),e[1]=r*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e},Wc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=o*a,e},Wc.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Wc.fromMat3=zu,Wc.fromEuler=function(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c,e},Wc.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Wc.setAxes=Wc.sqlerp=Wc.rotationTo=Wc.equals=Wc.exactEquals=Wc.normalize=Wc.sqrLen=Wc.squaredLength=Wc.len=Wc.length=Wc.lerp=Wc.dot=Wc.scale=Wc.mul=Wc.add=Wc.set=Wc.copy=Wc.fromValues=Wc.clone=void 0;var bu=Au(hc),wu=Au(kc),Su=Au(Zc),Tu=Au(au);function Eu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Eu=function(e){return e?n:t})(e)}function Au(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==xu(e)&&"function"!=typeof e)return{default:e};var n=Eu(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function Mu(){var e=new bu.ARRAY_TYPE(4);return bu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ku(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function Cu(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+s*a+r*c-o*l,e[1]=r*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-r*a,e[3]=s*u-i*a-r*l-o*c,e}function Pu(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=Math.sqrt(n*n+i*i+r*r),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return e[0]=n*l,e[1]=i*l,e[2]=r*l,e[3]=a*Math.cos(s),e}function Iu(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=Math.sqrt(n*n+i*i+r*r),a=s>0?Math.atan2(s,o)/s:0;return e[0]=n*a,e[1]=i*a,e[2]=r*a,e[3]=.5*Math.log(n*n+i*i+r*r+o*o),e}function Du(e,t,n,i){var r,o,s,a,l,c=t[0],u=t[1],h=t[2],d=t[3],p=n[0],f=n[1],m=n[2],g=n[3];return(o=c*p+u*f+h*m+d*g)<0&&(o=-o,p=-p,f=-f,m=-m,g=-g),1-o>bu.EPSILON?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(a=1-i,l=i),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*h+l*m,e[3]=a*d+l*g,e}function zu(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*s+s]+1),e[r]=.5*n,e[3]=(t[3*o+s]-t[3*s+o])*(n=.5/n),e[o]=(t[3*o+r]+t[3*r+o])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e}Wc.clone=Tu.clone,Wc.fromValues=Tu.fromValues,Wc.copy=Tu.copy,Wc.set=Tu.set,Wc.add=Tu.add,Wc.mul=Cu;var Ru=Tu.scale;Wc.scale=Ru;var Lu=Tu.dot;Wc.dot=Lu,Wc.lerp=Tu.lerp;var Ou=Tu.length;Wc.length=Ou,Wc.len=Ou;var Fu=Tu.squaredLength;Wc.squaredLength=Fu,Wc.sqrLen=Fu;var Bu=Tu.normalize;Wc.normalize=Bu,Wc.exactEquals=Tu.exactEquals,Wc.equals=Tu.equals;var Nu,ju,Vu,Uu=(Nu=Su.create(),ju=Su.fromValues(1,0,0),Vu=Su.fromValues(0,1,0),function(e,t,n){var i=Su.dot(t,n);return i<-.999999?(Su.cross(Nu,ju,t),Su.len(Nu)<1e-6&&Su.cross(Nu,Vu,t),Su.normalize(Nu,Nu),ku(e,Nu,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Su.cross(Nu,t,n),e[0]=Nu[0],e[1]=Nu[1],e[2]=Nu[2],e[3]=1+i,Bu(e,e))});Wc.rotationTo=Uu;var Gu,qu,Wu=(Gu=Mu(),qu=Mu(),function(e,t,n,i,r,o){return Du(Gu,t,r,o),Du(qu,n,i,o),Du(e,Gu,qu,2*o*(1-o)),e});Wc.sqlerp=Wu;var Zu,Hu=(Zu=wu.create(),function(e,t,n,i){return Zu[0]=n[0],Zu[3]=n[1],Zu[6]=n[2],Zu[1]=i[0],Zu[4]=i[1],Zu[7]=i[2],Zu[2]=-t[0],Zu[5]=-t[1],Zu[8]=-t[2],Bu(e,zu(e,Zu))});Wc.setAxes=Hu;var Xu={};function Yu(e){return Yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yu(e)}Object.defineProperty(Xu,"__esModule",{value:!0}),Xu.create=function(){var e=new Ku.ARRAY_TYPE(8);return Ku.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Xu.clone=function(e){var t=new Ku.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Xu.fromValues=function(e,t,n,i,r,o,s,a){var l=new Ku.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=r,l[5]=o,l[6]=s,l[7]=a,l},Xu.fromRotationTranslationValues=function(e,t,n,i,r,o,s){var a=new Ku.ARRAY_TYPE(8);a[0]=e,a[1]=t,a[2]=n,a[3]=i;var l=.5*r,c=.5*o,u=.5*s;return a[4]=l*i+c*n-u*t,a[5]=c*i+u*e-l*n,a[6]=u*i+l*t-c*e,a[7]=-l*e-c*t-u*n,a},Xu.fromRotationTranslation=th,Xu.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Xu.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Xu.fromMat4=function(e,t){var n=Ju.create();$u.getRotation(n,t);var i=new Ku.ARRAY_TYPE(3);return $u.getTranslation(i,t),th(e,n,i),e},Xu.copy=nh,Xu.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Xu.set=function(e,t,n,i,r,o,s,a,l){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e},Xu.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Xu.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Xu.getTranslation=function(e,t){var n=t[4],i=t[5],r=t[6],o=t[7],s=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=2*(n*c+o*s+i*l-r*a),e[1]=2*(i*c+o*a+r*s-n*l),e[2]=2*(r*c+o*l+n*a-i*s),e},Xu.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=.5*n[0],l=.5*n[1],c=.5*n[2],u=t[4],h=t[5],d=t[6],p=t[7];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=s*a+r*c-o*l+u,e[5]=s*l+o*a-i*c+h,e[6]=s*c+i*l-r*a+d,e[7]=-i*a-r*l-o*c+p,e},Xu.rotateX=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*r,d=l*s+u*r+c*i-a*o,p=c*s+u*o+a*r-l*i,f=u*s-a*i-l*r-c*o;return Ju.rotateX(e,t,n),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*s+f*r+p*i-h*o,e[6]=p*s+f*o+h*r-d*i,e[7]=f*s-h*i-d*r-p*o,e},Xu.rotateY=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*r,d=l*s+u*r+c*i-a*o,p=c*s+u*o+a*r-l*i,f=u*s-a*i-l*r-c*o;return Ju.rotateY(e,t,n),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*s+f*r+p*i-h*o,e[6]=p*s+f*o+h*r-d*i,e[7]=f*s-h*i-d*r-p*o,e},Xu.rotateZ=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*i+l*o-c*r,d=l*s+u*r+c*i-a*o,p=c*s+u*o+a*r-l*i,f=u*s-a*i-l*r-c*o;return Ju.rotateZ(e,t,n),e[4]=h*(s=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*s+f*r+p*i-h*o,e[6]=p*s+f*o+h*r-d*i,e[7]=f*s-h*i-d*r-p*o,e},Xu.rotateByQuatAppend=function(e,t,n){var i=n[0],r=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2],u=t[3];return e[0]=a*s+u*i+l*o-c*r,e[1]=l*s+u*r+c*i-a*o,e[2]=c*s+u*o+a*r-l*i,e[3]=u*s-a*i-l*r-c*o,e[4]=(a=t[4])*s+(u=t[7])*i+(l=t[5])*o-(c=t[6])*r,e[5]=l*s+u*r+c*i-a*o,e[6]=c*s+u*o+a*r-l*i,e[7]=u*s-a*i-l*r-c*o,e},Xu.rotateByQuatPrepend=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+s*a+r*c-o*l,e[1]=r*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-r*a,e[3]=s*u-i*a-r*l-o*c,e[4]=i*(u=n[7])+s*(a=n[4])+r*(c=n[6])-o*(l=n[5]),e[5]=r*u+s*l+o*a-i*c,e[6]=o*u+s*c+i*l-r*a,e[7]=s*u-i*a-r*l-o*c,e},Xu.rotateAroundAxis=function(e,t,n,i){if(Math.abs(i)<Ku.EPSILON)return nh(e,t);var r=Math.hypot(n[0],n[1],n[2]);i*=.5;var o=Math.sin(i),s=o*n[0]/r,a=o*n[1]/r,l=o*n[2]/r,c=Math.cos(i),u=t[0],h=t[1],d=t[2],p=t[3];e[0]=u*c+p*s+h*l-d*a,e[1]=h*c+p*a+d*s-u*l,e[2]=d*c+p*l+u*a-h*s,e[3]=p*c-u*s-h*a-d*l;var f=t[4],m=t[5],g=t[6],y=t[7];return e[4]=f*c+y*s+m*l-g*a,e[5]=m*c+y*a+g*s-f*l,e[6]=g*c+y*l+f*a-m*s,e[7]=y*c-f*s-m*a-g*l,e},Xu.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},Xu.multiply=ih,Xu.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},Xu.lerp=function(e,t,n,i){var r=1-i;return rh(t,n)<0&&(i=-i),e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i,e[3]=t[3]*r+n[3]*i,e[4]=t[4]*r+n[4]*i,e[5]=t[5]*r+n[5]*i,e[6]=t[6]*r+n[6]*i,e[7]=t[7]*r+n[7]*i,e},Xu.invert=function(e,t){var n=sh(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},Xu.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Xu.normalize=function(e,t){var n=sh(t);if(n>0){n=Math.sqrt(n);var i=t[0]/n,r=t[1]/n,o=t[2]/n,s=t[3]/n,a=t[4],l=t[5],c=t[6],u=t[7],h=i*a+r*l+o*c+s*u;e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=(a-i*h)/n,e[5]=(l-r*h)/n,e[6]=(c-o*h)/n,e[7]=(u-s*h)/n}return e},Xu.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Xu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Xu.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=t[0],h=t[1],d=t[2],p=t[3],f=t[4],m=t[5],g=t[6],y=t[7];return Math.abs(n-u)<=Ku.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=Ku.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-d)<=Ku.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-p)<=Ku.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-f)<=Ku.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=Ku.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=Ku.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=Ku.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},Xu.sqrLen=Xu.squaredLength=Xu.len=Xu.length=Xu.dot=Xu.mul=Xu.setReal=Xu.getReal=void 0;var Ku=eh(hc),Ju=eh(Wc),$u=eh(Rc);function Qu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Qu=function(e){return e?n:t})(e)}function eh(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Yu(e)&&"function"!=typeof e)return{default:e};var n=Qu(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function th(e,t,n){var i=.5*n[0],r=.5*n[1],o=.5*n[2],s=t[0],a=t[1],l=t[2],c=t[3];return e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=i*c+r*l-o*a,e[5]=r*c+o*s-i*l,e[6]=o*c+i*a-r*s,e[7]=-i*s-r*a-o*l,e}function nh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function ih(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[4],l=n[5],c=n[6],u=n[7],h=t[4],d=t[5],p=t[6],f=t[7],m=n[0],g=n[1],y=n[2],_=n[3];return e[0]=i*_+s*m+r*y-o*g,e[1]=r*_+s*g+o*m-i*y,e[2]=o*_+s*y+i*g-r*m,e[3]=s*_-i*m-r*g-o*y,e[4]=i*u+s*a+r*c-o*l+h*_+f*m+d*y-p*g,e[5]=r*u+s*l+o*a-i*c+d*_+f*g+p*m-h*y,e[6]=o*u+s*c+i*l-r*a+p*_+f*y+h*g-d*m,e[7]=s*u-i*a-r*l-o*c+f*_-h*m-d*g-p*y,e}Xu.getReal=Ju.copy,Xu.setReal=Ju.copy,Xu.mul=ih;var rh=Ju.dot;Xu.dot=rh;var oh=Ju.length;Xu.length=oh,Xu.len=oh;var sh=Ju.squaredLength;Xu.squaredLength=sh,Xu.sqrLen=sh;var ah={};function lh(e){return lh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lh(e)}Object.defineProperty(ah,"__esModule",{value:!0}),ah.create=hh,ah.clone=function(e){var t=new ch.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},ah.fromValues=function(e,t){var n=new ch.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},ah.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},ah.set=function(e,t,n){return e[0]=t,e[1]=n,e},ah.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},ah.subtract=dh,ah.multiply=ph,ah.divide=fh,ah.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},ah.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},ah.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},ah.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},ah.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},ah.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},ah.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e},ah.distance=mh,ah.squaredDistance=gh,ah.length=yh,ah.squaredLength=_h,ah.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},ah.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},ah.normalize=function(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e},ah.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},ah.cross=function(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e},ah.lerp=function(e,t,n,i){var r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e},ah.random=function(e,t){t=t||1;var n=2*ch.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},ah.transformMat2=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e},ah.transformMat2d=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e},ah.transformMat3=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e},ah.transformMat4=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e},ah.rotate=function(e,t,n,i){var r=t[0]-n[0],o=t[1]-n[1],s=Math.sin(i),a=Math.cos(i);return e[0]=r*a-o*s+n[0],e[1]=r*s+o*a+n[1],e},ah.angle=function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1],s=Math.sqrt(n*n+i*i)*Math.sqrt(r*r+o*o);return Math.acos(Math.min(Math.max(s&&(n*r+i*o)/s,-1),1))},ah.zero=function(e){return e[0]=0,e[1]=0,e},ah.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},ah.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},ah.equals=function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1];return Math.abs(n-r)<=ch.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-o)<=ch.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},ah.forEach=ah.sqrLen=ah.sqrDist=ah.dist=ah.div=ah.mul=ah.sub=ah.len=void 0;var ch=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==lh(e)&&"function"!=typeof e)return{default:e};var t=uh(void 0);if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}(hc);function uh(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(uh=function(e){return e?n:t})(e)}function hh(){var e=new ch.ARRAY_TYPE(2);return ch.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function dh(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ph(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function fh(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function mh(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function gh(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function yh(e){return Math.hypot(e[0],e[1])}function _h(e){var t=e[0],n=e[1];return t*t+n*n}ah.len=yh,ah.sub=dh,ah.mul=ph,ah.div=fh,ah.dist=mh,ah.sqrDist=gh,ah.sqrLen=_h;var vh=function(){var e=hh();return function(t,n,i,r,o,s){var a,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,a=i;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function xh(e){return xh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xh(e)}ah.forEach=vh,Object.defineProperty(uc,"__esModule",{value:!0});var bh=uc.vec4=Lh=uc.vec3=uc.vec2=uc.quat2=Ih=uc.quat=Ch=uc.mat4=Mh=uc.mat3=uc.mat2d=Th=uc.mat2=uc.glMatrix=void 0,wh=Bh(hc);uc.glMatrix=wh;var Sh=Bh(gc),Th=uc.mat2=Sh,Eh=Bh(wc);uc.mat2d=Eh;var Ah=Bh(kc),Mh=uc.mat3=Ah,kh=Bh(Rc),Ch=uc.mat4=kh,Ph=Bh(Wc),Ih=uc.quat=Ph,Dh=Bh(Xu);uc.quat2=Dh;var zh=Bh(ah);uc.vec2=zh;var Rh=Bh(Zc),Lh=uc.vec3=Rh,Oh=Bh(au);function Fh(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Fh=function(e){return e?n:t})(e)}function Bh(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==xh(e)&&"function"!=typeof e)return{default:e};var n=Fh(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}bh=uc.vec4=Oh;const Nh=Ia([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jh}=Nh,Vh=Ia([{name:"a_pos_3",components:3,type:"Int16"}]);var Uh=Ia([{name:"a_pos",type:"Int16",components:2}]),Gh={};!function(e,t){!function(e){function t(e,t,i){var r=n(256*e,256*(t=Math.pow(2,i)-t-1),i),o=n(256*(e+1),256*(t+1),i);return r[0]+","+r[1]+","+o[0]+","+o[1]}function n(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}e.getURL=function(e,n,i,r,o,s){return s=s||{},e+"?"+["bbox="+t(i,r,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+n].join("&")},e.getTileBBox=t,e.getMercCoords=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,Gh);var qh=Gh;class Wh{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Xh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=qh.getTileBBox(this.x,this.y,this.z),i=function(e,t,n){let i,r="";for(let o=e;o>0;o--)i=1<<o-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class Zh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Xh(e,t.z,t.z,t.x,t.y)}}class Hh{constructor(e,t,n,i,r){this.overscaledZ=e,this.wrap=t,this.canonical=new Wh(n,+i,+r),this.key=0===t&&e===n?this.canonical.key:Xh(t,e,n,i,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Hh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Xh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Xh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Hh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Hh(t,this.wrap,t,n,i),new Hh(t,this.wrap,t,n+1,i),new Hh(t,this.wrap,t,n,i+1),new Hh(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zh(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function Xh(e,t,n,i,r){const o=1<<Math.min(n,22);let s=o*(r%o)+i%o;return e&&n<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*s+n)+(t-n)}const Yh=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new Hh(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new Hh(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new Hh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Hh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Os(Wh,"CanonicalTileID"),Os(Hh,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class Kh{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=Lh.dot(t,this.dir);if(Math.abs(i)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/i;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,n[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,t,n){if(Lh.equals(this.pos,e)||0===t)return n[0]=n[1]=n[2]=0,!1;const[i,r,o]=this.dir,s=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],c=i*i+r*r+o*o,u=2*(s*i+a*r+l*o),h=u*u-4*c*(s*s+a*a+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=s+i*e,h=a+r*e,d=l+o*e,p=Math.hypot(c,h,d);return n[0]=c*t/p,n[1]=h*t/p,n[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(s,a,l);return n[0]=s*t/e,n[1]=a*t/e,n[2]=l*t/e,!1}return n[0]=s+i*e,n[1]=a+r*e,n[2]=l+o*e,!0}}}class Jh{constructor(e,t,n,i,r){this.TL=e,this.TR=t,this.BR=n,this.BL=i,this.horizon=r}static fromInvProjectionMatrix(e,t,n){const i=[-1,1,1],r=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Lh.transformMat4(i,i,e),l=Lh.transformMat4(r,r,e),c=Lh.transformMat4(o,o,e),u=Lh.transformMat4(s,s,e);return new Jh(a,l,c,u,t/n)}}function $h(e,t,n){let i=1/0,r=-1/0;const o=[];for(const s of e){Lh.sub(o,s,t);const e=Lh.dot(o,n);i=Math.min(i,e),r=Math.max(r,e)}return[i,r]}function Qh(e,t){let n=!0;for(let i=0;i<e.planes.length;i++){const r=e.planes[i];let o=0;for(let e=0;e<t.length;e++)o+=Lh.dot(r,t[e])+r[3]>=0;if(0===o)return 0;o!==t.length&&(n=!1)}return n?2:1}function ed(e,t){for(const n of e.projections){const i=$h(t,e.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function td(e,t){let n=0;const i=[0,0,0,0];for(let r=0;r<e.length;r++)i[0]=e[r][0],i[1]=e[r][1],i[2]=e[r][2],i[3]=1,bh.dot(i,t)>=0&&n++;return n}class nd{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=id.fromPoints(this.points),this.projections=[],this.frustumEdges=[Lh.sub([],this.points[2],this.points[3]),Lh.sub([],this.points[0],this.points[3]),Lh.sub([],this.points[4],this.points[0]),Lh.sub([],this.points[5],this.points[1]),Lh.sub([],this.points[6],this.points[2]),Lh.sub([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const e=[0,-n[2],n[1]],t=[n[2],0,-n[0]];this.projections.push({axis:e,projection:$h(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:$h(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(e,t,n,i){const r=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(n=>{const o=bh.transformMat4([],n,e),s=1/o[3]/t*r;return bh.mul(o,o,[s,s,i?1/o[3]:s,s])}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const t=Lh.sub([],o[e[0]],o[e[1]]),n=Lh.sub([],o[e[2]],o[e[1]]),i=Lh.normalize([],Lh.cross([],t,n)),r=-Lh.dot(i,o[e[1]]);return i.concat(r)}),a=[];for(let l=0;l<o.length;l++)a.push([o[l][0],o[l][1],o[l][2]]);return new nd(a,s)}intersectsPrecise(e,t,n){for(let i=0;i<t.length;i++)if(!td(e,t[i]))return 0;for(let i=0;i<this.planes.length;i++)if(!td(e,this.planes[i]))return 0;for(const i of n)for(const t of this.frustumEdges){const n=Lh.cross([],i,t),r=Lh.length(n);if(0===r)continue;Lh.scale(n,n,1/r);const o=$h(this.points,this.points[0],n),s=$h(e,this.points[0],n);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}}class id{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const i of e)Lh.min(t,t,i),Lh.max(n,n,i);return new id(t,n)}static fromTileIdAndHeight(e,t,n){const i=1<<e.canonical.z,r=e.canonical.x,o=e.canonical.y;return new id([r/i,o/i,t],[(r+1)/i,(o+1)/i,n])}static applyTransform(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)Lh.transformMat4(n[i],n[i],t);return id.fromPoints(n)}static projectAabbCorners(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)Lh.transformMat4(n[i],n[i],t);return n}constructor(e,t){this.min=e,this.max=t,this.center=Lh.scale([],Lh.add([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=Lh.clone(this.min),i=Lh.clone(this.max);for(let r=0;r<t.length;r++)n[r]=t[r]?this.min[r]:this.center[r],i[r]=t[r]?this.center[r]:this.max[r];return i[2]=this.max[2],new id(n,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Qh(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Qh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?ed(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?ed(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Os(id,"Aabb");const rd=5,od=6,sd=pi/Math.PI/2,ad=16383,ld=64,cd=[ld,32,16],ud=-sd,hd=sd,dd=[new id([ud,ud,ud],[hd,hd,hd]),new id([ud,ud,ud],[0,0,hd]),new id([0,ud,ud],[hd,0,hd]),new id([ud,0,ud],[0,hd,hd]),new id([0,0,ud],[hd,hd,hd])];function pd(e){return e*sd/Hd}function fd(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=Lh.scale([],e._camera.position,e.worldSize),o=[t,n,1,1];bh.transformMat4(o,o,e.pixelMatrixInverse),bh.scale(o,o,1/o[3]);const s=Lh.sub([],o,r),a=Lh.normalize([],s),l=e.globeMatrix,c=[l[12],l[13],l[14]],u=Lh.sub([],c,r),h=Lh.length(u),d=Lh.normalize([],u),p=e.worldSize/(2*Math.PI),f=Lh.dot(d,a),m=Math.asin(p/h);if(m<Math.acos(f)){if(!i)return null;const e=[],t=[];Lh.scale(e,a,h/f),Lh.normalize(t,Lh.sub(t,e,u)),Lh.normalize(a,Lh.add(a,u,Lh.scale(a,t,Math.tan(m)*h)))}const g=[];new Kh(r,a).closestPointOnSphere(c,p,g);const y=Lh.normalize([],ae(l,0)),_=Lh.normalize([],ae(l,1)),v=Lh.normalize([],ae(l,2)),x=Lh.dot(y,g),b=Lh.dot(_,g),w=Lh.dot(v,g),S=A(Math.asin(-b/p));let T=A(Math.atan2(x,w));T=e.center.lng+function(e,t){const n=(t-e+180)%360-180;return n<-180?n+360:n}(e.center.lng,T);const E=ep(T),M=z(tp(S),0,1);return new hp(E,M)}class md{constructor(e,t,n){this.a=Lh.sub([],e,n),this.b=Lh.sub([],t,n),this.center=n;const i=Lh.normalize([],this.a),r=Lh.normalize([],this.b);this.angle=Math.acos(Lh.dot(i,r))}}function gd(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(e,t,n,i){const r=Math.sin(n);return e*(Math.sin((1-i)*n)/r)+t*(Math.sin(i*n)/r)}(e.a[t],e.b[t],e.angle,z(n,0,1))+e.center[t]}function yd(e){if(e.z<=1)return dd[e.z+2*e.y+e.x];const t=Sd(wd(e));return id.fromPoints(t)}function _d(e,t,n){return Lh.scale(e,e,1-n),Lh.scaleAndAdd(e,e,t,n)}function vd(e,t){const n=Ld(t.zoom);if(0===n)return yd(e);const i=wd(e),r=Sd(i),o=ep(i.getWest())*t.worldSize,s=ep(i.getEast())*t.worldSize,a=tp(i.getNorth())*t.worldSize,l=tp(i.getSouth())*t.worldSize,c=[o,a,0],u=[s,a,0],h=[o,l,0],d=[s,l,0],p=Ch.invert([],t.globeMatrix);return Lh.transformMat4(c,c,p),Lh.transformMat4(u,u,p),Lh.transformMat4(h,h,p),Lh.transformMat4(d,d,p),r[0]=_d(r[0],h,n),r[1]=_d(r[1],d,n),r[2]=_d(r[2],u,n),r[3]=_d(r[3],c,n),id.fromPoints(r)}function xd(e,t,n){for(const i of e)Lh.transformMat4(i,i,t),Lh.scale(i,i,n)}function bd(e,t,n,i){const r=t/e.worldSize,o=e.globeMatrix;if(n.z<=1){const e=yd(n).getCorners();return xd(e,o,r),id.fromPoints(e)}const s=wd(n,i),a=Sd(s);xd(a,o,r);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(e.center)){for(const e of a)Lh.min(u,u,e),Lh.max(c,c,e);c[2]=0;const t=e.point,n=[t.x*r,t.y*r,0];return Lh.min(u,u,n),Lh.max(c,c,n),new id(u,c)}const h=[o[12]*r,o[13]*r,o[14]*r],d=s.getCenter(),p=z(e.center.lat,-sp,sp),f=z(d.lat,-sp,sp),m=ep(e.center.lng),g=tp(p);let y=m-ep(d.lng);const _=g-tp(f);y>.5?y-=1:y<-.5&&(y+=1);let v=0;if(Math.abs(y)>Math.abs(_))v=y>=0?1:3;else{v=_>=0?0:2;const e=[o[4]*r,o[5]*r,o[6]*r],t=-Math.sin(E(_>=0?s.getSouth():s.getNorth()))*sd;Lh.scaleAndAdd(h,h,e,t)}const x=a[v],b=a[(v+1)%4],w=new md(x,b,h),S=[gd(w,0)||x[0],gd(w,1)||x[1],gd(w,2)||x[2]],T=Ld(e.zoom);if(T>0){const i=function(e,t,n,i,r){let{x:o,y:s,z:a}=e;const l=1/(1<<a);let c=o*l,u=c+l,h=s*l,d=h+l,p=0;const f=(c+u)/2-i;return f>.5?p=-1:f<-.5&&(p=1),c=((c+p)*t-(i*=t))*n+i,u=((u+p)*t-i)*n+i,h=(h*t-(r*=t))*n+r,d=(d*t-r)*n+r,[[c,d,0],[u,d,0],[u,h,0],[c,h,0]]}(n,t,e._pixelsPerMercatorPixel,m,g);for(let e=0;e<a.length;e++)_d(a[e],i[e],T);const r=Lh.add([],i[v],i[(v+1)%4]);Lh.scale(r,r,.5),_d(S,r,T)}for(const E of a)Lh.min(u,u,E),Lh.max(c,c,E);return u[2]=Math.min(x[2],b[2]),Lh.min(u,u,S),Lh.max(c,c,S),new id(u,c)}function wd(e){let{x:t,y:n,z:i}=e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=1/(1<<i),s=new Kd(ip(t*o),n===(1<<i)-1&&r?-90:rp((n+1)*o)),a=new Kd(ip((t+1)*o),0===n&&r?90:rp(n*o));return new cc(s,a)}function Sd(e){const t=E(e.getNorth()),n=E(e.getSouth()),i=Math.cos(t),r=Math.cos(n),o=Math.sin(t),s=Math.sin(n),a=e.getWest(),l=e.getEast();return[Td(r,s,a),Td(r,s,l),Td(i,o,l),Td(i,o,a)]}function Td(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:sd;return n=E(n),[e*Math.sin(n)*i,-t*i,e*Math.cos(n)*i]}function Ed(e,t,n){return Td(Math.cos(E(e)),Math.sin(E(e)),t,n)}function Ad(e,t,n,i){const r=1<<n.z,o=(e/pi+n.x)/r;return Ed(rp((t/pi+n.y)/r),ip(o),i)}function Md(e){let{min:t,max:n}=e;return ad/Math.max(n[0]-t[0],n[1]-t[1],n[2]-t[2])}const kd=new Float64Array(16);function Cd(e){const t=Md(e),n=Ch.fromScaling(kd,[t,t,t]);return Ch.translate(n,n,Lh.negate([],e.min))}function Pd(e){const t=Ch.fromTranslation(kd,e.min),n=1/Md(e);return Ch.scale(t,t,[n,n,n])}function Id(e){const t=pi/(2*Math.PI);return e/(2*Math.PI)/t}function Dd(e,t){return pi/(512*Math.pow(2,e))*Md(yd(t))}function zd(e,t,n,i,r){const o=Id(n),s=[e,t,-n/(2*Math.PI)],a=Ch.identity(new Float64Array(16));return Ch.translate(a,a,s),Ch.scale(a,a,[o,o,o]),Ch.rotateX(a,a,E(-r)),Ch.rotateY(a,a,E(-i)),a}function Rd(e){const t=e.pixelsPerMeter,n=t/np(1,e.center.lat),i=Ch.identity(new Float64Array(16));return Ch.translate(i,i,[e.point.x,e.point.y,0]),Ch.scale(i,i,[n,n,t]),Float32Array.from(i)}function Ld(e){return R(rd,od,e)}function Od(e,t,n){const i=Ch.identity(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return Ch.rotateY(i,n.globeMatrix,r),Float32Array.from(i)}function Fd(e,t,n){const i=Ld(n.zoom),r=e.style.map._antialias,o=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!r&&!o}function Bd(e,t,n,i){const r=t.getNorth(),o=t.getSouth(),s=t.getWest(),a=t.getEast(),l=1<<e.z,c=a-s,u=r-o,h=c/ld,d=-u/cd[n],p=[0,h,0,d,0,0,r,s,0];if(e.z>0){const e=180/i;Mh.multiply(p,p,[e/c+1,0,0,0,e/u+1,0,-.5*e/h,.5*e/d,1])}return p[2]=l,p[5]=e.x,p[8]=e.y,p}function Nd(e){const t=sp-5;e=z(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(E(e))),3);return Math.round(n*(cd.length-1))}function jd(e){const t=[0,0,0],n=Ch.identity(new Float64Array(16));return Ch.multiply(n,e.pixelMatrix,e.globeMatrix),Lh.transformMat4(t,t,n),new b(t[0],t[1])}function Vd(e,t){const n=Ed(t.lat,t.lng),i=function(e){const t=Ed(e._center.lat,e._center.lng),n=Lh.fromValues(0,1,0);let i=Lh.cross([],n,t);const r=Ch.fromRotation([],-e.angle,t);i=Lh.transformMat4(i,i,r),Ch.fromRotation(r,-e._pitch,i);const o=Lh.normalize([],t);return Lh.scale(o,o,pd(e.cameraToCenterDistance/e.pixelsPerMeter)),Lh.transformMat4(o,o,r),Lh.add([],t,o)}(e),r=Lh.subtract([],i,n);return Lh.angle(r,n)}function Ud(e,t){return Vd(e,t)>Math.PI/2*1.01}const Gd=E(85),qd=Math.cos(Gd),Wd=Math.sin(Gd);class Zd{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const n=new za,i=new Ka,r=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,n)=>{let i=e===o-1?e-2:0===e?e:e-1;return i+=n?24575:0,[i,t]};for(let c=0;c<o;++c)n.emplaceBack(...l(c,0,!0));for(let c=0;c<s;++c)for(let e=0;e<o;++e)n.emplaceBack(...l(e,c,(0===e||e===o-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<o;++t)n.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=i.length,s=t[c]+1+2,l=new Ka;for(let n=0;n<s-1;n++){const e=n===s-2,r=e?o*(a-t.length+c-n):o;for(let t=0;t<o-1;t++){const s=n*o+t;0===n||e||0===t||t===o-2?(l.emplaceBack(s+1,s,s+r),l.emplaceBack(s+r,s+r+1,s+1)):(i.emplaceBack(s+1,s,s+r),i.emplaceBack(s+r,s+r+1,s+1))}}const u=wl.simpleSegment(0,e,n.length,i.length-e);for(let t=0;t<l.uint16.length;t+=3)i.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const h=wl.simpleSegment(0,e,n.length,i.length-e);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:n,indices:i,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(ld,cd);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Uh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Ka;for(let s=0;s<=ld;s++)t.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new el,i=new el,r=new el,o=new el;this._poleSegments=[];for(let s=0,a=0;s<rd;s++){const e=360/(1<<s);n.emplaceBack(0,-sd,0,.5,0),i.emplaceBack(0,-sd,0,.5,1),r.emplaceBack(0,-sd,0,.5,.5),o.emplaceBack(0,-sd,0,.5,.5);for(let t=0;t<=ld;t++){let s=t/ld,a=0;const l=tr(0,e,s),[c,u,h]=Td(qd,Wd,l,sd);n.emplaceBack(c,u,h,s,a),i.emplaceBack(c,u,h,s,1-a);const d=E(l);s=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),r.emplaceBack(c,u,h,s,a),o.emplaceBack(c,u,h,s,1-a)}this._poleSegments.push(wl.simpleSegment(a,0,66,64)),a+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,jh,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,jh,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(r,jh,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,jh,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const Hd=6371008.8,Xd=2*Math.PI*Hd;class Yd{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yd(L(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Hd*Math.acos(Math.min(r,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new cc(new Yd(this.lng-t,this.lat-e),new Yd(this.lng+t,this.lat+e))}toEcef(e){const t=pd(e);return Ed(this.lat,this.lng,sd+t)}static convert(e){if(e instanceof Yd)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Yd(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Yd(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Kd=Yd;const Jd=0,$d=25.5;function Qd(e){return Xd*Math.cos(e*Math.PI/180)}function ep(e){return(180+e)/360}function tp(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function np(e,t){return e/Qd(t)}function ip(e){return 360*e-180}function rp(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function op(e,t){return e*Qd(rp(t))}const sp=85.051129;function ap(e){return Math.cos(E(z(e,-sp,sp)))}function lp(e,t){const n=z(t,Jd,$d),i=Math.pow(2,n);return ap(e)*Xd/(512*i)}function cp(e){return 1/Math.cos(e*Math.PI/180)}function up(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.exp(Math.PI*(1-(e.y+t/pi)/(1<<e.z)*2));return 80150034*n/(n*n+1)/pi/(1<<e.z)}class hp{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Kd.convert(e);return new hp(ep(n.lng),tp(n.lat),np(t,n.lat))}toLngLat(){return new Kd(ip(this.x),rp(this.y))}toAltitude(){return op(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Xd*cp(rp(this.y))}}function dp(e,t,n,i,r,o,s,a,l){const c=(t+i)/2,u=(n+r)/2,h=new b(c,u);a(h),function(e,t,n,i,r,o){const s=n-r,a=i-o;return Math.abs((i-t)*s-(n-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(dp(e,t,n,c,u,o,h,a,l),dp(e,c,u,i,r,h,s,a,l)):e.push(s)}function pp(e,t,n){let i=e[0],r=i.x,o=i.y;t(i);const s=[i];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),dp(s,r,o,c,u,i,l,t,n),r=c,o=u,i=l}return s}function fp(e,t,n,i){if(i(t,n)){const r=t.add(n)._mult(.5);fp(e,t,r,i),fp(e,r,n,i)}else e.push(n)}function mp(e,t){let n=e[0];const i=[n];for(let r=1;r<e.length;r++){const o=e[r];fp(i,n,o,t),n=o}return i}const gp=Math.pow(2,14)-1,yp=-gp-1;function _p(e,t){const n=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=z(n,yp,gp),e.y=z(i,yp,gp),(n<e.x||n>e.x+1||i<e.y||i>e.y+1)&&J("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function vp(e,t,n){const i=e.loadGeometry(),r=e.extent,o=pi/r;if(t&&n&&n.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=n,u=e=>{const n=ip((t.x+e.x/r)/o),i=rp((t.y+e.y/r)/o),u=c.project(n,i);e.x=(u.x*s-a)*r,e.y=(u.y*s-l)*r};for(let t=0;t<i.length;t++)if(1!==e.type)i[t]=pp(i[t],u,1);else{const e=[];for(const n of i[t])n.x<0||n.x>=r||n.y<0||n.y>=r||(u(n),e.push(n));i[t]=e}}for(const s of i)for(const e of s)_p(e,o);return i}function xp(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?vp(e):[]}}function bp(e,t,n,i,r){e.emplaceBack(2*t+(i+1)/2,2*n+(r+1)/2)}function wp(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class Sp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new za,this.indexArray=new Ka,this.segments=new wl,this.programConfigurations=new ic(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n,i){const r=this.layers[0],o=[];let s=null;"circle"===r.type&&(s=r.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=xp(l,e);if(!this.layers[0]._featureFilter.filter(new la(this.zoom),t,n))continue;const r=s?s.evaluate(t,{},n):void 0,a={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:e?t.geometry:vp(l,n,i),patterns:{},sortKey:r};o.push(a)}s&&o.sort((e,t)=>e.sortKey-t.sortKey);let a=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new Va,a=i.projection);for(const l of o){const{geometry:i,index:r,sourceLayerIndex:o}=l,s=e[r].feature;this.addFeature(l,i,r,t.availableImages,n,a,t.brightness),t.featureIndex.insert(s,i,r,o,this.index)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,bl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,i,r,o,s){for(const a of t)for(const t of a){const n=t.x,i=t.y;if(n<0||n>=pi||i<0||i>=pi)continue;if(o){const e=o.projectTilePoint(n,i,r),t=o.upVector(r,n,i),s=this.globeExtVertexArray;wp(s,e,t),wp(s,e,t),wp(s,e,t),wp(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;bp(this.layoutVertexArray,n,i,-1,-1),bp(this.layoutVertexArray,n,i,1,-1),bp(this.layoutVertexArray,n,i,1,1),bp(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,r,s)}}function Tp(e,t){for(let n=0;n<e.length;n++)if(zp(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(zp(e,t[n]))return!0;return!!kp(e,t)}function Ep(e,t,n){return!!zp(e,t)||!!Pp(t,e,n)}function Ap(e,t){if(1===e.length)return Dp(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(zp(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(Dp(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(kp(e,t[n]))return!0;return!1}function Mp(e,t,n){if(e.length>1){if(kp(e,t))return!0;for(let i=0;i<t.length;i++)if(Pp(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(Pp(e[i],t,n))return!0;return!1}function kp(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(Cp(i,r,t[e],t[e+1]))return!0}return!1}function Cp(e,t,n,i){return $(e,n,i)!==$(t,n,i)&&$(e,t,n)!==$(e,t,i)}function Pp(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let r=1;r<t.length;r++)if(Ip(e,t[r-1],t[r])<i)return!0;return!1}function Ip(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function Dp(e,t){let n,i,r,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)i=n[e],r=n[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function zp(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const o=e[i],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function Rp(e,t,n,i,r){for(const s of e)if(t<=s.x&&n<=s.y&&i>=s.x&&r>=s.y)return!0;const o=[new b(t,n),new b(t,r),new b(i,r),new b(i,n)];if(e.length>2)for(const s of o)if(zp(e,s))return!0;for(let s=0;s<e.length-1;s++)if(Lp(e[s],e[s+1],o))return!0;return!1}function Lp(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const o=$(e,t,n[0]);return o!==$(e,t,n[1])||o!==$(e,t,n[2])||o!==$(e,t,n[3])}function Op(e,t,n,i,r,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const e=s*s+a*a;if(0===e)return!0;const t=Math.sqrt(e);s/=t,a/=t}return!((n.x-e.x)*s+(n.y-e.y)*a-o<0||(i.x-e.x)*s+(i.y-e.y)*a-o<0||(r.x-e.x)*s+(r.y-e.y)*a-o<0)}function Fp(e,t,n,i,r,o,s){return!(Op(e,t,i,r,o,s)||Op(t,n,i,r,o,s)||Op(n,e,i,r,o,s)||Op(i,r,e,t,n,s)||Op(r,o,e,t,n,s)||Op(o,i,e,t,n,s))}function Bp(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Np(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function jp(e,t,n,i,r){if(!t[0]&&!t[1])return e;const o=b.convert(t)._mult(r);"viewport"===n&&o._rotate(-i);const s=[];for(let a=0;a<e.length;a++)s.push(e[a].sub(o));return s}function Vp(e,t,n,i){const r=b.convert(e)._mult(i);return"viewport"===t&&r._rotate(-n),r}Os(Sp,"CircleBucket",{omit:["layers"]});const Up=new xa({"circle-sort-key":new _a(Rt.layout_circle["circle-sort-key"]),visibility:new ya(Rt.layout_circle.visibility)});var Gp={paint:new xa({"circle-radius":new _a(Rt.paint_circle["circle-radius"]),"circle-color":new _a(Rt.paint_circle["circle-color"]),"circle-blur":new _a(Rt.paint_circle["circle-blur"]),"circle-opacity":new _a(Rt.paint_circle["circle-opacity"]),"circle-translate":new ya(Rt.paint_circle["circle-translate"]),"circle-translate-anchor":new ya(Rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ya(Rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ya(Rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _a(Rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _a(Rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _a(Rt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ya(Rt.paint_circle["circle-emissive-strength"])}),layout:Up};const qp=Ch.create(),Wp=(e,t,n,i,r,o)=>{const s=e.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const e=Dd(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=s.calculatePixelsToTileUnitsMatrix(n);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:mt.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:qp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=i,c.u_merc_center=r,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Ld(s.zoom);const e=r[0]*pi,n=r[1]*pi;c.u_up_dir=s.projection.upVector(new Wh(0,0,0),e,n)}return c},Zp=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Hp(e,t,n,i,r,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=n.projection.upVectorScale(c,n.center.lat,n.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(h.x,h.y,!0):0,p=n.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=n.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Xp(p.x,p.y,p.z,i),m=o?e.tilespaceRays.map(e=>Jp(e,d)):e.queryGeometry.screenGeometry,g=bh.transformMat4([],[p.x,p.y,p.z,1],i);if(!s&&o?l*=g[3]/n.cameraToCenterDistance:s&&!o&&(l*=n.cameraToCenterDistance/g[3]),o){const e=rp((t.y/pi+c.y)/(1<<c.z));l/=n.projection.pixelsPerMeter(e,1)/np(1,e)}if(Ep(m,f,l))return!0}return!1}function Xp(e,t,n,i){const r=bh.transformMat4([],[e,t,n,1],i);return new b(r[0]/r[3],r[1]/r[3])}const Yp=Lh.fromValues(0,0,0),Kp=Lh.fromValues(0,0,1);function Jp(e,t){const n=Lh.create();return Yp[2]=t,e.intersectsPlane(Yp,Kp,n),new b(n[0],n[1])}class $p extends Sp{}function Qp(e,t,n,i){let{width:r,height:o}=t;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*o*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*o*n);return e.width=r,e.height=o,e.data=i,e}function ef(e,t,n){const{width:i,height:r}=t;i===e.width&&r===e.height||(tf(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,r)},n),e.width=i,e.height=r,e.data=t.data)}function tf(e,t,n,i,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<r.height;l++){const c=((n.y+l)*e.width+n.x)*o,u=((i.y+l)*t.width+i.x)*o;for(let e=0;e<r.width*o;e++)a[u+e]=s[c+e]}return t}Os($p,"HeatmapBucket",{omit:["layers"]});class nf{constructor(e,t){Qp(this,e,1,t)}resize(e){ef(this,new nf(e),1)}clone(){return new nf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){tf(e,t,n,i,r,1)}}class rf{constructor(e,t){Qp(this,e,4,t)}resize(e){ef(this,new rf(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new rf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){tf(e,t,n,i,r,4)}}class of{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}Os(nf,"AlphaImage"),Os(rf,"RGBAImage");const sf=new xa({visibility:new ya(Rt.layout_heatmap.visibility)});var af={paint:new xa({"heatmap-radius":new _a(Rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _a(Rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ya(Rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new va(Rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ya(Rt.paint_heatmap["heatmap-opacity"])}),layout:sf};function lf(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new rf({width:n,height:i}),o=(n,i,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);s&&(r.data[n+i+0]=Math.floor(255*s.r/s.a),r.data[n+i+1]=Math.floor(255*s.g/s.a),r.data[n+i+2]=Math.floor(255*s.b/s.a),r.data[n+i+3]=Math.floor(255*s.a))};if(e.clips)for(let s=0,a=0;s<i;++s,a+=4*n)for(let t=0,i=0;t<n;t++,i+=4){const r=t/(n-1),{start:l,end:c}=e.clips[s];o(a,i,l*(1-r)+c*r)}else for(let s=0,a=0;s<n;s++,a+=4)o(0,a,s/(n-1));return r}const cf=new xa({visibility:new ya(Rt.layout_hillshade.visibility)});var uf={paint:new xa({"hillshade-illumination-direction":new ya(Rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ya(Rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ya(Rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ya(Rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ya(Rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ya(Rt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ya(Rt.paint_hillshade["hillshade-emissive-strength"])}),layout:cf};const hf=Ia([{name:"a_pos",components:2,type:"Int16"}],4),{members:df}=hf;var pf={exports:{}};function ff(e,t,n){n=n||2;var i,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=mf(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,i){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=mf(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),a.push(Af(s));for(a.sort(wf),r=0;r<a.length;r++)n=Sf(a[r],n);return n}(e,t,d,n)),e.length>80*n){i=o=e[0],r=s=e[1];for(var f=n;f<h;f+=n)(a=e[f])<i&&(i=a),(l=e[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-i,s-r))?32767/c:0}return yf(d,p,n,i,r,c,0),p}function mf(e,t,n,i,r){var o,s;if(r===Nf(e,t,n,i)>0)for(o=t;o<n;o+=i)s=Of(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=Of(o,e[o],e[o+1],s);return s&&Pf(s,s.next)&&(Ff(s),s=s.next),s}function gf(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Pf(i,i.next)&&0!==Cf(i.prev,i,i.next))i=i.next;else{if(Ff(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function yf(e,t,n,i,r,o,s){if(e){!s&&o&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=Ef(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?vf(e,i,r,o):_f(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Ff(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?yf(e=xf(gf(e),t,n),t,n,i,r,o,2):2===s&&bf(e,t,n,i,r,o):yf(gf(e),t,n,i,r,o,1);break}}}function _f(e){var t=e.prev,n=e,i=e.next;if(Cf(t,n,i)>=0)return!1;for(var r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=i.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Mf(r,a,o,l,s,c,f.x,f.y)&&Cf(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function vf(e,t,n,i){var r=e.prev,o=e,s=e.next;if(Cf(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,y=Ef(p,f,t,n,i),_=Ef(m,g,t,n,i),v=e.prevZ,x=e.nextZ;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Mf(a,u,l,h,c,d,v.x,v.y)&&Cf(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Mf(a,u,l,h,c,d,x.x,x.y)&&Cf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Mf(a,u,l,h,c,d,v.x,v.y)&&Cf(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Mf(a,u,l,h,c,d,x.x,x.y)&&Cf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function xf(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!Pf(r,o)&&If(r,i,i.next,o)&&Rf(r,o)&&Rf(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),Ff(i),Ff(i.next),i=e=o),i=i.next}while(i!==e);return gf(i)}function bf(e,t,n,i,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&kf(s,a)){var l=Lf(s,a);return s=gf(s,s.next),l=gf(l,l.next),yf(s,t,n,i,r,o,0),void yf(l,t,n,i,r,o,0)}a=a.next}s=s.next}while(s!==e)}function wf(e,t){return e.x-t.x}function Sf(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&Mf(o<h?r:s,o,u,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),Rf(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&Tf(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var i=Lf(n,e);return gf(i,i.next),gf(n,n.next)}function Tf(e,t){return Cf(e.prev,e,t.prev)<0&&Cf(t.next,e,e.next)<0}function Ef(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Af(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Mf(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function kf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&If(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Rf(e,t)&&Rf(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Cf(e.prev,e,t.prev)||Cf(e,t.prev,t))||Pf(e,t)&&Cf(e.prev,e,e.next)>0&&Cf(t.prev,t,t.next)>0)}function Cf(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Pf(e,t){return e.x===t.x&&e.y===t.y}function If(e,t,n,i){var r=zf(Cf(e,t,n)),o=zf(Cf(e,t,i)),s=zf(Cf(n,i,e)),a=zf(Cf(n,i,t));return r!==o&&s!==a||!(0!==r||!Df(e,n,t))||!(0!==o||!Df(e,i,t))||!(0!==s||!Df(n,e,i))||!(0!==a||!Df(n,t,i))}function Df(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function zf(e){return e>0?1:e<0?-1:0}function Rf(e,t){return Cf(e.prev,e,e.next)<0?Cf(e,t,e.next)>=0&&Cf(e,e.prev,t)>=0:Cf(e,t,e.prev)<0||Cf(e,e.next,t)<0}function Lf(e,t){var n=new Bf(e.i,e.x,e.y),i=new Bf(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Of(e,t,n,i){var r=new Bf(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ff(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bf(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nf(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}pf.exports=ff,pf.exports.default=ff,ff.deviation=function(e,t,n,i){var r=t&&t.length,o=Math.abs(Nf(e,0,r?t[0]*n:e.length,n));if(r)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(Nf(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n));var l=0;for(s=0;s<i.length;s+=3){var c=i[s]*n,u=i[s+1]*n,h=i[s+2]*n;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},ff.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&n.holes.push(i+=e[r-1].length)}return n};var jf=m(pf.exports);function Vf(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,o;for(let s=0;s<n;s++){const t=Q(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(r&&i.push(r),r=[e[s]]):r.push(e[s]))}if(r&&i.push(r),t>1)for(let s=0;s<i.length;s++)i[s].length<=t||(Un(i[s],t,1,i[s].length-1,Uf),i[s]=i[s].slice(0,t));return i}function Uf(e,t){return t.area-e.area}function Gf(e,t,n){const i=n.patternDependencies;let r=!1;for(const o of t){const t=o.paint.get("".concat(e,"-pattern"));t.isConstant()||(r=!0);const n=t.constantOr(null);n&&(r=!0,i[n]=!0)}return r}function qf(e,t,n,i,r){const o=r.patternDependencies;for(const s of t){const t=s.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i},n,{},r.availableImages);e=e&&e.name?e.name:e,o[e]=!0,n.patterns[s.id]=e}}return n}class Wf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new za,this.indexArray=new Ka,this.indexArray2=new Wa,this.programConfigurations=new ic(e.layers,e.zoom),this.segments=new wl,this.segments2=new wl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection}populate(e,t,n,i){this.hasPattern=Gf("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=xp(s,e);if(!this.layers[0]._featureFilter.filter(new la(this.zoom),u,n))continue;const h=r?r.evaluate(u,{},n,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:vp(s,n,i),patterns:{},sortKey:h};o.push(d)}r&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const s of o){const{geometry:i,index:r,sourceLayerIndex:o}=s;if(this.hasPattern){const e=qf("fill",this.layers,s,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(s,i,r,n,{},t.availableImages,t.brightness);t.featureIndex.insert(e[r].feature,i,r,o,this.index)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}addFeatures(e,t,n,i,r,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,df),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=arguments.length>6?arguments[6]:void 0;for(const a of Vf(t,500)){let e=0;for(const s of a)e+=s.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=t.vertexLength,i=[],r=[];for(const s of a){if(0===s.length)continue;s!==a[0]&&r.push(i.length/2);const e=this.segments2.prepareSegment(s.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(s[0].x,s[0].y),this.indexArray2.emplaceBack(t+s.length-1,t),i.push(s[0].x),i.push(s[0].y);for(let n=1;n<s.length;n++)this.layoutVertexArray.emplaceBack(s[n].x,s[n].y),this.indexArray2.emplaceBack(t+n-1,t+n),i.push(s[n].x),i.push(s[n].y);e.vertexLength+=s.length,e.primitiveLength+=s.length}const o=jf(i,r);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(n+o[s],n+o[s+1],n+o[s+2]);t.vertexLength+=e,t.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,s)}}Os(Wf,"FillBucket",{omit:["layers","patternFeatures"]});const Zf=new xa({"fill-sort-key":new _a(Rt.layout_fill["fill-sort-key"]),visibility:new ya(Rt.layout_fill.visibility)});var Hf={paint:new xa({"fill-antialias":new ya(Rt.paint_fill["fill-antialias"]),"fill-opacity":new _a(Rt.paint_fill["fill-opacity"]),"fill-color":new _a(Rt.paint_fill["fill-color"]),"fill-outline-color":new _a(Rt.paint_fill["fill-outline-color"]),"fill-translate":new ya(Rt.paint_fill["fill-translate"]),"fill-translate-anchor":new ya(Rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _a(Rt.paint_fill["fill-pattern"]),"fill-emissive-strength":new ya(Rt.paint_fill["fill-emissive-strength"])}),layout:Zf};const Xf=Ia([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Yf=Ia([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Kf=Ia([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Jf=Ia([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),$f=Ia([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Qf}=Xf;var em={},tm=v,nm=im;function im(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(rm,this,t)}function rm(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function om(e){for(var t,n,i=0,r=0,o=e.length,s=o-1;r<o;s=r++)i+=((n=e[s]).x-(t=e[r]).x)*(t.y+n.y);return i}im.types=["Unknown","Point","LineString","Polygon"],im.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,r=0,o=0,s=0,a=[];e.pos<n;){if(r<=0){var l=e.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&a.push(t),t=[]),t.push(new tm(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&a.push(t),a},im.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,c]},im.prototype.toGeoJSON=function(e,t,n){var i,r,o=this.extent*Math.pow(2,n),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=im.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],o=0;o<t;o++){var s=om(e[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var sm=nm,am=lm;function lm(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(cm,this,t),this.length=this._features.length}function cm(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}lm.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new sm(this._pbf,t,this.extent,this._keys,this._values)};var um=am;function hm(e,t,n){if(3===e){var i=new um(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}var dm=em.VectorTile=function(e,t){this.layers=e.readFields(hm,{},t)},pm=em.VectorTileFeature=nm;function fm(e,t,n,i){const r=[],o=0===i?(e,t,n,i,r,o)=>{e.push(new b(o,n+(o-t)/(i-t)*(r-n)))}:(e,t,n,i,r,o)=>{e.push(new b(t+(o-n)/(r-n)*(i-t),o))};for(const s of e){const e=[];for(const r of s){if(r.length<=2)continue;const s=[];for(let e=0;e<r.length-1;e++){const a=r[e].x,l=r[e].y,c=r[e+1].x,u=r[e+1].y,h=0===i?a:l,d=0===i?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>n?d<n&&o(s,a,l,c,u,n):s.push(r[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>n&&h<=n&&o(s,a,l,c,u,n)}let a=r[r.length-1];const l=0===i?a.x:a.y;l>=t&&l<=n&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&r.push(e)}return r}em.VectorTileLayer=am;class mm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var gm={read:function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},write:function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*m}},ym=vm,_m=gm;function vm(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}vm.Varint=0,vm.Fixed64=1,vm.Bytes=2,vm.Fixed32=5;var xm=4294967296,bm=1/xm,wm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Sm(e){return e.type===vm.Bytes?e.readVarint()+e.pos:e.pos+1}function Tm(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Em(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function Am(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Mm(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function km(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Cm(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function Pm(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Im(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function Dm(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function zm(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function Rm(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Lm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Om(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Fm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}vm.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,e(r,t,this),this.pos===o&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Lm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Fm(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Lm(this.buf,this.pos)+Lm(this.buf,this.pos+4)*xm;return this.pos+=8,e},readSFixed64:function(){var e=Lm(this.buf,this.pos)+Fm(this.buf,this.pos+4)*xm;return this.pos+=8,e},readFloat:function(){var e=_m.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=_m.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128)return Tm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<3,r<128)return Tm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<10,r<128)return Tm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<17,r<128)return Tm(e,i,t);if(i|=(127&(r=o[n.pos++]))<<24,r<128)return Tm(e,i,t);if(i|=(1&(r=o[n.pos++]))<<31,r<128)return Tm(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&wm?function(e,t,n){return wm.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var i="",r=t;r<n;){var o,s,a,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[r+2],128==(192&(o=e[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[r+2],a=e[r+3],128==(192&(o=e[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==vm.Bytes)return e.push(this.readVarint(t));var n=Sm(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==vm.Bytes)return e.push(this.readSVarint());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==vm.Bytes)return e.push(this.readBoolean());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==vm.Bytes)return e.push(this.readFloat());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==vm.Bytes)return e.push(this.readDouble());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==vm.Bytes)return e.push(this.readFixed32());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==vm.Bytes)return e.push(this.readSFixed32());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==vm.Bytes)return e.push(this.readFixed64());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==vm.Bytes)return e.push(this.readSFixed64());var t=Sm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===vm.Varint)for(;this.buf[this.pos++]>127;);else if(t===vm.Bytes)this.pos=this.readVarint()+this.pos;else if(t===vm.Fixed32)this.pos+=4;else{if(t!==vm.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Om(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Om(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Om(this.buf,-1&e,this.pos),Om(this.buf,Math.floor(e*bm),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Om(this.buf,-1&e,this.pos),Om(this.buf,Math.floor(e*bm),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,o=0;o<t.length;o++){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&Em(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),_m.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),_m.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&Em(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,vm.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Am,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Mm,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Pm,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,km,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Cm,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Im,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Dm,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,zm,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Rm,t)},writeBytesField:function(e,t){this.writeTag(e,vm.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,vm.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,vm.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,vm.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,vm.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,vm.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,vm.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,vm.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,vm.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,vm.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Bm=m(ym);const Nm=["tile","layer","source","sourceLayer","state"];class jm{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=i,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Nm)void 0!==this[t]&&(e[t]=this[t]);return e}}class Vm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},B(this.stateChanges[e][i],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])n[t]||(this.deletedStates[e][i][t]=null)}else for(const r in n)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][r]&&delete this.deletedStates[e][i][r]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),i=B({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const n=this.deletedStates[e][t];if(null===n)return{};for(const e in n)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const e={};for(const t in this.stateChanges[i])this.state[i][t]||(this.state[i][t]={}),B(this.state[i][t],this.stateChanges[i][t]),e[t]=this.state[i][t];n[i]=e}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const e={};if(null===this.deletedStates[i])for(const t in this.state[i])e[t]={},this.state[i][t]={};else for(const t in this.deletedStates[i]){if(null===this.deletedStates[i][t])this.state[i][t]={};else if(this.state[i][t])for(const e of Object.keys(this.deletedStates[i][t]))delete this.state[i][t][e];e[t]=this.state[i][t]}n[i]=n[i]||{},B(n[i],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const i in e)e[i].setFeatureState(n,t)}}class Um{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Gm(e,t,n,i){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(i[s])<1e-15){if(n[s]<e[s]||n[s]>t[s])return null}else{const a=1/i[s];let l=(e[s]-n[s])*a,c=(t[s]-n[s])*a;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function qm(e,t,n,i,r,o,s,a,l,c,u){const h=i-e,d=r-t,p=o-n,f=s-e,m=a-t,g=l-n,y=u[1]*g-u[2]*m,_=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*y+d*_+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,S=c[1]-t,T=c[2]-n,E=(w*y+S*_+T*v)*b;if(E<0||E>1)return null;const A=S*p-T*d,M=T*h-w*p,k=w*d-S*h,C=(u[0]*A+u[1]*M+u[2]*k)*b;return C<0||E+C>1?null:(f*A+m*M+g*k)*b}function Wm(e,t,n){return(e-t)/(n-t)}function Zm(e,t,n,i,r,o,s,a,l){const c=1<<n,u=o-i,h=s-r,d=(e+1)/c*u+i,p=(t+0)/c*h+r,f=(t+1)/c*h+r;a[0]=(e+0)/c*u+i,a[1]=p,l[0]=d,l[1]=f}class Hm{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let i=Math.ceil(Math.pow(2,t));const r=1/i,o=(e,t,n,i,r)=>{const o=i?1:0,s=(e+1)*n-o,a=t*n,l=(t+1)*n-o;r[0]=e*n,r[1]=a,r[2]=s,r[3]=l};let s=new Um(i);const a=[];for(let l=0;l<i*i;l++){o(l%i,Math.floor(l/i),r,!1,a);const t=Ym(a[0],a[1],e),n=Ym(a[2],a[1],e),c=Ym(a[2],a[3],e),u=Ym(a[0],a[3],e);s.minimums.push(Math.min(t,n,c,u)),s.maximums.push(Math.max(t,n,c,u)),s.leaves.push(1)}for(n.push(s),i/=2;i>=1;i/=2){const e=n[n.length-1];s=new Um(i);for(let t=0;t<i*i;t++){o(t%i,Math.floor(t/i),2,!0,a);const n=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(n.min,r.min,l.min,c.min),m=Math.max(n.max,r.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}n.push(s)}return n}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Gm([e,t,-100],[n,i,this.maximums[0]*s],r,o)}raycast(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,n,i,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){Zm(f,m,g,e,t,n,i,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,y=(m+1)/a,_=Ym(l,d,this.dem)*s,v=Ym(c,d,this.dem)*s,x=Ym(c,y,this.dem)*s,b=Ym(l,y,this.dem)*s,w=qm(u[0],u[1],_,h[0],u[1],v,h[0],h[1],x,r,o),S=qm(h[0],h[1],x,u[0],h[1],b,u[0],u[1],_,r,o),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=Lh.scaleAndAdd([],r,o,p);if(Xm(_,v,b,x,Wm(e[0],u[0],h[0]),Wm(e[1],u[1],h[1]))>=e[2])return p}continue}let y=0;for(let d=0;d<this._siblingOffset.length;d++){Zm((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,n,i,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=Gm(u,h,r,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let n=0;n<y&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,d),t=!0);t||(c[y]=d),y++}}for(let e=0;e<y;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,r){if(1===e[i].isLeaf(t,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=i-1,s=e[o];let a=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],i=2*n+this._siblingOffset[c][1],r=s.getElevation(e,i),o=s.isLeaf(e,i),u=this._addNode(r.min,r.max,o);o&&(a|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)a&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,l+c)}}function Xm(e,t,n,i,r,o){return tr(tr(e,n,o),tr(t,i,o),r)}function Ym(e,t,n){const i=n.dim,r=z(e*i-.5,0,i-1),o=z(t*i-.5,0,i-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,i-1),c=Math.min(a+1,i-1);return Xm(n.get(s,a),n.get(l,a),n.get(s,c),n.get(l,c),r-s,o-a)}const Km={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Jm(e,t,n){return(256*e*256+256*t+n)/10-1e4}function $m(e,t,n){return 256*e+t+n/256-32768}class Qm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return J('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const r=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=i,this._modifiedForSources={},!i){for(let e=0;e<r;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(r,e)]=o[this._idx(r-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,r)]=o[this._idx(e,r-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(r,-1)]=o[this._idx(r-1,0)],o[this._idx(-1,r)]=o[this._idx(0,r-1)],o[this._idx(r,r)]=o[this._idx(r-1,r-1)]}const s="terrarium"===n?$m:Jm;for(let a=0;a<o.length;++a){const e=4*a;this.floatView[a]=s(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=mt.now()}_buildQuadTree(){this._tree=new Hm(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=z(e,-1,this.dim),t=z(t,-1,this.dim));const n=this._idx(e,t);return this.floatView[n]}set(e,t,n){const i=this._idx(e,t),r=this.floatView[i];return this.floatView[i]=n,n-r}static getUnpackVector(e){return Km[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],i=Qm.getUnpackVector(t);let r=Math.floor((e+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return new of({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let c=o;c<s;c++)for(let t=i;t<r;t++){const n=4*this._idx(t,c),i=4*this._idx(t+a,c+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Os(Qm,"DEMData"),Os(Hm,"DemMinMaxQuadTree",{omit:["dem"]});class eg{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,i=1<<n,r=Math.floor(e.x),o=Math.floor((e.x-r)*i),s=Math.floor(e.y*i),a=this.findDEMTileFor(new Hh(n,r,n,o,s));return!(!a||!a.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,o=1<<r,s=Math.floor(e.x),a=e.x-s,l=new Hh(r,s,r,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(n?this.exaggeration():1)*tr(tr(u.get(f,m),u.get(f,m+1),p-m),tr(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,n){const i=1<<e.canonical.z;return this.getAtPointOrZero(new hp(e.wrap+(e.canonical.x+t/pi)/i,(e.canonical.y+n/pi)/i))}getAtTileOffsetFunc(e,t,n,i){return r=>{const o=this.getAtTileOffset(e,r.x,r.y),s=i.upVector(e.canonical,r.x,r.y),a=i.upVectorScale(e.canonical,t,n).metersToTile;return Lh.scale(s,s,o*a),s}}getForTilePoints(e,t,n,i){if(this.isUsingMockSource())return!1;const r=tg.create(this,e,i);return!!r&&(t.forEach(e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],n)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z;let o=e.canonical.x/r-i.canonical.x,s=e.canonical.y/r-i.canonical.y,a=0;for(let l=0;l<e.canonical.z-i.canonical.z&&!n.leaves[a];l++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,n=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const r of e){const e=this.getMinMaxForTile(r.tileID);e&&(n=Math.min(n,e.min),i=Math.max(i,e.max),t=!0)}return t?{min:n,max:i}:null}}class tg{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const r=i.dem,o=i.tileID,s=1<<t.canonical.z-o.canonical.z;return new tg(i,r.dim/pi/s,[(t.canonical.x/s-o.canonical.x)*r.dim,(t.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),r=Math.floor(n);return new b(i,r)}getElevationAt(e,t,n,i){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return i=!!i,n?tr(tr(l.get(s,a,i),l.get(s,a+1,i),o-a),tr(l.get(s+1,a,i),l.get(s+1,a+1,i),o-a),r-s):l.get(s,a,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*np(1,e)*this._dem.stride}}class ng{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Rs(pi,16,0),this.featureIndexArray=new _l,this.promoteId=t}insert(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,o);const a=this.grid;for(let l=0;l<t.length;l++){const e=t[l],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const i=e[t];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<pi&&n[1]<pi&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new dm(new Bm(this.rawTileData)).layers,this.sourceLayerCoder=new mm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,i){var r=this;this.loadVTLayers();const o=e.params||{},s=Vo(o.filter),a=e.tileResult,l=e.transform,c=a.bufferedTilespaceBounds,u=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(e,t,n,i)=>Rp(a.bufferedTilespaceGeometry,e,t,n,i));u.sort(rg);let h=null;l.elevation&&u.length>0&&(h=tg.create(l.elevation,this.tileID));const d={};let p;for(let f=0;f<u.length;f++){const l=u[f];if(l===p)continue;p=l;const c=this.featureIndexArray.get(l);let m=null;this.loadMatchingFeature(d,c,s,o.layers,o.availableImages,t,n,i,function(t,n,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return m||(m=vp(t,r.tileID.canonical,e.tileTransform)),n.queryIntersectsFeature(a,t,i,m,r.z,e.transform,e.pixelPosMatrix,h,o)})}return d}loadMatchingFeature(e,t,n,i,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(i&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(i,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(n.needGeometry){const e=xp(m,!0);if(!n.filter(new la(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new la(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let y=0;y<p.length;y++){const t=p[y];if(i&&i.indexOf(t)<0)continue;const n=o[t];if(!n)continue;let u={};void 0!==g&&a&&(u=a.getState(n.sourceLayer||"_geojsonTileLayer",g));const h=B({},s[t]);h.paint=ig(h.paint,n.paint,m,u,r),h.layout=ig(h.layout,n.layout,m,u,r);const f=!l||l(m,n,u,d);if(!f)continue;const _=new jm(m,this.z,this.x,this.y,g);_.layer=h;let v=e[t];void 0===v&&(v=e[t]=[]),v.push({featureIndex:c,feature:_,intersectionZ:f})}}lookupSymbolFeatures(e,t,n,i,r,o,s,a){const l={};this.loadVTLayers();const c=Vo(r);for(const u of e)this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:i,featureIndex:u,layoutVertexArrayOffset:0},c,o,s,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(n),r=this.vtFeatures[i];if(r[t])return r[t];const o=this.vtLayers[i].feature(t);return r[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const i="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=i&&(n=e.properties[i]),"boolean"==typeof n&&(n=Number(n))}return n}}function ig(e,t,n,i,r){return H(e,(e,o)=>{const s=t instanceof ga?t.get(o):null;return s&&s.evaluate?s.evaluate(n,i,r):s})}function rg(e,t){return t-e}Os(ng,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const og=Ia([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sg=Ia([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ag=Ia([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ia([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lg=Ia([{name:"a_z_offset",components:1,type:"Float32"}],4),cg=Ia([{name:"a_texb",components:2,type:"Uint16"}]),ug=Ia([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),hg=Ia([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ia([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const dg=Ia([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pg=Ia([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ia([{name:"triangle",components:3,type:"Uint16"}]),Ia([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ia([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ia([{type:"Float32",name:"offsetX"}]),Ia([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var fg=24;const mg=128;function gg(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new la(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[r],a=t[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new la(s)),maxSize:n.evaluate(new la(a)),interpolationType:i}}}function yg(e,t,n){let{uSize:i,uSizeT:r}=t,{lowerSize:o,upperSize:s}=n;return"source"===e.kind?o/mg:"composite"===e.kind?tr(o/mg,s/mg,r):i}function _g(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=e,a=r?z(Tr.interpolationFactor(r,t,o,s),0,1):0;"camera"===e.kind?i=tr(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:i}}var vg=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:mg,evaluateSizeForFeature:yg,evaluateSizeForZoom:_g,getSizeData:gg});function xg(e,t,n){return e.sections.forEach(e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),aa.applyArabicShaping&&(e=aa.applyArabicShaping(e)),e}(e.text,t,n)}),e}const bg={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function wg(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Sg(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const Tg=3;function Eg(e,t,n){t.glyphs=[],1===e&&n.readMessage(Ag,t)}function Ag(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:o,left:s,top:a,advance:l}=n.readMessage(Mg,{});t.glyphs.push({id:e,bitmap:new nf({width:r+2*Tg,height:o+2*Tg},i),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function Mg(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const kg=Tg,Cg={horizontal:1,vertical:2,horizontalOnly:3},Pg=-17;class Ig{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Ig;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Ig;return t.imageName=e,t}}class Dg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Dg;for(let i=0;i<e.sections.length;i++){const r=e.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,o=e.charCodeAt(i-1)||null;n+=!t&&(r&&Zs(r)&&!bg[e[i+1]]||o&&Zs(o)&&!bg[e[i-1]])||!bg[e[i]]?e[i]:bg[e[i]]}return n}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Rg[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Rg[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Dg;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Ig.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void J("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Ig.forImage(t)),this.sectionIndex.push(this.sections.length-1)):J("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zg(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){const m=Dg.fromFeature(e,r);h===Cg.vertical&&m.verticalizePunctuation(d);let g=[];const y=function(e,t,n,i,r,o){if(!e)return[];const s=[],a=function(e,t,n,i,r,o){let s=0;for(let a=0;a<e.length();a++){const n=e.getSection(a);s+=Og(e.getCodePoint(a),n,i,r,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,i,r,o),l=e.text.indexOf("\u200b")>=0;let c=0;for(let h=0;h<e.length();h++){const n=e.getSection(h),d=e.getCodePoint(h);if(Rg[d]||(c+=Og(d,n,i,r,t,o)),h<e.length()-1){const t=!((u=d)<11904||!(Vs["Bopomofo Extended"](u)||Vs.Bopomofo(u)||Vs["CJK Compatibility Forms"](u)||Vs["CJK Compatibility Ideographs"](u)||Vs["CJK Compatibility"](u)||Vs["CJK Radicals Supplement"](u)||Vs["CJK Strokes"](u)||Vs["CJK Symbols and Punctuation"](u)||Vs["CJK Unified Ideographs Extension A"](u)||Vs["CJK Unified Ideographs"](u)||Vs["Enclosed CJK Letters and Months"](u)||Vs["Halfwidth and Fullwidth Forms"](u)||Vs.Hiragana(u)||Vs["Ideographic Description Characters"](u)||Vs["Kangxi Radicals"](u)||Vs["Katakana Phonetic Extensions"](u)||Vs.Katakana(u)||Vs["Vertical Forms"](u)||Vs["Yi Radicals"](u)||Vs["Yi Syllables"](u)));(Lg[d]||t||n.imageName)&&s.push(Ng(h+1,c,a,s,Bg(d,e.getCodePoint(h+1),t&&l),!1))}}var u;return jg(Ng(e.length(),c,a,s,0,!0))}(m,c,o,t,i,p),{processBidirectionalText:_,processStyledBidirectionalText:v}=aa;if(_&&1===m.sections.length){const e=_(m.toString(),y);for(const t of e){const e=new Dg;e.text=t,e.sections=m.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);g.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,y);for(const t of e){const e=new Dg;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const n=[],i=e.text;let r=0;for(const o of t)n.push(e.substring(r,o)),r=o;return r<i.length&&n.push(e.substring(r,i.length)),n}(m,y);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,n,i,r,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const w of r){const e=w.getSections();for(const n of e){if(n.imageName)continue;const e=t[n.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let y=0;for(const w of r){w.trim();const r=w.getMaxScale(),s=(r-1)*fg,a={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){p+=o,++y;continue}let b=0,S=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),f=w.getCodePoint(o);let m=s.scale,y=null,T=null,E=null,A=fg,M=0;const k=!(l===Cg.horizontal||!u&&!Ws(f)||u&&(Rg[f]||(_=f,Vs.Arabic(_)||Vs["Arabic Supplement"](_)||Vs["Arabic Extended-A"](_)||Vs["Arabic Presentation Forms-A"](_)||Vs["Arabic Presentation Forms-B"](_))));if(s.imageName){const t=i[s.imageName];if(!t)continue;E=s.imageName,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const n=t.displaySize;m=m*fg/h,y={width:n[0],height:n[1],left:0,top:-kg,advance:k?n[1]:n[0],localGlyph:!1},M=g?-y.height*m:Pg+r*fg-n[1]*m,A=y.advance;const o=(k?n[0]:n[1])*m-fg*r;o>0&&o>x&&(x=o)}else{const e=n[s.fontStack];if(!e)continue;e[f]&&(T=e[f]);const i=t[s.fontStack];if(!i)continue;const o=i.glyphs[f];if(!o)continue;if(y=o.metrics,A=8203!==f?fg:0,g){const e=void 0!==i.ascender?Math.abs(i.ascender):0,t=void 0!==i.descender?Math.abs(i.descender):0,n=(e+t)*m;b<n&&(b=n,S=(e-t)/2*m),M=-e*m}else M=Pg+(r-m)*fg}k?(e.verticalizable=!0,v.push({glyph:f,imageName:E,x:d,y:p+M,vertical:k,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:T}),d+=A*m+c):(v.push({glyph:f,imageName:E,x:d,y:p+M,vertical:k,scale:m,localGlyph:y.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:y,rect:T}),d+=y.advance*m+c)}0!==v.length&&(f=Math.max(d-c,f),g?Ug(v,m,x,S,o*r/2):Ug(v,m,x,0,o/2)),d=0;const T=o*r+x;a.lineOffset=Math.max(x,s),p+=T,++y}var _;const v=p,{horizontalAlign:x,verticalAlign:b}=Vg(s);(function(e,t,n,i,r,o){const s=(t-n)*r,a=-o*i;for(const l of e)for(const e of l.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,x,b,f,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=g}(b,t,n,i,g,s,a,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const Rg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Og(e,t,n,i,r,o){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*fg/o+r:0}{const i=n[t.fontStack],o=i&&i.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function Fg(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function Bg(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Ng(e,t,n,i,r,o){let s=null,a=Fg(t,n,r,o);for(const l of i){const e=Fg(t-l.x,n,r,o)+l.badness;e<=a&&(s=l,a=e)}return{index:e,x:t,priorBreak:s,badness:a}}function jg(e){return e?jg(e.priorBreak).concat(e.index):[]}function Vg(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Ug(e,t,n,i,r){if(!(t||n||i||r))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let l=0;l<=o;l++)e[l].x-=a,e[l].y+=n+i+r}function Gg(e,t,n,i){const{horizontalAlign:r,verticalAlign:o}=Vg(i),s=n[0]-e.displaySize[0]*r,a=n[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function qg(e,t,n,i,r,o){const s=e.imagePrimary;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class Wg extends b{constructor(e,t,n,i,r){super(e,t),this.angle=i,this.z=n,void 0!==r&&(this.segment=r)}clone(){return new Wg(this.x,this.y,this.z,this.angle,this.segment)}}function Zg(e,t,n,i,r){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(n)}return!0}function Hg(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Xg(e,t,n){return e?.6*t*n:0}function Yg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Kg(e,t,n,i,r,o){const s=Xg(n,r,o),a=Yg(n,i)*o;let l=0;const c=Hg(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],i=e[u+1],r=n.dist(i);if(l+r>c){const o=(c-l)/r,h=tr(n.x,i.x,o),d=tr(n.y,i.y,o),p=new Wg(h,d,0,i.angleTo(n),u);return!s||Zg(e,p,a,s,t)?p:void 0}l+=r}}function Jg(e,t,n,i,r,o,s,a,l){const c=Xg(i,o,s),u=Yg(i,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),$g(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function $g(e,t,n,i,r,o,s,a,l){const c=o/2,u=Hg(e);let h=0,d=t-n,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],s=e[f+1],a=t.dist(s),m=s.angleTo(t);for(;d+n<h+a;){d+=n;const g=(d-h)/a,y=tr(t.x,s.x,g),_=tr(t.y,s.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const t=new Wg(y,_,0,m,f);i&&!Zg(e,t,o,i,r)||p.push(t)}}h+=a}return a||p.length||s||(p=$g(e,h/2,n,i,r,o,s,!0,l)),p}function Qg(e,t,n,i,r){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let l;for(let e=0;e<a.length-1;e++){let s=a[e],c=a[e+1];s.x<t&&c.x<t||(s.x<t?s=new b(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<t&&(c=new b(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<n&&c.y<n||(s.y<n?s=new b(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y<n&&(c=new b(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),s.x>=i&&c.x>=i||(s.x>=i?s=new b(i,s.y+(i-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=i&&(c=new b(i,s.y+(i-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=r&&c.y>=r||(s.y>=r?s=new b(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round():c.y>=r&&(c=new b(s.x+(r-s.y)/(c.y-s.y)*(c.x-s.x),r)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}function ey(e){let t=0,n=0;for(const s of e)t+=s.w*s.h,n=Math.max(n,s.w);e.sort((e,t)=>t.h-e.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,o=0;for(const s of e)for(let e=i.length-1;e>=0;e--){const t=i[e];if(!(s.w>t.w||s.h>t.h)){if(s.x=t.x,s.y=t.y,o=Math.max(o,s.y+s.h),r=Math.max(r,s.x+s.w),s.w===t.w&&s.h===t.h){const t=i.pop();e<i.length&&(i[e]=t)}else s.h===t.h?(t.x+=s.w,t.w-=s.w):s.w===t.w?(t.y+=s.h,t.h-=s.h):(i.push({x:t.x+s.w,y:t.y,w:t.w-s.w,h:s.h}),t.y+=s.h,t.h-=s.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}Os(Wg,"Anchor");const ty=1;class ny{constructor(e,t){let{pixelRatio:n,version:i,stretchX:r,stretchY:o,content:s}=t;this.paddedRect=e,this.pixelRatio=n,this.stretchX=r,this.stretchY=o,this.content=s,this.version=i}get tl(){return[this.paddedRect.x+ty,this.paddedRect.y+ty]}get br(){return[this.paddedRect.x+this.paddedRect.w-ty,this.paddedRect.y+this.paddedRect.h-ty]}get displaySize(){return[(this.paddedRect.w-2*ty)/this.pixelRatio,(this.paddedRect.h-2*ty)/this.pixelRatio]}}class iy{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,n,r),this.addImages(t,i,r);const{w:o,h:s}=ey(r),a=new rf({width:o||1,height:s||1});for(const l in e){const t=e[l],i=n[l].paddedRect;rf.copy(t.data,a,{x:0,y:0},{x:i.x+ty,y:i.y+ty},t.data)}for(const l in t){const e=t[l],n=i[l].paddedRect,r=n.x+ty,o=n.y+ty,s=e.data.width,c=e.data.height;rf.copy(e.data,a,{x:0,y:0},{x:r,y:o},e.data),rf.copy(e.data,a,{x:0,y:c-1},{x:r,y:o-1},{width:s,height:1}),rf.copy(e.data,a,{x:0,y:0},{x:r,y:o+c},{width:s,height:1}),rf.copy(e.data,a,{x:s-1,y:0},{x:r-1,y:o},{width:1,height:c}),rf.copy(e.data,a,{x:0,y:0},{x:r+s,y:o},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const r=e[i],o={x:0,y:0,w:r.data.width+2*ty,h:r.data.height+2*ty};n.push(o),t[i]=new ny(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(t=>e.hasImage(t,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const i in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[i],e.getImage(i,n),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i,n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl;n.update(t.data,void 0,{x:i,y:r})}}Os(ny,"ImagePosition"),Os(iy,"ImageAtlas");const ry=1e20;function oy(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)sy(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)sy(e,c*o+t,1,i,s,a,l)}function sy(e,t,n,i,r,o,s){o[0]=0,s[0]=-ry,s[1]=ry,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=ry}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}const ay=2;class ly{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,n){const i=[],r=this.urls[t]||a.GLYPHS_URL;for(const o in e)for(const t of e[o])i.push({stack:o,id:t});O(i,(e,t)=>{let{stack:n,id:i}=e,o=this.entries[n];o||(o=this.entries[n]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let s=o.glyphs[i];if(void 0!==s)return void t(null,{stack:n,id:i,glyph:s});if(s=this._tinySDF(o,n,i),s)return o.glyphs[i]=s,void t(null,{stack:n,id:i,glyph:s});const a=Math.floor(i/256);if(256*a>65535)return void t(new Error("glyphs > 65535 not supported"));if(o.ranges[a])return void t(null,{stack:n,id:i,glyph:s});let l=o.requests[a];l||(l=o.requests[a]=[],ly.loadGlyphRange(n,a,r,this.requestManager,(e,t)=>{if(t){o.ascender=t.ascender,o.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(o.glyphs[+e]=t.glyphs[+e]);o.ranges[a]=!0}for(const n of l)n(e,t);delete o.requests[a]})),l.push((e,r)=>{e?t(e):r&&t(null,{stack:n,id:i,glyph:r.glyphs[i]||null})})},(e,t)=>{if(e)n(e);else if(t){const e={};for(const{stack:n,id:i,glyph:r}of t)void 0===e[n]&&(e[n]={}),void 0===e[n].glyphs&&(e[n].glyphs={}),e[n].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[n].ascender=this.entries[n].ascender,e[n].descender=this.entries[n].descender;n(null,e)}})}_doesCharSupportLocalGlyph(e){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(Vs["CJK Unified Ideographs"](e)||Vs["Hangul Syllables"](e)||Vs.Hiragana(e)||Vs.Katakana(e)||Vs["CJK Symbols and Punctuation"](e)||Vs["CJK Unified Ideographs Extension A"](e)||Vs["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,n){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(n))return;let r=e.tinySDF;if(!r){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),r=e.tinySDF=new ly.TinySDF({fontFamily:i,fontWeight:n,fontSize:24*ay,buffer:3*ay,radius:8*ay}),r.fontWeight=n}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const o=String.fromCodePoint(n),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(o);return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new nf({width:a,height:l},s),metrics:{width:c/ay,height:u/ay,left:h/ay,top:d/ay-27,advance:p/ay,localGlyph:!0}}}}ly.loadGlyphRange=function(e,t,n,i,r){const o=256*t,s=o+255,a=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}","".concat(o,"-").concat(s)),be.Glyphs);Ae(a,(e,t)=>{if(e)r(e);else if(t){const e={},n=function(e){return new Bm(e).readFields(Eg,{})}(t);for(const t of n.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}})},ly.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=i,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font="".concat(s," ").concat(o," ").concat(e,"px ").concat(r),c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const _=f.getImageData(m,m,a,l);y.fill(ry,0,h),g.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<a;e++){const t=_.data[4*(v*a+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)y[n]=0,g[n]=ry;else{const e=.5-t;y[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}oy(y,0,0,c,u,c,this.f,this.v,this.z),oy(g,m,m,a,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(y[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const cy=ty;function uy(e,t,n,i){const r=[],o=e.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2*cy,l=o.paddedRect.h-2*cy,c=e.right-e.left,u=e.bottom-e.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,y=l-m;let _=0,v=f,x=0,w=m,S=0,T=g,E=0,A=y;if(o.content&&i){const e=o.content;_=hy(h,0,e[0]),x=hy(d,0,e[1]),v=hy(h,e[0],e[2]),w=hy(d,e[1],e[3]),S=e[0]-_,E=e[1]-x,T=e[2]-e[0]-v,A=e[3]-e[1]-w}const M=(i,r,a,l)=>{const h=py(i.stretch-_,v,c,e.left),d=fy(i.fixed-S,T,i.stretch,f),p=py(r.stretch-x,w,u,e.top),g=fy(r.fixed-E,A,r.stretch,m),y=py(a.stretch-_,v,c,e.left),M=fy(a.fixed-S,T,a.stretch,f),k=py(l.stretch-x,w,u,e.top),C=fy(l.fixed-E,A,l.stretch,m),P=new b(h,p),I=new b(y,p),D=new b(y,k),z=new b(h,k),R=new b(d/s,g/s),L=new b(M/s,C/s),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),n=[t,-e,e,t];P._matMult(n),I._matMult(n),z._matMult(n),D._matMult(n)}const F=i.stretch+i.fixed,B=a.stretch+a.fixed,N=r.stretch+r.fixed,j=l.stretch+l.fixed,V=e.imageSecondary;return{tl:P,tr:I,bl:z,br:D,texPrimary:{x:o.paddedRect.x+cy+F,y:o.paddedRect.y+cy+N,w:B-F,h:j-N},texSecondary:V?{x:V.paddedRect.x+cy+F,y:V.paddedRect.y+cy+N,w:B-F,h:j-N}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:L,minFontScaleX:T/s/c,minFontScaleY:A/s/u,isSDF:n}};if(i&&(o.stretchX||o.stretchY)){const e=dy(h,g,f),t=dy(d,y,m);for(let n=0;n<e.length-1;n++){const i=e[n],o=e[n+1];for(let e=0;e<t.length-1;e++)r.push(M(i,t[e],o,t[e+1]))}}else r.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return r}function hy(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function dy(e,t,n){const i=[{fixed:-cy,stretch:0}];for(const[r,o]of e){const e=i[i.length-1];i.push({fixed:r-e.stretch,stretch:e.stretch}),i.push({fixed:r-e.stretch,stretch:e.stretch+(o-r)})}return i.push({fixed:t+cy,stretch:n}),i}function py(e,t,n,i){return e/t*n+i}function fy(e,t,n,i){return e-t*n/i}function my(e,t,n,i){const r=t+e.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(t+e.positionedLines[i-1].lineOffset))/2}function gy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,r=1/0,o=-1/0,s=-1/0;const a=e[0];for(let p=0;p<a.length;p++){const e=a[p];(!p||e.x<i)&&(i=e.x),(!p||e.y<r)&&(r=e.y),(!p||e.x>o)&&(o=e.x),(!p||e.y>s)&&(s=e.y)}const l=Math.min(o-i,s-r);let c=l/2;const u=new di([],yy);if(0===l)return new b(i,r);for(let p=i;p<o;p+=l)for(let t=r;t<s;t+=l)u.push(new _y(p+c,t+c,c,e));let h=function(e){let t=0,n=0,i=0;const r=e[0];for(let o=0,s=r.length,a=s-1;o<s;a=o++){const e=r[o],s=r[a],l=e.x*s.y-s.x*e.y;n+=(e.x+s.x)*l,i+=(e.y+s.y)*l,t+=3*l}return new _y(n/t,i/t,0,e)}(e),d=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=t||(c=i.h/2,u.push(new _y(i.p.x-c,i.p.y-c,c,e)),u.push(new _y(i.p.x+c,i.p.y-c,c,e)),u.push(new _y(i.p.x-c,i.p.y+c,c,e)),u.push(new _y(i.p.x+c,i.p.y+c,c,e)),d+=4)}return n&&(console.log("num probes: ".concat(d)),console.log("best distance: ".concat(h.d))),h.p}function yy(e,t){return t.max-e.max}class _y{constructor(e,t,n,i){this.p=new b(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,Ip(e,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const vy=7,xy=Number.POSITIVE_INFINITY,by=Math.sqrt(2);function wy(e,t){let[n,i]=t,r=0,o=0;if(i===xy){n<0&&(n=0);const t=n/by;switch(e){case"top-right":case"top-left":o=t-vy;break;case"bottom-right":case"bottom-left":o=-t+vy;break;case"bottom":o=-n+vy;break;case"top":o=n-vy}switch(e){case"top-right":case"bottom-right":r=-t;break;case"top-left":case"bottom-left":r=t;break;case"left":r=n;break;case"right":r=-n}}else{switch(n=Math.abs(n),i=Math.abs(i),e){case"top-right":case"top-left":case"top":o=i-vy;break;case"bottom-right":case"bottom-left":case"bottom":o=-i+vy}switch(e){case"top-right":case"bottom-right":case"right":r=-n;break;case"top-left":case"bottom-left":case"left":r=n}}return[r,o]}function Sy(e,t,n,i,r,o,s,a,l,c,u){e.createArrays(),e.tilePixelRatio=pi/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new la(t),a),d["text-size"].possiblyEvaluate(new la(n),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new la(t),a),d["icon-size"].possiblyEvaluate(new la(n),a)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new la(l+1),a),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new la(l+1),a),p.textMaxSize=d["text-size"].possiblyEvaluate(new la(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let g=!1;for(const y of e.features)if(y.icon&&y.icon.nameSecondary){g=!0;break}for(const y of e.features){const o=h.get("text-font").evaluate(y,{},a).join(","),l=m.evaluate(y,{},a),d=p.layoutTextSize.evaluate(y,{},a),_=(p.layoutIconSize.evaluate(y,{},a),{horizontal:{},vertical:void 0}),v=y.text;let x,b=[0,0];if(v){const i=v.toString(),s=h.get("text-letter-spacing").evaluate(y,{},a)*fg,c=h.get("text-line-height").evaluate(y,{},a)*fg,u=Gs(i)?s:0,p=h.get("text-anchor").evaluate(y,{},a),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(y,{},a);b=e?wy(p,[e*fg,xy]):h.get("text-offset").evaluate(y,{},a).map(e=>e*fg)}let g=f?"center":h.get("text-justify").evaluate(y,{},a);const x="point"===h.get("symbol-placement"),w=x?h.get("text-max-width").evaluate(y,{},a)*fg:1/0,S=s=>{e.allowVerticalPlacement&&Us(i)&&(_.vertical=zg(v,t,n,r,o,w,c,p,s,u,b,Cg.vertical,!0,d,l))};if(!f&&m){const e="auto"===g?m.map(e=>Ty(e)):[g];let i=!1;for(let s=0;s<e.length;s++){const a=e[s];if(!_.horizontal[a])if(i)_.horizontal[a]=_.horizontal[0];else{const e=zg(v,t,n,r,o,w,c,"center",a,u,b,Cg.horizontal,!1,d,l);e&&(_.horizontal[a]=e,i=1===e.positionedLines.length)}}S("left")}else{if("auto"===g&&(g=Ty(p)),x||h.get("text-writing-mode").indexOf("horizontal")>=0||!Us(i)){const e=zg(v,t,n,r,o,w,c,p,g,u,b,Cg.horizontal,!1,d,l);e&&(_.horizontal[g]=e)}S(x?"left":g)}}let w=!1;if(y.icon&&y.icon.namePrimary){const t=i[y.icon.namePrimary];t&&(x=Gg(r[y.icon.namePrimary],y.icon.nameSecondary?r[y.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(y,{},a),h.get("icon-anchor").evaluate(y,{},a)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&J("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const S=Cy(_.horizontal)||_.vertical;e.iconsInText||(e.iconsInText=!!S&&S.iconsInText),(S||x)&&Ey(e,y,_,x,i,p,d,0,b,w,s,a,c,u,g)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Ty(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ey(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){let m=o.textMaxSize.evaluate(t,{},h);void 0===m&&(m=s);const g=e.layers[0].layout,y=g.get("icon-offset").evaluate(t,{},h),_=Cy(n.horizontal)||n.vertical,v="globe"===d.name,x=fg,b=s/x,w=e.tilePixelRatio*m/x,S=(D=e.overscaling,e.zoom>18&&D>2&&(D>>=1),Math.max(pi/(512*D),1)*g.get("symbol-spacing")),T=g.get("text-padding")*e.tilePixelRatio,A=g.get("icon-padding")*e.tilePixelRatio,M=E(g.get("text-max-angle")),k="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),C="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),P=g.get("symbol-placement"),I=S/2;var D;const z=g.get("icon-text-fit").evaluate(t,{},h),R=g.get("icon-text-fit-padding").evaluate(t,{},h),L="none"!==z;let O;!1===e.hasAnyIconTextFit&&L&&(e.hasAnyIconTextFit=!0),i&&L&&(e.allowVerticalPlacement&&n.vertical&&(O=qg(i,n.vertical,z,R,y,b)),_&&(i=qg(i,_,z,R,y,b)));const F=(s,a,m)=>{if(a.x<0||a.x>=pi||a.y<0||a.y>=pi)return;let g=null;if(v){const{x:e,y:t,z:n}=d.projectTilePoint(a.x,a.y,m);g={anchor:new Wg(e,t,n,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,S,T,E,A){const M=e.addToLineVertexArray(t,i);let k,C,P,I,D,z,R,L=0,O=0,F=0,B=0,N=-1,j=-1;const V={};let U=Dl("");const G=n?n.anchor:t,q="none"!==l.layout.get("icon-text-fit").evaluate(x,{},T);let W=0,Z=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[W,Z]=l.layout.get("text-offset").evaluate(x,{},T).map(e=>e*fg):(W=l.layout.get("text-radial-offset").evaluate(x,{},T)*fg,Z=xy),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)z=Iy(e),a&&(R=Iy(a));else{const n=l.layout.get("text-rotate").evaluate(x,{},T)+90;P=Py(c,G,t,u,h,d,e,p,n,m),a&&(I=Py(c,G,t,u,h,d,a,y,n))}}if(o){const i=l.layout.get("icon-rotate").evaluate(x,{},T),r=uy(o,i,w,q),s=a?uy(a,i,w,q):void 0;C=Py(c,G,t,u,h,d,o,y,i),L=4*r.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[mg*l.layout.get("icon-size").evaluate(x,{},T)],f[0]>My&&J("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Ay,'. Reduce your "icon-size".'))):"composite"===p.kind&&(f=[mg*b.compositeIconSizes[0].evaluate(x,{},T),mg*b.compositeIconSizes[1].evaluate(x,{},T)],(f[0]>My||f[1]>My)&&J("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Ay,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,r,f,v,_,x,!1,n,t,M.lineStartIndex,M.lineLength,-1,S,T,E,A),N=e.icon.placedSymbolArray.length-1,s&&(O=4*s.length,e.addSymbols(e.icon,s,f,v,_,x,Cg.vertical,n,t,M.lineStartIndex,M.lineLength,-1,S,T,E,A),j=e.icon.placedSymbolArray.length-1)}for(const K in r.horizontal){const i=r.horizontal[K];k||(U=Dl(i.text),f?D=Iy(i):k=Py(c,G,t,u,h,d,i,p,l.layout.get("text-rotate").evaluate(x,{},T),m));const o=1===i.positionedLines.length;if(F+=ky(e,n,t,i,s,l,f,x,m,M,r.vertical?Cg.horizontal:Cg.horizontalOnly,o?Object.keys(r.horizontal):[K],V,N,b,S,T,E),o)break}r.vertical&&(B+=ky(e,n,t,r.vertical,s,l,f,x,m,M,Cg.vertical,["vertical"],V,j,b,S,T,E));let H=-1;const X=(e,t)=>e?Math.max(e,t):t;H=X(D,H),H=X(z,H),H=X(R,H);const Y=H>-1?1:0;e.glyphOffsetArray.length>=x_.MAX_GLYPHS&&J("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,N,j,U,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,I||e.collisionBoxArray.length,I?I+1:e.collisionBoxArray.length,u,F,B,L,O,Y,0,W,Z,H,0,q?1:0)}(e,a,g,s,n,i,r,O,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,T,k,l,0,A,C,y,t,o,c,u,h,p,f)};if("line"===P)for(const E of Qg(t.geometry,0,0,pi,pi)){const t=Jg(E,S,M,n.vertical||_,i,x,w,e.overscaling,pi);for(const n of t)_&&Dy(e,_.text,I,n)||F(E,n,h)}else if("line-center"===P){for(const E of t.geometry)if(E.length>1){const e=Kg(E,M,n.vertical||_,i,x,w);e&&F(E,e,h)}}else if("Polygon"===t.type)for(const E of Vf(t.geometry,0)){const e=gy(E,16);F(E[0],new Wg(e.x,e.y,0,0,void 0),h)}else if("LineString"===t.type)for(const E of t.geometry)F(E,new Wg(E[0].x,E[0].y,0,0,void 0),h);else if("Point"===t.type)for(const E of t.geometry)for(const e of E)F([e],new Wg(e.x,e.y,0,0,void 0),h)}const Ay=255,My=Ay*mg;function ky(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=function(e,t,n,i,r,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],n=e[1],i=t*n;return i>0?[t,-n]:i<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let h=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)h-=m.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-n[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];f=my(t,p,f,m);for(const i of e.positionedGlyphs){if(!i.rect)continue;const e=i.rect||{};let o=kg+1,h=!0,d=1,p=0;if(i.imageName){const e=s[i.imageName];if(!e)continue;if(e.sdf){J("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=ty/d}const m=(r||a)&&i.vertical,g=i.metrics.advance*i.scale/2,y=i.metrics,_=i.rect;if(null===_)continue;a&&t.verticalizable&&(p=i.imageName?g-i.metrics.width*i.scale/2:0);const v=r?[i.x+g,i.y]:[0,0];let x=[0,0],w=[0,0],S=!1;r||(m?(w=[i.x+g+u[0],i.y+u[1]-p],S=!0):x=[i.x+g+n[0],i.y+n[1]-p]);const T=_.w*i.scale/(d*(i.localGlyph?ay:1)),E=_.h*i.scale/(d*(i.localGlyph?ay:1));let A,M,k,C;if(m){const e=i.y-f,t=new b(-g,g-e),n=-Math.PI/2,r=new b(...w);A=new b(-g+x[0],x[1]),A._rotateAround(n,t)._add(r),A.x+=-e+g,A.y-=(y.left-o)*i.scale;const s=i.imageName?y.advance*i.scale:fg*i.scale,a=String.fromCodePoint(i.glyph);wg(a)?A.x+=(1-o)*i.scale:Sg(a)?A.x+=s-y.height*i.scale+(-o-1)*i.scale:A.x+=i.imageName||y.width+2*o===_.w&&y.height+2*o===_.h?(s-E)/2:(s-(y.height+2*o)*i.scale)/2,M=new b(A.x,A.y-T),k=new b(A.x+E,A.y),C=new b(A.x+E,A.y-T)}else{const e=(y.left-o)*i.scale-g+x[0],t=(-y.top-o)*i.scale+x[1],n=e+T,r=t+E;A=new b(e,t),M=new b(n,t),k=new b(e,r),C=new b(n,r)}if(c){let e;e=r?new b(0,0):S?new b(u[0],u[1]):new b(n[0],n[1]),A._rotateAround(c,e),M._rotateAround(c,e),k._rotateAround(c,e),C._rotateAround(c,e)}const P=new b(0,0),I=new b(0,0);l.push({tl:A,tr:M,bl:k,br:C,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:i.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}}return l}(0,i,l,o,s,a,r,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[mg*o.layout.get("text-size").evaluate(a,{},g)],x[0]>My&&J("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Ay,'. Reduce your "text-size".'))):"composite"===v.kind&&(x=[mg*f.compositeTextSizes[0].evaluate(a,{},g),mg*f.compositeTextSizes[1].evaluate(a,{},g)],(x[0]>My||x[1]>My)&&J("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Ay,'. Reduce your "text-size".'))),e.addSymbols(e.text,_,x,l,s,a,u,t,n,c.lineStartIndex,c.lineLength,p,m,g,y,!1);for(const b of h)d[b]=e.text.placedSymbolArray.length-1;return 4*_.length}function Cy(e){for(const t in e)return e[t];return null}function Py(e,t,n,i,r,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new b(d,u),t=new b(p,u),n=new b(d,h),i=new b(p,h),r=E(l);let o=new b(0,0);c&&(o=new b(c[0],c[1])),e._rotateAround(r,o),t._rotateAround(r,o),n._rotateAround(r,o),i._rotateAround(r,o),d=Math.min(e.x,t.x,n.x,i.x),p=Math.max(e.x,t.x,n.x,i.x),u=Math.min(e.y,t.y,n.y,i.y),h=Math.max(e.y,t.y,n.y,i.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,d,u,p,h,a,i,r,o),e.length-1}function Iy(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Dy(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}function zy(e,t){const n=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),o=Math.sin(n)*r/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),s=Math.sin(e._pitch)*o+r;return Math.min(1.01*s,r*(1/e._horizonShift))}function Ry(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),i=e.x*n,r=(e.x+1)*n,o=e.y*n,s=(e.y+1)*n,a=ip(i),l=ip(r),c=rp(o),u=rp(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),y=Math.max(h.x,d.x,p.x,f.x),_=Math.max(h.y,d.y,p.y,f.y);const v=n/16;function x(e,n,i,r,o,s){const a=(i+o)/2,l=(r+s)/2,c=t.project(ip(a),rp(l)),u=Math.max(0,m-c.x,g-c.y,c.x-y,c.y-_);m=Math.min(m,c.x),y=Math.max(y,c.x),g=Math.min(g,c.y),_=Math.max(_,c.y),u>v&&(x(e,c,i,r,a,l),x(c,n,a,l,o,s))}x(h,d,i,o,r,o),x(d,p,r,o,r,s),x(p,f,r,s,i,s),x(f,h,i,s,i,o),m-=v,g-=v,y+=v,_+=v;const b=1/Math.max(y-m,_-g);return{scale:b,x:m*b,y:g*b,x2:y*b,y2:_*b,projection:t}}function Ly(e,t,n,i,r,o,s,a,l){if("globe"===l.name)return bd(e,t,new Wh(n,i,r),!1);const c=Ry({z:n,x:i,y:r},l);return new id([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])}function Oy(e,t){let{x:n,y:i}=t;return new b(((n-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*pi,(i*e.scale-e.y)*pi)}function Fy(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Lh.fromValues(((t.x-n)*e.scale-e.x)*pi,(t.y*e.scale-e.y)*pi,op(t.z,t.y))}const By=Ch.identity(new Float32Array(16));class Ny{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Kd(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return np(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return zy(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,i){const r=e.horizonLineFromTop(!1),o=new b(t,Math.max(r,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,i))}pointCoordinate3D(e,t,n){const i=new b(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);{const t=this.pointCoordinate(e,i.x,i.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return By}createTileMatrix(e,t,n){let i,r,o;const s=n.canonical,a=Ch.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Ry(s,this);i=1,r=l.x+n.wrap*l.scale,o=l.y,Ch.scale(a,a,[i/l.scale,i/l.scale,e.pixelsPerMeter/t])}else i=t/e.zoomScale(s.z),r=(s.x+Math.pow(2,s.z)*n.wrap)*i,o=s.y*i;return Ch.translate(a,a,[r,o,0]),Ch.scale(a,a,[i/pi,i/pi,1]),a}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class jy extends Ny{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(E(t));this.n=(i+Math.sin(E(n)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:n,c:i,r0:r}=this,o=E(e-this.center[0]),s=E(t),a=Math.sqrt(i-2*n*Math.sin(s))/n;return{x:a*Math.sin(o*n),y:a*Math.cos(o*n)-r,z:0}}unproject(e,t){const{n:n,c:i,r0:r}=this,o=r+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*n<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=E(this.center[0])*n;s=L(s,-Math.PI-a,Math.PI-a);const l=z(A(s/n)+this.center[0],-180,180),c=Math.asin(z((i-(e*e+o*o)*n*n)/(2*n),-1,1)),u=z(A(c),-sp,sp);return new Kd(l,u)}}const Vy=1.340264,Uy=-.081106,Gy=893e-6,qy=.003796,Wy=Math.sqrt(3)/2;class Zy extends Ny{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Wy*Math.sin(t)),i=n*n,r=i*i*i;return{x:.5*(e*Math.cos(n)/(Wy*(Vy+3*Uy*i+r*(7*Gy+9*qy*i)))/Math.PI+.5),y:1-.5*(n*(Vy+Uy*i+r*(Gy+qy*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=n*n,r=i*i*i;for(let c,u,h,d=0;d<12&&(u=n*(Vy+Uy*i+r*(Gy+qy*i))-t,h=Vy+3*Uy*i+r*(7*Gy+9*qy*i),c=u/h,n=z(n-c,-Math.PI/3,Math.PI/3),i=n*n,r=i*i*i,!(Math.abs(c)<1e-12));++d);const o=Wy*e*(Vy+3*Uy*i+r*(7*Gy+9*qy*i))/Math.cos(n),s=Math.asin(Math.sin(n)/Wy),a=z(180*o/Math.PI,-180,180),l=z(180*s/Math.PI,-sp,sp);return new Kd(a,l)}}class Hy extends Ny{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),i=z(360*(.5-t),-sp,sp);return new Kd(n,i)}}const Xy=Math.PI/2;function Yy(e){return Math.tan((Xy+e)/2)}class Ky extends Ny{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let i=E(t),r=E(n);this.southernCenter=i+r<0,this.southernCenter&&(i=-i,r=-r);const o=Math.cos(i),s=Yy(i);this.n=i===r?Math.sin(i):Math.log(o/Math.cos(r))/Math.log(Yy(r)/s),this.f=o*Math.pow(Yy(i),this.n)/this.n}project(e,t){t=E(t),this.southernCenter&&(t=-t),e=E(e-this.center[0]);const n=1e-6,{n:i,f:r}=this;r>0?t<-Xy+n&&(t=-Xy+n):t>Xy-n&&(t=Xy-n);const o=r/Math.pow(Yy(t),i);let s=o*Math.sin(i*e),a=r-o*Math.cos(i*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:n,f:i}=this,r=i-t,o=Math.sign(r),s=Math.sign(n)*Math.sqrt(e*e+r*r);let a=Math.atan2(e,Math.abs(r))*o;r*n<0&&(a-=Math.PI*Math.sign(e)*o);const l=z(A(a/n)+this.center[0],-180,180),c=z(A(2*Math.atan(Math.pow(i/s,1/n))-Xy),-sp,sp);return new Kd(l,this.southernCenter?-c:c)}}class Jy extends Ny{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:ep(e),y:tp(t),z:0}}unproject(e,t){const n=ip(e),i=rp(t);return new Kd(n,i)}}const $y=E(sp);class Qy extends Ny{project(e,t){const n=(t=E(t))*t,i=n*n;return{x:.5*((e=E(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=25,r=0,o=n*n;do{o=n*n;const e=o*o;r=(n*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),n=z(n-r,-$y,$y)}while(Math.abs(r)>1e-6&&--i>0);o=n*n;const s=z(A(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=A(n);return new Kd(s,a)}}const e_=E(sp);class t_ extends Ny{project(e,t){t=E(t),e=E(e);const n=Math.cos(t),i=2/Math.PI,r=Math.acos(n*Math.cos(e/2)),o=Math.sin(r)/r,s=.5*(e*i+2*n*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,r=25;const o=1e-6;let s=0,a=0;do{const r=Math.cos(i),o=Math.sin(i),l=2*o*r,c=o*o,u=r*r,h=Math.cos(n/2),d=Math.sin(n/2),p=2*h*d,f=d*d,m=1-u*h*h,g=m?1/m:0,y=m?Math.acos(r*h)*Math.sqrt(1/m):0,_=.5*(2*y*r*d+2*n/Math.PI)-e,v=.5*(y*o+i)-t,x=.5*g*(u*f+y*r*h*c)+1/Math.PI,b=g*(p*l/4-y*o*d),w=.125*g*(l*d-y*o*u*p),S=.5*g*(c*h+y*f*r)+.5,T=b*w-S*x;s=(v*b-_*S)/T,a=(_*w-v*x)/T,n=z(n-s,-Math.PI,Math.PI),i=z(i-a,-e_,e_)}while((Math.abs(s)>o||Math.abs(a)>o)&&--r>0);return new Kd(A(n),A(i))}}class n_ extends Ny{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(E(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:i}=this;return{x:E(e)*i*n+.5,y:-Math.sin(E(t))/i*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:i}=this,r=-(t-.5)/n,o=z(A((e-.5)/n)/i,-180,180),s=Math.asin(z(r*i,-1,1)),a=z(A(s),-sp,sp);return new Kd(o,a)}}class i_ extends Jy{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const i=Ad(e,t,n),r=Cd(yd(n));return Lh.transformMat4(i,i,r),{x:i[0],y:i[1],z:i[2]}}locationPoint(e,t){const n=Ed(t.lat,t.lng),i=Lh.normalize([],n),r=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude,o=np(1,0)*pi*r;Lh.scaleAndAdd(n,n,i,o);const s=Ch.identity(new Float64Array(16));return Ch.multiply(s,e.pixelMatrix,e.globeMatrix),Lh.transformMat4(n,n,s),new b(n[0],n[1])}pixelsPerMeter(e,t){return np(1,0)*t}pixelSpaceConversion(e,t,n){const i=np(1,e)*t,r=tr(np(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,n){const i=Pd(yd(n.canonical));return Ch.multiply(new Float64Array(16),e.globeMatrix,i)}createInversionMatrix(e,t){const{center:n}=e,i=Cd(yd(t));return Ch.rotateY(i,i,E(n.lng)),Ch.rotateX(i,i,E(n.lat)),Ch.scale(i,i,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(i)}pointCoordinate(e,t,n,i){return fd(e,t,n,!0)||new hp(0,0)}pointCoordinate3D(e,t,n){const i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!fd(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const n=e.cameraToCenterDistance,i=e._centerAltitude*t,r=e._camera,o=e._camera.forward(),s=Lh.add([],Lh.scale([],o,-n),[0,0,i]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=Lh.scale([],r.up(),u),d=Lh.scale([],r.right(),u*c),p=Lh.normalize([],Lh.add([],Lh.add([],o,h),d)),f=[];let m;if(new Kh(s,p).closestPointOnSphere(l,a,f)){const t=Lh.add([],f,l),n=Lh.sub([],t,s);m=Math.cos(e.fovAboveCenter)*Lh.length(n)}else{const e=Lh.sub([],s,l),t=Lh.sub([],l,s);Lh.normalize(t,t);const n=Lh.length(e)-a;m=Math.sqrt(n*(n+2*a));const i=Math.acos(m/(a+n))-Math.acos(Lh.dot(o,t));m*=Math.cos(i)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Ld(e.zoom);if(n>0){const i=zy(e,np(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return tr(t,i+r*(1-Math.cos(o)),Math.pow(n,10))}return t}upVector(e,t,n){return Ad(t,n,e,1)}upVectorScale(e){return{metersToTile:pd(Md(yd(e)))}}}function r_(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Jy(e);case"equirectangular":return new Hy(e);case"naturalEarth":return new Qy(e);case"equalEarth":return new Zy(e);case"winkelTripel":return new t_(e);case"albers":return n?new n_(e):new jy(e);case"lambertConformalConic":return n?new n_(e):new Ky(e);case"globe":return new i_(e)}throw new Error("Invalid projection name: ".concat(e.name))}const o_=new xa({"symbol-placement":new ya(Rt.layout_symbol["symbol-placement"]),"symbol-spacing":new ya(Rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ya(Rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _a(Rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ya(Rt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ya(Rt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ya(Rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ya(Rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ya(Rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ya(Rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new _a(Rt.layout_symbol["icon-size"]),"icon-text-fit":new _a(Rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _a(Rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new _a(Rt.layout_symbol["icon-image"]),"icon-rotate":new _a(Rt.layout_symbol["icon-rotate"]),"icon-padding":new ya(Rt.layout_symbol["icon-padding"]),"icon-keep-upright":new ya(Rt.layout_symbol["icon-keep-upright"]),"icon-offset":new _a(Rt.layout_symbol["icon-offset"]),"icon-anchor":new _a(Rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ya(Rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ya(Rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ya(Rt.layout_symbol["text-rotation-alignment"]),"text-field":new _a(Rt.layout_symbol["text-field"]),"text-font":new _a(Rt.layout_symbol["text-font"]),"text-size":new _a(Rt.layout_symbol["text-size"]),"text-max-width":new _a(Rt.layout_symbol["text-max-width"]),"text-line-height":new _a(Rt.layout_symbol["text-line-height"]),"text-letter-spacing":new _a(Rt.layout_symbol["text-letter-spacing"]),"text-justify":new _a(Rt.layout_symbol["text-justify"]),"text-radial-offset":new _a(Rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ya(Rt.layout_symbol["text-variable-anchor"]),"text-anchor":new _a(Rt.layout_symbol["text-anchor"]),"text-max-angle":new ya(Rt.layout_symbol["text-max-angle"]),"text-writing-mode":new ya(Rt.layout_symbol["text-writing-mode"]),"text-rotate":new _a(Rt.layout_symbol["text-rotate"]),"text-padding":new ya(Rt.layout_symbol["text-padding"]),"text-keep-upright":new ya(Rt.layout_symbol["text-keep-upright"]),"text-transform":new _a(Rt.layout_symbol["text-transform"]),"text-offset":new _a(Rt.layout_symbol["text-offset"]),"text-allow-overlap":new ya(Rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ya(Rt.layout_symbol["text-ignore-placement"]),"text-optional":new ya(Rt.layout_symbol["text-optional"]),visibility:new ya(Rt.layout_symbol.visibility)});var s_={paint:new xa({"icon-opacity":new _a(Rt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new _a(Rt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new _a(Rt.paint_symbol["text-emissive-strength"]),"icon-color":new _a(Rt.paint_symbol["icon-color"]),"icon-halo-color":new _a(Rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new _a(Rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _a(Rt.paint_symbol["icon-halo-blur"]),"icon-translate":new ya(Rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ya(Rt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new _a(Rt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new _a(Rt.paint_symbol["text-opacity"]),"text-color":new _a(Rt.paint_symbol["text-color"],{runtimeType:Xt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new _a(Rt.paint_symbol["text-halo-color"]),"text-halo-width":new _a(Rt.paint_symbol["text-halo-width"]),"text-halo-blur":new _a(Rt.paint_symbol["text-halo-blur"]),"text-translate":new ya(Rt.paint_symbol["text-translate"]),"text-translate-anchor":new ya(Rt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ya(Rt.paint_symbol["icon-color-saturation"])}),layout:o_};class a_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:qt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Os(a_,"FormatSectionOverride",{omit:["defaultValue"]});class l_ extends Aa{constructor(e,t){super(e,s_,t)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Ao(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,(t,n)=>n in e?String(e[n]):"")}(t.properties,r)}createBucket(e){return new x_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of s_.paint.overridableProperties){if(!l_.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new a_(t),i=new Eo(n,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new ko("source",i):new Co("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new ma(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&l_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=s_.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof yn)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof Tn&&bn(t.value)===$t?o(t.value.sections):t instanceof Cn?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),n=[];return e&&n.push("symbolIcon"),t&&n.push("symbolSDF"),n}getDefaultProgramParams(e,t){return{config:new nc(this,t),overrideFog:!1}}}const c_=pm.types,u_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function h_(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=a?Math.min(My,Math.round(a[0])):0,f=a?Math.min(My,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function d_(e,t,n){e.emplaceBack(t,n)}function p_(e,t,n,i,r,o,s){e.emplaceBack(t,n,i,r,o,s)}function f_(e,t,n,i,r){const o=5*t+2;e.float32[o+0]=n,e.float32[o+1]=i,e.float32[o+2]=r}function m_(e,t,n,i,r){e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r)}function g_(e){for(const t of e.sections)if(Ys(t.text))return!0;return!1}class y_{constructor(e){this.layoutVertexArray=new Ua,this.indexArray=new Ka,this.programConfigurations=e,this.segments=new wl,this.dynamicLayoutVertexArray=new Ba,this.opacityVertexArray=new qa,this.placedSymbolArray=new dl,this.iconTransitioningVertexArray=new Wa,this.globeExtVertexArray=new Ga,this.zOffsetVertexArray=new Qa}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,n,i,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,og.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ag.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,u_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,cg.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,sg.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||r)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,lg.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Os(y_,"SymbolBuffers");class __{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new wl,this.collisionVertexArray=new Ya,this.collisionVertexArrayExt=new Ba}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ug.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,hg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Os(__,"CollisionBuffers");class v_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ch.identity([]),this.placementViewportMatrix=Ch.identity([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gg(this.zoom,t["text-size"]),this.iconSizeData=gg(this.zoom,t["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(e=>Cg[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new y_(new ic(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new y_(new ic(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ml,this.lineVertexArray=new gl,this.symbolInstances=new fl}calculateGlyphDependencies(e,t,n,i,r){for(let o=0;o<e.length;o++){const n=e.codePointAt(o);if(void 0===n)break;if(t[n]=!0,i&&r&&n<=65535){const n=bg[e.charAt(o)];n&&(t[n.charCodeAt(0)]=!0)}}}populate(e,t,n,i){const r=this.layers[0],o=r.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof yn&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=t.iconDependencies,f=t.glyphDependencies,m=t.availableImages,g=new la(this.zoom);for(const{feature:y,id:_,index:v,sourceLayerIndex:x}of e){const e=r._featureFilter.needGeometry,t=xp(y,e);if(!r._featureFilter.filter(g,t,n))continue;if(e||(t.geometry=vp(y,n,i)),s&&1!==y.type&&n.z<=5){const e=t.geometry,i=.98078528056,r=(e,t)=>{const r=Ad(e.x,e.y,n,1),o=Ad(t.x,t.y,n,1);return Lh.dot(r,o)<i};for(let t=0;t<e.length;t++)e[t]=mp(e[t],r)}let l,c;if(u){const e=r.getValueAndResolveTokens("text-field",t,n,m),i=yn.factory(e);g_(i)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===oa()||this.hasRTLText&&aa.isParsed())&&(l=xg(i,r,t))}if(h){const e=r.getValueAndResolveTokens("icon-image",t,n,m);c=e instanceof _n?e:_n.fromString(e)}if(!l&&!c)continue;const b=this.sortFeaturesByKey?d.evaluate(t,{},n):void 0;if(this.features.push({id:_,text:l,icon:c,index:v,sourceLayerIndex:x,geometry:t.geometry,properties:y.properties,type:c_[y.type],sortKey:b}),c&&(p[c.namePrimary]=!0,c.nameSecondary&&(p[c.nameSecondary]=!0)),l){const e=a.evaluate(t,{},n).join(","),i="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Cg.vertical)>=0;for(const t of l.sections)if(t.image)p[t.image.namePrimary]=!0;else{const n=Us(l.toString()),r=t.fontStack||e,o=f[r]=f[r]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function o(t){i.push(e[t]),r++}function s(e,t,r){const o=n[e];return delete n[e],n[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function a(e,n,r){const o=t[n];return delete t[n],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(i.x,":").concat(i.y)}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=a(p,f,h),r=s(p,f,i[e].geometry);delete t[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else p in n?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=r-1,n[f]=r-1)}return i.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}update(e,t,n,i,r){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,s,n,i,r),this.icon.programConfigurations.updatePaintArrays(e,t,s,n,i,r)}updateZOffset(){const e=(e,t,i)=>{n+=t,n>e.length&&e.resize(n);for(let r=-t;r<0;r++)e.emplace(r+n,i)},t=(e,t,n)=>{i+=t,i>e.length&&e.resize(i);for(let r=-t;r<0;r++)e.emplace(r+i,n)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,i=0;for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:o,numIconVertices:s}=n,a=n.zOffset,l=s>0;if((i>0||o>0)&&(e(this.text.zOffsetVertexArray,i,a),e(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=n;e>=0&&t(this.icon.zOffsetVertexArray,s,a),i>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=r_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:i,y:r}of t)this.lineVertexArray.emplaceBack(i,r);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=e.indexArray,y=e.layoutVertexArray,_=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,y,g,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&s===Cg.vertical?Math.PI/2:0,S=o.text&&o.text.sections;for(let E=0;E<t.length;E++){const{tl:i,tr:r,bl:s,br:c,texPrimary:u,texSecondary:h,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:T,minFontScaleY:A,glyphOffset:M,isSDF:k,sectionIndex:C}=t[E],P=v.vertexLength,I=M[1];if(h_(y,l.x,l.y,i.x,I+i.y,u.x,u.y,n,k,x.x,x.y,T,A),h_(y,l.x,l.y,r.x,I+r.y,u.x+u.w,u.y,n,k,b.x,x.y,T,A),h_(y,l.x,l.y,s.x,I+s.y,u.x,u.y+u.h,n,k,x.x,b.y,T,A),h_(y,l.x,l.y,c.x,I+c.y,u.x+u.w,u.y+u.h,n,k,b.x,b.y,T,A),a){const{x:t,y:n,z:i}=a.anchor,[r,o,s]=a.up;p_(_,t,n,i,r,o,s),p_(_,t,n,i,r,o,s),p_(_,t,n,i,r,o,s),p_(_,t,n,i,r,o,s),m_(e.dynamicLayoutVertexArray,t,n,i,w)}else m_(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=h||u;d_(e.iconTransitioningVertexArray,t.x,t.y),d_(e.iconTransitioningVertexArray,t.x+t.w,t.y),d_(e.iconTransitioningVertexArray,t.x,t.y+t.h),d_(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(P,P+1,P+2),g.emplaceBack(P+1,P+2,P+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),E!==t.length-1&&C===t[E+1].sectionIndex||e.programConfigurations.populatePaintArrays(y.length,o,o.index,{},d,p,f,S&&S[C])}const T=a?a.anchor:l;e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,n,i,r,o,s){e.emplaceBack(t,n,i,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,n,i,r,o,s){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let d=0;d<4;d++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,t,e.padding,s.zOffset),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new b(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new b(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new b(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new b(e.x1,e.y2)),a.vertexLength+=4;const h=n.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new __(Ha,dg.members,Wa),this.iconCollisionBox=new __(Ha,dg.members,Wa);const n=_g(this.iconSizeData,e),i=_g(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,n,i){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),o=yg(this.textSizeData,e,r)/fg;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),r=yg(this.iconSizeData,e,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,n,i){e.emplaceBack(t,-n,-n,i),e.emplaceBack(t,n,-n,i),e.emplaceBack(t,n,n,i),e.emplaceBack(t,-n,n,i)}_updateTextDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding,o.zOffset)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=_g(this.iconSizeData,e),i=_g(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,o,s,a,l){const c={};if(t<n){const{x1:n,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:n,y1:i,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(i<r){const{x1:t,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(i);c.verticalTextBox={x1:t,y1:n,x2:r,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:n,x2:i,y2:r,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)e.indexArray.emplaceBack(r,r+1,r+2),e.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const e=this.symbolInstances.get(s);i.push(0|Math.round(t*e.tileAnchorX+n*e.tileAnchorY)),r.push(e.featureIndex)}return o.sort((e,t)=>i[e]-i[t]||r[t]-r[e]),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&r!==n&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Os(v_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),v_.MAX_GLYPHS=65535,v_.addDynamicAttributes=m_;var x_=v_;const b_=Ia([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:w_}=b_,S_=Ia([{name:"a_packed",components:4,type:"Float32"}]),{members:T_}=S_,E_=pm.types,A_=Math.cos(Math.PI/180*37.5);class M_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new Fa,this.layoutVertexArray2=new Ba,this.indexArray=new Ka,this.programConfigurations=new ic(e.layers,e.zoom),this.segments=new wl,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,n,i){this.hasPattern=Gf("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=xp(c,e);if(!this.layers[0]._featureFilter.filter(new la(this.zoom),t,n))continue;const s=r?r.evaluate(t,{},n):void 0,a={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:e?t.geometry:vp(c,n,i),patterns:{},sortKey:s};o.push(a)}r&&o.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:s,featureIndex:a}=t,l=this.addConstantDashes(s);for(const c of o){const{geometry:i,index:r,sourceLayerIndex:o}=c;if(l&&this.addFeatureDashes(c,s),this.hasPattern){const e=qf("line",this.layers,c,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(c,i,r,n,s.positions,t.availableImages,t.brightness);a.insert(e[r].feature,i,r,o,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,n=i.value;if(!n)continue;e.addDash(n,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a;if("constant"===r.kind){if(s=r.value,!s)continue}else s=r.evaluate({zoom:n},e);a="constant"===o.kind?o.value:o.evaluate({zoom:n},e),t.addDash(s,a),e.patterns[i.id]=t.getKey(s,a)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}addFeatures(e,t,n,i,r,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,t,n,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,T_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(e,{}),c=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,s)}addLine(e,t,n,i,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===E_[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?15*pi/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let g=l;g<a;g++){if(p=g===a-1?s?e[l+1]:void 0:e[g+1],p&&e[g].equals(p))continue;m&&(f=m),h&&(d=h),h=e[g],m=p?p.sub(h)._unit()._perp():f,f=f||m;let t=f.add(m);0===t.x&&0===t.y||t._unit();const y=f.x*m.x+f.y*m.y,_=t.x*m.x+t.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<A_&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&g>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const S=d&&p;let T=S?n:s?"butt":i;if(S&&"round"===T&&(v<o?T="miter":v<=2&&(T="fakeround")),"miter"===T&&v>r&&(T="bevel"),"bevel"===T&&(v>2&&(T="flipbevel"),v<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)t._mult(v),this.addCurrentVertex(h,t,0,0,u);else if("flipbevel"===T){if(v>100)t=m.mult(-1);else{const e=v*f.add(m).mag()/f.sub(m).mag();t._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,t,0,0,u),this.addCurrentVertex(h,t.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(v*v-1),t=w?e:0,n=w?0:e;if(d&&this.addCurrentVertex(h,f,t,n,u),"fakeround"===T){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*e*e+(.848013+y*(.215638*y-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-n,u)}else if("butt"===T)this.addCurrentVertex(h,t,0,0,u);else if("square"===T){const e=d?1:-1;d||this.addCurrentVertex(h,t,e,e,u),this.addCurrentVertex(h,t,0,0,u),d&&this.addCurrentVertex(h,t,e,e,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&g<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=t.y*i-t.x,a=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,r),this.addHalfVertex(e,s,a,o,!0,-i,r)}addHalfVertex(e,t,n,i,r,o,s){let{x:a,y:l}=e;this.layoutVertexArray.emplaceBack((a<<1)+(i?1:0),(l<<1)+(r?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),s.primitiveLength++),r?this.e2=c:this.e1=c}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Os(M_,"LineBucket",{omit:["layers","patternFeatures"]});class k_{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,n,i){const{width:r,height:o}=e,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=t;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!n||!1!==n.premultiply)),i||this.size&&this.size[0]===r&&this.size[1]===o){const{x:t,y:n}=i||{x:0,y:0};if(e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d)a.texSubImage2D(a.TEXTURE_2D,0,t,n,a.RGBA,a.UNSIGNED_BYTE,e);else{let i=this.format,s=a.UNSIGNED_BYTE;this.format===a.R32F&&(i=a.RED,s=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,t,n,r,o,i,s,e.data)}}else if(this.size=[r,o],e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d){let t=this.format;this.format===a.R8&&(t=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,t,a.UNSIGNED_BYTE,e)}else{let t=this.format,n=this.format,i=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(t=a.DEPTH_COMPONENT16,i=a.UNSIGNED_SHORT),this.format===a.R32F&&(i=a.FLOAT,n=a.RED),a.texImage2D(a.TEXTURE_2D,0,t,r,o,0,n,i,e.data)}this.useMipmap=Boolean(n&&n.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,n,i){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,n),this.wrapS=n),i!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapT=i)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class C_{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}}const P_=32,I_=33,D_=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,n=0,r=0,o=0,s=0,a=0;for(1&e?r=o=s=P_:t=n=a=P_;(e>>=1)>1;){const i=t+r>>1,l=n+o>>1;1&e?(r=t,o=n,t=s,n=a):(t=r,n=o,r=s,o=a),s=i,a=l}const l=4*i;D_[l+0]=t,D_[l+1]=n,D_[l+2]=r,D_[l+3]=o}const z_=new Uint16Array(2178),R_=new Uint8Array(1089),L_=new Uint16Array(1089);function O_(e){return 0===e?-.03125:32===e?.03125:0}var F_=Ia([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const B_={type:2,extent:pi,loadGeometry:()=>[[new b(0,0),new b(pi+1,0),new b(pi+1,pi+1),new b(0,pi+1),new b(0,0)]]};class N_{constructor(e,t,n,i,r){this.tileID=e,this.uid=V(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<mt.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ry(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)n[t.fqid]=i}}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof x_){if(this.hasSymbolBuckets=!0,!n)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof x_&&t.hasRTLText){this.hasRTLText=!0,aa.isLoading()||aa.isLoaded()||"deferred"!==oa()||sa();break}}this.queryPadding=0;for(const e in this.buckets){const n=this.buckets[e],i=t.style.getOwnLayer(e);if(!i)continue;const r=i.queryRadius(n);this.queryPadding=Math.max(this.queryPadding,r)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new ul}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const n in this.buckets){const t=this.buckets[n];t.uploadPending()&&t.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new k_(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new k_(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new k_(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,t,n){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,n),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=t.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this._lastUpdatedBrightness=i,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,n,i,r,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:s,transform:o,params:r,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),r=t?t.sourceLayer:"",o=i._geojsonTileLayer||i[r];if(!o)return;const s=Vo(t&&t.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let h=0;h<o.length;h++){const t=o.feature(h);if(s.needGeometry){const e=xp(t,!0);if(!s.filter(new la(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new la(this.tileID.overscaledZ),t))continue;const i=n.getId(t,r),d=new jm(t,a,l,c,i);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=ie(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let n=!1;if(this.expirationTime>e)n=!1;else if(t)if(this.expirationTime<t)n=!0;else{const i=this.expirationTime-t;i?this.expirationTime=e+Math.max(i,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(e,t){if(!this.latestFeatureIndex)return;const n=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages(),r=t.style.getBrightness();for(const o in this.buckets){if(!t.style.hasLayer(o))continue;const s=this.buckets[o],a=s.layers[0].sourceLayer||"_geojsonTileLayer",l=n[a];let c={};if(e&&(c=e[a],!l||!c||0===Object.keys(c).length))continue;if(s.update(c,l,i,this.imageAtlas&&this.imageAtlas.patternPositions||{},r),s instanceof M_||s instanceof Wf){const e=t.style.getOwnSourceCache(s.layers[0].source);t._terrain&&t._terrain.enabled&&e&&s.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const u=t&&t.style&&t.style.getOwnLayer(o);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<mt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=mt.now()+e}setTexture(e,t){const n=t.context,i=n.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture&&this.texture instanceof k_?this.texture.update(e,{useMipmap:!0}):(this.texture=new k_(n,e,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const n=vp(B_,this.tileID.canonical,this.tileTransform)[0],i=new za,r=new il;for(let o=0;o<n.length;o++){const{x:e,y:t}=n[o];i.emplaceBack(e,t),r.emplaceBack(o)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(i,Uh.members),this._tileDebugSegments=wl.simpleSegment(0,0,i.length,r.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const n=vp(B_,this.tileID.canonical,this.tileTransform)[0];let i,r;if(this.isRaster){const e=function(e,t){const n=Ry(e,t),i=Math.pow(2,e.z);for(let c=0;c<I_;c++)for(let r=0;r<I_;r++){const o=ip((e.x+(r+O_(r))/P_)/i),s=rp((e.y+(c+O_(c))/P_)/i),a=t.project(o,s),l=c*I_+r;z_[2*l+0]=Math.round((a.x*n.scale-n.x)*pi),z_[2*l+1]=Math.round((a.y*n.scale-n.y)*pi)}R_.fill(0),L_.fill(0);for(let c=2045;c>=0;c--){const e=4*c,t=D_[e+0],n=D_[e+1],i=D_[e+2],r=D_[e+3],o=t+i>>1,s=n+r>>1,a=o+s-n,l=s+t-o,u=n*I_+t,h=r*I_+i,d=s*I_+o,p=Math.hypot((z_[2*u+0]+z_[2*h+0])/2-z_[2*d+0],(z_[2*u+1]+z_[2*h+1])/2-z_[2*d+1])>=16;R_[d]=R_[d]||(p?1:0),c<1022&&(R_[d]=R_[d]||R_[(n+l>>1)*I_+(t+a>>1)]||R_[(r+l>>1)*I_+(i+a>>1)])}const r=new La,o=new Ka;let s=0;function a(e,t){const n=t*I_+e;return 0===L_[n]&&(r.emplaceBack(z_[2*n+0],z_[2*n+1],e*pi/P_,t*pi/P_),L_[n]=++s),L_[n]-1}function l(e,t,n,i,r,s){const c=e+n>>1,u=t+i>>1;if(Math.abs(e-r)+Math.abs(t-s)>1&&R_[u*I_+c])l(r,s,e,t,c,u),l(n,i,r,s,c,u);else{const l=a(e,t),c=a(n,i),u=a(r,s);o.emplaceBack(l,c,u)}}return l(0,0,P_,P_,P_,0),l(P_,P_,0,0,0,P_),{vertices:r,indices:o}}(this.tileID.canonical,t);i=e.vertices,r=e.indices}else{i=new La,r=new Ka;for(const{x:t,y:r}of n)i.emplaceBack(t,r,0,0);const e=jf(i.int16,void 0,4);for(let t=0;t<e.length;t+=3)r.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(i,F_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(r),this._tileBoundsSegments=wl.simpleSegment(0,0,i.length,r.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||"globe"!==n.name||t.freezeTileCoverage)return;const i=this.tileID.canonical,r=Cd(vd(i,t)),o=Ld(t.zoom);let s;o>0&&(s=Ch.invert(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,i,t,r,s,o),this._makeGlobeTileDebugTextBuffer(e,i,t,r,s,o)}_globePoint(e,t,n,i,r,o,s){let a=Ad(e,t,n);if(o){const r=1<<n.z,l=ep(i.center.lng),c=tp(i.center.lat),u=(n.x+.5)/r-l;let h=0;u>.5?h=-1:u<-.5&&(h=1);let d=(e/pi+n.x)/r+h,p=(t/pi+n.y)/r;d=(d-l)*i._pixelsPerMercatorPixel+l,p=(p-c)*i._pixelsPerMercatorPixel+c;const f=[d*i.worldSize,p*i.worldSize,0];Lh.transformMat4(f,f,o),a=_d(a,f,s)}return Lh.transformMat4(a,a,r)}_makeGlobeTileDebugBorderBuffer(e,t,n,i,r,o){const s=new za,a=new il,l=new Ra,c=(e,c,u,h,d)=>{const p=(u-e)/(d-1),f=(h-c)/(d-1),m=s.length;for(let g=0;g<d;g++){const u=e+g*p,h=c+g*f;s.emplaceBack(u,h);const d=this._globePoint(u,h,t,n,i,r,o);l.emplaceBack(d[0],d[1],d[2]),a.emplaceBack(m+g)}},u=pi;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(a),this._tileDebugBuffer=e.createVertexBuffer(s,Uh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,Vh.members),this._tileDebugSegments=wl.simpleSegment(0,0,s.length,a.length)}_makeGlobeTileDebugTextBuffer(e,t,n,i,r,o){const s=pi/4,a=new za,l=new Ka,c=new Ra,u=25;l.reserve(32),a.reserve(u),c.reserve(u);const h=(e,t)=>u*e+t;for(let d=0;d<u;d++){const e=d*s;for(let l=0;l<u;l++){const u=l*s;a.emplaceBack(u,e);const h=this._globePoint(u,e,t,n,i,r,o);c.emplaceBack(h[0],h[1],h[2])}}for(let d=0;d<4;d++)for(let e=0;e<4;e++){const t=h(d,e),n=h(d,e+1),i=h(d+1,e),r=h(d+1,e+1);l.emplaceBack(t,n,i),l.emplaceBack(i,n,r)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(a,Uh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(c,Vh.members),this._tileDebugTextSegments=wl.simpleSegment(0,0,u,32)}destroy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof k_&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class j_{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout(()=>{this.remove(e,r)},n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class V_{constructor(e,t,n,i){this.id=V_.uniqueIdxCounter,V_.uniqueIdxCounter++,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=V_.uniqueIdxCounter,V_.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}V_.uniqueIdxCounter=0;const U_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class G_{constructor(e,t,n,i,r,o){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.instanceCount=o,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[U_[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(r,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class q_{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class W_ extends q_{getDefault(){return fn.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Z_ extends q_{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class H_ extends q_{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class X_ extends q_{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Y_ extends q_{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class K_ extends q_{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class J_ extends q_{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class $_ extends q_{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Q_ extends q_{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class ev extends q_{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class tv extends q_{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class nv extends q_{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class iv extends q_{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class rv extends q_{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ov extends q_{getDefault(){return fn.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class sv extends q_{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class av extends q_{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class lv extends q_{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class cv extends q_{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let uv=class extends q_{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class hv extends q_{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class dv extends q_{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class pv extends q_{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class fv extends q_{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class mv extends q_{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class gv extends q_{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class yv extends q_{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _v extends q_{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class vv extends q_{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class xv extends q_{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class bv extends q_{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class wv extends q_{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Sv extends wv{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Tv extends wv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ev extends wv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Av extends Tv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Mv{constructor(e,t,n,i,r){this.context=e,this.width=t,this.height=n;const o=this.framebuffer=e.gl.createFramebuffer();i&&(this.colorAttachment=new Sv(e,o)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new Tv(e,o):new Ev(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class kv{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}kv.ReadOnly=!1,kv.ReadWrite=!0,kv.disabled=new kv(519,kv.ReadOnly,[0,1]);const Cv=7680;class Pv{constructor(e,t,n,i,r,o){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}Pv.disabled=new Pv({func:519,mask:0},0,0,Cv,Cv,Cv);const Iv=771;class Dv{constructor(e,t,n,i){this.blendFunction=e,this.blendColor=t,this.mask=n,this.blendEquation=i}}Dv.Replace=[1,0,1,0],Dv.disabled=new Dv(Dv.Replace,fn.transparent,[!1,!1,!1,!1]),Dv.unblended=new Dv(Dv.Replace,fn.transparent,[!0,!0,!0,!0]),Dv.alphaBlended=new Dv([1,Iv,1,Iv],fn.transparent,[!0,!0,!0,!0]),Dv.multiply=new Dv([774,0,774,0],fn.transparent,[!0,!0,!0,!0]);const zv=1029,Rv=2305;class Lv{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}Lv.disabled=new Lv(!1,zv,Rv),Lv.backCCW=new Lv(!0,zv,Rv),Lv.backCW=new Lv(!0,zv,2304),Lv.frontCW=new Lv(!0,1028,2304),Lv.frontCCW=new Lv(!0,1028,Rv);class Ov{constructor(e,t){this.gl=e,this.clearColor=new W_(this),this.clearDepth=new Z_(this),this.clearStencil=new H_(this),this.colorMask=new X_(this),this.depthMask=new Y_(this),this.stencilMask=new K_(this),this.stencilFunc=new J_(this),this.stencilOp=new $_(this),this.stencilTest=new Q_(this),this.depthRange=new ev(this),this.depthTest=new tv(this),this.depthFunc=new nv(this),this.blend=new iv(this),this.blendFunc=new rv(this),this.blendColor=new ov(this),this.blendEquation=new sv(this),this.cullFace=new av(this),this.cullFaceSide=new lv(this),this.frontFace=new cv(this),this.program=new uv(this),this.activeTexture=new hv(this),this.viewport=new dv(this),this.bindFramebuffer=new pv(this),this.bindRenderbuffer=new fv(this),this.bindTexture=new mv(this),this.bindVertexBuffer=new gv(this),this.bindElementBuffer=new yv(this),this.bindVertexArrayOES=new _v(this),this.pixelStoreUnpack=new vv(this),this.pixelStoreUnpackPremultiplyAlpha=new xv(this),this.pixelStoreUnpackFlipY=new bv(this),this.options=t?i({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,n){return new V_(this,e,t,n)}createVertexBuffer(e,t,n,i,r){return new G_(this,e,t,n,i,r)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n,i){return new Mv(this,e,t,n,i)}clear(e){let{color:t,depth:n,stencil:i,colorMask:r}=e;const o=this.gl;let s=0;t&&(s|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==n&&(s|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(s|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),o.clear(s)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){w(e.blendFunction,Dv.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Fv extends zt{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new j_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Vm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return F(this._tiles).map(e=>e.tileID).sort(Bv).map(e=>e.key)}getRenderableIds(e,t){const n=[];for(const i in this._tiles)this._isIdRenderable(+i,e,t)&&n.push(this._tiles[i]);return e?n.sort((e,t)=>{const n=e.tileID,i=t.tileID,r=new b(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new b(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-r.y||o.x-r.x}).map(e=>e.tileID.key):n.map(e=>e.tileID).sort(Bv).map(e=>e.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(n||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,i){if(i)if(e.state="errored",404!==i.status)this._source.fire(new Dt(i,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new It("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=mt.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new It("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,t,n,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let r;if(this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(e=>new Hh(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)):(r=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(r=r.filter(e=>this._source.hasTile(e)))):r=[],r.length>0&&this.castsShadows&&i&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Nv(this._source.type)){const o=e.coveringZoomLevel({tileSize:t||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),s=Math.min(o,this._source.maxzoom),a=e.extendTileCoverForShadows(r,i,s);for(const e of a)this._shadowCasterTiles[e.key]=!0,r.push(e)}const o=this._updateRetainedTiles(r);if(Nv(this._source.type)&&0!==r.length){const e={},t={},n=Object.keys(o);for(const r of n){const n=o[r],i=this._tiles[r];if(!i||i.fadeEndTime&&i.fadeEndTime<=mt.now())continue;const s=this.findLoadedParent(n,Math.max(n.overscaledZ-Fv.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),t[r]=n}const i=r[r.length-1].overscaledZ;for(const r in this._tiles){const e=this._tiles[r];if(o[r]||!e.hasData())continue;let n=e.tileID;for(;n.overscaledZ>i;){n=n.scaledTo(n.overscaledZ-1);const i=this._tiles[n.key];if(i&&i.hasData()&&t[n.key]){o[r]=e.tileID;break}}}for(const r in e)o[r]||(this._coveredTiles[r]=!0,o[r]=e[r])}for(const a in o)this._tiles[a].clearFadeHold();const s=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n}(this._tiles,o);for(const a of s){const e=this._tiles[a];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+a)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),r=e[0].overscaledZ,o=Math.max(r-Fv.maxOverzooming,this._source.minzoom),s=Math.max(r+Fv.maxUnderzooming,this._source.minzoom),a={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||i<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,i,s,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let r=l.overscaledZ-1;r>=o;--r){const o=l.scaledTo(r);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&i&&(e=this._addTile(o)),e&&(t[o.key]=o,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return!0!==t.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const n=this.map?this.map.painter:null;t=new N_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new It("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const i=[],r=this.transform;if(!r)return i;const o="globe"===r.projection.name,s=ep(r.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(n&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(z(s,...jv(e,-1))-s),Math.abs(z(s,...jv(e,1))-s)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(z(s,...jv(e,-1))-s),Math.abs(z(s,...jv(e,0))-s),Math.abs(z(s,...jv(e,1))-s)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const n of c){const o=e.containsTile(l,r,t,n);o&&i.push(o)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const n=this.getRenderableIds(e,t).map(e=>this._tiles[e].tileID),i="globe"===this.transform.projection.name;for(const r of n)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped()),r.expandedProjMatrix=i?this.transform.calculateProjMatrix(r.toUnwrapped(),!1,!0):r.projMatrix;return n}sortCoordinatesByDistance(e){const t=e.slice(),n=this.transform._camera.position,i=this.transform._camera.forward(),r={};for(const o of t){const e=1/(1<<o.canonical.z);r[o.key]=((o.canonical.x+.5)*e+o.wrap-n[0])*i[0]+((o.canonical.y+.5)*e-n[1])*i[1]-n[2]*i[2]}return t.sort((e,t)=>r[e.key]-r[t.key]),t}hasTransition(){if(this._source.hasTransition())return!0;if(Nv(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=mt.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(e,t){if(!this._sourceLoaded){const n=()=>{this._sourceLoaded&&(this._source.off("data",n),this._preloadTiles(e,t))};return void this._source.on("data",n)}const n=new Map,i=Array.isArray(e)?e:[e],r=this.map.painter.terrain,o=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const s of i){const e=s.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)n.set(t.key,t);this.usedForTerrain&&s.updateElevation(!1)}O(Array.from(n.values()),(e,t)=>{const n=new N_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(n,e=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),t(e,n)})},t)}}function Bv(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Nv(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function jv(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}Fv.maxOverzooming=10,Fv.maxUnderzooming=3;const Vv=Ia([{name:"a_pos_3f",components:3,type:"Float32"}]),Uv=Ia([{name:"a_color_3f",components:3,type:"Float32"}]),Gv=Ia([{name:"a_color_4f",components:4,type:"Float32"}]),qv=Ia([{name:"a_uv_2f",components:2,type:"Float32"}]),Wv=Ia([{name:"a_normal_3f",components:3,type:"Float32"}]),Zv=Ia([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Hv=Ia([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Xv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(e,t,n){return null!=t.top&&null!=e.top&&(this.top=tr(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=tr(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=tr(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=tr(e.right,t.right,n)),this}getCenter(e,t){const n=z((this.left+e-this.right)/2,0,e),i=z((this.top+t-this.bottom)/2,0,t);return new b(n,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Xv(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Yv(e,t){const n=ae(e,3);Ch.fromQuat(e,t),le(e,3,n)}function Kv(e,t){const n=Ih.identity([]);return Ih.rotateZ(n,n,-t),Ih.rotateX(n,n,-e),n}function Jv(e,t){const n=[e[0],e[1],0],i=[t[0],t[1],0];if(Lh.length(n)>=1e-15){const e=Lh.normalize([],n);Lh.scale(i,e,Lh.dot(i,e)),t[0]=i[0],t[1]=i[1]}const r=Lh.cross([],t,e);if(Lh.len(r)<1e-15)return null;const o=Math.atan2(-r[1],r[0]);return Kv(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),o)}class $v{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(e){if(e){const t=e instanceof hp?e:new hp(e[0],e[1],e[2]);this._renderWorldCopies&&(t.x=L(t.x,0,1)),this._position=t}else this._position=null}lookAtPoint(e,t){if(this.orientation=null,!this.position)return;const n=this.position,i=this._elevation?this._elevation.getAtPointOrZero(hp.fromLngLat(e)):0,r=hp.fromLngLat(e,i),o=[r.x-n.x,r.y-n.y,r.z-n.z];t||(t=[0,0,1]),t[2]=Math.abs(t[2]),this.orientation=Jv(o,t)}setPitchBearing(e,t){this.orientation=Kv(E(e),E(-t))}}class Qv{constructor(e,t){this._transform=Ch.identity([]),this.orientation=t,this.position=e}get mercatorPosition(){const e=this.position;return new hp(e[0],e[1],e[2])}get position(){const e=ae(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var t;e&&le(this._transform,3,[(t=e)[0],t[1],t[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||Ih.identity([]),e&&Yv(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Kv(e,t),Yv(this._transform,this._orientation)}forward(){const e=ae(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=ae(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=ae(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,t){const n=new Float64Array(16);return Ch.invert(n,this.getWorldToCamera(e,t)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,t,n){const i=this.position;Lh.scale(i,i,-e);const r=new Float64Array(16);return Ch.fromScaling(r,[n,n,n]),Ch.translate(r,r,i),r[10]*=t,r}getWorldToCamera(e,t){const n=new Float64Array(16),i=new Float64Array(4),r=this.position;return Ih.conjugate(i,this._orientation),Lh.scale(r,r,-e),Ch.fromQuat(n,i),Ch.translate(n,n,r),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=t,n[9]*=t,n[10]*=t,n[11]*=t,n}getCameraToClipPerspective(e,t,n,i){const r=new Float64Array(16);return Ch.perspective(r,e,t,n,i),r}getCameraToClipOrthographic(e,t,n,i,r,o){const s=new Float64Array(16);return Ch.ortho(s,e,t,n,i,r,o),s}getDistanceToElevation(e){const t=0===e?0:np(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]?rp(this.position[1]):this.position[1]),n=this.forward();return(t-this.position[2])/n[2]}clone(){return new Qv([...this.position],[...this.orientation])}}function ex(e,t){const n=nx(e.projection,e.zoom,e.width,e.height),i=function(e,t,n,i,r){const o=new Kd(n.lng-180*ix,n.lat),s=new Kd(n.lng+180*ix,n.lat),a=e.project(o.lng,o.lat),l=e.project(s.lng,s.lat),c=-Math.atan2(l.y-a.y,l.x-a.x),u=hp.fromLngLat(n);u.y=z(u.y,-1+ix,1-ix);const h=u.toLngLat(),d=e.project(h.lng,h.lat),p=hp.fromLngLat(h);p.x+=ix;const f=p.toLngLat(),m=e.project(f.lng,f.lat),g=ox(m.x-d.x,m.y-d.y,c),y=hp.fromLngLat(h);y.y+=ix;const _=y.toLngLat(),v=e.project(_.lng,_.lat),x=ox(v.x-d.x,v.y-d.y,c),b=Math.abs(g.x)/Math.abs(x.y),w=Ch.identity([]);Ch.rotateZ(w,w,-c*(1-(r?0:i)));const S=Ch.identity([]);return Ch.scale(S,S,[1,1-(1-b)*i,1]),S[4]=-x.x/x.y*i,Ch.rotateZ(S,S,c),Ch.multiply(S,w,S),S}(e.projection,0,e.center,n,t),r=tx(e);return Ch.scale(i,i,[r,r,1]),i}function tx(e){const t=e.projection,n=nx(e.projection,e.zoom,e.width,e.height),i=rx(t,e.center),r=rx(t,Kd.convert(t.center));return Math.pow(2,i*n+(1-n)*r)}function nx(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=e.range;if(!o)return 0;const s=Math.min(r,Math.max(n,i)),a=Math.log(s/1024)/Math.LN2;return R(o[0]+a,o[1]+a,t)}const ix=1/4e4;function rx(e,t){const n=z(t.lat,-sp,sp),i=new Kd(t.lng-180*ix,n),r=new Kd(t.lng+180*ix,n),o=e.project(i.lng,n),s=e.project(r.lng,n),a=hp.fromLngLat(i),l=hp.fromLngLat(r),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function ox(e,t,n){const i=Math.cos(n),r=Math.sin(n);return{x:e*i-t*r,y:e*r+t*i}}function sx(e,t,n){return t*(pi/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}const ax={unknown:0,flipRequired:1,flipNotRequired:2},lx=Math.tan(85*Math.PI/180);function cx(e,t,n,i,r,o,s){const a=Ch.create();if(n)if("globe"===o.name){const e=function(e,t){const{x:n,y:i}=e.point,r=zd(n,i,e.worldSize/e._pixelsPerMercatorPixel,0,0);return Ch.multiply(r,r,Pd(yd(t)))}(r,t);Ch.multiply(a,a,e)}else{const e=Th.invert([],s);a[0]=e[0],a[1]=e[1],a[4]=e[2],a[5]=e[3],i||Ch.rotateZ(a,a,r.angle)}else Ch.multiply(a,r.labelPlaneMatrix,e);return a}function ux(e,t,n,i,r,o,s){const a=cx(e,t,n,i,r,o,s);return"globe"===o.name&&n||(a[2]=a[6]=a[10]=a[14]=0),a}function hx(e,t,n,i,r,o,s){if(n){if("globe"===o.name){const a=cx(e,t,n,i,r,o,s);return Ch.invert(a,a),Ch.multiply(a,e,a),a}{const t=Ch.clone(e),n=Ch.identity([]);return n[0]=s[0],n[1]=s[1],n[4]=s[2],n[5]=s[3],Ch.multiply(t,t,n),i||Ch.rotateZ(t,t,-r.angle),t}}return r.glCoordMatrix}function dx(e,t,n,i){const r=[e,t,n,1];n?bh.transformMat4(r,r,i):Sx(r,r,i);const o=r[3];return r[0]/=o,r[1]/=o,r[2]/=o,r}function px(e,t){return Math.min(.5+e/t*.5,1.5)}function fx(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function mx(e,t,n,i,r,o,s,a,l,c){const u=n.transform,h=i?e.textSizeData:e.iconSizeData,d=_g(h,n.transform.zoom),p="globe"===u.projection.name,f=[256/n.width*2+1,256/n.height*2+1],m=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();let g=null;p&&(g=i?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const y=e.lineVertexArray,_=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=n.transform.width/n.transform.height;let x,w=!1;for(let S=0;S<_.length;S++){const i=_.get(S),{numGlyphs:p,writingMode:T}=i;if(T!==Cg.vertical||w||x===Cg.horizontal||(w=!0),x=T,(i.hidden||T===Cg.vertical)&&!w){wx(p,m);continue}w=!1;const E=new b(i.tileAnchorX,i.tileAnchorY);let{x:A,y:M,z:k}=u.projection.projectTilePoint(E.x,E.y,c.canonical);if(l){const[e,t,n]=l(E);A+=e,M+=t,k+=n}const C=[A,M,k,1];if(bh.transformMat4(C,C,t),!fx(C,f)){wx(p,m);continue}const P=C[3],I=px(n.transform.getCameraToCenterDistance(u.projection),P),D=yg(h,d,i),z=s?D/I:D*I,R=dx(A,M,k,r);if(R[3]<=0){wx(p,m);continue}let L={};const O=s?null:l,F=_x(i,z,!1,a,t,r,o,e.glyphOffsetArray,y,m,g,R,E,L,v,O,u.projection,c,s);w=F.useVertical,O&&F.needsFlipping&&(L={}),(F.notEnoughRoom||w||F.needsFlipping&&_x(i,z,!0,a,t,r,o,e.glyphOffsetArray,y,m,g,R,E,L,v,O,u.projection,c,s).notEnoughRoom)&&wx(p,m)}i?(e.text.dynamicLayoutVertexBuffer.updateData(m),g&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(g)):(e.icon.dynamicLayoutVertexBuffer.updateData(m),g&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(g))}function gx(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:y,segment:_}=a,v=y+a.numGlyphs,x=g+a.lineLength,b=t.getoffsetX(y),w=t.getoffsetX(v-1),S=bx(e*b,n,i,r,o,s,_,g,x,l,c,u,h,d,!0,p,f,m);if(!S)return null;const T=bx(e*w,n,i,r,o,s,_,g,x,l,c,u,h,d,!0,p,f,m);return T?{first:S,last:T}:null}function yx(e,t,n,i){return e===Cg.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:e===Cg.vertical?i>0?{needsFlipping:!0}:null:t!==ax.unknown&&function(e,t){return 0===e||Math.abs(t/e)>lx}(n,i)?t===ax.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function _x(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_){const v=t/24,x=e.lineOffsetX*v,w=e.lineOffsetY*v,{lineStartIndex:S,glyphStartIndex:T,numGlyphs:E,segment:A,writingMode:M,flipState:k}=e,C=S+e.lineLength,P=e=>{if(u){const[t,n,i]=e.up,r=c.length;f_(u,r+0,t,n,i),f_(u,r+1,t,n,i),f_(u,r+2,t,n,i),f_(u,r+3,t,n,i)}const[t,n,i]=e.point;m_(c,t,n,i,e.angle)};if(E>1){const t=gx(v,a,x,w,n,h,d,e,l,o,p,m,!1,g,y,_);if(!t)return{notEnoughRoom:!0};if(i&&!n){let[n,i,r]=t.first.point,[o,a,l]=t.last.point;[n,i]=dx(n,i,r,s),[o,a]=dx(o,a,l,s);const c=yx(M,k,(o-n)*f,a-i);if(e.flipState=c&&c.needsFlipping?ax.flipRequired:ax.flipNotRequired,c)return c}P(t.first);for(let e=T+1;e<T+E-1;e++){const t=bx(v*a.getoffsetX(e),x,w,n,h,d,A,S,C,l,o,p,m,!1,!1,g,y,_);if(!t)return c.length-=4*(e-T),{notEnoughRoom:!0};P(t)}P(t.last)}else{if(i&&!n){const t=dx(d.x,d.y,0,r),n=S+A+1,i=new b(l.getx(n),l.gety(n)),o=dx(i.x,i.y,0,r),s=o[3]>0?o:xx(d,i,t,1,r,void 0,g,y.canonical),a=yx(M,k,(s[0]-t[0])*f,s[1]-t[1]);if(e.flipState=a&&a.needsFlipping?ax.flipRequired:ax.flipNotRequired,a)return a}const t=bx(v*a.getoffsetX(T),x,w,n,h,d,A,S,C,l,o,p,m,!1,!1,g,y,_);if(!t)return{notEnoughRoom:!0};P(t)}return{}}function vx(e,t,n,i,r){const{x:o,y:s,z:a}=i.projectTilePoint(e.x,e.y,t);if(!r)return dx(o,s,a,n);const[l,c,u]=r(e);return dx(o+l,s+c,a+u,n)}function xx(e,t,n,i,r,o,s,a){const l=vx(e.sub(t)._unit()._add(e),a,r,s,o);return Lh.sub(l,n,l),Lh.normalize(l,l),Lh.scaleAndAdd(l,n,l,i)}function bx(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=i?e-t:e+t;let v=_>0?1:-1,x=0;i&&(v*=-1,x=Math.PI),v<0&&(x+=Math.PI);let w=a+s+(v>0?0:1)|0,S=r,T=r,E=0,A=0;const M=Math.abs(_),k=[],C=[];let P=o,I=P;const D=()=>xx(I,P,T,M-E+1,u,d,m,g.canonical);for(;E+A<=M;){if(w+=v,w<a||w>=l)return null;if(T=S,I=P,k.push(T),p&&C.push(I),P=new b(c.getx(w),c.gety(w)),S=h[w],!S){const e=vx(P,g.canonical,u,m,d);S=e[3]>0?h[w]=e:D()}E+=A,A=Lh.distance(T,S)}f&&d&&(h[w]&&(S=D(),A=Lh.distance(T,S)),h[w]=S);const z=(M-E)/A,R=P.sub(I)._mult(z)._add(I),L=Lh.sub([],S,T),O=Lh.scaleAndAdd([],T,L,z);let F=[0,0,1],B=L[0],N=L[1];if(y&&(F=m.upVector(g.canonical,R.x,R.y),0!==F[0]||0!==F[1]||1!==F[2])){const e=[F[2],0,-F[0]],t=Lh.cross([],F,e);Lh.normalize(e,e),Lh.normalize(t,t),B=Lh.dot(L,e),N=Lh.dot(L,t)}if(n){const e=Lh.cross([],F,L);Lh.normalize(e,e),Lh.scaleAndAdd(O,O,e,n*v)}const j=x+Math.atan2(N,B);return k.push(O),p&&C.push(R),{point:O,angle:j,path:k,tilePath:C,up:F}}function wx(e,t){const n=t.length,i=n+4*e;t.resize(i),t.float32.fill(-1/0,4*n,4*i)}function Sx(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const Tx=(e,t,n)=>(1-n)*e+n*t,Ex=e=>e*e*e*e*e;class Ax{constructor(e,t,n,i,r,o,s){this.tileSize=512,this._renderWorldCopies=void 0===r||r,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=null==n?0:n,this._maxPitch=null==i?60:i,this.setProjection(o),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new Kd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Xv,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Qv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new Ax(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return N(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const t=this.projection?this.getProjection():void 0;this.projection=r_(this.projectionOptions);const n=!w(t,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r_({name:"mercator"});const t=e!==this.projection.name;return t&&this._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return np(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new b(this.width,this.height)}get bearing(){return L(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const t=-e*Math.PI/180;this.angle!==t&&(this._unmodified=!1,this.angle=t,this._calcMatrices(),this.rotationMatrix=Th.create(),Th.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const t=z(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==t&&(this._unmodified=!1,this._pitch=t,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=E(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,t=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let i=0,r=0;for(let o=0;o<t.length;o++){const s=new b(t[o][0]*this.width,n+t[o][1]*(this.height-n)),a=e.pointCoordinate(s);if(!a)continue;const l=1/Math.hypot(a[0]-this._camera.position[0],a[1]-this._camera.position[1]);i+=a[3]*l,r+=l}return 0===r?NaN:i/r}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,i=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(i-n,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const t=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[t.x,t.y,t.z]:[e.x,e.y,e.z];const i=Lh.length(Lh.sub([],this._camera.position,n));return z(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let t=!1;if(e.orientation&&!Ih.exactEquals(e.orientation,this._camera.orientation)&&(t=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];Lh.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),t=!0)}t&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,t=new $v;return t.position=new hp(e[0],e[1],e[2]),t.orientation=this._camera.orientation,t._elevation=this.elevation,t._renderWorldCopies=this.renderWorldCopies,t}_setCameraOrientation(e){if(!Ih.length(e))return!1;Ih.normalize(e,e);const t=Lh.transformQuat([],[0,0,-1],e),n=Lh.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const i=Jv(t,n);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(e){const t=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;e[2]=z(e[2],i/n,i/t),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(e){const t=[new Zh(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new b(0,0)),i=this.pointCoordinate(new b(this.width,0)),r=this.pointCoordinate(new b(this.width,this.height)),o=this.pointCoordinate(new b(0,this.height)),s=Math.floor(Math.min(n.x,i.x,r.x,o.x)),a=Math.floor(Math.max(n.x,i.x,r.x,o.x)),l=1;for(let c=s-l;c<=a+l;c++)0!==c&&t.push(new Zh(c,e))}return t}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,t,n){let i=[];if(0===t[0]&&0===t[1])return i;for(const o of e){const e=o.canonical,n=o.overscaledZ,r=o.wrap,s=1<<e.z,a=e.x+1<s,l=e.x>0,c=e.y+1<s,u=e.y>0,h=o.wrap-(l?0:1),d=o.wrap+(a?0:1),p=l?e.x-1:s-1,f=a?e.x+1:0;t[0]<0?(i.push(new Hh(n,d,e.z,f,e.y)),t[1]<0&&c&&(i.push(new Hh(n,r,e.z,e.x,e.y+1)),i.push(new Hh(n,d,e.z,f,e.y+1))),t[1]>0&&u&&(i.push(new Hh(n,r,e.z,e.x,e.y-1)),i.push(new Hh(n,d,e.z,f,e.y-1)))):t[0]>0?(i.push(new Hh(n,h,e.z,p,e.y)),t[1]<0&&c&&(i.push(new Hh(n,r,e.z,e.x,e.y+1)),i.push(new Hh(n,h,e.z,p,e.y+1))),t[1]>0&&u&&(i.push(new Hh(n,r,e.z,e.x,e.y-1)),i.push(new Hh(n,h,e.z,p,e.y-1)))):t[1]<0&&c?i.push(new Hh(n,r,e.z,e.x,e.y+1)):u&&i.push(new Hh(n,r,e.z,e.x,e.y-1))}if(i.length>1){i.sort((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y);let e=0,t=0;for(;t<i.length;)i[t].equals(i[e])?++t:i[++e]=i[t++];i.length=e+1}const r=[];for(const o of i)i.some(e=>o.isChildOf(e))||r.push(o);return i=r.filter(t=>!e.some(e=>!!(t.overscaledZ<n&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))),i}coveringTiles(e){let t=this.coveringZoomLevel(e);const n=t,i=this.elevation&&this.elevation.exaggeration(),r=i&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&t<e.minzoom)return[];void 0!==e.maxzoom&&t>e.maxzoom&&(t=e.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<t,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=nd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*np(1,this.center.lat),m=this._camera.position[2]/np(1,this.center.lat),g=[l*p.x,l*p.y,m*(h?1:f)],y=u||i,_=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),v=this.isLODDisabled(!0)?t:0;let x;if(this._elevation&&e.isTerrainDEM)x=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();x=e?e.max:this._centerAltitude}else x=this._centerAltitude;const b=e.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?tx(this):1,S=e=>{const t=1/4e4,n=new hp(e.x+t,e.y,e.z),i=new hp(e.x,e.y+t,e.z),r=e.toLngLat(),o=n.toLngLat(),s=i.toLngLat(),a=this.locationCoordinate(r),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=Math.hypot(l.x-a.x,l.y-a.y),h=Math.hypot(c.x-a.x,c.y-a.y);return Math.sqrt(u*h)*w/t},T=e=>{const t=x,n=b;return{aabb:Ly(this,l,0,0,0,e,n,t,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:t,wrap:e,fullyVisible:!1}},E=[];let A=[];const k=t,C=e.reparseOverscaled?n:t,P=e=>e*e,I=P((m-this._centerAltitude)*f),D=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=z(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},z=e=>{if(e.zoom<v)return!0;if(e.zoom===k)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(g),i=e.aabb.distanceY(g);let o=I,s=1;if(u){o=P(e.aabb.distanceZ(g));const t=Math.pow(2,e.zoom),n=rp((e.y+1)/t),i=rp(e.y/t),r=Math.min(Math.max(a,n),i),l=Qd(r)/Qd(a);if(s=r===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,l/this._mercatorScaleRatio),this.zoom<=rd&&e.zoom===k-1&&l>=.9)return!0}else if(r&&(o=P(e.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&n<=5){const t=Math.pow(2,e.zoom),n=S(new hp((e.x+.5)/t,(e.y+.5)/t));s=n>.85?1:n}const l=t*t+i*i+o,c=P((1<<k-e.zoom)*_*s*((e,t)=>{if(t*P(.707)<e)return 1;const n=Math.sqrt(t/e);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,I),l));return l<c};if(this.renderWorldCopies)for(let M=1;M<=3;M++)E.push(T(-M)),E.push(T(M));for(E.push(T(0));E.length>0;){const n=E.pop(),i=n.x,s=n.y;let a=n.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!a){let e=y?n.aabb.intersects(d):n.aabb.intersectsFlat(d);if(0===e&&h()){const t=new Wh(n.zoom,i,s);e=bd(this,l,t,!0).intersects(d)}if(0===e)continue;a=2===e}if(n.zoom!==k&&z(n))for(let e=0;e<4;e++){const t=(i<<1)+e%2,c=(s<<1)+(e>>1),h={aabb:o?n.aabb.quadrant(e):Ly(this,l,n.zoom+1,t,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:t,y:c,wrap:n.wrap,fullyVisible:a,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!u&&(h.tileID=new Hh(n.zoom+1===k?C:n.zoom+1,n.wrap,n.zoom+1,t,c),D(h)),E.push(h)}else{const r=n.zoom===k?C:n.zoom;if(e.minzoom&&e.minzoom>r)continue;if(!a){let e=y?n.aabb.intersectsPrecise(d):n.aabb.intersectsPreciseFlat(d);if(0===e&&h()){const t=new Wh(n.zoom,i,s);e=bd(this,l,t,!0).intersectsPrecise(d)}if(0===e)continue}const o=c[0]-(.5+i+(n.wrap<<n.zoom))*(1<<t-n.zoom),u=c[1]-.5-s,p=n.tileID?n.tileID:new Hh(r,n.wrap,n.zoom,i,s);A.push({tileID:p,distanceSq:o*o+u*u})}}if(this.fogCullDistSq){const t=this.fogCullDistSq,n=this.horizonLineFromTop();A=A.filter(i=>{const r=[0,0,0,1],o=[pi,pi,0,1],s=this.calculateFogTileMatrix(i.tileID.toUnwrapped());bh.transformMat4(r,r,s),bh.transformMat4(o,o,s);const a=function(e,t){let n=0;for(let i=0;i<2;++i){const r=0;e[i]>r&&(n+=(e[i]-r)*(e[i]-r)),t[i]<r&&(n+=(r-t[i])*(r-t[i]))}return n}(bh.min([],r,o),bh.max([],r,o));if(0===a)return!0;let l=!1;const c=this._elevation;if(c&&a>t&&0!==n){const t=this.calculateProjMatrix(i.tileID.toUnwrapped());let r;e.isTerrainDEM||(r=c.getMinMaxForTile(i.tileID)),r||(r={min:b,max:x});const o=function(e){const t=Math.round((e+45+360)%360/90)%4;return M[t]}(this.rotation),s=[o[0]*pi,o[1]*pi,r.max];Lh.transformMat4(s,s,t),l=(1-s[1])*this.height*.5<n}return a<t||l})}return A.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const t=z(e.lat,-sp,sp),n=this.projection.project(e.lng,t);return new b(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/np(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,t){let n,i;const r=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(t.x-r.x)/e,i=(t.y-r.y)/e}else{const e=this.pointCoordinate(t),o=this.pointCoordinate(r);n=e.x-o.x,i=e.y-o.y}const o=this.locationCoordinate(e);this.setLocation(new hp(o.x-n,o.y-i))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,t){const n=t?np(t,e.lat):void 0,i=this.projection.project(e.lng,e.lat);return new hp(i.x,i.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,t){const n=null!=t?t:this._centerAltitude,i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];bh.transformMat4(i,i,this.pixelMatrixInverse),bh.transformMat4(r,r,this.pixelMatrixInverse);const o=r[3];bh.scale(i,i,1/i[3]),bh.scale(r,r,1/o);const s=i[2],a=r[2];return{p0:i,p1:r,t:s===a?0:(n-s)/(a-s)}}screenPointToMercatorRay(e){const t=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return bh.transformMat4(t,t,this.pixelMatrixInverse),bh.transformMat4(n,n,this.pixelMatrixInverse),bh.scale(t,t,1/t[3]),bh.scale(n,n,1/n[3]),t[2]=np(t[2],this._center.lat)*this.worldSize,n[2]=np(n[2],this._center.lat)*this.worldSize,bh.scale(t,t,1/this.worldSize),bh.scale(n,n,1/this.worldSize),new Kh([t[0],t[1],t[2]],Lh.normalize([],Lh.sub([],n,t)))}rayIntersectionCoordinate(e){const{p0:t,p1:n,t:i}=e,r=np(t[2],this._center.lat),o=np(n[2],this._center.lat);return new hp(tr(t[0],n[0],i)/this.worldSize,tr(t[1],n[1],i)/this.worldSize,tr(r,o,i))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let t=this.projection.pointCoordinate3D(this,e.x,e.y);if(t)return new hp(t[0],t[1],t[2]);let n=0,i=this.horizonLineFromTop();if(e.y>i)return this.pointCoordinate(e);const r=.02*i,o=e.clone();for(let s=0;s<10&&i-n>r;s++){o.y=tr(n,i,.66);const e=this.projection.pointCoordinate3D(this,o.x,o.y);e?(i=o.y,t=e):n=o.y}return t?new hp(t[0],t[1],t[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=od)return!this.isPointAboveHorizon(e);const t=this.pointCoordinate(e);return t.y>=0&&t.y<=1}_coordinatePoint(e,t){const n=t&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,i=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return bh.transformMat4(i,i,this.pixelMatrix),i[3]>0?new b(i[0]/i[3],i[1]/i[3]):new b(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:t}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,i=this.width-this._edgeInsets.right,r=this.pointLocation3D(new b(t,e)),o=this.pointLocation3D(new b(i,e)),s=this.pointLocation3D(new b(i,n)),a=this.pointLocation3D(new b(t,n));let l=Math.min(r.lng,o.lng,s.lng,a.lng),c=Math.max(r.lng,o.lng,s.lng,a.lng),u=Math.min(r.lat,o.lat,s.lat,a.lat),h=Math.max(r.lat,o.lat,s.lat,a.lat);const d=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,f=(e,t,n,i,r)=>{const o=(e+n)/2,s=(t+i)/2,a=new b(o,s),{lng:m,lat:g}=this.pointLocation3D(a),y=Math.max(0,l-m,u-g,m-c,g-h);l=Math.min(l,m),c=Math.max(c,m),u=Math.min(u,g),h=Math.max(h,g),(r<p||y>d)&&(f(e,t,o,s,r+1),f(o,s,n,i,r+1))};if(f(t,e,i,e,1),f(i,e,i,n,1),f(i,n,t,n,1),f(t,n,t,e,1),"globe"===this.projection.name){const[e,t]=function(e){const t=Ch.identity(new Float64Array(16));Ch.multiply(t,e.pixelMatrix,e.globeMatrix);const n=[0,ud,0],i=[0,hd,0];return Lh.transformMat4(n,n,t),Lh.transformMat4(i,i,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Ud(e,new Kd(e.center.lat,90)),i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Ud(e,new Kd(e.center.lat,-90))]}(this);e?(h=90,c=180,l=-180):t&&(u=-90,c=180,l=-180)}return new cc(new Kd(l,u),new Kd(c,h))}_getBoundsRectangular(e,t){const{top:n,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,s=new b(i,n),a=new b(o,n),l=new b(o,r),c=new b(i,r);let u=this.pointCoordinate(s,e),h=this.pointCoordinate(a,e);const d=this.pointCoordinate(l,t),p=this.pointCoordinate(c,t),f=(e,t)=>(t.y-e.y)/(t.x-e.x);return u.y>1&&h.y>=0?u=new hp((1-p.y)/f(p,u)+p.x,1):u.y<0&&h.y<=1&&(u=new hp(-p.y/f(p,u)+p.x,0)),h.y>1&&u.y>=0?h=new hp((1-d.y)/f(d,h)+d.x,1):h.y<0&&u.y<=1&&(h=new hp(-d.y/f(d,h)+d.x,0)),(new cc).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(d))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-sp,this.maxLat=sp,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=ep(this.minLng)*this.tileSize,this.worldMaxX=ep(this.maxLng)*this.tileSize,this.worldMinY=tp(this.maxLat)*this.tileSize,this.worldMaxY=tp(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(e){const t=e.key,n=this._distanceTileDataCache;if(n[t])return n[t];const i=e.canonical,r=1/this.height,o=this.cameraWorldSize,s=o/this.zoomScale(i.z),a=(i.x+Math.pow(2,i.z)*e.wrap)*s,l=i.y*s,c=this.point;c.x*=o/this.worldSize,c.y*=o/this.worldSize;const u=this.angle,h=Math.sin(-u),d=-Math.cos(-u);return n[t]={bearing:[h,d],center:[(c.x-a)*r,(c.y-l)*r],scale:s/pi*r},n[t]}calculateFogTileMatrix(e){const t=e.key,n=this._fogTileMatrixCache;if(n[t])return n[t];const i=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return Ch.multiply(i,this.worldToFogMatrix,i),n[t]=new Float32Array(i),n[t]}calculateProjMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.key;let r;if(r=n?this._expandedProjMatrixCache:t?this._alignedProjMatrixCache:this._projMatrixCache,r[i])return r[i];const o=this.calculatePosMatrix(e,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:t?this.alignedProjMatrix:this.projMatrix,Ch.multiply(o,s,o),r[i]=new Float32Array(o),r[i]}calculatePixelsToTileUnitsMatrix(e){const t=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[t])return n[t];const i=function(e,t){const{scale:n}=e.tileTransform,i=n*pi/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return Th.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[i,i])}(e,this);return n[t]=i,n[t]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,t=Ch.fromScaling([],[e,e,e]);return Ch.multiply(t,t,this.globeMatrix),t}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const t=np(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(t),i=this._camera.forward(),r=np(1,this._center.lat);n[2]/=r,i[2]/=r,Lh.normalize(i,i);const o=e.raycast(n,i,e.exaggeration());if(o){const e=Lh.scaleAndAdd([],n,i,o),t=new hp(e[0],e[1],np(e[2],rp(e[1]))),s=(t.z+Lh.length([t.x-n[0],t.y-n[1],t.z-n[2]*r]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=t.toAltitude(),this._center=this.coordinateLocation(t),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const t=this._elevation,n=np(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),r=t.getAtPointOrZero(new hp(...i)),o=this.pixelsPerMeter/this.worldSize*r,s=this._minimumHeightOverTerrain(),a=i[2]-o;if(a<=s)if(a<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),t=[i[0],i[1],e.z-i[2]],n=Lh.length(t);t[2]-=(s-a)/this._pixelsPerMercatorPixel;const r=Lh.length(t);if(0===r)return;Lh.scale(t,t,n/r*this._pixelsPerMercatorPixel),this._camera.position=[i[0],i[1],e.z*this._pixelsPerMercatorPixel-t[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const t=this.center;return t.lat=z(t.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(t.lng=z(t.lng,this.minLng,this.maxLng)),this.center=t,void(this._constraining=!1)}const t=this._unmodified,{x:n,y:i}=this.point;let r=0,o=n,s=i;const a=this.width/2,l=this.height/2,c=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(i-l<c&&(s=c+l),i+l>u&&(s=u-l),u-c<this.height&&(r=Math.max(r,this.height/(u-c)),s=(u+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;o=(n+i+this.worldSize)%this.worldSize-i,o-a<e&&(o=e+a),o+a>t&&(o=t-a),t-e<this.width&&(r=Math.max(r,this.width/(t-e)),o=(t+e)/2)}o===n&&s===i||(this.center=this.unproject(new b(o,s))),r&&(this.zoom+=this.scaleZoom(r)),this._constrainCamera(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,t="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=np(1,this.center.lat)/np(1,45));const i=nx(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,i),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r="meters"===this.projection.zAxisUnit?n:1,o=this._camera.getWorldToCamera(this.worldSize,r);let s;const a=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(a[8]=2*-e.x/this.width,a[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),n=t*this.aspect,i=-n,r=-t;n-=e.x,i-=e.x,t+=e.y,r+=e.y,s=this._camera.getCameraToClipOrthographic(i,n,r,t,this._nearZ,this._farZ),((e,t,n,i)=>{for(let r=0;r<16;r++)e[r]=Tx(t[r],n[r],i)})(s,s,a,Ex(this.pitch>=15?1:this.pitch/15))}else s=a;const l=Ch.mul([],a,o);let c=Ch.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),t=Ch.identity([]);Ch.translate(t,t,[e.x*this.worldSize,e.y*this.worldSize,0]),Ch.multiply(t,t,ex(this)),Ch.translate(t,t,[-e.x*this.worldSize,-e.y*this.worldSize,0]),Ch.multiply(c,c,t),Ch.multiply(l,l,t),this.inverseAdjustmentMatrix=function(e){const t=ex(e,!0);return Th.invert([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=Ch.scale([],c,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=c,this.invProjMatrix=Ch.invert(new Float64Array(16),this.projMatrix),t){const t=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);t[8]=2*-e.x/this.width,t[9]=2*e.y/this.height,this.expandedFarZProjMatrix=Ch.mul([],t,o)}else this.expandedFarZProjMatrix=this.projMatrix;const u=Ch.invert([],s);this.frustumCorners=Jh.fromInvProjectionMatrix(u,this.horizonLineFromTop(),this.height),this.cameraFrustum=nd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!t);const h=new Float32Array(16);Ch.identity(h),Ch.scale(h,h,[1,-1,1]),Ch.rotateX(h,h,this._pitch),Ch.rotateZ(h,h,this.angle);const d=Ch.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=Ch.clone(d);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;d[8]=2*-e.x/this.width,d[9]=2*(e.y+p)/this.height,this.skyboxMatrix=Ch.multiply(h,d,h);const f=this.point,m=f.x,g=f.y,y=this.width%2/2,_=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),b=m-Math.round(m)+v*y+x*_,w=g-Math.round(g)+v*_+x*y,S=new Float64Array(c);if(Ch.translate(S,S,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=S,c=Ch.create(),Ch.scale(c,c,[this.width/2,-this.height/2,1]),Ch.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=Ch.create(),Ch.scale(c,c,[1,-1,1]),Ch.translate(c,c,[-1,-1,0]),Ch.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=Ch.multiply(new Float64Array(16),this.labelPlaneMatrix,l),this._calcFogMatrices(),this._distanceTileDataCache={},c=Ch.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=c,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(e){const{x:t,y:n}=e.point,{lng:i,lat:r}=e._center;return zd(t,n,e.worldSize,i,r)}(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Lh.transformMat4(e,e,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=c;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,t=this.cameraPixelsPerMeter,n=this._camera.position,i=1/this.height/this._pixelsPerMercatorPixel,r=[e,e,t];Lh.scale(r,r,i),Lh.scale(n,n,-1),Lh.multiply(n,n,r);const o=Ch.create();Ch.translate(o,o,n),Ch.scale(o,o,r),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,t,i)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),i=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-n[0]*r,i.y/this.worldSize-n[1]*r,e/this.worldSize*this._centerAltitude-n[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const t=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],i=e[2];let r=1;this.projection.wrap&&(this.center=this.center.wrap()),i>0&&(r=Math.min((t-n)/i,1)),this._camera.position=Lh.scaleAndAdd([],this._camera.position,e,r),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,t=this._camera.forward(),{pitch:n,bearing:i}=this._camera.getPitchBearing(),r=np(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(E(this._maxPitch)),s=Math.max((e[2]-r)/Math.cos(n),o),a=this._zoomFromMercatorZ(s);Lh.scaleAndAdd(e,e,t,s),this._pitch=z(n,E(this.minPitch),E(this.maxPitch)),this.angle=L(i,-Math.PI,Math.PI),this._setZoom(z(a,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new hp(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let t=0,n=od,i=0,r=1/0;for(;n-t>1e-6&&n>t;){const o=t+.5*(n-t),s=this.tileSize*Math.pow(2,o),a=this.getCameraToCenterDistance(this.projection,o,s),l=this.scaleZoom(a/(e*this.tileSize)),c=Math.abs(o-l);c<r&&(r=c,i=o),o<l?t=o:n=o}return i}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(J("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,t){const n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.y,t.y);if(r<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new b(n,r),new b(i,o),new b(n,o),new b(i,r)],a=this.renderWorldCopies?-3:0,l=this.renderWorldCopies?4:1;for(const c of s){const e=this.pointRayIntersection(c);if(e.t<0)return!0;const t=this.rayIntersectionCoordinate(e);if(t.x<a||t.y<0||t.x>l||t.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+A(this.fovAboveCenter)>88||this.anyCornerOffEdge(new b(0,0),new b(this.width,this.height))}zoomDeltaToMovement(e,t){const n=Lh.length(Lh.sub([],this._camera.position,e)),i=this._zoomFromMercatorZ(n)+t;return n-this._mercatorZfromZoom(i)}getCameraPoint(){if("globe"===this.projection.name){const e=function(e,t){let[n,i,r]=e;const o=[n,i,r,1];bh.transformMat4(o,o,t);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new b(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new b(0,e))}}getCameraToCenterDistance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const i=nx(e,t,this.width,this.height,1024),r=e.pixelSpaceConversion(this.center.lat,n,i);let o=.5/Math.tan(.5*this._fov)*this.height*r;return this.isOrthographic&&(o=Tx(1,o,Ex(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&Ch.multiply(e,e,this.globeMatrix),e}getFrustum(e){return nd.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}function Mx(e,t,n){Ch.identity(e),Ch.rotateZ(e,e,E(t[2])),Ch.rotateX(e,e,E(t[0])),Ch.rotateY(e,e,E(t[1])),Ch.scale(e,e,n),Ch.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function kx(e,t,n,i,r,o,s,a){const l=[n[0]-t[0],n[1]-t[1],0],c=[i[0]-t[0],i[1]-t[1],0];if(Lh.length(l)<1e-12||Lh.length(c)<1e-12)return Ih.identity(e);const u=Lh.cross([],l,c);Lh.normalize(u,u),Lh.subtract(c,i,t),l[2]=(o-r)*a,c[2]=(s-r)*a;const h=l;return Lh.cross(h,l,c),Lh.normalize(h,h),Ih.rotationTo(e,u,h)}function Cx(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Ld(t.zoom),r=function(e,t,n){const i=t.worldSize,r=[e[12],e[13],e[14]],o=rp(r[1]/i),s=ip(r[0]/i),a=Ch.identity([]),l=np(1,o)*i,c=np(1,0)*i*lp(o,t.zoom),u=1/Id(i);let h=c*u;if(n){const e=nx(t.projection,t.zoom,t.width,t.height,1024);h=u*t.projection.pixelSpaceConversion(t.center.lat,i,e)}const d=Ed(o,s);Lh.add(d,d,Lh.scale([],Lh.normalize([],d),l*h*r[2]));const p=function(e){const t=[e[0],e[1],e[2]];let n=[0,1,0];const i=Lh.cross([],n,t);return Lh.cross(n,t,i),0===Lh.squaredLength(n)&&(n=[0,1,0],Lh.cross(i,t,n)),Lh.normalize(i,i),Lh.normalize(n,n),Lh.normalize(t,t),[i[0],i[1],i[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(d);Ch.scale(a,a,[h,h,h*l]),Ch.translate(a,a,[-r[0],-r[1],-r[2]]);const f=Ch.multiply([],t.globeMatrix,p);return Ch.multiply(f,f,a),Ch.multiply(f,f,e),f}(e,t,n);if(i>0){const n=function(e,t){const n=t.worldSize,i=np(1,0)*n*lp(t.center.lat,t.zoom)/Id(n),r=np(1,t.center.lat)*n,o=Ch.identity([]);return Ch.rotateY(o,o,E(t.center.lng)),Ch.rotateX(o,o,E(t.center.lat)),Ch.translate(o,o,[0,0,sd]),Ch.scale(o,o,[i,i,i*r]),Ch.translate(o,o,[t.point.x-.5*n,t.point.y-.5*n,0]),Ch.multiply(o,o,e),Ch.multiply(o,t.globeMatrix,o)}(e,t);return function(e,t,n){const i=(e,t,n)=>{const i=Lh.length(e),r=Lh.length(t),o=_d(e,t,n);return Lh.scale(o,o,1/Lh.length(o)*tr(i,r,n))},r=i([e[0],e[1],e[2]],[t[0],t[1],t[2]],n),o=i([e[4],e[5],e[6]],[t[4],t[5],t[6]],n),s=i([e[8],e[9],e[10]],[t[8],t[9],t[10]],n),a=_d([e[12],e[13],e[14]],[t[12],t[13],t[14]],n);return[r[0],r[1],r[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(r,n,i)}return r}const Px=64,Ix=[1,1,1];class Dx{constructor(e,t,n,i){this.id=e,this.position=null!=t?new Kd(t[0],t[1]):new Kd(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new id([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(Ch.multiply(e.matrix,t,e.matrix),e.meshes)for(const n of e.meshes){const t=id.applyTransform(n.aabb,e.matrix);this.aabb.encapsulate(t)}if(e.children)for(const n of e.children)this._applyTransformations(n,e.matrix)}computeBoundsAndApplyParent(){const e=Ch.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}_positionModelOnTerrain(e,t){const n=e.elevation;if(!n)return 0;const i=id.projectAabbCorners(this.aabb,this.matrix),r=np(1,this.position.lat)*e.worldSize,o=function(e,t){const n=[0,0,1],i=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const r of i){const i=e[r.corners[0]],o=e[r.corners[1]],s=e[r.corners[2]],a=[o[0]-i[0],o[1]-i[1],t*(o[2]-i[2])],l=Lh.cross(a,a,[s[0]-i[0],s[1]-i[1],t*(s[2]-i[2])]);Lh.normalize(l,l),r.dotProductWithUp=Lh.dot(l,n)}return i.sort((e,t)=>e.dotProductWithUp-t.dotProductWithUp),i[0].corners}(i,r),s=i[o[0]],a=i[o[1]],l=i[o[2]],c=i[o[3]],u=n.getAtPointOrZero(new hp(s[0]/e.worldSize,s[1]/e.worldSize),0),h=n.getAtPointOrZero(new hp(a[0]/e.worldSize,a[1]/e.worldSize),0),d=n.getAtPointOrZero(new hp(l[0]/e.worldSize,l[1]/e.worldSize),0),p=n.getAtPointOrZero(new hp(c[0]/e.worldSize,c[1]/e.worldSize),0),f=(u+p)/2,m=(h+d)/2;return f>m?h<d?kx(t,a,c,s,h,p,u,r):kx(t,l,s,c,d,u,p,r):u<p?kx(t,s,a,l,u,h,d,r):kx(t,c,l,a,p,d,h,r),Math.max(f,m)}computeModelMatrix(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=e.transform,l=a.zoom,c=a.project(this.position),u=lp(this.position.lat,l),h=1/u;Ch.identity(this.matrix),Ch.translate(this.matrix,this.matrix,[c.x+i[0]*h,c.y+i[1]*h,i[2]]);let d=1,p=1;const f=a.worldSize;if(s){if("mercator"===a.projection.name){let e=0;a.elevation&&(e=a.elevation.getAtPointOrZero(new hp(c.x/f,c.y/f),0));const t=bh.transformMat4([],[c.x,c.y,e,1],a.projMatrix)[3]/a.cameraToCenterDistance;d=t,p=t*lp(a.center.lat,l)}else if("globe"===a.projection.name){const e=Cx(this.matrix,a),t=Ch.multiply([],a.projMatrix,e),n=[0,0,0,1];bh.transformMat4(n,n,t);const i=n[3]/a.cameraToCenterDistance,r=Ld(l),o=a.projection.pixelsPerMeter(this.position.lat,f)*lp(this.position.lat,l),s=a.projection.pixelsPerMeter(a.center.lat,f)*lp(a.center.lat,l);d=i/tr(o,ap(a.center.lat),r),p=i*u/o,d*=s,p*=s}}else d=h;Ch.scale(this.matrix,this.matrix,[d,d,p]);const m=[...this.matrix],g=this.orientation,y=[];if(Mx(y,[g[0]+t[0],g[1]+t[1],g[2]+t[2]],n),Ch.multiply(this.matrix,m,y),r&&a.elevation){let e=0;const t=[];if(o&&a.elevation){e=this._positionModelOnTerrain(a,t);const n=Ch.fromQuat([],t),i=Ch.multiply([],n,y);Ch.multiply(this.matrix,m,i)}else e=a.elevation.getAtPointOrZero(new hp(c.x/f,c.y/f),0);0!==e&&(this.matrix[14]+=e)}}upload(e){if(!this.uploaded){for(const t of this.nodes)Lx(t,e);for(const e of this.nodes)Ox(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Fx(e)}}function zx(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new k_(t,e.image,n?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function Rx(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Vv.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,Wv.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,qv.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?Uv:Gv).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,Hv.members,!0)),e.segments=wl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&zx(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&zx(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&zx(i.normalTexture,t),i.occlusionTexture&&zx(i.occlusionTexture,t,n),i.emissionTexture&&zx(i.emissionTexture,t)}function Lx(e,t,n){if(e.meshes)for(const i of e.meshes)Rx(i,t,n);if(e.children)for(const i of e.children)Lx(i,t,n)}function Ox(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Ox(t)}function Fx(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)Fx(n)}class Bx{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Nx{constructor(){this.instancedDataArray=new sl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class jx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,n,i){this.tileToMeter=up(n);const r=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=xp(o,r);if(!this.layers[0]._featureFilter.filter(new la(this.zoom),e,n))continue;const c={id:s,sourceLayerIndex:l,index:a,geometry:r?e.geometry:vp(o,n,i),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,e);u&&t.featureIndex.insert(o,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length)}this.lookup=null}update(e,t,n,i){for(const r in this.instancesPerModel){const t=this.instancesPerModel[r];for(const n in e)t.idToFeaturesIndex.hasOwnProperty(n)&&this.evaluate(t.features[t.idToFeaturesIndex[n]],e[n],t,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];for(const t of n.features){const i=this.layers[0],r=t.feature,o=this.canonical,s=i.paint.get("model-rotation").evaluate(r,{},o),a=i.paint.get("model-scale").evaluate(r,{},o),l=i.paint.get("model-translation").evaluate(r,{},o);Lh.exactEquals(t.rotation,s)&&Lh.exactEquals(t.scale,a)&&Lh.exactEquals(t.translation,l)||(this.evaluate(t,t.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length<0||0===n.instancedDataArray.length||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,Zv.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}}addFeature(e,t,n){const i=this.layers[0],r=i.layout.get("model-id").evaluate(n,{},this.canonical);if(!r)return J("modelId is not evaluated for layer ".concat(i.id," and it is not going to get rendered.")),r;this.instancesPerModel[r]||(this.instancesPerModel[r]=new Nx);const o=this.instancesPerModel[r],s=o.instancedDataArray,a=new Bx(n,s.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=pi||e.y<0||e.y>=pi)continue;const t=(this.lookupDim-1)/pi,n=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[n])continue;this.lookup[n]=1}this.instanceCount++;const i=s.length;s.resize(i+1),o.instancesEvaluatedElevation.push(0),s.float32[16*i]=e.x,s.float32[16*i+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),r}evaluate(e,t,n,i){const r=this.layers[0],o=e.feature,s=this.canonical,a=e.rotation=r.paint.get("model-rotation").evaluate(o,t,s),l=e.scale=r.paint.get("model-scale").evaluate(o,t,s),c=e.translation=r.paint.get("model-translation").evaluate(o,t,s),u=r.paint.get("model-color").evaluate(o,t,s);u.a=r.paint.get("model-color-mix-intensity").evaluate(o,t,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Mx(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,r=16*t,o=n.instancedDataArray.float32;let a=0;i&&(a=o[r+6]-n.instancesEvaluatedElevation[t]);const l=0|o[r+1];o[r]=(0|o[r])+u.r/1.05,o[r+1]=l+u.g/1.05,o[r+2]=d,o[r+3]=1/(s.z>10?this.tileToMeter:up(s,l)),o[r+4]=c[0],o[r+5]=c[1],o[r+6]=c[2]+a,o[r+7]=h[0],o[r+8]=h[1],o[r+9]=h[2],o[r+10]=h[4],o[r+11]=h[5],o[r+12]=h[6],o[r+13]=h[8],o[r+14]=h[9],o[r+15]=h[10],n.instancesEvaluatedElevation[t]=c[2]}}}Os(jx,"ModelBucket",{omit:["layers"]}),Os(Nx,"PerModelAttributes"),Os(Bx,"ModelFeature");const Vx=new xa({visibility:new ya(Rt.layout_model.visibility),"model-id":new _a(Rt.layout_model["model-id"])});var Ux={paint:new xa({"model-opacity":new ya(Rt.paint_model["model-opacity"]),"model-rotation":new _a(Rt.paint_model["model-rotation"]),"model-scale":new _a(Rt.paint_model["model-scale"]),"model-translation":new _a(Rt.paint_model["model-translation"]),"model-color":new _a(Rt.paint_model["model-color"]),"model-color-mix-intensity":new _a(Rt.paint_model["model-color-mix-intensity"]),"model-type":new ya(Rt.paint_model["model-type"]),"model-cast-shadows":new ya(Rt.paint_model["model-cast-shadows"]),"model-receive-shadows":new ya(Rt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ya(Rt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new _a(Rt.paint_model["model-emissive-strength"]),"model-roughness":new _a(Rt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new _a(Rt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ya(Rt.paint_model["model-cutoff-fade-range"])}),layout:Vx};const Gx=new Float32Array(262144),qx=new Uint8Array(262144);function Wx(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,Wx(n));return t}const Zx=["","wall","door","roof","window","lamp","logo"];class Hx{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Wx(e)}}}}class Xx{constructor(e,t,n,i){this.nodes=e,this.id=t,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=i,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const n of t){const t=n.node;this.uploaded?this.updatePbrBuffer(t):Lx(t,e,!0)}for(const n of t)Ox(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),t=!0);return t}needsReEvaluation(e,t,n){const i=e.transform.projectionOptions,r=e.style.getBrightness(),o=this.brightness!==r;return!!(!this.uploaded||this.dirty||i.name!==this.projection.name||Yx(n.paint.get("model-color").value,o)||Yx(n.paint.get("model-color-mix-intensity").value,o)||Yx(n.paint.get("model-roughness").value,o)||Yx(n.paint.get("model-emissive-strength").value,o)||Yx(n.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=i,this.brightness=r,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),i=this.id.canonical;for(const r of n){const e=r.feature;r.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},i)}}evaluate(e){const t=this.getNodesInfo();for(const n of t){if(!n.node.meshes)continue;const t=n.feature,i=n.node.meshes&&n.node.meshes[0].featureData,r=n.evaluatedColor[2],o=n.evaluatedRMEA[2],s=this.id.canonical;if(n.hasTranslucentParts=!1,i){for(let i=0;i<Zx.length;i++){const r=Zx[i];r.length&&(t.properties.part=r);const o=e.paint.get("model-color").evaluate(t,{},s),a=e.paint.get("model-color-mix-intensity").evaluate(t,{},s);n.evaluatedColor[i]=[o.r,o.g,o.b,a],n.evaluatedRMEA[i][0]=e.paint.get("model-roughness").evaluate(t,{},s),n.evaluatedRMEA[i][2]=e.paint.get("model-emissive-strength").evaluate(t,{},s),n.evaluatedRMEA[i][3]=o.a,n.emissionHeightBasedParams[i]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},s),!n.hasTranslucentParts&&o.a<1&&(n.hasTranslucentParts=!0)}delete t.properties.part,Jx(n,r!==n.evaluatedColor[2]||o!==n.evaluatedRMEA[2])}n.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},s),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,n,i){const r=e.findDEMTileFor(n);if(r&&(r.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(r.dem&&r.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=r.tileID.overscaledZ;const t=tg.create(e,n,r);if(!t)return;4&this.modelTraits&&this.updateDEM(e,t,n,i);for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.vertices||!n.footprint.vertices.length)continue;const i=n.footprint.vertices;let r=t.getElevationAt(i[0].x,i[0].y,!0,!0);for(let e=1;e<i.length;e++)r=Math.min(r,t.getElevationAt(i[e].x,i[e].y,!0,!0));n.elevation=r}}this.terrainTile=r.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,n,i){let r=t._dem._modifiedForSources[i];if(void 0===r&&(t._dem._modifiedForSources[i]=[],r=t._dem._modifiedForSources[i]),r.includes(n.canonical))return;const o=t._dem.dim;r.push(n.canonical);let s=!1;for(const a of this.getNodesInfo()){const e=a.node;if(!e.footprint||!e.footprint.grid)continue;const n=e.footprint.grid,i=t.tileCoordToPixel(n.min.x,n.min.y),r=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(o-r.y,i.x),Math.min(i.y,o-r.x));if(l<0)continue;const c=z(l,2,5);let u=Math.max(0,i.x-c),h=Math.max(0,i.y-c),d=Math.min(r.x+c,o-1),p=Math.min(r.y+c,o-1);for(let t=h;t<=p;++t)for(let e=u;e<=d;++e)qx[t*o+e]=255;let f=0,m=0;for(let s=0;s<n.cellsY;++s)for(let e=0;e<n.cellsX;++e){if(!n.cells[s*n.cellsX+e])continue;const i=t.tileCoordToPixel(n.min.x+e/n.xScale,n.min.y+s/n.yScale),r=t.tileCoordToPixel(n.min.x+(e+1)/n.xScale,n.min.y+(s+1)/n.yScale);for(let e=i.y;e<=Math.min(r.y+1,o-1);++e)for(let n=i.x;n<=Math.min(r.x+1,o-1);++n)255===qx[e*o+n]&&(qx[e*o+n]=0,f+=t.getElevationAtPixel(n,e),m++)}const g=f/m;u=Math.max(1,i.x-c),h=Math.max(1,i.y-c),d=Math.min(r.x+c,o-2),p=Math.min(r.y+c,o-2),s=!0;for(let s=h;s<=p;++s)for(let e=u;e<=d;++e)0===qx[s*o+e]&&(Gx[s*o+e]=t._dem.set(e,s,g));for(let s=1;s<c;++s){u=Math.max(1,i.x-s),h=Math.max(1,i.y-s),d=Math.min(r.x+s,o-2),p=Math.min(r.y+s,o-2);for(let e=h;e<=p;++e)for(let n=u;n<=d;++n){const i=e*o+n;if(255===qx[i]){let r=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const c=(e+t)*o+n+i;if(qx[c]>=s)continue;const h=Gx[c],d=Math.abs(h);d>a&&(r=h,a=d,l=i,u=t)}if(a>.1){const o=1-(s+.5*Math.abs(l*u))/c;let a=t._dem.get(n,e)+r*o;const h=t._dem.get(n+l,e+u),d=t._dem.get(n-l,e-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),Gx[i]=t._dem.set(n,e,a),qx[i]=s}}}}}s&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=mt.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new Hx(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Fx(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const t of e)Ox(t.node),Fx(t.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped()),i=this.getNodesInfo();for(let r=0;r<this.nodesInfo.length;r++){const e=i[r].node;i[r].hiddenByReplacement=!!e.footprint&&!n.find(t=>t.footprint===e.footprint)}}getHeightAtTileCoord(e,t){const n=this.getNodesInfo(),i=[];for(let r=0;r<this.nodesInfo.length;r++){const o=n[r],s=o.node.meshes[0];if(e<s.aabb.min[0]||t<s.aabb.min[1]||e>s.aabb.max[0]||t>s.aabb.max[1])continue;const a=(e-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*Px|0,l=Math.min(63,(t-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*Px|0)*Px+Math.min(63,a);if(!(s.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:s.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new b(e,t),new b(e,t),i),i.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function Yx(e,t){return!e.isLightConstant&&t}function Kx(e,t,n,i,r,o,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;n[3]>0&&(l=tr(l,255*n[0],n[3]),c=tr(c,255*n[1],n[3]),u=tr(u,255*n[2],n[3]));const h=l<<8|c,d=u<<8|Math.floor(255*i[3]),p=function(e){const t=z(e,0,2);return Math.min(Math.round(.5*t*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],f=z(r[0],0,1),m=z(r[1],0,1),g=z(r[2],0,1),y=z(r[3],0,1);let _,v,x,b;if(f!==m&&s!==o&&m!==f){const e=s-o;v=1/(e*(m-f)),x=-(o+e*f)/(e*(m-f));const t=z(r[4],-1,1);b=Math.pow(10,t),_=255*g<<8|255*y}else _=65535,v=0,x=1,b=1;if(e.emplaceBack(h,d,p,_,v,x,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,p,_,v,x,b)}}function Jx(e,t){const n=e.node;let i=0;for(const r of n.meshes){if(n.lights&&n.lightMeshIndex===i)continue;if(!r.featureData)continue;r.featureArray=new al,r.featureArray.reserve(r.featureData.length);let o=t;for(const t of r.featureData){let i;const s=65535&t,a=(15&s)<8?15&s:0,l=t>>16&65535,c=e.evaluatedRMEA[a],u=e.evaluatedColor[a],h=e.emissionHeightBasedParams[a];if(o&&2===a&&n.lights&&(i=new al,i.resize(10*n.lights.length)),Kx(r.featureArray,l,u,c,h,r.aabb.min[2],r.aabb.max[2],i),i&&o){o=!1;const e=n.meshes[n.lightMeshIndex];e.featureArray=i,e.featureArray._trim()}}r.featureArray._trim(),i++}}Os(Xx,"Tiled3dModelBucket",{omit:["layers"]}),Os(Hx,"Tiled3dModelFeature");class $x{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=nb(new b(0,0),new b(pi,pi),e),n=[];for(const i of this._activeRegions){if(i.hiddenByOverlap)continue;if(!tb(t,i))continue;const r=ib(i.min,i.max,e);n.push({min:r.min,max:r.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId})}return n}setSources(e){this._setSources(e.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const n of e.cache.getVisibleCoordinates()){const i=e.cache.getTile(n).buckets[e.layer];if(i)for(const e of i.getNodesInfo()){const i=e.node;i.footprint&&t.push({footprint:i.footprint,id:n.toUnwrapped()})}}return t}})))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=nb(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,t)=>e.priority-t.priority||Qx(e.min,t.min)||Qx(e.max,t.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,n=0;for(;!e&&t!==this._activeRegions.length;){const i=this._activeRegions[t],r=this._prevRegions[n];e=i.priority!==r.priority||!eb(i,r),++t,++n}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const n=t[e].priority;for(;e<t.length&&t[e].priority===n;)++e;return e};if(this._sourceIds.length>1){let t=0,n=e(t);for(;t!==n;){let i=t;const r=t;for(;i!==n;){const e=this._activeRegions[i];e.hiddenByOverlap=!1;for(let t=0;t<r;t++){const n=this._activeRegions[t];if(!n.hiddenByOverlap&&tb(e,n)&&(e.hiddenByOverlap=ob(e.footprint,e.tileId,n.footprint,n.tileId),e.hiddenByOverlap))break}++i}t=n,n=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}}function Qx(e,t){return e.x-t.x||e.y-t.y}function eb(e,t){return 0===Qx(e.min,t.min)&&0===Qx(e.max,t.max)}function tb(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function nb(e,t,n){const i=1/pi,r=1/(1<<n.canonical.z),o=(t.x*i+n.canonical.x)*r+n.wrap,s=(t.y*i+n.canonical.y)*r;return{min:new b((e.x*i+n.canonical.x)*r+n.wrap,(e.y*i+n.canonical.y)*r),max:new b(o,s)}}function ib(e,t,n){const i=1<<n.canonical.z,r=((t.x-n.wrap)*i-n.canonical.x)*pi,o=(t.y*i-n.canonical.y)*pi;return{min:new b(((e.x-n.wrap)*i-n.canonical.x)*pi,(e.y*i-n.canonical.y)*pi),max:new b(r,o)}}function rb(e,t,n,i,r,o,s){const a=e.indices,l=e.vertices,c=[];for(let u=i;u<i+r;u+=3){const i=t[n[u+0]+o],r=t[n[u+1]+o],h=t[n[u+2]+o],d=Math.min(i.x,r.x,h.x),p=Math.max(i.x,r.x,h.x),f=Math.min(i.y,r.y,h.y),m=Math.max(i.y,r.y,h.y);c.length=0,e.grid.query(new b(d,f),new b(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(Fp(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],i,r,h,s))return!0}}return!1}function ob(e,t,n,i){if(!e||!n)return!1;let r=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(n.vertices.length<e.vertices.length)return ob(n,i,e,t);const o=t.canonical,s=i.canonical,a=Math.pow(2,s.z-o.z);r=e.vertices.map(e=>new b(e.x*o.x*pi*a-s.x*pi,e.y*o.y*pi*a-s.y*pi))}return rb(n,r,e.indices,0,e.indices.length,0,0)}const sb=pm.types,ab=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],lb=["fill-extrusion-flood-light-ground-radius"],cb=Math.pow(2,13),ub=Math.pow(2,15)-1,hb=new b(0,1),db=2147483648;function pb(e,t,n,i,r,o,s,a){e.emplaceBack((t<<1)+s,(n<<1)+o,(Math.floor(i*cb)<<1)+r,Math.round(a))}function fb(e,t,n,i,r,o){e.emplaceBack(t.x,t.y,(n.x<<1)+i,(n.y<<1)+r,o)}function mb(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class gb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class yb{constructor(){this.centroidXY=new b(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new b(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new b(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new b(this.max.x-this.min.x,this.max.y-this.min.y)}}class _b{constructor(){this.acc=new b(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,n){this.accCount++,this.acc._add(t);let i=!!this.borders;t.x<e.min.x?(e.min.x=t.x,i=!0):t.x>e.max.x&&(e.max.x=t.x,i=!0),t.y<e.min.y?(e.min.y=t.y,i=!0):t.y>e.max.y&&(e.max.y=t.y,i=!0),((0===t.x||t.x===pi)&&t.x===n.x)!=((0===t.y||t.y===pi)&&t.y===n.y)&&this.processBorderOverlap(t,n),i&&this.checkBorderIntersection(t,n)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,tr(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>pi!=e.x>pi&&this.addBorderIntersection(1,tr(t.y,e.y,(pi-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,tr(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>pi!=e.y>pi&&this.addBorderIntersection(3,tr(t.x,e.x,(pi-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){return 0===this.accCount?new b(0,0):new b(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0):0}}function vb(e,t){const n=e.add(t)._unit(),i=z(e.x*n.x+e.y*n.y,-1,1);var r,o,s;return r=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(r)))/4*ub*((o=e).x*(s=t).y-o.y*s.x<0?-1:1)}const xb=[e=>e.x<0,e=>e.x>pi,e=>e.y<0,e=>e.y>pi];function bb(e,t,n,i){const r=[4];if(0===i)return r;n._mult(i);const o=e.sub(n),s=t.sub(n),a=[e,t,o,s];for(let l=0;l<4;l++)for(const e of a)if(xb[l](e)){r.push(l);break}return r}class wb{constructor(e){this.vertexArray=new Oa,this.indexArray=new Ka,this.programConfigurations=new ic(e.layers,e.zoom,e=>lb.includes(e)),this._segments=new wl,this.hiddenByLandmarkVertexArray=new ll,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new wl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e.length;if(r>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*r,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],n=e[1];a=vb(t.sub(e[r-1])._perp()._unit(),n.sub(t)._perp()._unit())}for(let l=0;l<r;l++){const c=l===r-1?0:l+1,u=e[l],h=e[c],d=e[c===r-1?0:c+1],p=h.sub(u)._perp()._unit(),f=vb(p,d.sub(h)._perp()._unit()),m=a,g=f;if(Mb(u,h,t)||i&&kb(u,t)&&kb(h,t)){a=f;continue}const y=s.vertexLength;fb(this.vertexArray,u,h,1,1,m),fb(this.vertexArray,u,h,1,0,m),fb(this.vertexArray,u,h,0,1,g),fb(this.vertexArray,u,h,0,0,g),s.vertexLength+=4;const _=bb(u,h,p,n);for(const e of _)this._segmentToGroundQuads[o].push({id:y,region:e}),this._segmentToRegionTriCounts[o][e]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let n=0;n<t;n++)this._segmentToGroundQuads[n].sort((e,t)=>e.region-t.region);for(let n=0;n<t;n++){const t=this._segmentToGroundQuads[n],i=e[n],r=this._segmentToRegionTriCounts[n];r.reduce((e,t)=>e+t,0);let o=0;for(let e=0;e<=4;e++){const t=r[e];if(0!==t){let n=this.regionSegments[e];n||(n=this.regionSegments[e]=new wl);const r={vertexOffset:i.vertexOffset,primitiveOffset:i.primitiveOffset+o,vertexLength:i.vertexLength,primitiveLength:t};n.get().push(r)}o+=t}for(let e=0;e<t.length;e++){const n=t[e].id;this.indexArray.emplaceBack(n,n+1,n+3),this.indexArray.emplaceBack(n,n+3,n+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,n,i,r,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,n,i,r,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Yf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,n,i,r,o){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,n,i,r,o)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const n=e.flags&db?1:0;for(let i=e.groundVertexArrayOffset;i<t;++i)this.hiddenByLandmarkVertexArray.emplace(i,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Jf.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class Sb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ka,this.footprintVertices=new za,this.footprintSegments=[],this.layoutVertexArray=new La,this.centroidVertexArray=new vl,this.indexArray=new Ka,this.programConfigurations=new ic(e.layers,e.zoom,e=>ab.includes(e)),this.segments=new wl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new wb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,t,n,i){this.features=[],this.hasPattern=Gf("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=up(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:r,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=xp(r,e);if(!this.layers[0]._featureFilter.filter(new la(this.zoom),l,n))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:vp(r,n,i),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(qf("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,n,{},t.availableImages,i,t.brightness),t.featureIndex.insert(r,c.geometry,s,a,this.index,u)}this.sortBorders(),"globe"!==this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,n,i,r,o){for(const s of this.features){const{geometry:e}=s;this.addFeature(s,e,s.index,t,n,i,r,o)}this.sortBorders(),"globe"!==this.projection.name&&this.splitToSubtiles()}update(e,t,n,i,r){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,s,n,i,r),this.groundEffect.update(e,t,s,n,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,$f.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Kf.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new b(0,0),new b(pi,pi)],u=s.projection,h="globe"===u.name,d="Polygon"===sb[e.type],p=new _b;p.centroidDataIndex=this.centroidData.length;const f=new yb,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},i)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},i);f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Va);const y=Vf(t,500);for(let b=y.length-1;b>=0;b--){const e=y[b];(0===e.length||(_=e[0]).every(e=>e.x<=0)||_.every(e=>e.x>=pi)||_.every(e=>e.y<=0)||_.every(e=>e.y>=pi))&&y.splice(b,1)}var _;let v;if(h)v=Db(y,c,i);else{v=[];for(const e of y)v.push({polygon:e,bounds:c})}const x=d?this.edgeRadius:0,w=x>0&&this.zoom<17,S=(e,t)=>{if(0===e.length)return!1;const n=e[e.length-1];return t.x===n.x&&t.y===n.y};for(const{polygon:b,bounds:T}of v){let e=0,t=0;for(const i of b)d&&!i[0].equals(i[i.length-1])&&i.push(i[0]),t+=d?i.length-1:i.length;const n=this.segments.prepareSegment((d?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const r={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},o=new gb;if(o.vertexOffset=this.footprintVertices.length,o.indexOffset=3*this.footprintIndices.length,o.ringIndices=[],d){const t=[],r=[];e=n.vertexLength;for(let e=0;e<b.length;e++){const s=b[e];s.length&&0!==e&&r.push(t.length/2);const a=[];let c,d;c=s[1].sub(s[0])._perp()._unit(),o.ringIndices.push(s.length-1);for(let e=1;e<s.length;e++){const r=s[e],o=s[e===s.length-1?1:e+1],l=r.clone();if(x){d=o.sub(r)._perp()._unit();const e=c.add(d)._unit(),t=x*Math.min(4,1/(c.x*e.x+c.y*e.y));l.x+=t*e.x,l.y+=t*e.y,l.x=Math.round(l.x),l.y=Math.round(l.y),c=d}!m||0!==x&&!w||S(a,l)||a.push(l),pb(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),n.vertexLength++,this.footprintVertices.emplaceBack(r.x,r.y),t.push(r.x,r.y),h&&mb(this.layoutVertexExtArray,u.projectTilePoint(l.x,l.y,i),u.upVector(i,l.x,l.y))}m&&(0===x||w)&&(0!==a.length&&S(a,a[0])&&a.pop(),this.groundEffect.addData(a,T,l))}const s=jf(t,r);for(let i=0;i<s.length;i+=3)this.footprintIndices.emplaceBack(o.vertexOffset+s[i+0],o.vertexOffset+s[i+1],o.vertexOffset+s[i+2]),this.indexArray.emplaceBack(e+s[i],e+s[i+2],e+s[i+1]),n.primitiveLength++;o.indexCount+=s.length,o.vertexCount+=this.footprintVertices.length-o.vertexOffset}for(let s=0;s<b.length;s++){const t=b[s];p.startRing(f,t[0]);let r=t.length>4&&Cb(t[t.length-2],t[0],t[1]),o=x?Eb(t[t.length-2],t[0],t[1],x):0;const a=[];let c,g,y;g=t[1].sub(t[0])._perp()._unit();let _=!0;for(let s=1,l=0;s<t.length;s++){let d=t[s-1],v=t[s];const b=t[s===t.length-1?1:s+1];if(p.appendEdge(f,v,d),Mb(v,d,T)){x&&(g=b.sub(v)._perp()._unit(),_=!_);continue}const w=v.sub(d)._perp(),E=w.x/(Math.abs(w.x)+Math.abs(w.y)),A=w.y>0?1:0,M=d.dist(v);if(l+M>32768&&(l=0),x){y=b.sub(v)._perp()._unit();let e=Ab(d,v,b,Tb(g,y),x);isNaN(e)&&(e=0);const t=v.sub(d)._unit();d=d.add(t.mult(o))._round(),v=v.add(t.mult(-e))._round(),o=e,g=y,m&&this.zoom>=17&&(S(a,d)||a.push(d),S(a,v)||a.push(v))}const k=n.vertexLength,C=t.length>4&&Cb(d,v,b);let P=Pb(l,r,_);if(pb(this.layoutVertexArray,d.x,d.y,E,A,0,0,P),pb(this.layoutVertexArray,d.x,d.y,E,A,0,1,P),l+=M,P=Pb(l,C,!_),r=C,pb(this.layoutVertexArray,v.x,v.y,E,A,0,0,P),pb(this.layoutVertexArray,v.x,v.y,E,A,0,1,P),n.vertexLength+=4,this.indexArray.emplaceBack(k+0,k+1,k+2),this.indexArray.emplaceBack(k+1,k+3,k+2),n.primitiveLength+=2,x){const i=e+(1===s?t.length-2:s-2),r=1===s?e:i+1;if(this.indexArray.emplaceBack(k+1,i,k+3),this.indexArray.emplaceBack(i,r,k+3),n.primitiveLength+=2,void 0===c&&(c=k),!Mb(b,t[s],T)){const e=s===t.length-1?c:n.vertexLength;this.indexArray.emplaceBack(k+2,k+3,e),this.indexArray.emplaceBack(k+3,e+1,e),this.indexArray.emplaceBack(k+3,r,e+1),n.primitiveLength+=3}_=!_}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(d.x,d.y,i),n=u.projectTilePoint(v.x,v.y,i),r=u.upVector(i,d.x,d.y),o=u.upVector(i,v.x,v.y);mb(e,t,r),mb(e,t,r),mb(e,n,o),mb(e,n,o)}}d&&(e+=t.length-1),m&&x&&this.zoom>=17&&(0!==a.length&&S(a,a[0])&&a.pop(),this.groundEffect.addData(a,T,l,x>0))}this.footprintSegments.push(o),r.triangleCount=this.indexArray.length-r.triangleArrayOffset,this.polygonSegments.push(r),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?hb:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,a),this.groundEffect.addPaintPropertiesData(e,n,r,o,i,a),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let s=0;s<this.centroidData.length;s++){const t=this.centroidData[s],n=+(t.min.y+t.max.y>pi),i=2*n+(+(t.min.x+t.max.x>pi)^n);for(let r=0;r<t.polygonSegLen;r++){const n=t.polygonSegIdx+r;e.push({centroidIdx:s,subtile:i,polygonSegmentIdx:n,triangleSegmentIdx:this.polygonSegments[n].triangleSegIdx})}}const t=new Ka;e.sort((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx);let n=0,i=0,r=0;for(const s of e){if(s.triangleSegmentIdx!==n)break;r++}const o=e.length;for(;i!==e.length;){n=e[i].triangleSegmentIdx;let s=0,a=i,l=i;for(let t=a;t<r&&e[t].subtile===s;t++)l++;for(;a!==r;){const i=e[a];s=i.subtile;const o=this.centroidData[i.centroidIdx].min.clone(),c=this.centroidData[i.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let n=a;n<l;n++){const i=e[n],r=this.polygonSegments[i.polygonSegmentIdx],s=this.centroidData[i.centroidIdx].min,a=this.centroidData[i.centroidIdx].max,l=this.indexArray.uint16;for(let e=r.triangleArrayOffset;e<r.triangleArrayOffset+r.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=r.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let t=a;t<r&&e[t].subtile===e[a].subtile;t++)l++}i=r;for(let t=i;t<o&&e[t].triangleSegmentIdx===e[i].triangleSegmentIdx;t++)r++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,n){let i=0,r=0;const o=1<<e.canonical.z;if(t){const n=t.getMinMaxForTile(e);n&&(i=n.min,r=n.max)}r+=this.maxHeight;const s=e.toUnwrapped();let a;const l=[s.canonical.x/o+s.wrap,s.canonical.y/o],c=[(s.canonical.x+1)/o+s.wrap,(s.canonical.y+1)/o],u=new wl,h=(e,t,n)=>[e[0]*(1-n[0])+t[0]*n[0],e[1]*(1-n[1])+t[1]*n[1]],d=[],p=[];for(const f of this.triangleSubSegments){d[0]=f.min.x/pi,d[1]=f.min.y/pi,p[0]=f.max.x/pi,p[1]=f.max.y/pi;const e=h(l,c,d),t=h(l,c,p);if(0===new id([e[0],e[1],i],[t[0],t[1],r]).intersectsPrecise(n)){a&&(u.segments.push(a),a=void 0);continue}const o=f.segment;a&&a.vertexOffset!==o.vertexOffset&&(u.segments.push(a),a=void 0),a?(a.vertexLength+=o.vertexLength,a.primitiveLength+=o.primitiveLength):a={vertexOffset:o.vertexOffset,primitiveLength:o.primitiveLength,vertexLength:o.vertexLength,primitiveOffset:o.primitiveOffset,sortKey:void 0,vaos:{}}}return a&&u.segments.push(a),u}encodeCentroid(e,t){const n=e.centroid(),i=t.span(),r=Math.min(7,Math.round(i.x*this.tileToMeter/10)),o=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new b(z(n.x,1,pi-1)<<3|r,z(n.y,1,pi-1)<<3|o)}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=db,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,i=e.flags&db?hb:e.centroidXY,r=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==i.y||r!==i.x){for(let e=t;e<n;++e)this.centroidVertexArray.emplace(e,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].sourceId!==t[n].sourceId||!eb(e[n],t[n]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const r of this.centroidData)r.flags&=2147483647;const i=[];for(const r of this.activeReplacements){const t=Math.pow(2,r.footprintTileId.canonical.z-e.canonical.z);for(const n of this.centroidData)if(!(n.flags&db||r.min.x>n.max.x||n.min.x>r.max.x||r.min.y>n.max.y||n.min.y>r.max.y))for(let o=0;o<n.footprintSegLen;o++){const s=this.footprintSegments[n.footprintSegIdx+o];if(i.length=0,zb(this.footprintVertices,s.vertexOffset,s.vertexCount,r.footprintTileId.canonical,e.canonical,i),rb(r.footprint,i,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-t)){n.flags|=db;break}}}for(const r of this.centroidData)this.writeCentroidToBuffer(r);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,n){let i=!1;for(let r=0;r<n.footprintSegLen;r++){const o=this.footprintSegments[n.footprintSegIdx+r];let s=0;for(const n of o.ringIndices){for(let r=s,a=n+s-1;r<n+s;a=r++){const n=this.footprintVertices.int16[2*(r+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(r+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>t!=l>t&&e<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-n)*(t-s)/(l-s)+n&&(i=!i)}s=n}}return i}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,i=!0;const r=4*(e+pi)*pi+(t+pi);if(this.partLookup.hasOwnProperty(r)){const e=this.partLookup[r];return e?{height:e.height,hidden:!!(e.flags&db)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||this.footprintContainsPoint(e,t,o)&&o&&o.height>n&&(n=o.height,this.partLookup[r]=o,i=!!(o.flags&db));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:i};this.partLookup[r]=void 0}}function Tb(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function Eb(e,t,n,i){const r=t.sub(e)._perp()._unit(),o=n.sub(t)._perp()._unit();return Ab(e,t,n,Tb(r,o),i)}function Ab(e,t,n,i,r){const o=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(n)/3,r*o/i)}function Mb(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function kb(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function Cb(e,t,n){if(e.x<0||e.x>=pi||t.x<0||t.x>=pi||n.x<0||n.x>=pi)return!1;const i=n.sub(t),r=i.perp(),o=e.sub(t);return(i.x*o.x+i.y*o.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function Pb(e,t,n){const i=t?2|e:-3&e;return n?1|i:-2&i}function Ib(){const e=Math.PI/32,t=Math.tan(e),n=Hd;return n*Math.sqrt(1+2*t*t)-n}function Db(e,t,n){const i=1<<n.z,r=ip(n.x/i),o=ip((n.x+1)/i),s=rp(n.y/i),a=rp((n.y+1)/i);return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;const s=[];if(!e.length||!n||!i)return s;const a=(e,t)=>{for(const n of e)s.push({polygon:n,bounds:t})},l=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(i)),u=l-c,h=[];for(let f=0;f<Math.abs(u);f++)h.push(u>0?0:1);for(let f=0;f<Math.min(l,c);f++)h.push(0),h.push(1);let d=e;if(d=fm(d,t[0].y-r,t[1].y+r,1),d=fm(d,t[0].x-r,t[1].x+r,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):a(d,t);p.length;){const e=p.pop(),t=e.depth,n=h[t],i=e.bounds[0],s=e.bounds[1],l=0===n?i.x:i.y,c=0===n?s.x:s.y,u=o?o(n,l,c):.5*(l+c),d=fm(e.polygons,l-r,u+r,n),f=fm(e.polygons,u-r,c+r,n);if(d.length){const e=[i,new b(0===n?u:s.x,1===n?u:s.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(f.length){const e=[new b(0===n?u:i.x,1===n?u:i.y),s];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):a(f,e)}}return s}(e,t,Math.ceil((o-r)/11.25),Math.ceil((s-a)/11.25),1,(e,t,r)=>{if(0===e)return.5*(t+r);{const e=rp((n.y+t/pi)/i);return(tp(.5*(rp((n.y+r/pi)/i)+e))*i-n.y)*pi}})}function zb(e,t,n,i,r,o){const s=Math.pow(2,i.z-r.z);for(let a=0;a<n;a++){let n=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];n=(n+r.x*pi)*s-i.x*pi,l=(l+r.y*pi)*s-i.y*pi,o.push(new b(n,l))}}Os(Sb,"FillExtrusionBucket",{omit:["layers","features"]}),Os(yb,"PartData"),Os(gb,"FootprintSegment"),Os(_b,"BorderCentroidData"),Os(wb,"GroundEffect");const Rb=new xa({visibility:new ya(Rt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ya(Rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Lb={paint:new xa({"fill-extrusion-opacity":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _a(Rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _a(Rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _a(Rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _a(Rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new _a(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new _a(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ya(Rt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Rb};class Ob extends b{constructor(e,t,n){super(e,t),this.z=n}}function Fb(e,t){return e.x*t.x+e.y*t.y}function Bb(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=r.sub(i),l=o.sub(i),c=s.sub(i),u=Fb(a,a),h=Fb(a,l),d=Fb(l,l),p=Fb(c,a),f=Fb(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=i.z*(1-g-y)+r.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function Nb(e,t,n,i,r,o,s,a){const l=s*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,n){const i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*i),s=10*(t[1]-8*r),a=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(i,r),d=2*c+1,p=2*u+1,f=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),y=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),_=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*y/p);return a+Math.max(_*o,v*s)}(r,o,a):l;return{base:l+(0===n)?-1:n,top:c?Math.max(u+i,l+n+2):l+i}}const jb=new xa({"line-cap":new _a(Rt.layout_line["line-cap"]),"line-join":new _a(Rt.layout_line["line-join"]),"line-miter-limit":new ya(Rt.layout_line["line-miter-limit"]),"line-round-limit":new ya(Rt.layout_line["line-round-limit"]),"line-sort-key":new _a(Rt.layout_line["line-sort-key"]),visibility:new ya(Rt.layout_line.visibility)});var Vb={paint:new xa({"line-opacity":new _a(Rt.paint_line["line-opacity"]),"line-color":new _a(Rt.paint_line["line-color"]),"line-translate":new ya(Rt.paint_line["line-translate"]),"line-translate-anchor":new ya(Rt.paint_line["line-translate-anchor"]),"line-width":new _a(Rt.paint_line["line-width"]),"line-gap-width":new _a(Rt.paint_line["line-gap-width"]),"line-offset":new _a(Rt.paint_line["line-offset"]),"line-blur":new _a(Rt.paint_line["line-blur"]),"line-dasharray":new _a(Rt.paint_line["line-dasharray"]),"line-pattern":new _a(Rt.paint_line["line-pattern"]),"line-gradient":new va(Rt.paint_line["line-gradient"]),"line-trim-offset":new ya(Rt.paint_line["line-trim-offset"]),"line-emissive-strength":new ya(Rt.paint_line["line-emissive-strength"]),"line-border-width":new _a(Rt.paint_line["line-border-width"]),"line-border-color":new _a(Rt.paint_line["line-border-color"])}),layout:jb};const Ub=(e,t,n,i,r,o,s)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Wb(e,t,n,i),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:Hb(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:qb(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:n.paint.get("line-emissive-strength")}},Gb=(e,t,n,i,r)=>{const o=e.transform;return{u_matrix:Wb(e,t,n,i),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:qb(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function qb(e,t){return 1/sx(e,1,t.tileZoom)}function Wb(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Zb=e=>{const t=[];Hb(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Hb(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Xb=new class extends _a{possiblyEvaluate(e,t){return t=new la(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=B({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(Vb.paint.properties["line-width"].specification);function Yb(e,t){return t>0?t+2*e:e}Xb.useIntegerZoom=!0;const Kb=new xa({visibility:new ya(Rt.layout_background.visibility)});var Jb={paint:new xa({"background-color":new ya(Rt.paint_background["background-color"]),"background-pattern":new ya(Rt.paint_background["background-pattern"]),"background-opacity":new ya(Rt.paint_background["background-opacity"]),"background-emissive-strength":new ya(Rt.paint_background["background-emissive-strength"])}),layout:Kb};const $b=new xa({visibility:new ya(Rt.layout_raster.visibility)});var Qb={paint:new xa({"raster-opacity":new ya(Rt.paint_raster["raster-opacity"]),"raster-color":new va(Rt.paint_raster["raster-color"]),"raster-color-mix":new ya(Rt.paint_raster["raster-color-mix"]),"raster-color-range":new ya(Rt.paint_raster["raster-color-range"]),"raster-hue-rotate":new ya(Rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ya(Rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ya(Rt.paint_raster["raster-brightness-max"]),"raster-saturation":new ya(Rt.paint_raster["raster-saturation"]),"raster-contrast":new ya(Rt.paint_raster["raster-contrast"]),"raster-resampling":new ya(Rt.paint_raster["raster-resampling"]),"raster-fade-duration":new ya(Rt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ya(Rt.paint_raster["raster-emissive-strength"]),"raster-array-band":new ya(Rt.paint_raster["raster-array-band"]),"raster-elevation":new ya(Rt.paint_raster["raster-elevation"])}),layout:$b};function ew(e,t,n,i,r,o,s,a){const l=[e,n,r,t,i,o,1,1,1],c=[s,a,1],u=Mh.adjoint([],l),[h,d,p]=Lh.transformMat3(c,c,Mh.transpose(u,u));return Mh.multiply(l,[h,0,0,0,d,0,0,0,p],l)}class tw extends zt{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=t,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new It("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ie(this.map._requestManager.transformRequest(this.url,be.Image),(n,i)=>{if(this._imageRequest=null,this._loaded=!0,n)this.fire(new Dt(n));else if(i){const{HTMLImageElement:n}=t;this.image=i instanceof n?mt.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new C_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new It("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof C_||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],n=e[0][1];for(const r of e)r[1]>n&&(n=r[1]),r[1]<t&&(t=r[1]);const i=(n+t)/2;if(i>sp?this.onNorthPole=!0:i<-sp&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(hp.fromLngLat);this.tileID=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const l of e)t=Math.min(t,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),r=Math.max(r,l.y);const o=Math.max(i-t,r-n),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);return new Wh(s,Math.floor((t+i)/2*a),Math.floor((n+r)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new It("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const a in this.tiles){const e=this.tiles[a];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray)return;const t=Ry(this.tileID,this.map.transform.projection),[n,i,r,o]=this.coordinates.map(e=>{const n=t.projection.project(e[0],e[1]);return Oy(t,n)._round()});this.perspectiveTransform=function(e,t,n,i,r,o,s,a,l,c){const u=ew(0,0,e,0,0,t,e,t),h=ew(n,i,r,o,s,a,l,c);return Mh.multiply(h,Mh.adjoint(u,u),h),[h[6]/h[8]*e/pi,h[7]/h[8]*t/pi]}(this.width,this.height,n.x,n.y,i.x,i.y,o.x,o.y,r.x,r.y);const s=this._boundsArray=new La;s.emplaceBack(n.x,n.y,0,0),s.emplaceBack(i.x,i.y,pi,0),s.emplaceBack(o.x,o.y,0,pi),s.emplaceBack(r.x,r.y,pi,pi),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(s,F_.members),this.boundsSegments=wl.simpleSegment(0,0,4,2)}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,n=t.gl;!this._dirty||this.texture instanceof C_||(this.texture?this.texture.update(this.image):(this.texture=new k_(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class nw extends Aa{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const iw=new xa({visibility:new ya(Rt.layout_sky.visibility)});var rw={paint:new xa({"sky-type":new ya(Rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ya(Rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ya(Rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ya(Rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ya(Rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new va(Rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ya(Rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ya(Rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ya(Rt.paint_sky["sky-opacity"])}),layout:iw};function ow(e,t,n){const i=[0,0,1],r=Ih.identity([]);return Ih.rotateY(r,r,n?-E(e)+Math.PI:E(e)),Ih.rotateX(r,r,-E(t)),Lh.transformQuat(i,i,r),Lh.normalize(i,i)}var sw={paint:new xa({})};const aw={circle:class extends Aa{constructor(e,t){super(e,Gp,t)}createBucket(e){return new Sp(e)}queryRadius(e){const t=e;return Bp("circle-radius",this,t)+Bp("circle-stroke-width",this,t)+Np(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=Vp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Hp(e,i,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const n=Zp(this);return{config:new nc(this,t),defines:n,overrideFog:!1}}},heatmap:class extends Aa{createBucket(e){return new $p(e)}constructor(e,t){super(e,af,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Bp("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,n);return Hp(e,i,o,s,a,!0,!0,new b(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new nc(this,t),overrideFog:!1}:{}}},hillshade:class extends Aa{constructor(e,t){super(e,uf,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends Aa{constructor(e,t){super(e,Hf,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t){return{config:new nc(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Wf(e)}queryRadius(){return Np(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,o){return!e.queryGeometry.isAboveHorizon&&Ap(jp(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Aa{constructor(e,t){super(e,Lb,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Sb(e)}queryRadius(){return Np(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,i,r,o,s,a,l){const c=Vp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),d=[0,0],p=a&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,m=e.tile.getBucket(this);if(p&&m instanceof Sb){const e=m.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(i=Db([i],[new b(0,0),new b(pi,pi)],e.tileID.canonical).map(e=>e.polygon).flat());const g=p?a:null,[y,_]=function(e,t,n,i,r,o,s,a,l,c,u){return"globe"===e.projection.name?function(e,t,n,i,r,o,s,a,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(e,t,n,i)=>{e[0]=t,e[1]=n,e[2]=i,e[3]=1},y=Ib();n>0&&(n+=y),i+=y;for(const _ of t){const t=[],y=[];for(const h of _){const d=h.x+r.x,_=h.y+r.y,v=e.projection.projectTilePoint(d,_,u),x=e.projection.upVector(u,h.x,h.y);let b=n,w=i;if(s){const e=Nb(d,_,n,i,s,a,l,c);b+=e.base,w+=e.top}0!==n?g(f,v.x+x[0]*p*b,v.y+x[1]*p*b,v.z+x[2]*p*b):g(f,v.x,v.y,v.z),g(m,v.x+x[0]*p*w,v.y+x[1]*p*w,v.z+x[2]*p*w),Lh.transformMat4(f,f,o),Lh.transformMat4(m,m,o),t.push(new Ob(f[0],f[1],f[2])),y.push(new Ob(m[0],m[1],m[2]))}h.push(t),d.push(y)}return[h,d]}(e,t,n,i,r,o,s,a,l,c,u):s?function(e,t,n,i,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+i.x,d=c.y+i.y,f=Nb(u,d,t,n,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,bh.transformMat4(h,h,r),h[3]=Math.max(h[3],1e-5);const m=new Ob(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,bh.transformMat4(h,h,r),h[3]=Math.max(h[3],1e-5);const g=new Ob(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(m),p.push(g)}c.push(e),u.push(p)}return[c,u]}(t,n,i,r,o,s,a,l,c):function(e,t,n,i,r){const o=[],s=[],a=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*n,d=r[9]*n,p=r[10]*n,f=r[11]*n;for(const m of e){const e=[],t=[];for(const n of m){const o=n.x+i.x,s=n.y+i.y,m=r[0]*o+r[4]*s+r[12],g=r[1]*o+r[5]*s+r[13],y=r[2]*o+r[6]*s+r[14],_=r[3]*o+r[7]*s+r[15],v=m+a,x=g+l,b=y+c,w=Math.max(_+u,1e-5),S=m+h,T=g+d,E=y+p,A=Math.max(_+f,1e-5);e.push(new Ob(v/w,x/w,b/w)),t.push(new Ob(S/A,T/A,E/A))}o.push(e),s.push(t)}return[o,s]}(t,n,i,r,o)}(o,i,h,u,c,s,g,d,f,o.center.lat,e.tileID.canonical),v=e.queryGeometry;return function(e,t,n){let i=1/0;Ap(n,t)&&(i=Bb(n,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];Tp(n,r)&&(i=Math.min(i,Bb(n,r)))}}return i!==1/0&&i}(y,_,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends Aa{constructor(e,t){super(e,Vb,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof er,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Xb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new M_(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const n=Zb(this);return{config:new nc(this,t),defines:n,overrideFog:!1}}queryRadius(e){const t=e,n=Yb(Bp("line-width",this,t),Bp("line-gap-width",this,t)),i=Bp("line-offset",this,t);return n/2+Math.abs(i)+Np(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,r,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=jp(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Yb(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(i=function(e,t){const n=[],i=new b(0,0);for(let r=0;r<e.length;r++){const o=e[r],s=[];for(let e=0;e<o.length;e++){const n=o[e],r=o[e+1],a=0===e?i:n.sub(o[e-1])._unit()._perp(),l=e===o.length-1?i:r.sub(n)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(n))}n.push(s)}return n}(i,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(zp(e,r[t]))return!0;if(Mp(e,r,n))return!0}return!1}(s,i,a)}isTileClipped(){return!0}},symbol:l_,background:class extends Aa{constructor(e,t){super(e,Jb,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends Aa{constructor(e,t){super(e,Qb,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof tw)||!e._source.onNorthPole&&!e._source.onSouthPole&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=lf({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Aa{constructor(e,t){super(e,rw,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,o=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&J("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?ow(o.azimuthal,90-o.polar,t):ow(n[0],90-n[1],t)}const n=this.paint.get("sky-gradient-center");return ow(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Aa{constructor(e,t){super(e,sw)}},model:class extends Aa{constructor(e,t){super(e,Ux,t)}createBucket(e){return new jx(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof Co}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function lw(e,t){return"custom"===e.type?new nw(e):new aw[e.type](e,t)}function cw(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class uw extends zt{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new rf({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:n}of this.requestors)this._notify(e,t,n);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,n){this._validate(e,n)&&(this.images[t][e]=n)}_validate(e,t){let n=!0;return this._validateStretch(t.stretchX,t.data&&t.data.width)||(this.fire(new Dt(new Error('Image "'.concat(e,'" has invalid "stretchX" value')))),n=!1),this._validateStretch(t.stretchY,t.data&&t.data.height)||(this.fire(new Dt(new Error('Image "'.concat(e,'" has invalid "stretchY" value')))),n=!1),this._validateContent(t.content,t)||(this.fire(new Dt(new Error('Image "'.concat(e,'" has invalid "content" value')))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,n){n.version=this.images[t][e].version+1,this.images[t][e]=n,this.updatedImages[t][e]=!0}removeImage(e,t){const n=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,n){let i=!0;const r=!!this.loaded[t];if(!r)for(const o of e)this.images[t][o]||(i=!1);r||i?this._notify(e,t,n):this.requestors.push({ids:e,scope:t,callback:n})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,t,n){const i={};for(const r of e){this.images[t][r]||this.fire(new It("styleimagemissing",{id:r}));const e=this.images[t][r];e?i[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:J('Image "'.concat(r,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}n(null,i)}getPixelSize(e){const{width:t,height:n}=this.atlasImage[e];return{width:t,height:n}}getPattern(e,t){const n=this.patterns[t][e],i=this.getImage(e,t);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new ny(n,i);this.patterns[t][e]={bin:n,position:r}}return this._updatePatternAtlas(t),this.patterns[t][e].position}bind(e,t){const n=e.gl;let i=this.atlasTexture[t];i?this.dirty&&(i.update(this.atlasImage[t]),this.dirty=!1):(i=new k_(e,this.atlasImage[t],n.RGBA),this.atlasTexture[t]=i),i.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const t=[];for(const o in this.patterns[e])t.push(this.patterns[e][o].bin);const{w:n,h:i}=ey(t),r=this.atlasImage[e];r.resize({width:n||1,height:i||1});for(const o in this.patterns[e]){const{bin:t}=this.patterns[e][o],n=t.x+1,i=t.y+1,s=this.images[e][o].data,a=s.width,l=s.height;rf.copy(s,r,{x:0,y:0},{x:n,y:i},{width:a,height:l}),rf.copy(s,r,{x:0,y:l-1},{x:n,y:i-1},{width:a,height:1}),rf.copy(s,r,{x:0,y:0},{x:n,y:i+l},{width:a,height:1}),rf.copy(s,r,{x:a-1,y:0},{x:n-1,y:i},{width:1,height:l}),rf.copy(s,r,{x:0,y:0},{x:n+a,y:i},{width:1,height:l})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const n of e){if(this.callbackDispatchedThisFrame[t][n])continue;this.callbackDispatchedThisFrame[t][n]=!0;const e=this.images[t][n];cw(e)&&this.updateImage(n,t,e)}}}const hw=new xa({anchor:new ya(Rt.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return ee(e.expression.evaluate(t))}interpolate(e,t,n){return{x:tr(e.x,t.x,n),y:tr(e.y,t.y,n),z:tr(e.z,t.z,n),azimuthal:tr(e.azimuthal,t.azimuthal,n),polar:tr(e.polar,t.polar,n)}}}(Rt.light.position),color:new ya(Rt.light.color),intensity:new ya(Rt.light.intensity)});class dw extends zt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new ha(hw),this.setLight(e,t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(xs,e,n)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,n){return(!n||!1!==n.validate)&&Ps(this,e.call(_s,B({value:t,style:{glyphs:!0,sprite:!0},styleSpec:Rt})))}}const pw=new xa({source:new ya(Rt.terrain.source),exaggeration:new ya(Rt.terrain.exaggeration)});let fw=class extends zt{constructor(e,t,n,i){super(),this.scope=n,this._transitionable=new ha(pw,i),this._transitionable.setTransitionOrValue(e,i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new la(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Co}};const mw=45,gw=65,yw=.05;function _w(e,t,n,i){const r=R(mw,gw,n),[o,s]=vw(e,i);let a=1-Math.min(1,Math.exp((t-o)/(s-o)*-6));return a*=a*a,a=Math.min(1,1.00747*a),a*r*e.alpha}function vw(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function xw(e,t,n,i,r){const o=Lh.transformMat4([],[t,n,i],r.mercatorFogMatrix);return _w(e,Lh.length(o),r.pitch,r._fov)}function bw(e,t,n,i,r,o,s){const a=[[n,i,0],[r,i,0],[r,o,0],[n,o,0]];let l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(const u of a){const e=Lh.transformMat4([],u,t),n=Lh.length(e);l=Math.min(l,n),c=Math.max(c,n)}return[_w(e,l,s.pitch,s._fov),_w(e,c,s.pitch,s._fov)]}const ww=new xa({range:new ya(Rt.fog.range),color:new ya(Rt.fog.color),"high-color":new ya(Rt.fog["high-color"]),"space-color":new ya(Rt.fog["space-color"]),"horizon-blend":new ya(Rt.fog["horizon-blend"]),"star-intensity":new ya(Rt.fog["star-intensity"]),"vertical-range":new ya(Rt.fog["vertical-range"])});class Sw extends zt{constructor(e,t){super(),this._transitionable=new ha(ww),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=t}get state(){const e=this._transform,t="globe"===e.projection.name,n=Ld(e.zoom),i=this.properties.get("range"),r=[.5,3];return{range:t?[tr(r[0],i[0],n),tr(r[1],i[1],n)]:i,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._validate(Ss,e,t))return;const n=B({},e);for(const i of Object.keys(Rt.fog))void 0===n[i]&&(n[i]=Rt.fog[i].default);this._transitionable.setTransitionOrValue(n)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const t=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:R(mw,gw,e))*t.a}getOpacityAtLatLng(e,t){return this._transform.projection.supportsFog?function(e,t,n){const i=hp.fromLngLat(t),r=n.elevation?n.elevation.getAtPointOrZero(i):0;return xw(e,i.x,i.y,r,n)}(this.state,e,t):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const t=this._transform.calculateFogTileMatrix(e.toUnwrapped());return bw(this.state,t,0,0,pi,pi,this._transform)}getOpacityForBounds(e,t,n,i,r){return this._transform.projection.supportsFog?bw(this.state,e,t,n,i,r,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?vw(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const t=[4,5,6,7];for(const n of t){const t=e.points[n];let i;if(t[2]>=0)i=t;else{const r=e.points[n-4];i=nr(r,t,r[2]/(r[2]-t[2]))}if(xw(this.state,i[0],i[1],0,this._transform)>=yw)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,n){return(!n||!1!==n.validate)&&Ps(this,e.call(_s,B({value:t,style:{glyphs:!0,sprite:!0},styleSpec:Rt})))}}class Tw{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ew{constructor(){this.tasks={},this.taskQueue=[],W(["process"],this),this.invoker=new Tw(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function(e){let{type:t,isSymbolTile:n,zoom:i}=e;return i=i||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-i:"maybePrepare"===t&&n?400-i:500:200-i:100-i}(t);if(0===i){ne();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){ne();try{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class Aw{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},W(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Ew}send(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:Ns(t,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||ne()){const e=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,t),e&&e.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(js(t.error)):n(null,js(t.data)))}else{const n=new Set,i=t.hasCallback?(t,i)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Ns(t):null,data:Ns(i,n)},n)}:e=>{},r=js(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,i);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source,r.scope)[e[1]](r,i)}else i(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Mw{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=V();const n=this.workerPool.acquire(this.id);for(let i=0;i<n.length;i++){const e=new Mw.Actor(n[i],t,this.id);e.name="Worker ".concat(i),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,t,n){O(this.actors,(n,i)=>{n.send(e,t,i)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Mw.Actor=Aw;class kw extends zt{constructor(e,t,n,i){super(),this.scope=n,this._options=e,this.properties=new ga(t),this._transitionable=new ha(t,new Map(i)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const Cw=new xa({color:new ya(Rt.properties_light_ambient.color),intensity:new ya(Rt.properties_light_ambient.intensity)}),Pw=new xa({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,n]=e;const i=ee([1,t,n]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:tr(e.x,t.x,n),y:tr(e.y,t.y,n),z:tr(e.z,t.z,n)}}}(Rt.properties_light_directional.direction),color:new ya(Rt.properties_light_directional.color),intensity:new ya(Rt.properties_light_directional.intensity),"cast-shadows":new ya(Rt.properties_light_directional["cast-shadows"]),"shadow-intensity":new ya(Rt.properties_light_directional["shadow-intensity"])});class Iw{constructor(e,t,n,i){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,i)}static createFromScreenPoints(e,t){let n,i;if(e instanceof b||"number"==typeof e[0]){const r=b.convert(e);n=[r],i=t.isPointAboveHorizon(r)}else{const r=b.convert(e[0]),o=b.convert(e[1]);n=[r,o],i=P(r,o).every(e=>t.isPointAboveHorizon(e))}return new Iw(n,t.getCameraPoint(),i,t)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return P(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const t=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new b(1,1)):this.screenBounds[1],i=P(t,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>t.x&&this.cameraPoint.x<n.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?i[2]=this.cameraPoint:this.cameraPoint.x<=t.x&&(i[3]=this.cameraPoint)),function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=L(i-1,-1,e.length-1),o=L(i+1,-1,e.length-1),s=e[i],a=e[o],l=e[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(s.add(h))}return n}(i,e)}bufferedCameraGeometryGlobe(e){const t=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new b(1,1)):this.screenBounds[1],i=P(t,n,e),r=this.cameraPoint.clone();switch(3*((r.y>t.y)+(r.y>n.y))+((r.x>t.x)+(r.x>n.x))){case 0:i[0]=r,i[4]=r.clone();break;case 1:i.splice(1,0,r);break;case 2:i[1]=r;break;case 3:i.splice(4,0,r);break;case 5:i.splice(2,0,r);break;case 6:i[3]=r;break;case 7:i.splice(3,0,r);break;case 8:i[2]=r}return i}containsTile(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=e.queryPadding/t._pixelsPerMercatorPixel+1,o=n?this._bufferedCameraMercator(r,t):this._bufferedScreenMercator(r,t);let s=e.tileID.wrap+(o.unwrapped?i:0);const a=o.polygon.map(t=>Oy(e.tileTransform,t,s));if(!Rp(a,0,0,pi,pi))return;s=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?i:0);const l=this.screenGeometryMercator.polygon.map(t=>Fy(e.tileTransform,t,s)),c=l.map(e=>new b(e[0],e[1])),u=t.getFreeCameraOptions().position||new hp(0,0,0),h=Fy(e.tileTransform,u,s),d=l.map(e=>{const t=Lh.sub(e,e,h);return Lh.normalize(t,t),new Kh(h,t)}),p=sx(e,1,t.zoom)*t._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:d,bufferedTilespaceGeometry:a,bufferedTilespaceBounds:(f=C(a),f.min.x=z(f.min.x,0,pi),f.min.y=z(f.min.y,0,pi),f.max.x=z(f.max.x,0,pi),f.max.y=z(f.max.y,0,pi),f),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:p};var f}_bufferedScreenMercator(e,t){const n=Rw(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(e,t){const n=Rw(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[n]=i,i}}_projectAndResample(e,t){const n=function(e,t){const n=Ch.multiply([],t.pixelMatrix,t.globeMatrix),i=[0,-sd,0,1],r=[0,sd,0,1],o=[0,0,0,1];bh.transformMat4(i,i,n),bh.transformMat4(r,r,n),bh.transformMat4(o,o,n);const s=new b(i[0]/i[3],i[1]/i[3]),a=new b(r[0]/r[3],r[1]/r[3]),l=zp(e,s)&&i[3]<o[3],c=zp(e,a)&&r[3]<o[3];if(!l&&!c)return null;const u=function(e,t,n){for(let i=1;i<e.length;i++){const r=zw(t.pointCoordinate3D(e[i-1]).x),o=zw(t.pointCoordinate3D(e[i]).x);if(n<0){if(r<o)return{idx:i,t:-r/(o-1-r)}}else if(o<r)return{idx:i,t:(1-r)/(o+1-r)}}return null}(e,t,l?-1:1);if(!u)return null;const{idx:h,t:d}=u;let p=h>1?Dw(e.slice(0,h),t):[],f=h<e.length?Dw(e.slice(h),t):[];p=p.map(e=>new b(zw(e.x),e.y)),f=f.map(e=>new b(zw(e.x),e.y));const m=[...p];0===m.length&&m.push(f[f.length-1]);const g=tr(m[m.length-1].y,(0===f.length?p[0]:f[0]).y,d);let y;return y=l?[new b(0,g),new b(0,0),new b(1,0),new b(1,g)]:[new b(1,g),new b(1,1),new b(0,1),new b(0,g)],m.push(...y),0===f.length?m.push(p[0]):m.push(...f),{polygon:m.map(e=>new hp(e.x,e.y)),unwrapped:!1}}(e,t);if(n)return n;const i=function(e,t){let n=!1,i=-1/0,r=0;for(let s=0;s<e.length-1;s++)e[s].x>i&&(i=e[s].x,r=s);for(let s=0;s<e.length-1;s++){const t=(r+s)%(e.length-1),i=e[t],o=e[t+1];Math.abs(i.x-o.x)>.5&&(i.x<o.x?(i.x+=1,0===t&&(e[e.length-1].x+=1)):(o.x+=1,t+1===e.length-1&&(e[0].x+=1)),n=!0)}const o=ep(t.center.lng);return n&&o<Math.abs(o-1)&&e.forEach(e=>{e.x-=1}),{polygon:e,unwrapped:n}}(Dw(e,t).map(e=>new b(zw(e.x),e.y)),t);return{polygon:i.polygon.map(e=>new hp(e.x,e.y)),unwrapped:i.unwrapped}}}function Dw(e,t){return pp(e,e=>{const n=t.pointCoordinate3D(e);e.x=n.x,e.y=n.y},1/256)}function zw(e){return e<0?1+e%1:e%1}function Rw(e){return 100*e|0}function Lw(e,t,n,i,r){const o=function(n,i){if(n)return r(n);if(i){e.url&&i.tiles&&e.tiles&&delete e.tiles;const n=N(B(i,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);i.vector_layers&&(n.vectorLayers=i.vector_layers,n.vectorLayerIds=n.vectorLayers.map(e=>e.id)),n.tiles=t.canonicalizeTileset(n,e.url),r(null,n)}};return e.url?Ee(t.transformRequest(t.normalizeSourceURL(e.url,null,n,i),be.Source),o):mt.frame(()=>o(null,e))}class Ow{constructor(e,t,n){this.bounds=cc.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const t=Math.pow(2,e.z),n=Math.floor(ep(this.bounds.getWest())*t),i=Math.floor(tp(this.bounds.getNorth())*t),r=Math.ceil(ep(this.bounds.getEast())*t),o=Math.ceil(tp(this.bounds.getSouth())*t);return e.x>=n&&e.x<r&&e.y>=i&&e.y<o}}class Fw{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new nf({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=G(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;i.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let l=1;l<e.length;l++){s=!s;const t=e[l];r=a*n,a+=t,o=a*n,i.push({left:r,right:o,isDash:s,zeroLength:0===t})}return i}addRoundDash(e,t,n){const i=t/2;for(let r=-n;r<=n;r++){const t=this.width*(this.nextRow+n+r);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(s.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.image.data[t+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let a=e.length-1;a>=0;--a){const t=e[a],n=e[a+1];t.zeroLength?e.splice(a,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(a,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const n=Math.abs(a-s.left),i=Math.abs(a-s.right),l=Math.min(n,i);this.image.data[r+a]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,r=i?7:0,o=2*r+1;if(this.nextRow+o>this.height)return J("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let c=0;c<e.length;c++)e[c]<0&&(J("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),s+=e[c];if(0!==s){const n=this.width/s,o=this.getDashRanges(e,this.width,n);i?this.addRoundDash(o,n,r):this.addRegularDash(o,"square"===t?.5*n:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[n]=l,l}}Os(Fw,"LineAtlas");const Bw=1*ay;class Nw{constructor(e){const t={},n=[];for(const s in e){const i=e[s],r=t[s]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const o=t.metrics.localGlyph?Bw:1,s={x:0,y:0,w:t.bitmap.width+2*o,h:t.bitmap.height+2*o};n.push(s),r[e]=s}}const{w:i,h:r}=ey(n),o=new nf({width:i||1,height:r||1});for(const s in e){const n=e[s];for(const e in n.glyphs){const i=n.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const r=t[s][e],a=i.metrics.localGlyph?Bw:1;nf.copy(i.bitmap,o,{x:0,y:0},{x:r.x+a,y:r.y+a},i.bitmap)}}this.image=o,this.positions=t}}Os(Nw,"GlyphAtlas");class jw{constructor(e){this.tileID=new Hh(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ry(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,t,n,i,r){this.status="parsing",this.data=e,this.collisionBoxArray=new ul;const o=new mm(Object.keys(e.layers).sort()),s=new ng(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Fw(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n,brightness:this.brightness},u=t.familiesBySource[this.source];for(const y in u){const t=e.layers[y];if(!t)continue;let i=!1,r=!1,l=!1;for(const e of u[y])"symbol"===e[0].type?i=!0:r=!0,e[0].is3D()&&"model"!==e[0].type&&(l=!0);if(this.extraShadowCaster&&!l)continue;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!r)continue;1===t.version&&J('Vector tile source "'.concat(this.source,'" layer "').concat(y,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const h=o.encode(y),d=[];for(let e=0;e<t.length;e++){const n=t.feature(e),i=s.getId(n,y);d.push({feature:n,id:i,index:e,sourceLayerIndex:h})}for(const e of u[y]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Vw(e,this.zoom,c.brightness,n),(a[t.id]=t.createBucket({index:s.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,projection:this.projection.spec})).populate(d,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(e.map(e=>e.id))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=()=>{if(h)return this.status="done",r(h);if(this.extraShadowCaster)this.status="done",r(null,{buckets:F(a).filter(e=>!e.isEmpty()),featureIndex:s,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:c.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(d&&p&&f){const e=new Nw(d),t=new iy(p,f);for(const i in a){const r=a[i];r instanceof x_?(Vw(r.layers,this.zoom,c.brightness,n),Sy(r,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):r.hasPattern&&(r instanceof M_||r instanceof Wf||r instanceof Sb)&&(Vw(r.layers,this.zoom,c.brightness,n),r.addFeatures(c,this.tileID.canonical,t.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",r(null,{buckets:F(a).filter(e=>!e.isEmpty()),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,brightness:c.brightness})}};if(!this.extraShadowCaster){const e=H(c.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(e).length?i.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},(e,t)=>{h||(h=e,d=t,g())},void 0,!1,m):d={};const t=Object.keys(c.iconDependencies);t.length?i.send("getImages",{icons:t,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,t)=>{h||(h=e,p=t,g())},void 0,!1,m):p={};const n=Object.keys(c.patternDependencies);n.length?i.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,t)=>{h||(h=e,f=t,g())},void 0,!1,m):f={}}g()}}function Vw(e,t,n,i){const r=new la(t,{brightness:n});for(const o of e)o.recalculate(r,i)}class Uw{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,n]=r.result;return this.scheduler?this.scheduler.add(()=>{i(e,n)},t):i(e,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n((n,i)=>{r.result=[n,i];for(const e of r.callbacks)this.scheduler?this.scheduler.add(()=>{e(n,i)},t):e(n,i);setTimeout(()=>delete this.entries[e],3e3)})),()=>{r.result||(r.callbacks=r.callbacks.filter(e=>e!==i),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function Gw(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},t=>{const i=Ae(e.request,(e,i,r,o)=>{e?t(e):i&&t(null,{vectorTile:n?void 0:new dm(new Bm(i)),rawData:i,cacheControl:r,expires:o})});return()=>{i.cancel(),t()}},t)}class qw extends zt{constructor(e,t,n,i){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,B(this,N(t,["url","scheme","tileSize","promoteId"])),this._options=B({type:"vector"},t),this._collectResourceTiming=!!t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new Uw}load(e){this._loaded=!1,this.fire(new It("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Lw(this._options,this.map._requestManager,t,n,(i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?(t&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(t)),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new Dt(i))):r&&(B(this,r),r.bounds&&(this.tileBounds=new Ow(r.bounds,this.minzoom,this.maxzoom)),Ze(r.tiles,this.map._requestManager._customAccessToken),this.fire(new It("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new It("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Sa(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return B({},this._options)}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,be.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:mt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=t:e.request=e.actor.send("reloadTile",i,r.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",i,r.bind(this),void 0,!0);else{const t=Gw.call({deduped:this._deduped},i,(t,n)=>{t||!n?r.call(this,t):(i.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},e.actor&&e.actor.send("loadTile",i,r.bind(this),void 0,!0))},!0);e.request={cancel:t}}function r(n,i){return delete e.request,e.aborted?t(null):n&&404!==n.status?t(n):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),xe(this.dispatcher),t(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ww extends zt{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=B({type:"raster"},t),B(this,N(t,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new It("dataloading",{dataType:"source"})),this._tileJSONRequest=Lw(this._options,this.map._requestManager,null,null,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new Dt(t)):n&&(B(this,n),n.bounds&&(this.tileBounds=new Ow(n.bounds,this.minzoom,this.maxzoom)),Ze(n.tiles),this.fire(new It("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new It("data",{dataType:"source",sourceDataType:"content"}))),e&&e(t)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Sa(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return B({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const n=mt.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=Ie(this.map._requestManager.transformRequest(i,be.Tile),(n,i,r,o)=>(delete e.request,e.aborted?(e.state="unloaded",t(null)):n?(e.state="errored",t(n)):i?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:r,expires:o}),e.setTexture(i,this.map.painter),e.state="loaded",xe(this.dispatcher),void t(null)):t(null)))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&e.texture instanceof k_?(e.destroy(!0),e.texture&&e.texture instanceof k_&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Zw(){return null!=wk.workerClass?new wk.workerClass:new t.Worker(wk.workerUrl)}const Hw="mapboxgl_preloaded_worker_pool";class Xw{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Xw.workerCount;)this.workers.push(new Zw);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Hw]}numActive(){return Object.keys(this.active).length}}let Yw;function Kw(){return Yw||(Yw=new Xw),Yw}Xw.workerCount=2;let Jw,$w,Qw,eS=null;function tS(){return ne()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:$w||a.DRACO_URL}const nS=5123,iS=5126,rS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[nS]:Uint16Array,5125:Uint32Array,[iS]:Float32Array},oS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[nS]:"DT_UINT16",5125:"DT_UINT32",[iS]:"DT_FLOAT32"},sS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function aS(e,t,n){const i=n.json.bufferViews.length,r=n.buffers.length;t.bufferView=i,n.json.bufferViews[i]={buffer:r,byteLength:e.byteLength},n.buffers[r]=e}const lS="KHR_draco_mesh_compression";function cS(e,t){const n=e.extensions&&e.extensions[lS];if(!n)return;const i=new Qw.Decoder,r=fS(t,n.bufferView),o=new Qw.Mesh;if(!i.DecodeArrayToMesh(r,r.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=rS[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=Qw._malloc(l);a===Uint16Array?i.GetTrianglesUInt16Array(o,l,c):i.GetTrianglesUInt32Array(o,l,c),aS(Qw.memory.buffer.slice(c,c+l),s,t),Qw._free(c);for(const u of Object.keys(n.attributes)){const r=i.GetAttributeByUniqueId(o,n.attributes[u]),s=t.json.accessors[e.attributes[u]],a=oS[s.componentType],l=s.count*sS[s.type]*rS[s.componentType].BYTES_PER_ELEMENT,c=Qw._malloc(l);i.GetAttributeDataArrayForAllPoints(o,r,Qw[a],l,c),aS(Qw.memory.buffer.slice(c,c+l),s,t),Qw._free(c)}i.destroy(),o.destroy(),delete e.extensions[lS]}const uS=1179937895,hS=new TextDecoder("utf8");function dS(e,t){return new URL(e,t).href}function pS(e,t,n,i){return fetch(dS(e.uri,i)).then(e=>e.arrayBuffer()).then(e=>{t.buffers[n]=e})}function fS(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function mS(e,n,i,r){if(e.uri){const o=dS(e.uri,r);return fetch(o).then(e=>e.blob()).then(e=>t.createImageBitmap(e)).then(e=>{n.images[i]=e})}if(void 0!==e.bufferView){const r=fS(n,e.bufferView),o=new t.Blob([r],{type:e.mimeType});return t.createImageBitmap(o).then(e=>{n.images[i]=e})}}function gS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===uS){const n=new Uint32Array(e,t);let r=2;const o=(n[r++]>>2)-3,s=n[r++]>>2;if(r++,i.json=JSON.parse(hS.decode(n.subarray(r,r+s))),r+=s,r<o){const o=n[r++];r++;const s=t+(r<<2);i.buffers[0]=e.slice(s,s+o)}}else i.json=JSON.parse(hS.decode(new Uint8Array(e,t)));const{buffers:r,images:o,meshes:s,extensionsUsed:a}=i.json;let l=Promise.resolve();if(r){const e=[];for(let t=0;t<r.length;t++){const o=r[t];o.uri?e.push(pS(o,i,t,n)):i.buffers[t]||(i.buffers[t]=null)}l=Promise.all(e)}return l.then(()=>{const e=[],t=a&&a.includes(lS);if(t&&e.push(function(){if(!Qw)return Jw||(Jw=function(e){let t,n=null;function i(){t=new Uint8Array(n.buffer)}function r(){throw new Error("Unexpected Draco error.")}const o={a:{a:r,d:function(e,n,i){return t.copyWithin(e,n,n+i)},c:function(e){const r=t.length,o=Math.max(e>>>0,Math.ceil(1.2*r)),s=Math.ceil((o-r)/65536);try{return n.grow(s),i(),!0}catch(e){return!1}},b:r}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,o))).then(e=>{const{Rb:r,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:g,e:y,yb:_,zb:v,Ab:x,Bb:b,Db:w,Gb:S}=e.instance.exports;n=y;const T=(()=>{let e=0,n=0,i=0,s=0;return a=>{i&&(r(s),r(e),n+=i,i=e=0),e||(n+=128,e=o(n));const l=a.length+7&-8;let c=e;l>=n&&(i=l,c=s=o(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return i(),g(),{memory:y,_free:r,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,n){const i=T(e),r=u(this.ptr,i,t,n.ptr);return!!l(r)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,n){d(this.ptr,e.ptr,t,n)}GetTrianglesUInt32Array(e,t,n){p(this.ptr,e.ptr,t,n)}GetAttributeDataArrayForAllPoints(e,t,n,i,r){f(this.ptr,e.ptr,t.ptr,n,i,r)}},DT_INT8:_(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:S()}})}(fetch(tS())),Jw.then(e=>{Qw=e,Jw=void 0}))}()),o)for(let r=0;r<o.length;r++)e.push(mS(o[r],i,r,n));return(e.length?Promise.all(e):Promise.resolve()).then(()=>{if(t&&s)for(const{primitives:e}of s)for(const t of e)cS(t,i);return i})})}function yS(e){return fetch(e).then(e=>e.arrayBuffer()).then(t=>gS(t,0,e))}class _S{constructor(e,t,n){if(this.triangleCount=t.length/3,this.min=new b(0,0),this.max=new b(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===n)return;const i=e.map(e=>e.x),r=e.map(e=>e.y);this.min=new b(Math.min(...i),Math.min(...r)),this.max=new b(Math.max(...i),Math.max(...r));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/n;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const a=[];for(let c=0;c<this.triangleCount;c++){const n=e[t[3*c+0]].sub(this.min),i=e[t[3*c+1]].sub(this.min),r=e[t[3*c+2]].sub(this.min),o=vS(Math.floor(Math.min(n.x,i.x,r.x)),this.xScale,this.cellsX),l=vS(Math.floor(Math.max(n.x,i.x,r.x)),this.xScale,this.cellsX),u=vS(Math.floor(Math.min(n.y,i.y,r.y)),this.yScale,this.cellsY),h=vS(Math.floor(Math.max(n.y,i.y,r.y)),this.yScale,this.cellsY),d=new b(0,0),p=new b(0,0),f=new b(0,0),m=new b(0,0);for(let e=u;e<=h;++e){d.y=p.y=e*s,f.y=m.y=(e+1)*s;for(let t=o;t<=l;++t)d.x=f.x=t*s,p.x=m.x=(t+1)*s,(Fp(n,i,r,d,p,m)||Fp(n,i,r,d,m,f))&&a.push({cellIdx:e*this.cellsX+t,triIdx:c})}}if(0===a.length)return;a.sort((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx);let l=0;for(;l<a.length;){const e=a[l].cellIdx,t={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===e;)++t.len,this.payload.push(a[l++].triIdx);this.cells[e]=t}}query(e,t,n){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let a=0;a<this.lookup.length;a++)this.lookup[a]=0;const i=vS(e.x-this.min.x,this.xScale,this.cellsX),r=vS(t.x-this.min.x,this.xScale,this.cellsX),o=vS(e.y-this.min.y,this.yScale,this.cellsY),s=vS(t.y-this.min.y,this.yScale,this.cellsY);for(let a=o;a<=s;a++)for(let e=i;e<=r;e++){const t=this.cells[a*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const i=this.payload[t.start+e],r=Math.floor(i/8),o=1<<i%8;if(!(this.lookup[r]&o)&&(this.lookup[r]|=o,n.push(i),n.length===this.triangleCount))return}}}}function vS(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}function xS(e,t){const n=e.json.bufferViews[t.bufferView];return new(0,rS[t.componentType])(e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*sS[t.type])}function bS(e,t,n){const i=e.indices,r=e.attributes,o={};o.indexArray=new Ka;const s=t.json.accessors[i],a=s.count/3;o.indexArray.reserve(a);const l=xS(t,s);for(let d=0;d<a;d++)o.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);o.indexArray._trim(),o.vertexArray=new rl;const c=t.json.accessors[r.POSITION];o.vertexArray.reserve(c.count);const u=xS(t,c);for(let d=0;d<c.count;d++)o.vertexArray.emplaceBack(u[3*d],u[3*d+1],u[3*d+2]);if(o.vertexArray._trim(),o.aabb=new id(c.min,c.max),o.centroid=function(e,t){const n=[0,0,0],i=e.length;if(i>0){for(let r=0;r<i;r++){const i=3*e[r];n[0]+=t[i],n[1]+=t[i+1],n[2]+=t[i+2]}n[0]/=i,n[1]/=i,n[2]/=i}return n}(l,u),void 0!==r.COLOR_0){const e=t.json.accessors[r.COLOR_0],n=sS[e.type];if(e.componentType===iS){o.colorArray=3===n?new rl:new Ba,o.colorArray.reserve(e.count);const i=xS(t,e);if(3===n)for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(i[3*t],i[3*t+1],i[3*t+2]);else for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(i[4*t],i[4*t+1],i[4*t+2],i[4*t+3]);o.colorArray._trim()}else if(e.componentType===nS&&4===n){o.colorArray=new Ba,o.colorArray.resize(e.count);const n=xS(t,e),i=1/65535,r=o.colorArray.float32;for(let e=0;e<4*n.length;++e)r[e]=n[e]*i}else J("glTF color buffer parsing for accessor ".concat(JSON.stringify(e)," is not supported"))}if(void 0!==r.NORMAL){o.normalArray=new rl;const e=t.json.accessors[r.NORMAL];o.normalArray.reserve(e.count);const n=xS(t,e);for(let t=0;t<e.count;t++)o.normalArray.emplaceBack(n[3*t],n[3*t+1],n[3*t+2]);o.normalArray._trim()}if(void 0!==r.TEXCOORD_0&&n.length>0){o.texcoordArray=new ol;const e=t.json.accessors[r.TEXCOORD_0];o.texcoordArray.reserve(e.count);const n=xS(t,e);for(let t=0;t<e.count;t++)o.texcoordArray.emplaceBack(n[2*t],n[2*t+1]);o.texcoordArray._trim()}const h=e.material;return o.material=function(e,t){const{emissiveFactor:n=[0,0,0],alphaMode:i="OPAQUE",alphaCutoff:r=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new fn(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:n,alphaMode:i,alphaCutoff:r,normalTexture:o?t[o.index]:void 0,occlusionTexture:s?t[s.index]:void 0,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},n),void 0!==r._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(xS(t,t.json.accessors[r._FEATURE_RGBA4444]).buffer)),o}function wS(e,t,n){const{matrix:i,rotation:r,translation:o,scale:s,mesh:a,extras:l,children:c}=e,u={};if(u.matrix=i||Ch.fromRotationTranslationScale([],r||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==a){u.meshes=n[a];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:n,max:i}=t.aabb;e[0]+=n[0]+i[0],e[1]+=n[1]+i[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.codePointAt(i);return n}(e),n=[],i=t.length/24,r=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let s=0;s<i;s++){const e=r[2*s*6]/30,t=r[2*s*6+1]/30,i=r[2*s*6+10]/100,a=o[6*s+1],l=o[6*s+2],c=o[6*s+3],u=o[6*s+4],h=c-a,d=u-l,p=Math.hypot(h,d);n.push({pos:[a+.5*h,l+.5*d,t],normal:[d/p,-h/p,0],width:p,height:e,depth:i,points:[a,l,c,u]})}return n}(l.lights))),c){const e=[];for(const i of c)e.push(wS(t.json.nodes[i],t,n));u.children=e}return u}function SS(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,n]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let s=1;s<e.vertices.length;++s){const i=e.vertices[s];t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),n.x=Math.max(n.x,i.x),n.y=Math.max(n.y,i.y)}const i=Math.ceil(Math.max(n.x-t.x,n.y-t.y)/256),r=Math.max(8,i),o=new _S(e.vertices,e.indices,r);return{vertices:e.vertices,indices:e.indices,grid:o,min:t,max:n}}function TS(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const s of n){if(!Array.isArray(s)||2!==s.length)continue;const e=s[0],t=s[1];"number"==typeof e&&"number"==typeof t&&i.push(new b(e,t))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let r=0;for(let s=0;s<i.length;s++){const e=i[s],t=i[(s+1)%i.length],n=i[(s+2)%i.length];r+=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}r>0&&i.reverse();const o=jf(i.flatMap(e=>[e.x,e.y]),[]);return 0===o.length?null:{vertices:i,indices:o}}function ES(e){const t=[],n=[];let i=0;for(const r of e){i=t.length;const e=r.vertexArray.float32,o=r.indexArray.uint16;for(let n=0;n<r.vertexArray.length;n++)t.push(new b(e[3*n+0],e[3*n+1]));for(let t=0;t<3*r.indexArray.length;t++)n.push(o[t]+i)}if(n.length%3!=0)return null;for(let r=0;r<n.length;r+=3){const e=t[n[r+0]],i=t[n[r+1]],o=t[n[r+2]];(e.x-i.x)*(o.y-i.y)-(o.x-i.x)*(e.y-i.y)>0&&([n[r+1],n[r+2]]=[n[r+2],n[r+1]])}return{vertices:t,indices:n}}function AS(e){const n=function(e,n){const i=[],r=t.WebGL2RenderingContext;if(e.json.textures)for(const t of e.json.textures){const o={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==t.sampler&&Object.assign(o,e.json.samplers[t.sampler]),i.push({image:n[t.source],sampler:o,uploaded:!1})}return i}(e,e.images),i=function(e,t){const n=[];for(const i of e.json.meshes){const r=[];for(const n of i.primitives)r.push(bS(n,e,t));n.push(r)}return n}(e,n),{scenes:r,scene:o,nodes:s}=e.json,a=r?r[o||0].nodes:s,l=[];for(const t of a)l.push(wS(s[t],e,i));return function(e,t,n){const i={},r=new Set;for(let o=0;o<e.length;o++){const e=n[t[o]];if(!e.extras)continue;const s=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(s||a)&&r.add(o),"1.0.0"===s&&a&&(i[a]=o)}for(let o=0;o<e.length;o++){if(r.has(o))continue;const s=e[o],a=n[t[o]];if(!a.extras)continue;let l=null;s.id in i&&(l=ES(e[i[s.id]].meshes)),l||(l=TS(a)),l&&(s.footprint=SS(l))}if(r.size>0){const t=Array.from(r.values()).sort((e,t)=>e-t);for(let n=t.length-1;n>=0;n--)e.splice(t[n],1)}}(l,a,e.json.nodes),l}function MS(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,i=e.aabb.min[1]-1,r=Px/(e.aabb.max[0]-n+2),o=Px/(e.aabb.max[1]-i+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-n)*r|0,c=(t[s+1]-i)*o|0;a>e.heightmap[c*Px+l]&&(e.heightmap[c*Px+l]=a)}}function kS(e,t){const n={};n.indexArray=new Ka,n.indexArray.reserve(4*e.length),n.vertexArray=new rl,n.vertexArray.reserve(10*e.length),n.colorArray=new Ba,n.vertexArray.reserve(10*e.length);let i=0;for(const s of e){const e=Math.min(10,Math.max(4,1.3*s.height))*t,r=[-s.normal[1],s.normal[0],0],o=Math.min(.29,.1*s.width/s.depth),a=s.width-2*s.depth*t*(o+.01),l=Lh.scaleAndAdd([],s.pos,r,a/2),c=Lh.scaleAndAdd([],s.pos,r,-a/2),u=[l[0],l[1],l[2]+s.height],h=[c[0],c[1],c[2]+s.height],d=Lh.scaleAndAdd([],s.normal,r,o);Lh.scale(d,d,e);const p=Lh.scaleAndAdd([],s.normal,r,-o);Lh.scale(p,p,e),Lh.add(d,l,d),Lh.add(p,c,p),l[2]+=.1,c[2]+=.1,n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(l[0],l[1],l[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(h[0],h[1],h[2]),n.vertexArray.emplaceBack(l[0],l[1],l[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]);const f=a/e/2;n.colorArray.emplaceBack(-f-o,-1,f,.8),n.colorArray.emplaceBack(f+o,-1,f,.8),n.colorArray.emplaceBack(-f,0,f,1.3),n.colorArray.emplaceBack(f,0,f,1.3),n.colorArray.emplaceBack(f+o,-.8,f,.7),n.colorArray.emplaceBack(f+o,-.8,f,.7),n.colorArray.emplaceBack(0,0,f,1.3),n.colorArray.emplaceBack(0,0,f,1.3),n.colorArray.emplaceBack(f+o,-1.2,f,.8),n.colorArray.emplaceBack(f+o,-1.2,f,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}const r={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=fn.white,r.pbrMetallicRoughness=o,n.material=r,n.aabb=new id([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Os(_S,"TriangleGridIndex");const CS={vector:qw,raster:Ww,"raster-dem":class extends Ww{constructor(e,t,n,i){super(e,t,n,i),this.type="raster-dem",this.maxzoom=22,this._options=B({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,n){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(t,i){t&&(e.state="errored",n(t)),i&&(e.dem=i,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",n(null))}e.request=Ie(this.map._requestManager.transformRequest(i,be.Tile),function(i,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const n=t.ImageBitmap&&o instanceof t.ImageBitmap&&ft(),i=1-(o.width-((l=o.width)<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))))/2;i<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const c=n?o:mt.getImageData(o,i),u={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:c,encoding:this.encoding,padding:i};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",u,r.bind(this),void 0,!0))}var l}.bind(this))}_getNeighboringTiles(e){const t=e.canonical,n=Math.pow(2,t.z),i=(t.x-1+n)%n,r=0===t.x?e.wrap-1:e.wrap,o=(t.x+1+n)%n,s=t.x+1===n?e.wrap+1:e.wrap,a={};return a[new Hh(e.overscaledZ,r,t.z,i,t.y).key]={backfilled:!1},a[new Hh(e.overscaledZ,s,t.z,o,t.y).key]={backfilled:!1},t.y>0&&(a[new Hh(e.overscaledZ,r,t.z,i,t.y-1).key]={backfilled:!1},a[new Hh(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},a[new Hh(e.overscaledZ,s,t.z,o,t.y-1).key]={backfilled:!1}),t.y+1<n&&(a[new Hh(e.overscaledZ,r,t.z,i,t.y+1).key]={backfilled:!1},a[new Hh(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},a[new Hh(e.overscaledZ,s,t.z,o,t.y+1).key]={backfilled:!1}),a}},geojson:class extends zt{constructor(e,t,n,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=t.data,this._options=B({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const r=pi/this.tileSize;this.workerOptions=B({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*r,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*r,extent:pi,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:pi,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*r,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new It("dataloading",{dataType:"source"})),this._loaded=!1;const e=B({},this.workerOptions);e.scope=this.scope;const t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(mt.resolveURL(t),be.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),e,(e,t)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new Dt(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&t&&t.resourceTiming&&t.resourceTiming[this.id]&&(e.resourceTiming=t.resourceTiming[this.id]),this.fire(new It("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const i={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:mt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(n,i,(i,r)=>(delete e.request,e.destroy(),e.aborted?t(null):i?t(i):(e.loadVectorData(r,this.map.painter,"reloadTile"===n),t(null))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return B({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends tw{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,be.Source).url);!function(e,n){const i=t.document.createElement("video");i.muted=!0,i.onloadstart=function(){n(null,i)};for(let r=0;r<e.length;r++){const n=t.document.createElement("source");Me(e[r])||(i.crossOrigin="Anonymous"),n.src=e[r],i.appendChild(n)}}(this.urls,(e,t)=>{this._loaded=!0,e?this.fire(new Dt(e)):t&&(this.video=t,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new Dt(new Lt("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(t.start(0)," and ").concat(t.end(0),"-second mark.")))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new k_(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:tw,model:class extends zt{constructor(e,t,n,i){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const n=this._options.models[t],i=yS(this.map._requestManager.transformRequest(n.uri,be.Model).url).then(e=>{if(!e)return;const i=AS(e),r=new Dx(t,n.position,n.orientation,i);r.computeBoundsAndApplyParent(),this.models.push(r)}).catch(e=>{this.fire(new Dt(new Error("Could not load model ".concat(t," from ").concat(n.uri,": ").concat(e.message))))});e.push(i)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new It("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new Dt(new Error("Could not load models: ".concat(e.message))))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends zt{constructor(e,t,n,i){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new It("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Lw(this._options,this.map._requestManager,t,n,(i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?(t&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(t)),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new Dt(i))):r&&(B(this,r),r.bounds&&(this.tileBounds=new Ow(r.bounds,this.minzoom,this.maxzoom)),Ze(r.tiles,this.map._requestManager._customAccessToken),this.fire(new It("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new It("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,be.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=t;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",r,o.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,o.bind(this),void 0,!0);function o(n,r){return e.aborted?t(null):n&&404!==n.status?t(n):(r&&(r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(r),e.buckets=i(i({},e.buckets),r.buckets)),e.state="loaded",void t(null))}}serialize(){return B({},this._options)}},canvas:class extends tw{constructor(e,n,i,r){super(e,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new Dt(new Lt("sources.".concat(e),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Dt(new Lt("sources.".concat(e),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new Dt(new Lt("sources.".concat(e),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.HTMLCanvasElement||this.fire(new Dt(new Lt("sources.".concat(e),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Dt(new Lt("sources.".concat(e),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.HTMLCanvasElement?this.options.canvas:t.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Dt(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof C_||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new k_(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends zt{constructor(e,t,n,i){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Dt(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new Dt(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new Ow(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),B(this,N(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return N(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new It("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new It("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new It("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:i}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){const{x:i,y:r,z:o}=e.tileID.canonical,s=new t.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:o},{signal:s.signal})).then(function(i){return delete e.request,e.aborted?(e.state="unloaded",n(null)):void 0===i?(e.state="errored",n(null)):null===i?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",n(null)):function(e){return e instanceof t.ImageData||e instanceof t.HTMLCanvasElement||e instanceof t.ImageBitmap||e instanceof t.HTMLImageElement}(i)?(this.loadTileData(e,i),e.state="loaded",void n(null)):(e.state="errored",n(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch(t=>{20!==t.code&&(e.state="errored",n(t))}),e.request.cancel=()=>s.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof k_?(e.destroy(!0),e.texture&&e.texture instanceof k_&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:t,y:n,z:i}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:n,z:i})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const e=Sa(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new It("data",{dataType:"source",sourceDataType:"content"}))}}},PS=function(e,t,n,i){const r=new CS[t.type](e,t,n,i);if(r.id!==e)throw new Error("Expected Source id to be ".concat(e," instead of ").concat(r.id));return W(["load","abort","unload","serialize","prepare"],r),r};function IS(e,t){const n=Ch.identity([]);return Ch.scale(n,n,[.5*e.width,.5*-e.height,1]),Ch.translate(n,n,[1,-1,0]),Ch.multiply(n,n,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(n)}function DS(e,t,n,i,r,o,s){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=e.tilesIn(i,s,a);l.sort(RS);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(t,n,e._state,h,r,o,IS(e.transform,h.tile.tileID),a)});const u=function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in e){const i=e[n],r=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const h in u)u[h].forEach(t=>{const n=t.feature,i=n.layer;i&&"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type&&(n.source=i.source,i["source-layer"]&&(n.sourceLayer=i["source-layer"]),n.state=void 0!==n.id?e.getFeatureState(i["source-layer"],n.id):{})});return u}function zS(e,t){const n=e.getRenderableIds().map(t=>e.getTileByID(t)),i=[],r={};for(let o=0;o<n.length;o++){const e=n[o],s=e.tileID.canonical.key;r[s]||(r[s]=!0,e.querySourceFeatures(i,t))}return i}function RS(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class LS{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const t=this.style._mergedLayers[e];if("fill-extrusion"===t.type)this.layers.push(t);else if("model"===t.type){const e=this.style.getLayerSource(t);e&&"batched-model"===e.type&&this.layers.push(t)}}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(let i=0;i<this.layers.length;++i){const e=this.layers[i],n=this.style.getLayerSourceCache(e);let r=1;"fill-extrusion"===e.type&&(r=e.paint.get("fill-extrusion-opacity")>0?e.paint.get("fill-extrusion-vertical-scale"):0);let o=n?n.getTile(t):null;if(!o&&n&&t.canonical.z>n.getSource().minzoom){let e=t.scaledTo(Math.min(n.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=n.getSource().minzoom&&(o=n.getTile(e),!o&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(e):null,tileID:o?o.tileID:t,verticalScale:r})}e.hasAnyZOffset=!1;let n=!1;for(let i=0;i<e.symbolInstances.length;i++){const r=e.symbolInstances.get(i),o=r.zOffset,s=this._getHeightAtTileOffset(t,r.tileAnchorX,r.tileAnchorY);r.zOffset=-1!==s?s:o,n||o===r.zOffset||(n=!0),e.hasAnyZOffset||0===r.zOffset||(e.hasAnyZOffset=!0)}n&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,t,n,i){let r=t,o=n;if(e.canonical.z!==i.canonical.z){const s=i.canonical,a=1/(1<<e.canonical.z-s.z);r=(t+e.canonical.x*pi)*a-s.x*pi|0,o=(n+e.canonical.y*pi)*a-s.y*pi|0}return{tileX:r,tileY:o}}_getHeightAtTileOffset(e,t,n){let i;for(let r=0;r<this.layers.length;++r){if("fill-extrusion"!==this.layers[r].type)continue;const{bucket:o,tileID:s,verticalScale:a}=this.currentBuildingBuckets[r];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,n,s),u=o.getHeightAtTileCoord(l,c);if(u&&void 0!==u.height){if(!u.hidden)return u.height*a;i=u.height}}for(let r=0;r<this.layers.length;++r){if("model"!==this.layers[r].type)continue;const{bucket:o,tileID:s}=this.currentBuildingBuckets[r];if(!o)continue;const{tileX:a,tileY:l}=this._mapCoordToOverlappingTile(e,t,n,s),c=o.getHeightAtTileCoord(a,l);if(c&&!c.hidden)return void 0===c.height&&void 0!==i?Math.min(c.maxHeight,i)*c.verticalScale:(c.height||0)*c.verticalScale}return-1}}var OS=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function FS(e,t){const n={};for(const i in e)"ref"!==i&&(n[i]=e[i]);return OS.forEach(e=>{e in t&&(n[e]=t[e])}),n}function BS(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=FS(e[n],t[e[n].ref]));return e}const NS={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function jS(e,t,n){n.push({command:NS.addSource,args:[e,t[e]]})}function VS(e,t,n){t.push({command:NS.removeSource,args:[e]}),n[e]=!0}function US(e,t,n,i){VS(e,n,i),jS(e,t,n)}function GS(e,t,n){let i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!w(e[n][i],t[n][i]))return!1;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!w(e[n][i],t[n][i]))return!1;return!0}function qS(e,t,n,i,r,o){let s;for(s in t=t||{},e=e||{})e.hasOwnProperty(s)&&(w(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}));for(s in t)t.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(w(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}))}function WS(e){return e.id}function ZS(e,t){return e[t.id]=t,e}class HS{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=z(e,0,1);let t=1,n=this._distances[t];const i=e*this.paddedLength+this.padding;for(;n<i&&t<this._distances.length;)n=this._distances[++t];const r=t-1,o=this._distances[r],s=n-o,a=s>0?(i-o)/s:0;return this.points[r].mult(1-a).add(this.points[t].mult(a))}}class XS{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,n,i,r,o){this.circleCells[r].push(o)}_query(e,t,n,i,r,o){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];const s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}return o?s.filter(o):s}return this._forEachCell(e,t,n,i,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(e,t,n,i,r){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!i&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}hitTest(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}hitTestCircle(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}_queryCell(e,t,n,i,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,n,i)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],n=r[u+2];o.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,i,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,o){const s=i-e,a=r-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,i,r,o,s){const a=(o-i)/2,l=Math.abs(e-(i+a));if(l>a+n)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}const YS=100;class KS{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new XS(e.width+200,e.height+200,25),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new XS(e.width+200,e.height+200,25);this.transform=e,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+YS,this.screenBottomBoundary=e.height+YS,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,n,i,r,o,s,a){let l=n.projectedAnchorX,c=n.projectedAnchorY,u=n.projectedAnchorZ;const h=n.elevation,d=n.tileID,p=e.getProjection();if(h&&d){const[e,t,i]=p.upVector(d.canonical,n.tileAnchorX,n.tileAnchorY),r=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*r,c+=t*h*r,u+=i*h*r}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,n.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,g=(n.x1*t+i.x-n.padding)*m+f.point.x,y=(n.y1*t+i.y-n.padding)*m+f.point.y,_=(n.x2*t+i.x+n.padding)*m+f.point.x,v=(n.y2*t+i.y+n.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,y,_,v)||!r&&this.grid.hitTest(g,y,_,v,a)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,y,_,v],offscreen:this.isOffscreen(g,y,_,v),occluded:!1}}placeCollisionCircles(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){const m=[],g=this.transform.elevation,y=e.getProjection(),_=g?g.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,y):null,v=new b(n.tileAnchorX,n.tileAnchorY);let{x:x,y:w,z:S}=y.projectTilePoint(v.x,v.y,f.canonical);if(_){const[e,t,n]=_(v);x+=e,w+=t,S+=n}const T="globe"===y.name,E=this.projectAndGetPerspectiveRatio(s,x,w,S,f,T||!!g||this.transform.pitch>0,y),{perspectiveRatio:A}=E,M=(u?o/A:o*A)/fg,k=dx(x,w,S,a),C=E.signedDistanceFromCamera>0?gx(M,r,n.lineOffsetX*M,n.lineOffsetY*M,!1,k,v,n,i,a,{},g&&!u?_:null,u&&!!g,y,f,u):null;let P=!1,I=!1,D=!0;if(C&&!E.occluded){const e=.5*d*A+p,n=new b(-100,-100),i=new b(this.screenRightBoundary,this.screenBottomBoundary),r=new HS,{first:o,last:s}=C,a=o.path.length;let u=[];for(let t=a-1;t>=1;t--)u.push(o.path[t]);for(let t=1;t<s.path.length;t++)u.push(s.path[t]);const f=2.5*e;l&&(u=u.map((e,t)=>{let[n,i,r]=e;return _&&!T&&(r=_(t<a-1?o.tilePath[a-1-t]:s.tilePath[t-a+2])[2]),dx(n,i,r,l)}),u.some(e=>e[3]<=0)&&(u=[]));let g=[];if(u.length>0){let e=1/0,t=-1/0,r=1/0,o=-1/0;for(const n of u)e=Math.min(e,n[0]),r=Math.min(r,n[1]),t=Math.max(t,n[0]),o=Math.max(o,n[1]);t>=n.x&&e<=i.x&&o>=n.y&&r<=i.y&&(g=[u.map(e=>new b(e[0],e[1]))],(e<n.x||t>i.x||r<n.y||o>i.y)&&(g=Qg(g,n.x,n.y,i.x,i.y)))}for(const l of g){r.reset(l,.25*e);let n=0;n=r.length<=.5*e?1:Math.ceil(r.paddedLength/f)+1;for(let i=0;i<n;i++){const o=i/Math.max(n-1,1),s=r.lerp(o),a=s.x+YS,l=s.y+YS;m.push(a,l,e,0);const u=a-e,d=l-e,p=a+e,f=l+e;if(D=D&&this.isOffscreen(u,d,p,f),I=I||this.isInsideGrid(u,d,p,f),!t&&this.grid.hitTestCircle(a,l,e,h)&&(P=!0,!c))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!c&&P||!I?[]:m,offscreen:D,collisionDetected:P,occluded:E.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const t=[];let n=1/0,i=1/0,r=-1/0,o=-1/0;for(const c of e){const e=new b(c.x+YS,c.y+YS);n=Math.min(n,e.x),i=Math.min(i,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y),t.push(e)}const s=this.grid.query(n,i,r,o).concat(this.ignoredGrid.query(n,i,r,o)),a={},l={};for(const c of s){const e=c.key;void 0===a[e.bucketInstanceId]&&(a[e.bucketInstanceId]={}),a[e.bucketInstanceId][e.featureIndex]||Tp(t,[new b(c.x1,c.y1),new b(c.x2,c.y1),new b(c.x2,c.y2),new b(c.x1,c.y2)])&&(a[e.bucketInstanceId][e.featureIndex]=!0,void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]=[]),l[e.bucketInstanceId].push(e.featureIndex))}return l}insertCollisionBox(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let a=0;a<e.length;a+=4)o.insertCircle(s,e[a],e[a+1],e[a+2])}projectAndGetPerspectiveRatio(e,t,n,i,r,o,s){const a=[t,n,i,1];let l=!1;if(i||this.transform.pitch>0){if(bh.transformMat4(a,a,e),this.fogState&&r&&"globe"!==s.name){const e=function(e,t,n,i,r,o){const s=o.calculateFogTileMatrix(r),a=[t,n,i];return Lh.transformMat4(a,a,s),_w(e,Lh.length(a),o.pitch,o._fov)}(this.fogState,t,n,i,r.toUnwrapped(),this.transform);l=e>.9}}else Sx(a,a,e);const c=a[3];return{point:new b((a[0]/c+1)/2*this.transform.width+YS,(-a[1]/c+1)/2*this.transform.height+YS),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/c*.5,1.5),signedDistanceFromCamera:c,occluded:o&&a[2]>c||l}}isOffscreen(e,t,n,i){return n<YS||e>=this.screenRightBoundary||i<YS||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=Ch.identity([]);return Ch.translate(e,e,[-100,-100,0]),e}}function JS(e,t,n){const i=t.createTileMatrix(e,e.worldSize,n.toUnwrapped());return Ch.multiply(new Float32Array(16),e.projMatrix,i)}function $S(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const i=n.clone();return i.setProjection(t.projection),JS(i,t.getProjection(),e)}function QS(e,t,n){return t.name===n.projection.name?e.projMatrix:JS(n,t,e)}class eT{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class tT{constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new eT(e?e.text:null,t,n,r),this.icon=new eT(e?e.icon:null,t,i,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nT{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=n,this.clipped=i}}class iT{constructor(){this.invProjMatrix=Ch.create(),this.viewportMatrix=Ch.create(),this.circles=[]}}class rT{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class oT{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function sT(e,t,n,i,r){const{horizontalAlign:o,verticalAlign:s}=Vg(e),a=-(o-.5)*t,l=-(s-.5)*n,c=wy(e,i);return new b(a+c[0]*r,l+c[1]*r)}function aT(e,t,n,i,r){const o=new b(e,t);return n&&o._rotate(i?r:-r),o}class lT{constructor(e,t,n,i,r,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new KS(this.transform,r),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new oT(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,t,n,i){const r=n.getBucket(t),o=n.latestFeatureIndex;if(!r||!o||t.fqid!==r.layerIds[0])return;const s=r.layers[0].layout,a=n.collisionBoxArray,l=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/pi,u=n.tileID.toUnwrapped();this.transform.setProjection(r.projection);const h=(d=n.tileID,p=r.getProjection(),f=this.transform,p.name===this.projection?f.calculateProjMatrix(d.toUnwrapped()):JS(f,p,d));var d,p,f;const m="map"===s.get("text-pitch-alignment"),g="map"===s.get("text-rotation-alignment");t.compileFilter();const y=t.dynamicFilter(),_=t.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(n),x=ux(h,n.tileID.canonical,m,g,this.transform,r.getProjection(),v);let b=null;if(m){const e=hx(h,n.tileID.canonical,m,g,this.transform,r.getProjection(),v);b=Ch.multiply([],this.transform.labelPlaneMatrix,e)}let w=null;y&&n.latestFeatureIndex&&(w={unwrappedTileID:u,dynamicFilter:y,dynamicFilterNeedsFeature:_,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[r.bucketInstanceId]=new rT(r.bucketInstanceId,o,r.sourceLayerIndex,r.index,n.tileID);const S={bucket:r,layout:s,posMatrix:h,textLabelPlaneMatrix:x,labelToScreenMatrix:b,clippingData:w,scale:l,textPixelRatio:c,holdingForFade:n.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:_g(r.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:_g(r.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(r.sourceID)};if(i)for(const T of r.sortKeyRanges){const{sortKey:t,symbolInstanceStart:n,symbolInstanceEnd:i}=T;e.push({sortKey:t,symbolInstanceStart:n,symbolInstanceEnd:i,parameters:S})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:r.symbolInstances.length,parameters:S})}attemptAnchorPlacement(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const{textOffset0:_,textOffset1:v,crossTileID:x}=h,b=[_,v],w=sT(e,n,i,b,r),S=this.collisionIndex.placeCollisionBox(p,r,t,aT(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(y,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,aT(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(S.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(t=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:n,height:i,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:S}}}placeLayerBucketPart(e,t,n,i){const{bucket:r,layout:o,posMatrix:s,textLabelPlaneMatrix:a,labelToScreenMatrix:l,clippingData:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,partiallyEvaluatedIconSize:f,collisionGroup:m}=e.parameters,g=o.get("text-optional"),y=o.get("icon-optional"),_=o.get("text-allow-overlap"),v=o.get("icon-allow-overlap"),x="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),S="viewport-y"===o.get("symbol-z-order"),T=o.get("symbol-z-elevate");this.transform.setProjection(r.projection);let E=_&&(v||!r.hasIconData()||y),A=v&&(_||!r.hasTextData()||g);!r.collisionArrays&&d&&r.deserializeCollisionBoxes(d),n&&i&&r.updateCollisionDebugBuffers(this.transform.zoom,d);const M=(e,i,d)=>{const{crossTileID:S,numVerticalGlyphVertices:T}=e;if(c){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let i=null;if(c.dynamicFilterNeedsFeature){const t=this.retainedQueryData[r.bucketInstanceId];i=c.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,c.dynamicFilter)(n,i,this.retainedQueryData[r.bucketInstanceId].tileID.canonical,new b(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(c.unwrappedTileID)))return this.placements[S]=new nT(!1,!1,!1,!0),void t.add(S)}if(t.has(S))return;if(h)return void(this.placements[S]=new nT(!1,!1,!1));let M=!1,k=!1,C=!0,P=!1,I=!1,D=null,z={box:null,offscreen:null,occluded:null},R={box:null,offscreen:null,occluded:null},L=null,O=null,F=null,B=0,N=0,j=0;d.textFeatureIndex?B=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(B=e.featureIndex),d.verticalTextFeatureIndex&&(N=d.verticalTextFeatureIndex);const V=t=>{t.tileID=this.retainedQueryData[r.bucketInstanceId].tileID;const n=this.transform.elevation;t.elevation=e.zOffset+(n?n.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},U=d.textBox;if(U){V(U);const t=t=>{let n=Cg.horizontal;if(r.allowVerticalPlacement&&!t&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[S];t&&(this.placedOrientations[S]=t,n=t,this.markUsedOrientation(r,n,e))}return n},n=(e,t)=>{if(r.allowVerticalPlacement&&T>0&&d.verticalTextBox){for(const n of r.writingModes)if(n===Cg.vertical?(z=t(),R=z):z=e(),z&&z.box&&z.box.length)break}else z=e()};if(o.get("text-variable-anchor")){let a=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[S]){const e=this.prevPlacement.variableOffsets[S];a.indexOf(e.anchor)>0&&(a=a.filter(t=>t!==e.anchor),a.unshift(e.anchor))}const l=(t,n,o)=>{const l=r.getSymbolInstanceTextSize(p,e,this.transform.zoom,i),c=(t.x2-t.x1)*l+2*t.padding,h=(t.y2-t.y1)*l+2*t.padding,d=e.hasIconTextFit&&!v?n:null;d&&V(d);let g={box:[],offscreen:!1,occluded:!1};const y=_?2*a.length:a.length;for(let _=0;_<y;++_){const n=this.attemptAnchorPlacement(a[_%a.length],t,c,h,l,x,w,u,s,m,_>=a.length,e,i,r,o,d,p,f);if(n&&(g=n.placedGlyphBoxes,g&&g.box&&g.box.length)){M=!0,D=n.shift;break}}return g};n(()=>l(U,d.iconBox,Cg.horizontal),()=>{const e=d.verticalTextBox;return e&&V(e),r.allowVerticalPlacement&&!(z&&z.box&&z.box.length)&&T>0&&e?l(e,d.verticalIconBox,Cg.vertical):{box:null,offscreen:null,occluded:null}}),z&&(M=z.box,C=z.offscreen,P=z.occluded);const c=t(!(!z||!z.box));if(!M&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[S];t&&(this.variableOffsets[S]=t,this.markUsedJustification(r,t.anchor,e,c))}}else{const o=(t,n)=>{const o=r.getSymbolInstanceTextSize(p,e,this.transform.zoom,i),a=this.collisionIndex.placeCollisionBox(r,o,t,new b(0,0),_,u,s,m.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(r,n,e),this.placedOrientations[S]=n),a};n(()=>o(U,Cg.horizontal),()=>{const e=d.verticalTextBox;return r.allowVerticalPlacement&&T>0&&e?(V(e),o(e,Cg.vertical)):{box:null,offscreen:null,occluded:null}}),t(!!(z&&z.box&&z.box.length))}}if(L=z,M=L&&L.box&&L.box.length>0,C=L&&L.offscreen,P=L&&L.occluded,e.useRuntimeCollisionCircles){const t=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),i=yg(r.textSizeData,p,t),c=o.get("text-padding");O=this.collisionIndex.placeCollisionCircles(r,_,t,r.lineVertexArray,r.glyphOffsetArray,i,s,a,l,n,w,m.predicate,e.collisionCircleDiameter*i/fg,c,this.retainedQueryData[r.bucketInstanceId].tileID),M=_||O.circles.length>0&&!O.collisionDetected,C=C&&O.offscreen,P=O.occluded}if(d.iconFeatureIndex&&(j=d.iconFeatureIndex),d.iconBox){const t=t=>{V(t);const n=e.hasIconTextFit&&D?aT(D.x,D.y,x,w,this.transform.angle):new b(0,0),i=r.getSymbolInstanceIconSize(f,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(r,i,t,n,v,u,s,m.predicate)};R&&R.box&&R.box.length&&d.verticalIconBox?(F=t(d.verticalIconBox),k=F.box.length>0):(F=t(d.iconBox),k=F.box.length>0),C=C&&F.offscreen,I=F.occluded}const G=g||0===e.numHorizontalGlyphVertices&&0===T,q=y||0===e.numIconVertices;if(G||q?q?G||(k=k&&M):M=k&&M:k=M=k&&M,M&&L&&L.box&&this.collisionIndex.insertCollisionBox(L.box,o.get("text-ignore-placement"),r.bucketInstanceId,R&&R.box&&N?N:B,m.ID),k&&F&&this.collisionIndex.insertCollisionBox(F.box,o.get("icon-ignore-placement"),r.bucketInstanceId,j,m.ID),O&&(M&&this.collisionIndex.insertCollisionCircles(O.circles,o.get("text-ignore-placement"),r.bucketInstanceId,B,m.ID),n)){const e=r.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new iT);for(let n=0;n<O.circles.length;n+=4)t.circles.push(O.circles[n+0]),t.circles.push(O.circles[n+1]),t.circles.push(O.circles[n+2]),t.circles.push(O.collisionDetected?1:0)}const W="globe"!==r.projection.name;E=E&&(W||!P),A=A&&(W||!I),this.placements[S]=new nT(M||E,k||A,C||r.justReloaded),t.add(S)};if(T&&this.buildingIndex&&(this.buildingIndex.updateZOffset(r,this.retainedQueryData[r.bucketInstanceId].tileID),r.updateZOffset()),S){const e=r.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const n=e[t];M(r.symbolInstances.get(n),n,r.collisionArrays[n])}r.hasAnyZOffset&&J("".concat(r.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(r.hasAnyZOffset){const e=r.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const n=e[t];M(r.symbolInstances.get(n),n,r.collisionArrays[n])}}else for(let b=e.symbolInstanceStart;b<e.symbolInstanceEnd;b++)M(r.symbolInstances.get(b),b,r.collisionArrays[b]);if(n&&r.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[r.bucketInstanceId];Ch.invert(e.invProjMatrix,s),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}markUsedJustification(e,t,n,i){const{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a,crossTileID:l}=n,c=Ty(t),u=i===Cg.vertical?a:"left"===c?r:"center"===c?o:"right"===c?s:-1;r>=0&&(e.text.placedSymbolArray.get(r).crossTileID=u>=0&&r!==u?0:l),o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=u>=0&&o!==u?0:l),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=u>=0&&s!==u?0:l),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=u>=0&&a!==u?0:l)}markUsedOrientation(e,t,n){const i=t===Cg.horizontal||t===Cg.horizontalOnly?t:0,r=t===Cg.vertical?t:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l}=n,c=e.text.placedSymbolArray;o>=0&&(c.get(o).placedOrientation=i),s>=0&&(c.get(s).placedOrientation=i),a>=0&&(c.get(a).placedOrientation=i),l>=0&&(c.get(l).placedOrientation=r)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const a in this.placements){const e=this.placements[a],t=r[a];t?(this.opacities[a]=new tT(t,i,e.text,e.icon,null,e.clipped),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[a]=new tT(null,i,e.text,e.icon,e.skipFade,e.clipped),n=n||e.text||e.icon)}for(const a in r){const e=r[a];if(!this.opacities[a]){const t=new tT(e,i,!1,!1);t.isHidden()||(this.opacities[a]=t,n=n||e.text.placed||e.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n=new Set;for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,n,i.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,i.tileID),t.updateZOffset()))}}updateBucketOpacities(e,t,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const i=e.layers[0].layout,r=!!e.layers[0].dynamicFilter(),o=new tT(null,0,!1,!1,!0),s=i.get("text-allow-overlap"),a=i.get("icon-allow-overlap"),l=i.get("text-variable-anchor"),c="map"===i.get("text-rotation-alignment"),u="map"===i.get("text-pitch-alignment"),h=new tT(null,0,s&&(a||!e.hasIconData()||i.get("icon-optional")),a&&(s||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const d=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)};let p=0;for(let f=0;f<e.symbolInstances.length;f++){const n=e.symbolInstances.get(f),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:s,crossTileID:a,numIconVertices:m}=n,g=t.has(a);let y=this.opacities[a];g?y=o:y||(y=h,this.opacities[a]=y),t.add(a);const _=i>0||s>0,v=m>0,x=this.placedOrientations[a],w=x===Cg.vertical,S=x===Cg.horizontal||x===Cg.horizontalOnly;if(!_&&!v||y.isHidden()||p++,_){const t=yT(y.text);d(e.text,i,w?_T:t),d(e.text,s,S?_T:t);const r=y.text.isHidden(),{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:l,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:u}=n,h=e.text.placedSymbolArray,p=r||w?1:0;o>=0&&(h.get(o).hidden=p),l>=0&&(h.get(l).hidden=p),c>=0&&(h.get(c).hidden=p),u>=0&&(h.get(u).hidden=r||S?1:0);const f=this.variableOffsets[a];f&&this.markUsedJustification(e,f.anchor,n,x);const m=this.placedOrientations[a];m&&(this.markUsedJustification(e,"left",n,m),this.markUsedOrientation(e,m,n))}if(v){const t=yT(y.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:r}=n,o=e.icon.placedSymbolArray,s=y.icon.isHidden()?1:0;i>=0&&(d(e.icon,m,w?_T:t),o.get(i).hidden=s),r>=0&&(d(e.icon,n.numVerticalIconVertices,S?_T:t),o.get(r).hidden=s)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const t=e.collisionArrays[f];if(t){let i=new b(0,0),o=!0;if(t.textBox||t.verticalTextBox){if(l){const e=this.variableOffsets[a];e?(i=sT(e.anchor,e.width,e.height,e.textOffset,e.textScale),c&&i._rotate(u?this.transform.angle:-this.transform.angle)):o=!1}r&&(o=!y.clipped),t.textBox&&cT(e.textCollisionBox.collisionVertexArray,y.text.placed,!o||w,i.x,i.y),t.verticalTextBox&&cT(e.textCollisionBox.collisionVertexArray,y.text.placed,!o||S,i.x,i.y)}const s=o&&Boolean(!S&&t.verticalIconBox);t.iconBox&&cT(e.iconCollisionBox.collisionVertexArray,y.icon.placed,s,n.hasIconTextFit?i.x:0,n.hasIconTextFit?i.y:0),t.verticalIconBox&&cT(e.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,n.hasIconTextFit?i.x:0,n.hasIconTextFit?i.y:0)}}}if(e.fullyClipped=0===p,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function cT(e,t,n,i,r){e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0)}const uT=Math.pow(2,25),hT=Math.pow(2,24),dT=Math.pow(2,17),pT=Math.pow(2,16),fT=Math.pow(2,9),mT=Math.pow(2,8),gT=Math.pow(2,1);function yT(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*uT+t*hT+n*dT+t*pT+n*fT+t*mT+n*gT+t}const _T=0;class vT{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,n,i,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class xT{constructor(e,t,n,i,r,o,s,a,l){this.placement=new lT(e,r,o,s,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,t,n,i){const r=mt.now(),o=()=>{const e=mt.now()-r;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const r=t[e[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=s)&&(!r.maxzoom||r.maxzoom>s)){const e=r,t=e.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new vT(e),a=Sa(r.source,r.scope);if(s.continuePlacement(t?i[a]:n[a],this.placement,this._showCollisionBoxes,r,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const bT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error("Got v".concat(i," data when expected v1."));const r=bT[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new wT(s,o,r,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,i=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=bT.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error("Unexpected typed array class: ".concat(n,"."));i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return ST(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=i&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=i&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=p:i>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)MT(r[2*n],r[2*n+1],e,t)<=l&&a.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];MT(p,f,e,t)<=l&&a.push(i[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function ST(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;TT(e,t,s,i,r,o),ST(e,t,n,i,s-1,1-o),ST(e,t,n,s+1,r,1-o)}function TT(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);TT(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(ET(e,t,i,n),t[2*r+o]>s&&ET(e,t,i,r);a<l;){for(ET(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?ET(e,t,i,l):(l++,ET(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function ET(e,t,n,i){AT(e,n,i),AT(t,2*n,2*i),AT(t,2*n+1,2*i+1)}function AT(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function MT(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}const kT=512/pi/2;class CT{constructor(e,t,n){this.tileID=e,this.bucketInstanceId=n,this.index=new wT(t.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const i=e.canonical.x*pi,r=e.canonical.y*pi;for(let o=0;o<t.length;o++){const{key:e,crossTileID:n,tileAnchorX:s,tileAnchorY:a}=t.get(o),l=Math.floor((i+s)*kT),c=Math.floor((r+a)*kT);this.index.add(l,c),this.keys.push(e),this.crossTileIDs.push(n)}this.index.finish()}findMatches(e,t,n){const i=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),r=kT/Math.pow(2,t.canonical.z-this.tileID.canonical.z),o=t.canonical.x*pi,s=t.canonical.y*pi;for(let a=0;a<e.length;a++){const t=e.get(a);if(t.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=t,h=Math.floor((o+c)*r),d=Math.floor((s+u)*r),p=this.index.range(h-i,d-i,h+i,d+i);for(const e of p){const i=this.crossTileIDs[e];if(this.keys[e]===l&&!n.has(i)){n.add(i),t.crossTileID=i;break}}}}}class PT{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class IT{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],i={};for(const n in e){const r=e[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const i=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in n){const o=n[r];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=n[e.scaledTo(Number(r)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let r=0;r<t.symbolInstances.length;r++){const e=t.symbolInstances.get(r);e.crossTileID||(e.crossTileID=n.generate(),i.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new CT(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.crossTileIDs)this.usedCrossTileIDs[e].delete(n)}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class DT{constructor(){this.layerIndexes={},this.crossTileIDs=new PT,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n,i){let r=this.layerIndexes[e.fqid];void 0===r&&(r=this.layerIndexes[e.fqid]=new IT);let o=!1;const s={};"globe"!==i.name&&r.handleWrapJump(n);for(const a of t){const t=a.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(a.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}var zT="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",RT="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",LT="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",OT="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",FT="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",BT="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)\n);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)\n);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",NT="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",jT="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const VT=[];HT(zT,VT);const UT={"_prelude_fog.vertex.glsl":OT,"_prelude_terrain.vertex.glsl":LT,"_prelude_shadow.vertex.glsl":NT,"_prelude_fog.fragment.glsl":FT,"_prelude_shadow.fragment.glsl":jT,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":BT},GT={};XT("",LT),XT(FT,OT),XT(jT,NT),XT(BT,"");const qT=XT("\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif","\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}"),WT=zT;var ZT={background:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:XT("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:XT('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:XT("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:XT("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:XT("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:XT("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:XT("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:XT('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:XT("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:XT("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#elif defined(PROJECTION_GLOBE_VIEW)\nin vec2 a_pos;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),symbolIcon:XT('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:XT('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;flat in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nflat out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:XT('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;flat in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nflat out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:XT("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:XT('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',RT),skyboxGradient:XT('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',RT),skyboxCapture:XT("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:XT('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:XT('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:XT("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:XT("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function HT(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=i.split(" ");for(const n of e)t.includes(n)||t.push(n)}}function XT(e,t){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map(e=>{const t=e.split(" ");return t[t.length-1]}),r=[...new Set(r)]);const o={},s=[],a=[];e=e.replace(n,(e,t)=>(a.push(t),"")),t=t.replace(n,(e,t)=>(s.push(t),""));let l=[...VT];HT(e,l),HT(t,l);for(const c of[...s,...a])UT[c]||console.error("Undefined include: ".concat(c)),GT[c]||(GT[c]=[],HT(UT[c],GT[c])),l=[...l,...GT[c]];return{fragmentSource:e=e.replace(i,(e,t,n,i,r)=>(o[r]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nin ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"":void 0)),vertexSource:t=t.replace(i,(e,t,n,i,r)=>{const s="float"===i?"vec2":i,a=r.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\nin ").concat(n," ").concat(i," a_").concat(r,";\n#endif\n"):o[r]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(s," a_").concat(r,";\nout ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = unpack_mix_").concat(a,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," a_").concat(r,";\n    out ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(s," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"define-instanced"===t?"mat4"===a?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(r,"0;\nin vec4 a_").concat(r,"1;\nin vec4 a_").concat(r,"2;\nin vec4 a_").concat(r,"3;\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(n," ").concat(s," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#endif\n"):"vec4"===a?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = unpack_mix_").concat(a,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n")}),staticAttributes:r,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class YT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,n,i,r,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let u=0;!l&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let u=0;!c&&u<s.length;u++)this.boundDynamicVertexBuffers[u]!==s[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o)this.freshBind(t,n,i,r,o,s,a);else{e.bindVertexArrayOES.set(this.vao);for(const n of s)n&&(n.bind(),a&&n.instanceCount&&n.setVertexAttribDivisor(e.gl,t,a));r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,n,i,r,o,s){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const u of n)u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r);for(const u of o)u&&(u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r),s&&u.instanceCount&&u.setVertexAttribDivisor(c,e,s));i&&i.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function KT(e,t){const n=Math.pow(2,t.canonical.z),i=t.canonical.y;return[new hp(0,i/n).toLngLat().lat,new hp(0,(i+1)/n).toLngLat().lat]}function JT(e,t,n,i,r,o,s){const a=e.context,l=a.gl,c=n.hillshadeFBO;if(!c)return;e.prepareDrawTile();const u=e.isTileAffectedByFog(t),h=e.getOrCreateProgram("hillshade",{overrideFog:u});a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());const d=((e,t,n,i)=>{const r=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color"),a=n.paint.get("hillshade-emissive-strength");let l=E(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))l-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const t=e.style.directionalLight.properties.get("direction");l=E(te(t.x,t.y,t.z)[1])}const c=!e.options.moving;return{u_matrix:i||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),c),u_image:0,u_latrange:KT(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),l],u_shadow:r,u_highlight:o,u_emissive_strength:a,u_accent:s}})(e,n,i,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(a,h,t.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=e.getTileBoundsBuffers(n);h.draw(e,l.TRIANGLES,r,o,s,Lv.disabled,d,i.id,p,f,m)}function $T(e,t,n){if(!t.needsDEMTextureUpload)return;const i=e.context,r=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(n.stride);const o=n.getPixels();t.demTexture?t.demTexture.update(o,{premultiply:!1}):t.demTexture=new k_(i,o,r.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function QT(e,t,n){const i=e.context,r=i.gl;if(!t.dem)return;const o=t.dem;if(i.activeTexture.set(r.TEXTURE1),$T(e,t,o),!t.demTexture)return;t.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE);const s=o.dim;i.activeTexture.set(r.TEXTURE0);let a=t.hillshadeFBO;if(!a){const e=new k_(i,{width:s,height:s,data:null},r.RGBA);e.bind(r.LINEAR,r.CLAMP_TO_EDGE),a=t.hillshadeFBO=i.createFramebuffer(s,s,!0,"renderbuffer"),a.colorAttachment.set(e.texture)}i.bindFramebuffer.set(a.framebuffer),i.viewport.set([0,0,s,s]);const{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=e.getMercatorTileBoundsBuffers(),h=[];e.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(e,r.TRIANGLES,kv.disabled,Pv.disabled,Dv.unblended,Lv.disabled,((e,t)=>{const n=t.stride,i=Ch.create();return Ch.ortho(i,0,pi,-pi,0,0,1),Ch.translate(i,i,[0,-pi,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ}})(t.tileID,o),n.id,l,c,u),t.needsHillshadePrepare=!1}const eE=e=>({u_matrix:new Wl(e),u_image0:new Bl(e),u_skirt_height:new Nl(e),u_ground_shadow_factor:new Vl(e)}),tE=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),nE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p}),iE=(e,t)=>{if(t>0&&e.terrain&&J("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=e.transform,i=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),r=n.isLODDisabled(!1)?R(60,45,n.pitch):R(30,15,n.pitch),o=n._farZ-n._nearZ,s=t*n.height,a=((1-(l=r))*(.75*n.cameraToCenterDistance)+l*(n._farZ+s))*i;var l;return{shouldRenderCutoff:r<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(a-n._nearZ)/o,(a-s-n._nearZ)/o]}}};function rE(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const oE=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},sE={0:null,1:"TERRAIN_VERTEX_MORPHING"};function aE(e,t,n){if(0===t)return 0;const i=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*i}function lE(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const cE=e=>({u_matrix:e});function uE(e,t,n,i,r){if(r>0){const o=mt.now(),s=(o-e.timeAdded)/r,a=t?(o-t.timeAdded)/r:-1,l=n.getSource(),c=i.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),u=!t||Math.abs(t.tileID.overscaledZ-c)>Math.abs(e.tileID.overscaledZ-c),h=u&&e.refreshedUponExpiration?1:z(u?s:1-a,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}class hE extends Fv{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},n=new Mw(Kw(),null),i=PS("mock-dem",t,n,e.style);super("mock-dem",i,!1),i.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class dE extends Fv{constructor(e){const t=PS("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new Mw(Kw(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,n){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((t,n)=>{if(t[n.key]="",!this._tiles[n.key]){const t=new N_(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[n.key]=t}return t},{});for(const r in this._tiles)r in i||(this.freeFBO(r),this._tiles[r].unloadVectorData(),delete this._tiles[r])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pE extends Hh{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class fE extends eg{constructor(e,t){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,i,r]=function(){const e=new za,t=new Ka,n=131;e.reserve(17161),t.reserve(33800);const i=pi/128,r=pi+i/2,o=r+i;for(let a=-i;a<o;a+=i)for(let t=-i;t<o;t+=i){const n=t<0||t>r||a<0||a>r?24575:0,i=z(Math.round(t),0,pi),o=z(Math.round(a),0,pi);e.emplaceBack(i+n,o)}const s=(e,i)=>{const r=i*n+e;t.emplaceBack(r+1,r,r+n),t.emplaceBack(r+n,r+n+1,r+1)};for(let a=1;a<129;a++)for(let e=1;e<129;e++)s(e,a);return[0,129].forEach(e=>{for(let t=0;t<130;t++)s(t,e),s(e,t)}),[e,t,32768]}(),o=e.context;this.gridBuffer=o.createVertexBuffer(n,Uh.members),this.gridIndexBuffer=o.createIndexBuffer(i),this.gridSegments=wl.simpleSegment(0,0,n.length,i.length),this.gridNoSkirtSegments=wl.simpleSegment(0,0,n.length,r),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dE(t.map),this.orthoMatrix=Ch.create(),Ch.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,pi,0,pi,0,1);const s=o.gl;this._overlapStencilMode=new Pv({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=t,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new hE(t.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,t,n){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const i=e.terrain.properties,r=0===e.terrain.drapeRenderMode,o=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=mt.now();const s=e.terrain&&e.terrain.scope,a=i.get("source"),l=r?this._mockSourceCache:e.getSourceCache(a,s);if(!l)return void J("Couldn't find terrain source \"".concat(a,'".'));if(this.sourceCache=l,this._exaggeration=o?this.calculateExaggeration(t):i.get("exaggeration"),!t.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const c=()=>{this.sourceCache.used&&J("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const e=this.getScaledDemTileSize();this.sourceCache.update(t,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,c(),this._initializing=!0),c(),t.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(t),this._emptyDEMTextureDirty=!0,this._previousZoom=t.zoom}else this._disable()}calculateExaggeration(e){const t=this._previousCameraAltitude,n=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=n;const i=null!=t?n-t:Number.MAX_VALUE;if(Math.abs(i)<2)return this._exaggeration;const r=e.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(r);let s=r-this._previousZoom;const a=this._previousUpdateTimestamp;let l=r;null!=this._evaluationZoom&&(l=this._evaluationZoom,Math.abs(r-l)>.5&&(s=.5*(r-l+s)),s*i<0&&(l+=s)),this._evaluationZoom=l;const c=o.getExaggeration(l),u=c===o.getExaggeration(Math.max(0,l-.1));if(u&&Math.abs(c-this._exaggeration)<.01)return c;let h=Math.min(.1,.00375*(this._updateTimestamp-a));return(u||c<.1||Math.abs(s)<1e-4)&&(h=Math.min(.2,4*h)),tr(this._exaggeration,c,h)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const t=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(hp.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=t.getIds().map(e=>{const i=t.getTileByID(e).tileID;return i.projMatrix=n.calculateProjMatrix(i.toUnwrapped()),i});!function(e,t){const n=t.transform.pointCoordinate(t.transform.getCameraPoint()),i=new b(n.x,n.y);e.sort((e,t)=>{if(t.overscaledZ-e.overscaledZ)return t.overscaledZ-e.overscaledZ;const n=new b(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),r=new b(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=i.mult(1<<e.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(n)-o.distSqr(r)})}(i,this.painter);const r=this.proxyToSource||{};this.proxyToSource={},i.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const a in o){const t=o[a];if(!t.used)continue;if(t!==this.sourceCache&&this.resetTileLookupCache(t.id),this._setupProxiedCoordsForOrtho(t,e[a],r),t.usedForTerrain)continue;const n=e[a];t.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[t.id]=i.map(e=>new pE(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(r),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const a of this.proxyCoords){const e=this.terrainTileForTile[a.key];if(!e)continue;const t=e.tileID.key;t in s||(this._visibleDemTiles.push(e),s[t]=t)}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),$T(this.painter,i,r))}}_prepareDemTileUniforms(e,t,n,i){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),s=i||"";return n["u_dem_tl".concat(s)]=[r.x*o%1,r.y*o%1],n["u_dem_scale".concat(s)]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,t=e.gl;if(!this._emptyDepthBufferTexture){const n=new rf({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new k_(e,n,t.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce((t,n)=>{if(!n.dem)return t;const i=n.dem.tree.minimums[0];return i>0&&e++,t+i},0);return e?t/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,t=e.gl;e.activeTexture.set(t.TEXTURE2);const n=this._getLoadedAreaMinimum(),[i,r]=(()=>{const e=new of({width:1,height:1},new Float32Array([n]));return[t.R32F,e]})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new k_(e,r,i,{premultiply:!1}),o}setupElevationDraw(e,t,n){const i=this.painter.context,r=i.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};o.u_exaggeration=this.exaggeration();let s=null,a=null,l=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,i=n.morphing.dstDemTile;l=n.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,o,"_prev")&&(a=t),this._prepareDemTileUniforms(e,i,o)&&(s=i))}const c=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?r.LINEAR:r.NEAREST,u=e=>{o.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(a&&s)i.activeTexture.set(r.TEXTURE2),s.demTexture.bind(c(s),r.CLAMP_TO_EDGE),i.activeTexture.set(r.TEXTURE4),a.demTexture.bind(c(a),r.CLAMP_TO_EDGE),s.demTexture&&u(s.demTexture),o.u_dem_lerp=l;else{s=this.terrainTileForTile[e.tileID.key],i.activeTexture.set(r.TEXTURE2);const t=this._prepareDemTileUniforms(e,s,o)?s.demTexture:this.emptyDEMTexture;t.bind(c(s),r.CLAMP_TO_EDGE),u(t)}if(i.activeTexture.set(r.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&s){const e=(1<<s.tileID.canonical.z)*np(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=e}if(n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),t.setTerrainUniformValues(i,o),"globe"===this.painter.transform.projection.name){const r=this.globeUniformValues(this.painter.transform,e.tileID.canonical,n&&n.useDenormalizedUpVectorScale);t.setGlobeUniformValues(i,r)}}globeUniformValues(e,t,n){const i=e.projection;return{u_tile_tl_up:i.upVector(t,0,0),u_tile_tr_up:i.upVector(t,pi,0),u_tile_br_up:i.upVector(t,pi,pi),u_tile_bl_up:i.upVector(t,0,pi),u_tile_up_scale:n?pd(1):i.upVectorScale(t,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const t=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]),t.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,t,n,i,r){if("globe"===e.transform.projection.name)!function(e,t,n,i,r){const o=e.context,s=o.gl;let a,l;const c=e.transform,u=Fd(e,o,c),h=(t,n)=>{if(l===n)return;const i=[sE[n],"PROJECTION_GLOBE_VIEW"];u&&i.push("CUSTOM_ANTIALIASING");const r=e.isTileAffectedByFog(t);a=e.getOrCreateProgram("globeRaster",{defines:i,overrideFog:r}),l=n},d=e.colorModeForRenderPass(),p=new kv(s.LEQUAL,kv.ReadWrite,e.depthRangeFor3D);oE.update(r);const f=Rd(c),m=[ep(c.center.lng),tp(c.center.lat)],g=e.globeSharedBuffers,y=[c.width*mt.devicePixelRatio,c.height*mt.devicePixelRatio],_=Float32Array.from(c.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const c=e.transform,u=aE(c.zoom,t.exaggeration(),t.sourceCache._source.tileSize);l=-1;const x=s.TRIANGLES;for(const l of i){const i=n.getTile(l),b=Pv.disabled,w=t.prevTerrainTileForTile[l.key],S=t.terrainTileForTile[l.key];rE(w,S)&&oE.newMorphing(l.key,w,S,r,250),o.activeTexture.set(s.TEXTURE0),i.texture&&i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const T=oE.getMorphValuesForProxy(l.key),E=T?1:0;T&&Ft(v,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:k(T.phase)}});const A=wd(l.canonical),M=Nd(A.getCenter().lat),C=Bd(l.canonical,A,M,c.worldSize/c._pixelsPerMercatorPixel),P=Cd(yd(l.canonical)),I=nE(c.expandedFarZProjMatrix,_,f,P,Ld(c.zoom),m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,y,u,C);if(h(l,E),a&&(t.setupElevationDraw(i,a,v),e.uploadCommonUniforms(o,a,l.toUnwrapped()),g)){const[t,n,i]=g.getGridBuffers(M,0!==u);a.draw(e,x,p,b,d,Lv.backCCW,I,"globe_raster",t,n,i)}}}if(g&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const r=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];u&&r.push("CUSTOM_ANTIALIASING"),a=e.getOrCreateProgram("globeRaster",{defines:r});for(const l of i){const{x:i,y:r,z:u}=l.canonical,h=0===r,f=r===(1<<u)-1,[_,x,b,w]=g.getPoleBuffers(u,!1);if(w&&(h||f)){const r=n.getTile(l);o.activeTexture.set(s.TEXTURE0),r.texture&&r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let g=Od(u,i,c);const S=Cd(yd(l.canonical)),T=(t,n)=>t.draw(e,s.TRIANGLES,p,Pv.disabled,d,Lv.disabled,nE(c.expandedFarZProjMatrix,g,g,S,0,m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,y,0),"globe_pole_raster",n,b,w);t.setupElevationDraw(r,a,v),e.uploadCommonUniforms(o,a,l.toUnwrapped()),h&&e.renderDefaultNorthPole&&T(a,_),f&&e.renderDefaultSouthPole&&(g=Ch.scale(Ch.create(),g,[1,-1,1]),T(a,x))}}}}(e,t,n,i,r);else{const o=e.context,s=o.gl;let a,l;const c=e.shadowRenderer,u=iE(e,e.longestCutoffRange),h=t=>{if(l===t)return;const n=[];n.push(sE[t]),u.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),a=e.getOrCreateProgram("terrainRaster",{defines:n}),l=t},d=e.colorModeForRenderPass(),p=new kv(s.LEQUAL,kv.ReadWrite,e.depthRangeFor3D);oE.update(r);const f=e.transform,m=aE(f.zoom,t.exaggeration(),t.sourceCache._source.tileSize);let g=[0,0,0];if(c){const t=e.style.directionalLight,n=e.style.ambientLight;t&&n&&(g=KA(t,n))}{l=-1;const y=s.TRIANGLES,[_,v]=[t.gridIndexBuffer,t.gridSegments];for(const l of i){const i=n.getTile(l),x=Pv.disabled,b=t.prevTerrainTileForTile[l.key],w=t.terrainTileForTile[l.key];rE(b,w)&&oE.newMorphing(l.key,b,w,r,250),o.activeTexture.set(s.TEXTURE0),i.texture&&i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const S=oE.getMorphValuesForProxy(l.key),T=S?1:0;let E;S&&(E={morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:k(S.phase)}});const A=tE(l.projMatrix,lE(l.canonical,f.renderWorldCopies)?m/10:m,g);if(h(T),!a)continue;t.setupElevationDraw(i,a,E);const M=l.toUnwrapped();c&&c.setupShadows(M,a),e.uploadCommonUniforms(o,a,M,null,u),a.draw(e,y,p,x,d,Lv.backCCW,A,"terrain_raster",t.gridBuffer,_,v)}}}}(t,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,t.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const t=this.painter,n=this.painter.context,i=this.proxySourceCache,r=this.proxiedCoords[i.id],o=this._drapedRenderBatches.shift(),s=t.style.order,a=[];let l=0;for(const c of r){const r=i.getTileByID(c.proxyTileKey),u=i.proxyCachedFBO[c.key]?i.proxyCachedFBO[c.key][e]:void 0,h=void 0!==u?i.renderCache[u]:this.pool[l++],d=void 0!==u;if(r.texture=h.tex,d&&!h.dirty){a.push(r.tileID);continue}let p;n.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(n.clear({color:fn.transparent,stencil:0}),h.dirty=!1);for(let e=o.start;e<=o.end;++e){const i=t.style._mergedLayers[s[e]];if(i.isHidden(t.transform.zoom))continue;const r=t.style.getLayerSourceCache(i),o=r?this.proxyToSource[c.key][r.id]:[c];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(h,o,i,r),p=r?r.id:null),t.renderLayer(t,r,i,a)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const i=t.style._mergedLayers[s[e]];if(i.isHidden(t.transform.zoom))continue;const r=t.style.getLayerSourceCache(i),o=r?this.proxyToSource[c.key][r.id]:[c];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(h,o,i,r),p=r?r.id:null),t.renderLayer(t,r,i,a)}this.renderedToTile?(h.dirty=!0,a.push(r.tileID)):d||--l,5===l&&(l=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]),o.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let n=-1,i=t;for(let r=0;r<t;++r)this._style.isLayerDraped(e._mergedLayers[e.order[r]])?n=Math.max(n,r):i=Math.min(i,r);return i>n}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(t=>{e=Math.min(e,t.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter(e=>e.dem).map(i=>{const r=i.tileID,o=1<<r.overscaledZ,{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:i}});i.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,n);if(null!=i)return i}return null}_createFBO(){const e=this.painter.context,t=e.gl,n=this.drapeBufferSize;e.activeTexture.set(t.TEXTURE0);const i=new k_(e,{width:n[0],height:n[1],data:null},t.RGBA);i.bind(t.LINEAR,t.CLAMP_TO_EDGE);const r=e.createFramebuffer(n[0],n[1],!0,null);return r.colorAttachment.set(i.texture),r.depthAttachment=new Av(e,r.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,r.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):r.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&t.texParameterf(t.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:r,tex:i,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const t=this._style._mergedLayers[e],n=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!n&&t.shouldRedrape():!n&&t.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(const n of this._style.getSources())if(n instanceof qw){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(e);if(i&&!t[i.id]&&!e.isHidden(this.painter.transform.zoom)&&"line"===e.type&&e.widthExpression()instanceof Co){t[i.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][i.id];if(t)for(const e of t)this._clearRenderCacheForTile(i.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n]._source instanceof Ww){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(e);if(!i||t[i.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const r=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=uE(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const n=[];this._pendingGroundEffectLayers=[];let i,r=0,o=this._style._mergedLayers[e[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<t;)o=this._style._mergedLayers[e[r]];for(;r<t;++r){const t=this._style._mergedLayers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===i&&(i=r):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(r),void 0!==i&&(n.push({start:i,end:r-1}),i=void 0)))}if(void 0!==i&&n.push({start:i,end:r-1}),0!==n.length){const e=n[n.length-1];this._pendingGroundEffectLayers.every(t=>t>e.end)||J("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const i=Object.values(e[n]);t.renderCachePool.push(...i)}}return}this._clearRasterLayersFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let o=n.length-1;o>=0;o--){const r=n[o];if(t.getTileByID(r.key),void 0!==t.proxyCachedFBO[r.key]){const n=e[r.key],o=this.proxyToSource[r.key];let s=0;for(const e in o){const t=o[e],r=n[e];if(!r||r.length!==t.length||t.some((t,n)=>t!==r[n]||i[e]&&i[e].hasOwnProperty(t.key))){s=-1;break}++s}for(const e in t.proxyCachedFBO[r.key])t.renderCache[t.proxyCachedFBO[r.key][e]].dirty=s<0||s!==Object.values(n).length}}const r=[...this._drapedRenderBatches];r.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const o of r)for(const e of n){if(t.proxyCachedFBO[e.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][o.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Pv.disabled}_renderTileClippingMasks(e,t){const n=this.painter,i=this.painter.context,r=i.gl;n._tileClippingMaskIDs={},i.setColorMode(Dv.disabled),i.setDepthMode(kv.disabled);const o=n.getOrCreateProgram("clippingMask");for(const s of e){const e=n._tileClippingMaskIDs[s.key]=--t;o.draw(n,r.TRIANGLES,kv.disabled,new Pv({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),Dv.disabled,Lv.disabled,cE(s.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(e){const t=this.painter.transform;if(e.x<0||e.x>t.width||e.y<0||e.y>t.height)return null;const n=[e.x,e.y,1,1];bh.transformMat4(n,n,t.pixelMatrixInverse),bh.scale(n,n,1/n[3]),n[0]/=t.worldSize,n[1]/=t.worldSize;const i=t._camera.position,r=np(1,t.center.lat),o=[i[0],i[1],i[2]/r,0],s=Lh.subtract([],n.slice(0,3),o);Lh.normalize(s,s);const a=this.raycast(o,s,this._exaggeration);return null!==a&&a?(Lh.scaleAndAdd(o,o,s,a),o[3]=o[2],o[2]*=r,o):null}drawDepth(){const e=this.painter,t=e.context,n=this.proxySourceCache,i=Math.ceil(e.width),r=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===r||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=t.gl,n=t.createFramebuffer(i,r,!0,"renderbuffer");t.activeTexture.set(e.TEXTURE0);const o=new k_(t,{width:i,height:r,data:null},e.RGBA);o.bind(e.NEAREST,e.CLAMP_TO_EDGE),n.colorAttachment.set(o.texture);const s=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,i,r);n.depthAttachment.set(s),this._depthFBO=n,this._depthTexture=o}t.bindFramebuffer.set(this._depthFBO.framebuffer),t.viewport.set([0,0,i,r]),function(e,t,n,i){if("globe"===e.transform.projection.name)return;const r=e.context,o=r.gl;r.clear({depth:1});const s=e.getOrCreateProgram("terrainDepth"),a=new kv(o.LESS,kv.ReadWrite,e.depthRangeFor3D);for(const l of i){const i=n.getTile(l),r=tE(l.projMatrix,0,[0,0,0]);t.setupElevationDraw(i,s),s.draw(e,o.TRIANGLES,a,Pv.disabled,Dv.unblended,Lv.backCCW,r,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(e,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,n){if(e.getSource()instanceof tw)return this._setupProxiedCoordsForImageSource(e,t,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const i=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let s=0;s<r.length;s++){const t=r[s],o=this._findTileCoveringTileID(t,e);if(o){const r=this._createProxiedId(t,o,n[t.key]&&n[t.key][e.id]);i.push(r),this.proxyToSource[t.key][e.id]=[r]}}let o=!1;for(let s=0;s<t.length;s++){const r=e.getTile(t[s]);if(!r||!r.hasData())continue;const a=this._findTileCoveringTileID(r.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==r.tileID.canonical.z){const t=this.proxyToSource[a.tileID.key][e.id],s=this._createProxiedId(a.tileID,r,n[a.tileID.key]&&n[a.tileID.key][e.id]);t?t.splice(t.length-1,0,s):this.proxyToSource[a.tileID.key][e.id]=[s],i.push(s),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(e,t,n){if(!e.getSource().loaded())return;const i=this.proxiedCoords[e.id]=[],r=this.proxyCoords,o=e.getSource(),s=o.tileID;if(!s)return;const a=new b(s.x,s.y)._div(1<<s.z),l=o.coordinates.map(hp.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-a.x),e.min.y=Math.min(e.min.y,t.y-a.y),e.max.x=Math.max(e.max.x,t.x-a.x),e.max.y=Math.max(e.max.y,t.y-a.y),e),{min:new b(Number.MAX_VALUE,Number.MAX_VALUE),max:new b(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,t)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),i=e.canonical.y/(1<<e.canonical.z),r=pi/(1<<e.canonical.z),o=t.wrap+t.canonical.x/(1<<t.canonical.z),s=t.canonical.y/(1<<t.canonical.z);return n+r<o+l.min.x||n>o+l.max.x||i+r<s+l.min.y||i>s+l.max.y};for(let u=0;u<r.length;u++){const o=r[u];for(let r=0;r<t.length;r++){const s=e.getTile(t[r]);if(!s||!s.hasData())continue;if(c(o,s.tileID))continue;const a=this._createProxiedId(o,s,n[o.key]&&n[o.key][e.id]),l=this.proxyToSource[o.key][e.id];l?l.push(a):this.proxyToSource[o.key][e.id]=[a],i.push(a)}}}_createProxiedId(e,t,n){let i=this.orthoMatrix;if(n){const e=n.find(e=>e.key===t.tileID.key);if(e)return e}if(t.tileID.key!==e.key){const n=e.canonical.z-t.tileID.canonical.z;let r,o,s;i=Ch.create();const a=t.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(r=pi>>n,o=r*((t.tileID.canonical.x<<n)-e.canonical.x+a),s=r*((t.tileID.canonical.y<<n)-e.canonical.y)):(r=pi<<-n,o=pi*(t.tileID.canonical.x-(e.canonical.x+a<<-n)),s=pi*(t.tileID.canonical.y-(e.canonical.y<<-n))),Ch.ortho(i,0,r,0,r,0,1),Ch.translate(i,i,[o,s,0])}return new pE(t.tileID,e.key,i)}_findTileCoveringTileID(e,t){let n=t.getTile(e);if(n&&n.hasData())return n;const i=this._findCoveringTileCache[t.id],r=i[e.key];if(n=r?t.getTileByID(r):null,n&&n.hasData()||null===r)return n;let o=n?n.tileID:e,s=o.overscaledZ;const a=t.getSource().minzoom,l=[];if(!r){const i=t.getSource().maxzoom;if(e.canonical.z>=i){const n=e.canonical.z-i;t.getSource().reparseOverscaled?(s=Math.max(e.canonical.z+2,t.transform.tileZoom),o=new Hh(s,e.wrap,i,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(s=i,o=new Hh(s,e.wrap,i,e.canonical.x>>n,e.canonical.y>>n))}o.key!==e.key&&(l.push(o.key),n=t.getTile(o))}const c=e=>{l.forEach(t=>{i[t]=e}),l.length=0};for(s-=1;s>=a&&(!n||!n.hasData());s--){n&&c(n.tileID.key);const e=o.calculateScaledKey(s);if(n=t.getTileByID(e),n&&n.hasData())break;const r=i[e];if(null===r)break;void 0===r?l.push(e):n=t.getTileByID(r)}return c(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}}function mE(e,t,n){const i=function(e,t,n){const i=Lh.dot(t,e),r=Lh.dot(n,[.2126,.7152,.0722]),o=(e,t,n)=>(1-n)*e+n*t,s=o(1-.3*Math.min(r,1),1,Math.min(i+1,1));return o(.92,1,Math.asin(z(t[2],-1,1))/Math.PI+.5)*s}(e,[0,0,1],t),r=[0,0,0];Lh.scale(r,n.slice(0,3),i);const o=[0,0,0];Lh.scale(o,t.slice(0,3),e[2]);const s=[0,0,0];return Lh.add(s,r,o),ue(s)}const gE=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],yE=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class _E{static cacheKey(e,t,n,i){let r="".concat(t).concat(i?i.cacheKey:"");for(const o of n)e.usedDefines.includes(o)&&(r+="/".concat(o));return r}constructor(e,t,n,i,r,o){const s=e.gl;this.program=s.createProgram(),this.configuration=i,this.name=t,this.fixedDefines=[...o];const a=i?i.getBinderAttributes():[],l=(n.staticAttributes||[]).concat(a);let c=i?i.defines():[];c=c.concat(o.map(e=>"#define ".concat(e)));const u="#version 300 es\n";let h=u+c.concat("precision mediump float;",WT,qT.fragmentSource).join("\n");for(const m of n.fragmentIncludes)h+="\n".concat(UT[m]);h+="\n".concat(n.fragmentSource);let d=u+c.concat("precision highp float;",WT,qT.vertexSource).join("\n");for(const m of n.vertexIncludes)d+="\n".concat(UT[m]);d+="\n".concat(n.vertexSource);const p=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(p,h),s.compileShader(p),s.attachShader(this.program,p);const f=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(f,d),s.compileShader(f),s.attachShader(this.program,f),this.attributes={},this.numAttributes=l.length;for(let e=0;e<this.numAttributes;e++)if(l[e]){const t=l[e].startsWith("a_")?l[e]:"a_".concat(l[e]);s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}s.linkProgram(this.program),s.deleteShader(f),s.deleteShader(p),this.fixedUniforms=r(e),this.binderUniforms=i?i.getUniforms(e):[],o.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new Bl(e),u_dem_prev:new Bl(e),u_dem_tl:new jl(e),u_dem_scale:new Nl(e),u_dem_tl_prev:new jl(e),u_dem_scale_prev:new Nl(e),u_dem_size:new Nl(e),u_dem_lerp:new Nl(e),u_exaggeration:new Nl(e),u_depth:new Bl(e),u_depth_size_inv:new jl(e),u_meter_to_dem:new Nl(e),u_label_plane_matrix_inv:new Wl(e)}))(e)),o.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new Vl(e),u_tile_tr_up:new Vl(e),u_tile_br_up:new Vl(e),u_tile_bl_up:new Vl(e),u_tile_up_scale:new Nl(e)}))(e)),o.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new Wl(e),u_fog_range:new jl(e),u_fog_color:new Ul(e),u_fog_horizon_blend:new Nl(e),u_fog_vertical_limit:new jl(e),u_fog_temporal_offset:new Nl(e),u_frustum_tl:new Vl(e),u_frustum_tr:new Vl(e),u_frustum_br:new Vl(e),u_frustum_bl:new Vl(e),u_globe_pos:new Vl(e),u_globe_radius:new Nl(e),u_globe_transition:new Nl(e),u_is_globe:new Bl(e),u_viewport:new jl(e)}))(e)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new Ul(e)}))(e)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new Vl(e),u_lighting_directional_dir:new Vl(e),u_lighting_directional_color:new Vl(e),u_ground_radiance:new Vl(e)}))(e)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new Wl(e),u_light_matrix_1:new Wl(e),u_fade_range:new jl(e),u_shadow_normal_offset:new Vl(e),u_shadow_intensity:new Nl(e),u_shadow_texel_size:new Nl(e),u_shadow_map_resolution:new Nl(e),u_shadow_direction:new Vl(e),u_shadow_bias:new Vl(e),u_shadowmap_0:new Bl(e),u_shadowmap_1:new Bl(e)}))(e))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const n=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const n=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const n=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const n=this.shadowUniforms;e.program.set(this.program);for(const i in t)n[i].set(this.program,i,t[i])}_drawDebugWireframe(e,t,n,i,r,o,s,a,l,c){const u=e.options.wireframe;if(!1===u.terrain&&!1===u.layers2D&&!1===u.layers3D)return;const h=e.context;if(!(()=>!(!u.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!u.layers2D||e._terrain&&e._terrain.renderingToTexture||!gE.includes(this.name))||!(!u.layers3D||!yE.includes(this.name)))())return;const d=h.gl,p=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,r,h);if(!p)return;const f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");const m=e.getOrCreateProgram(this.name,{config:this.configuration,defines:f});h.program.set(m.program);const g=(e,t,n)=>{if(t[e]&&n[e])for(const i in t[e])n[e][i]&&n[e][i].set(n.program,i,t[e][i].current)};l&&l.setUniforms(m.program,h,m.binderUniforms,s,{zoom:a}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),p.bind(),h.setColorMode(new Dv([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE],fn.transparent,[!0,!0,!0,!1])),h.setDepthMode(new kv(t.func===d.LESS?d.LEQUAL:t.func,kv.ReadOnly,t.range)),h.setStencilMode(Pv.disabled);const y=3*o.primitiveLength*2,_=3*o.primitiveOffset*2*2;c&&c>1?d.drawElementsInstanced(d.LINES,y,d.UNSIGNED_SHORT,_,c):d.drawElements(d.LINES,y,d.UNSIGNED_SHORT,_),r.bind(),h.program.set(this.program),h.setDepthMode(t),h.setStencilMode(n),h.setColorMode(i)}draw(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=e.context,y=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(n),g.setStencilMode(i),g.setColorMode(r),g.setCullFace(o);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,s[x]);p&&p.setUniforms(this.program,g,this.binderUniforms,h,{zoom:d});const _={[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t],v=m&&m>0?1:void 0;for(const x of u.get()){const o=x.vaos||(x.vaos={});(o[a]||(o[a]=new YT)).bind(g,this,l,p?p.getPaintVertexBuffers():[],c,x.vertexOffset,f||[],v),m&&m>1?y.drawElementsInstanced(t,x.primitiveLength*_,y.UNSIGNED_SHORT,x.primitiveOffset*_*2,m):y.drawElements(t,x.primitiveLength*_,y.UNSIGNED_SHORT,x.primitiveOffset*_*2),t===y.TRIANGLES&&this._drawDebugWireframe(e,n,i,r,c,x,h,d,p,m)}}}function vE(e,t){const n=Math.pow(2,t.tileID.overscaledZ),i=t.tileSize*Math.pow(2,e.transform.tileZoom)/n,r=i*(t.tileID.canonical.x+t.tileID.wrap*n),o=i*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/sx(t,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,o>>16],u_pixel_coord_lower:[65535&r,65535&o]}}const xE=Ch.create(),bE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)=>{const g=t.style.light,y=g.properties.get("position"),_=[y.x,y.y,y.z],v=Mh.create();"viewport"===g.properties.get("anchor")&&(Mh.fromRotation(v,-t.transform.angle),Lh.transformMat3(_,_,v));const x=g.properties.get("color"),b=t.transform,w={u_matrix:e,u_lightpos:_,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xE,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:r,u_edge_radius:o,u_flood_light_color:h,u_vertical_scale:d,u_flood_light_intensity:p,u_ground_shadow_factor:f,u_emissive_strength:m};return"globe"===b.projection.name&&(w.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],w.u_zoom_transition=l,w.u_inv_rot_matrix=u,w.u_merc_center=c,w.u_up_dir=b.projection.upVector(new Wh(0,0,0),c[0]*pi,c[1]*pi),w.u_height_lift=a),w},wE=(e,t,n)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:n}),SE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p)=>{const f=bE(e,t,n,i,r,o,s,l,c,u,h,d,p,1,[0,0,0],0),m={u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8};return B(f,vE(t,a),m)},TE=(e,t)=>({u_matrix:e,u_emissive_strength:t}),EE=(e,t,n,i)=>B(TE(e,t),vE(n,i)),AE=(e,t,n)=>({u_matrix:e,u_world:n,u_emissive_strength:t}),ME=(e,t,n,i,r)=>B(EE(e,t,n,i),{u_world:r}),kE=(e,t,n,i)=>{const r=pi/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(i),u_extrude_scale:[t.pixelsToGLUnits[0]/r,t.pixelsToGLUnits[1]/r]}},CE=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},PE=Ch.create(),IE=(e,t,n,i,r,o,s)=>{const a=e.transform,l="globe"===a.projection.name,c=l?Dd(a.zoom,t.canonical)*a._pixelsPerMercatorPixel:sx(n,1,o),u={u_matrix:t.projMatrix,u_extrude_scale:c,u_intensity:s,u_inv_rot_matrix:PE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=i,u.u_merc_center=r,u.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],u.u_zoom_transition=Ld(a.zoom);const e=r[0]*pi,n=r[1]*pi;u.u_up_dir=a.projection.upVector(new Wh(0,0,0),e,n)}return u},DE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:i,u_grid_matrix:r,u_tl_parent:o,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(S=d.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(w=d.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:zE(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_tl_br:s,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:RE(g,_),u_colorization_offset:LE(y,_),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b};var w,S};function zE(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}function RE(e,t){let[n,i,r,o]=e,[s,a]=t;if(s===a)return[0,0,0,0];const l=259/257/(a-s);return[n*l,i*l,r*l,o*l]}function LE(e,t){let[n,i]=t;return n===i?0:((e-n)/(i-n)*259-1)/257}const OE=Ch.create(),FE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y)=>{const _=r.transform,v={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:_.getCameraToCenterDistance(m),u_rotate_symbol:+n,u_aspect_ratio:_.width/_.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:OE,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:OE,u_up_vector:[0,-1,0],u_icon_transition:y||0,u_icon_saturation:g};return"globe"===m.name&&(v.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],v.u_zoom_transition=h,v.u_inv_rot_matrix=p,v.u_merc_center=d,v.u_camera_forward=_._camera.forward(),v.u_ecef_origin=function(e,t){const n=[0,0,0],i=Cd(yd(t.canonical));return Lh.transformMat4(n,n,i),Lh.transformMat4(n,n,e),n}(_.globeMatrix,u.toUnwrapped()),v.u_tile_matrix=Float32Array.from(_.globeMatrix),v.u_up_vector=f),v},BE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g)=>B(FE(e,t,n,i,r,o,s,a,l,c,h,d,p,f,m,g,1),{u_gamma_scale:i?r.transform.getCameraToCenterDistance(g)*Math.cos(r.terrain?0:r.transform._pitch):1,u_device_pixel_ratio:mt.devicePixelRatio,u_is_halo:+u,undefined:void 0}),NE=(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)=>B(BE(e,t,n,i,r,o,s,a,!0,l,!0,u,h,d,p,f,m),{u_texsize_icon:c,u_texture_icon:1}),jE=(e,t,n,i)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:i}),VE=(e,t,n,i,r,o,s)=>B(function(e,t,n,i){const r=n.imageManager.getPattern(e.toString(),t),{width:o,height:s}=n.imageManager.getPixelSize(t),a=Math.pow(2,i.tileID.overscaledZ),l=i.tileSize*Math.pow(2,n.transform.tileZoom)/a,c=l*(i.tileID.canonical.x+i.tileID.wrap*a),u=l*i.tileID.canonical.y;return{u_image:0,u_pattern_tl:r.tl,u_pattern_br:r.br,u_texsize:[o,s],u_pattern_size:r.displaySize,u_tile_units_to_pixels:1/sx(i,1,n.transform.tileZoom),u_pixel_coord_upper:[c>>16,u>>16],u_pixel_coord_lower:[65535&c,65535&u]}}(r,o,i,s),{u_matrix:e,u_emissive_strength:t,u_opacity:n}),UE={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},GE=function(e,t,n,i,r,o,s,a,l,c,u,h){let d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:[0,0,0];const p=i.style.light,f=p.properties.get("position"),m=[-f.x,-f.y,f.z],g=Mh.create();"viewport"===p.properties.get("anchor")&&(Mh.fromRotation(g,-i.transform.angle),Lh.transformMat3(m,m,g));const y="MASK"===c.alphaMode,_=p.properties.get("color"),v=h.paint.get("model-ambient-occlusion-intensity"),x=h.paint.get("model-color").constantOr(fn.white),b=h.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:n,u_lightpos:m,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_camera_pos:d,u_opacity:r,u_baseTextureIsAlpha:0,u_alphaMask:+y,u_alphaCutoff:c.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[s[0],s[1],s[2],1],u_metallicFactor:a,u_roughnessFactor:l,u_baseColorTexture:UE.BaseColor,u_metallicRoughnessTexture:UE.MetallicRoughness,u_normalTexture:UE.Normal,u_occlusionTexture:UE.Occlusion,u_emissionTexture:UE.Emission,u_color_mix:[x.r,x.g,x.b,b],u_aoIntensity:v,u_emissive_strength:u}},qE=new Float32Array(16),WE=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:qE,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:qE}},ZE={fillExtrusion:e=>({u_matrix:new Wl(e),u_lightpos:new Vl(e),u_lightintensity:new Nl(e),u_lightcolor:new Vl(e),u_vertical_gradient:new Nl(e),u_opacity:new Nl(e),u_edge_radius:new Nl(e),u_ao:new jl(e),u_tile_id:new Vl(e),u_zoom_transition:new Nl(e),u_inv_rot_matrix:new Wl(e),u_merc_center:new jl(e),u_up_dir:new Vl(e),u_height_lift:new Nl(e),u_flood_light_color:new Vl(e),u_vertical_scale:new Nl(e),u_flood_light_intensity:new Nl(e),u_ground_shadow_factor:new Vl(e),u_emissive_strength:new Nl(e)}),fillExtrusionDepth:e=>({u_matrix:new Wl(e),u_edge_radius:new Nl(e),u_vertical_scale:new Nl(e)}),fillExtrusionPattern:e=>({u_matrix:new Wl(e),u_lightpos:new Vl(e),u_lightintensity:new Nl(e),u_lightcolor:new Vl(e),u_vertical_gradient:new Nl(e),u_height_factor:new Nl(e),u_edge_radius:new Nl(e),u_ao:new jl(e),u_tile_id:new Vl(e),u_zoom_transition:new Nl(e),u_inv_rot_matrix:new Wl(e),u_merc_center:new jl(e),u_up_dir:new Vl(e),u_height_lift:new Nl(e),u_image:new Bl(e),u_texsize:new jl(e),u_pixel_coord_upper:new jl(e),u_pixel_coord_lower:new jl(e),u_tile_units_to_pixels:new Nl(e),u_opacity:new Nl(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new Wl(e),u_opacity:new Nl(e),u_ao_pass:new Nl(e),u_meter_to_tile:new Nl(e),u_ao:new jl(e),u_flood_light_intensity:new Nl(e),u_flood_light_color:new Vl(e),u_attenuation:new Nl(e),u_edge_radius:new Nl(e),u_fb:new Bl(e),u_fb_size:new Nl(e)}),fill:e=>({u_matrix:new Wl(e),u_emissive_strength:new Nl(e)}),fillPattern:e=>({u_matrix:new Wl(e),u_emissive_strength:new Nl(e),u_image:new Bl(e),u_texsize:new jl(e),u_pixel_coord_upper:new jl(e),u_pixel_coord_lower:new jl(e),u_tile_units_to_pixels:new Nl(e)}),fillOutline:e=>({u_matrix:new Wl(e),u_emissive_strength:new Nl(e),u_world:new jl(e)}),fillOutlinePattern:e=>({u_matrix:new Wl(e),u_emissive_strength:new Nl(e),u_world:new jl(e),u_image:new Bl(e),u_texsize:new jl(e),u_pixel_coord_upper:new jl(e),u_pixel_coord_lower:new jl(e),u_tile_units_to_pixels:new Nl(e)}),circle:e=>({u_camera_to_center_distance:new Nl(e),u_extrude_scale:new Yl(e),u_device_pixel_ratio:new Nl(e),u_matrix:new Wl(e),u_inv_rot_matrix:new Wl(e),u_merc_center:new jl(e),u_tile_id:new Vl(e),u_zoom_transition:new Nl(e),u_up_dir:new Vl(e),u_emissive_strength:new Nl(e)}),collisionBox:e=>({u_matrix:new Wl(e),u_camera_to_center_distance:new Nl(e),u_extrude_scale:new jl(e)}),collisionCircle:e=>({u_matrix:new Wl(e),u_inv_matrix:new Wl(e),u_camera_to_center_distance:new Nl(e),u_viewport_size:new jl(e)}),debug:e=>({u_color:new Gl(e),u_matrix:new Wl(e),u_overlay:new Bl(e),u_overlay_scale:new Nl(e)}),clippingMask:e=>({u_matrix:new Wl(e)}),heatmap:e=>({u_extrude_scale:new Nl(e),u_intensity:new Nl(e),u_matrix:new Wl(e),u_inv_rot_matrix:new Wl(e),u_merc_center:new jl(e),u_tile_id:new Vl(e),u_zoom_transition:new Nl(e),u_up_dir:new Vl(e)}),heatmapTexture:e=>({u_image:new Bl(e),u_color_ramp:new Bl(e),u_opacity:new Nl(e)}),hillshade:e=>({u_matrix:new Wl(e),u_image:new Bl(e),u_latrange:new jl(e),u_light:new jl(e),u_shadow:new Gl(e),u_highlight:new Gl(e),u_emissive_strength:new Nl(e),u_accent:new Gl(e)}),hillshadePrepare:e=>({u_matrix:new Wl(e),u_image:new Bl(e),u_dimension:new jl(e),u_zoom:new Nl(e)}),line:e=>({u_matrix:new Wl(e),u_pixels_to_tile_units:new Yl(e),u_device_pixel_ratio:new Nl(e),u_units_to_pixels:new jl(e),u_dash_image:new Bl(e),u_gradient_image:new Bl(e),u_image_height:new Nl(e),u_texsize:new jl(e),u_tile_units_to_pixels:new Nl(e),u_alpha_discard_threshold:new Nl(e),u_trim_offset:new jl(e),u_emissive_strength:new Nl(e)}),linePattern:e=>({u_matrix:new Wl(e),u_texsize:new jl(e),u_pixels_to_tile_units:new Yl(e),u_device_pixel_ratio:new Nl(e),u_image:new Bl(e),u_units_to_pixels:new jl(e),u_tile_units_to_pixels:new Nl(e),u_alpha_discard_threshold:new Nl(e)}),raster:e=>({u_matrix:new Wl(e),u_normalize_matrix:new Wl(e),u_globe_matrix:new Wl(e),u_merc_matrix:new Wl(e),u_grid_matrix:new Hl(e),u_tl_parent:new jl(e),u_scale_parent:new Nl(e),u_fade_t:new Nl(e),u_opacity:new Nl(e),u_image0:new Bl(e),u_image1:new Bl(e),u_brightness_low:new Nl(e),u_brightness_high:new Nl(e),u_saturation_factor:new Nl(e),u_contrast_factor:new Nl(e),u_spin_weights:new Vl(e),u_perspective_transform:new jl(e),u_raster_elevation:new Nl(e),u_tl_br:new Ul(e),u_zoom_transition:new Nl(e),u_merc_center:new jl(e),u_cutoff_params:new Ul(e),u_colorization_mix:new Ul(e),u_colorization_offset:new Nl(e),u_color_ramp:new Bl(e),u_texture_offset:new jl(e),u_texture_res:new jl(e),u_emissive_strength:new Nl(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Bl(e),u_is_size_feature_constant:new Bl(e),u_size_t:new Nl(e),u_size:new Nl(e),u_camera_to_center_distance:new Nl(e),u_rotate_symbol:new Bl(e),u_aspect_ratio:new Nl(e),u_fade_change:new Nl(e),u_matrix:new Wl(e),u_label_plane_matrix:new Wl(e),u_coord_matrix:new Wl(e),u_is_text:new Bl(e),u_pitch_with_map:new Bl(e),u_texsize:new jl(e),u_tile_id:new Vl(e),u_zoom_transition:new Nl(e),u_inv_rot_matrix:new Wl(e),u_merc_center:new jl(e),u_camera_forward:new Vl(e),u_tile_matrix:new Wl(e),u_up_vector:new Vl(e),u_ecef_origin:new Vl(e),u_texture:new Bl(e),u_icon_transition:new Nl(e),u_icon_saturation:new Nl(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Bl(e),u_is_size_feature_constant:new Bl(e),u_size_t:new Nl(e),u_size:new Nl(e),u_camera_to_center_distance:new Nl(e),u_rotate_symbol:new Bl(e),u_aspect_ratio:new Nl(e),u_fade_change:new Nl(e),u_matrix:new Wl(e),u_label_plane_matrix:new Wl(e),u_coord_matrix:new Wl(e),u_is_text:new Bl(e),u_pitch_with_map:new Bl(e),u_texsize:new jl(e),u_texture:new Bl(e),u_gamma_scale:new Nl(e),u_device_pixel_ratio:new Nl(e),u_tile_id:new Vl(e),u_zoom_transition:new Nl(e),u_inv_rot_matrix:new Wl(e),u_merc_center:new jl(e),u_camera_forward:new Vl(e),u_tile_matrix:new Wl(e),u_up_vector:new Vl(e),u_ecef_origin:new Vl(e),u_is_halo:new Bl(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Bl(e),u_is_size_feature_constant:new Bl(e),u_size_t:new Nl(e),u_size:new Nl(e),u_camera_to_center_distance:new Nl(e),u_rotate_symbol:new Bl(e),u_aspect_ratio:new Nl(e),u_fade_change:new Nl(e),u_matrix:new Wl(e),u_label_plane_matrix:new Wl(e),u_coord_matrix:new Wl(e),u_is_text:new Bl(e),u_pitch_with_map:new Bl(e),u_texsize:new jl(e),u_texsize_icon:new jl(e),u_texture:new Bl(e),u_texture_icon:new Bl(e),u_gamma_scale:new Nl(e),u_device_pixel_ratio:new Nl(e),u_is_halo:new Bl(e)}),background:e=>({u_matrix:new Wl(e),u_emissive_strength:new Nl(e),u_opacity:new Nl(e),u_color:new Gl(e)}),backgroundPattern:e=>({u_matrix:new Wl(e),u_emissive_strength:new Nl(e),u_opacity:new Nl(e),u_image:new Bl(e),u_pattern_tl:new jl(e),u_pattern_br:new jl(e),u_texsize:new jl(e),u_pattern_size:new jl(e),u_pixel_coord_upper:new jl(e),u_pixel_coord_lower:new jl(e),u_tile_units_to_pixels:new Nl(e)}),terrainRaster:eE,terrainDepth:eE,skybox:e=>({u_matrix:new Wl(e),u_sun_direction:new Vl(e),u_cubemap:new Bl(e),u_opacity:new Nl(e),u_temporal_offset:new Nl(e)}),skyboxGradient:e=>({u_matrix:new Wl(e),u_color_ramp:new Bl(e),u_center_direction:new Vl(e),u_radius:new Nl(e),u_opacity:new Nl(e),u_temporal_offset:new Nl(e)}),skyboxCapture:e=>({u_matrix_3f:new Hl(e),u_sun_direction:new Vl(e),u_sun_intensity:new Nl(e),u_color_tint_r:new Ul(e),u_color_tint_m:new Ul(e),u_luminance:new Nl(e)}),globeRaster:e=>({u_proj_matrix:new Wl(e),u_globe_matrix:new Wl(e),u_normalize_matrix:new Wl(e),u_merc_matrix:new Wl(e),u_zoom_transition:new Nl(e),u_merc_center:new jl(e),u_image0:new Bl(e),u_grid_matrix:new Hl(e),u_skirt_height:new Nl(e),u_frustum_tl:new Vl(e),u_frustum_tr:new Vl(e),u_frustum_br:new Vl(e),u_frustum_bl:new Vl(e),u_globe_pos:new Vl(e),u_globe_radius:new Nl(e),u_viewport:new jl(e)}),globeAtmosphere:e=>({u_frustum_tl:new Vl(e),u_frustum_tr:new Vl(e),u_frustum_br:new Vl(e),u_frustum_bl:new Vl(e),u_horizon:new Nl(e),u_transition:new Nl(e),u_fadeout_range:new Nl(e),u_color:new Ul(e),u_high_color:new Ul(e),u_space_color:new Ul(e),u_temporal_offset:new Nl(e),u_horizon_angle:new Nl(e)}),model:e=>({u_matrix:new Wl(e),u_lighting_matrix:new Wl(e),u_normal_matrix:new Wl(e),u_lightpos:new Vl(e),u_lightintensity:new Nl(e),u_lightcolor:new Vl(e),u_camera_pos:new Vl(e),u_opacity:new Nl(e),u_baseColorFactor:new Ul(e),u_emissiveFactor:new Ul(e),u_metallicFactor:new Nl(e),u_roughnessFactor:new Nl(e),u_baseTextureIsAlpha:new Bl(e),u_alphaMask:new Bl(e),u_alphaCutoff:new Nl(e),u_baseColorTexture:new Bl(e),u_metallicRoughnessTexture:new Bl(e),u_normalTexture:new Bl(e),u_occlusionTexture:new Bl(e),u_emissionTexture:new Bl(e),u_color_mix:new Ul(e),u_aoIntensity:new Nl(e),u_emissive_strength:new Nl(e)}),modelDepth:e=>({u_matrix:new Wl(e),u_instance:new Wl(e),u_node_matrix:new Wl(e)}),groundShadow:e=>({u_matrix:new Wl(e),u_ground_shadow_factor:new Vl(e)}),stars:e=>({u_matrix:new Wl(e),u_up:new Vl(e),u_right:new Vl(e),u_intensity_multiplier:new Nl(e)})};let HE;function XE(e,t,n,i,r,o,s){const a=e.context,l=a.gl,c=e.transform,u=e.getOrCreateProgram("collisionBox"),h=[];let d=0,p=0;for(let x=0;x<i.length;x++){const a=i[x],f=t.getTile(a),m=f.getBucket(n);if(!m)continue;const g=$S(a,m,c);let y=g;0===r[0]&&0===r[1]||(y=e.translatePosMatrix(g,f,r,o));const _=s?m.textCollisionBox:m.iconCollisionBox,v=m.collisionCircleArray;if(v.length>0){const e=Ch.create(),t=y;Ch.mul(e,m.placementInvProjMatrix,c.glCoordMatrix),Ch.mul(e,e,m.placementViewportMatrix),h.push({circleArray:v,circleOffset:p,transform:t,invTransform:e,projection:m.getProjection()}),d+=v.length/4,p=d}_&&(e.terrain&&e.terrain.setupElevationDraw(f,u),u.draw(e,l.LINES,kv.disabled,Pv.disabled,e.colorModeForRenderPass(),Lv.disabled,kE(y,c,f,m.getProjection()),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,c.zoom,null,[_.collisionVertexBuffer,_.collisionVertexBufferExt]))}if(!s||!h.length)return;const f=e.getOrCreateProgram("collisionCircle"),m=new Xa;m.resize(4*d),m._trim();let g=0;for(const x of h)for(let e=0;e<x.circleArray.length/4;e++){const t=4*e,n=x.circleArray[t+0],i=x.circleArray[t+1],r=x.circleArray[t+2],o=x.circleArray[t+3];m.emplace(g++,n,i,r,o,0),m.emplace(g++,n,i,r,o,1),m.emplace(g++,n,i,r,o,2),m.emplace(g++,n,i,r,o,3)}(!HE||HE.length<2*d)&&(HE=function(e){const t=2*e,n=new Ka;n.resize(t),n._trim();for(let i=0;i<t;i++){const e=6*i;n.uint16[e+0]=4*i+0,n.uint16[e+1]=4*i+1,n.uint16[e+2]=4*i+2,n.uint16[e+3]=4*i+2,n.uint16[e+4]=4*i+3,n.uint16[e+5]=4*i+0}return n}(d));const y=a.createIndexBuffer(HE,!0),_=a.createVertexBuffer(m,pg.members,!0);for(const x of h){const t={u_matrix:x.transform,u_inv_matrix:x.invTransform,u_camera_to_center_distance:(v=c).getCameraToCenterDistance(x.projection),u_viewport_size:[v.width,v.height]};f.draw(e,l.TRIANGLES,kv.disabled,Pv.disabled,e.colorModeForRenderPass(),Lv.disabled,t,n.id,_,y,wl.simpleSegment(0,2*x.circleOffset,x.circleArray.length,x.circleArray.length/2),null,c.zoom)}var v;_.destroy(),y.destroy()}const YE=Ch.create();function KE(e,t){let{width:n,height:i,anchor:r,textOffset:o,textScale:s}=e;const{horizontalAlign:a,verticalAlign:l}=Vg(r),c=-(a-.5)*n,u=-(l-.5)*i,h=wy(r,o);return new b((c/s+h[0])*t,(u/s+h[1])*t)}function JE(e,t,n,i,r,o,s,a,l,c,u){const h=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,p=e.icon.dynamicLayoutVertexArray,f={},m=e.getProjection(),g=QS(a,m,o),y=o.elevation,_=m.upVectorScale(a.canonical,o.center.lat,o.worldSize).metersToTile;d.clear();for(let v=0;v<h.length;v++){const p=h.get(v),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=p,S=p.hidden||!p.crossTileID||e.allowVerticalPlacement&&!p.placedOrientation?null:i[p.crossTileID];if(S){let i=0,h=0,v=0;if(y){const e=y?y.getAtTileOffset(a,x,b):0,[t,n,r]=m.upVector(a.canonical,x,b);i=e*t*_,h=e*n*_,v=e*r*_}let[T,E,A,M]=dx(p.projectedAnchorX+i,p.projectedAnchorY+h,p.projectedAnchorZ+v,n?g:s);const k=px(o.getCameraToCenterDistance(m),M);let C=r.evaluateSizeForFeature(e.textSizeData,c,p)*k/fg;n&&(C*=e.tilePixelRatio/l);const P=KE(S,C);n?(({x:T,y:E,z:A}=m.projectTilePoint(x+P.x,b+P.y,a.canonical)),[T,E,A]=dx(T+i,E+h,A+v,s)):(t&&P._rotate(-o.angle),T+=P.x,E+=P.y,A=0);const I=e.allowVerticalPlacement&&p.placedOrientation===Cg.vertical?Math.PI/2:0;for(let e=0;e<w;e++)m_(d,T,E,A,I);u&&p.associatedIconIndex>=0&&(f[p.associatedIconIndex]={x:T,y:E,z:A,angle:I})}else wx(w,d)}if(u){p.clear();const t=e.icon.placedSymbolArray;for(let e=0;e<t.length;e++){const n=t.get(e),{numGlyphs:i}=n,r=f[e];if(n.hidden||!r)wx(i,p);else{const{x:e,y:t,z:n,angle:o}=r;for(let r=0;r<i;r++)m_(p,e,t,n,o)}}e.icon.dynamicLayoutVertexBuffer.updateData(p)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function $E(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function QE(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=e.context,f=p.gl,m=e.transform,g="map"===a,y="map"===l,_=g&&"point"!==n.layout.get("symbol-placement"),v=g&&!y&&!_,x=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=e.depthModeForSublayer(0,kv.ReadOnly),S=[ep(m.center.lng),tp(m.center.lat)],T=n.layout.get("text-variable-anchor"),E="globe"===m.projection.name,A=[],M=[0,-1,0];let k=M;!E&&!m.mercatorFromTransition||g||(k=function(e){const t=e._camera.getWorldToCamera(e.worldSize,1),n=Ch.multiply([],t,e.globeMatrix);Ch.invert(n,n);const i=[0,0,0],r=[0,1,0,0];return bh.transformMat4(r,r,n),i[0]=r[0],i[1]=r[1],i[2]=r[2],Lh.normalize(i,i),i}(m));for(const C of i){const i=t.getTile(C),a=i.getBucket(n);if(!a)continue;if("mercator"===a.projection.name&&E)continue;const l=r?a.text:a.icon;if(!l||a.fullyClipped||!l.segments.get().length)continue;const h=l.programConfigurations.get(n.id),d=r||a.sdfIcons,p=r?a.textSizeData:a.iconSizeData,w=y||0!==m.pitch,P=_g(p,m.zoom);let I,D,z,R,L=[0,0],O=null;if(r)D=i.glyphAtlasTexture?i.glyphAtlasTexture:null,z=f.LINEAR,I=i.glyphAtlasTexture?i.glyphAtlasTexture.size:[0,0],a.iconsInText&&(L=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],O=i.imageAtlasTexture?i.imageAtlasTexture:null,R=w||e.options.rotating||e.options.zooming||"composite"===p.kind||"camera"===p.kind?f.LINEAR:f.NEAREST);else{const t=1!==n.layout.get("icon-size").constantOr(0)||a.iconsNeedLinear;D=i.imageAtlasTexture?i.imageAtlasTexture:null,z=d||e.options.rotating||e.options.zooming||t||w?f.LINEAR:f.NEAREST,I=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0]}const F="globe"===a.projection.name,B=F?k:M,N=F?Ld(m.zoom):0,j=QS(C,a.getProjection(),m),V=m.calculatePixelsToTileUnitsMatrix(i),U=cx(j,i.tileID.canonical,y,g,m,a.getProjection(),V),G=e.terrain&&y&&_?Ch.invert(Ch.create(),U):YE,q=hx(j,i.tileID.canonical,y,g,m,a.getProjection(),V),W=T&&a.hasTextData(),Z=a.hasIconTextFit()&&W&&a.hasIconData();if(_){const t=m.elevation,n=t?t.getAtTileOffsetFunc(C,m.center.lat,m.worldSize,a.getProjection()):null,o=ux(j,i.tileID.canonical,y,g,m,a.getProjection(),V);mx(a,j,e,r,o,q,y,c,n,C)}const H=_||r&&T||Z,X=e.translatePosMatrix(j,i,o,s),Y=H?YE:U,K=e.translatePosMatrix(q,i,o,s,!0),J=a.getProjection().createInversionMatrix(m,C.canonical),$=n.paint.get("icon-image-cross-fade").constantOr(0),Q=[];e.terrainRenderModeElevated()&&y&&Q.push("PITCH_WITH_MAP_TERRAIN"),F&&(Q.push("PROJECTION_GLOBE_VIEW"),H&&Q.push("PROJECTED_POS_ON_VIEWPORT")),$>0&&Q.push("ICON_TRANSITION"),l.zOffsetVertexBuffer&&Q.push("Z_OFFSET");const ee=d&&0!==n.paint.get(r?"text-halo-width":"icon-halo-width").constantOr(1);let te;d?te=a.iconsInText?NE(p.kind,P,v,y,e,X,Y,K,I,L,C,N,S,J,B,a.getProjection()):BE(p.kind,P,v,y,e,X,Y,K,r,I,!0,C,N,S,J,B,a.getProjection()):(u<1&&Q.push("SATURATION"),te=FE(p.kind,P,v,y,e,X,Y,K,r,I,C,N,S,J,B,a.getProjection(),u,$));const ne={program:e.getOrCreateProgram($E(d,r,a),{config:h,defines:Q}),buffers:l,uniformValues:te,atlasTexture:D,atlasTextureIcon:O,atlasInterpolation:z,atlasInterpolationIcon:R,isSDF:d,hasHalo:ee,tile:i,labelPlaneMatrixInv:G};if(x&&a.canOverlap){b=!0;const e=l.segments.get();for(const t of e)A.push({segments:new wl([t]),sortKey:t.sortKey,state:ne})}else A.push({segments:l.segments,sortKey:0,state:ne})}b&&A.sort((e,t)=>e.sortKey-t.sortKey);for(const C of A){const t=C.state;if(e.terrain&&e.terrain.setupElevationDraw(t.tile,t.program,{useDepthForOcclusion:m.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:t.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),t.atlasTexture&&t.atlasTexture.bind(t.atlasInterpolation,f.CLAMP_TO_EDGE),t.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),t.atlasTextureIcon&&t.atlasTextureIcon.bind(t.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,t.program),t.hasHalo){const i=t.uniformValues;i.u_is_halo=1,eA(t.buffers,C.segments,n,e,t.program,w,h,d,i,2),i.u_is_halo=0}else{if(t.isSDF){const i=t.uniformValues;t.hasHalo&&(i.u_is_halo=1,eA(t.buffers,C.segments,n,e,t.program,w,h,d,i,1)),i.u_is_halo=0}eA(t.buffers,C.segments,n,e,t.program,w,h,d,t.uniformValues,1)}}}function eA(e,t,n,i,r,o,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];r.draw(i,i.context.gl.TRIANGLES,o,s,a,Lv.disabled,l,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),u,c)}function tA(e,t,n,i,r,o,s){const a=e.context.gl,l=n.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,d,p,f;s?(h=c&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of i){const i=t.getTile(m);if(c&&!i.patternsLoaded())continue;const g=i.getBucket(n);if(!g)continue;e.prepareDrawTile();const y=g.programConfigurations.get(n.id),_=e.isTileAffectedByFog(m),v=e.getOrCreateProgram(h,{config:y,overrideFog:_});c&&(e.context.activeTexture.set(a.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),y.updatePaintBuffers());const x=l.constantOr(null);if(x&&i.imageAtlas){const e=i.imageAtlas.patternPositions[x.toString()];e&&y.setConstantPatternPositions(e)}const b=e.translatePosMatrix(m.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),w=n.paint.get("fill-emissive-strength");if(s){p=g.indexBuffer2,f=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===h&&c?ME(b,w,e,i,t):AE(b,w,t)}else p=g.indexBuffer,f=g.segments,d=c?EE(b,w,e,i):TE(b,w);e.uploadCommonUniforms(e.context,v,m.toUnwrapped()),v.draw(e,u,r,e.stencilModeForClipping(m),o,Lv.disabled,d,n.id,g.layoutVertexBuffer,p,f,n.paint,e.transform.zoom,y,void 0)}}function nA(e,t,n,i,r,o,s,a){n.resetLayerRenderingStats();const l=e.context,c=l.gl,u=e.transform,h=n.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=n.paint.get("fill-extrusion-opacity"),f=e.style.enable3dLights(),m=n.paint.get(f&&!d?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),m],y=n.layout.get("fill-extrusion-edge-radius"),_=y>0&&!n.paint.get("fill-extrusion-rounded-roof"),v=_?0:y,x="globe"===u.projection.name?Ib():0,b="globe"===u.projection.name,w=b?Ld(u.zoom):0,S=[ep(u.center.lng),tp(u.center.lat)],T=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),E=n.paint.get("fill-extrusion-flood-light-intensity"),A=n.paint.get("fill-extrusion-vertical-scale"),M=iE(e,n.paint.get("fill-extrusion-cutoff-fade-range")),k=n.paint.get("fill-extrusion-emissive-strength"),C=[];let P;b&&C.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&C.push("FAUX_AO"),_&&C.push("ZERO_ROOF_RADIUS"),a&&C.push("HAS_CENTROID"),E>0&&C.push("FLOOD_LIGHT"),M.shouldRenderCutoff&&C.push("RENDER_CUTOFF");const I="shadow"===e.renderPass,D=e.shadowRenderer,z=I&&!!D;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let R=[0,0,0];if(D){const t=e.style.directionalLight,n=e.style.ambientLight;t&&n&&(R=KA(t,n)),P=C.concat(["SHADOWS_SINGLE_CASCADE"])}const L=z?"fillExtrusionDepth":d?"fillExtrusionPattern":"fillExtrusion",O=n.getLayerRenderingStats();for(const F of i){const i=t.getTile(F),f=i.getBucket(n);if(!f||f.projection.name!==u.projection.name)continue;let m=!1;D&&(m=0===D.getMaxCascadeForTile(F.toUnwrapped()));const y=e.isTileAffectedByFog(F),_=f.programConfigurations.get(n.id),z=e.getOrCreateProgram(L,{config:_,defines:m?P:C,overrideFog:y});if(e.terrain&&e.terrain.setupElevationDraw(i,z,{useMeterToDem:!0}),!f.centroidVertexBuffer){const e=z.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}!I&&D&&D.setupShadows(i.tileID.toUnwrapped(),z,"vector-tile",i.tileID.overscaledZ),d&&(e.context.activeTexture.set(c.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),_.updatePaintBuffers());const B=h.constantOr(null);if(B&&i.imageAtlas){const e=i.imageAtlas.patternPositions[B.toString()];e&&_.setConstantPatternPositions(e)}const N=n.paint.get("fill-extrusion-vertical-gradient");let j;if(I&&D){if(lA(i.tileID,f,e))continue;const t=D.calculateShadowPassMatrixFromTile(i.tileID.toUnwrapped());j=wE(t,v,A)}else{const t=e.translatePosMatrix(F.expandedProjMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=u.projection.createInversionMatrix(u,F.canonical);j=d?SE(t,e,N,p,g,v,F,i,x,w,S,r,T,A):bE(t,e,N,p,g,v,F,x,w,S,r,T,A,E,R,k)}e.uploadCommonUniforms(l,z,F.toUnwrapped(),null,M);let V=f.segments;if(!b&&!I&&(V=f.getVisibleSegments(i.tileID,e.terrain,e.transform.getFrustum(0)),!V.get().length))continue;if(O)if(I)for(const e of V.get())O.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of V.get())O.numRenderedVerticesInTransparentPass+=e.primitiveLength;const U=[];(e.terrain||a)&&U.push(f.centroidVertexBuffer),b&&U.push(f.layoutVertexExtBuffer),z.draw(e,l.gl.TRIANGLES,r,o,s,Lv.backCCW,j,n.id,f.layoutVertexBuffer,f.indexBuffer,V,n.paint,e.transform.zoom,_,U)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function iA(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_){const v=e.context,x=v.gl,b=e.transform,w=e.transform.zoom,S=[],T=iE(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===c?(S.push("CLEAR_SUBPASS"),_&&(S.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(x.TEXTURE0),_.bind(x.LINEAR,x.CLAMP_TO_EDGE))):"sdf"===c&&S.push("SDF_SUBPASS"),g&&S.push("HAS_CENTROID"),T.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const E=n.layout.get("fill-extrusion-edge-radius"),A=(t,i,c,y,x)=>{const b=i.programConfigurations.get(n.id),A=e.isTileAffectedByFog(t),M=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:S,overrideFog:A}),k=((e,t,n,i,r,o,s,a,l,c,u)=>({u_matrix:t,u_opacity:n,u_ao_pass:i?1:0,u_meter_to_tile:r,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,y,u,l,x,[h,d*x],p,f,m,w>=17?0:E*x,_?_.size[0]:0),C=[];g&&C.push(i.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(v,M,t.toUnwrapped(),null,T),M.draw(e,v.gl.TRIANGLES,r,o,s,a,k,n.id,i.vertexBuffer,i.indexBuffer,c,n.paint,w,b,C)};for(const M of i){const i=t.getTile(M),r=i.getBucket(n);if(!r||r.projection.name!==b.projection.name||!r.groundEffect||r.groundEffect&&!r.groundEffect.hasData())continue;const o=r.groundEffect,s=1/r.tileToMeter;{const t=e.translatePosMatrix(M.projMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=o.getDefaultSegment();A(M,o,r,t,s)}if(y)for(let a=0;a<4;a++){const r=Yh[a](M),o=t.getTile(r);if(!o)continue;const l=o.getBucket(n);if(!l||l.projection.name!==b.projection.name||!l.groundEffect||l.groundEffect&&!l.groundEffect.hasData())continue;const c=l.groundEffect;let u,h;0===a?(u=[-pi,0,0],h=1):1===a?(u=[pi,0,0],h=0):2===a?(u=[0,-pi,0],h=3):(u=[0,pi,0],h=2);const d=c.regionSegments[h];if(!d)continue;const p=new Float32Array(16);Ch.translate(p,M.projMatrix,u),A(M,c,d,e.translatePosMatrix(p,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),s)}}}function rA(e,t,n,i,r,o,s){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const a=o?o.findDEMTileFor(n):null;if(!(a&&a.dem||s))return;const l=e=>{const n=t.getSource().minzoom,i=e=>{const n=t.getTileByID(e);if(n&&n.hasData())return n.getBucket(r)},o=[0,-1,1];for(const t of o){if(e.overscaledZ+t<n)continue;const r=i(e.calculateScaledKey(e.overscaledZ+t));if(r)return r}},c=[0,0,0],u=(e,t)=>(c[0]=Math.min(e.min.y,t.min.y),c[1]=Math.max(e.max.y,t.max.y),c[2]=pi-t.min.x>e.max.x?t.min.x-pi:e.max.x,c),h=(e,t)=>(c[0]=Math.min(e.min.x,t.min.x),c[1]=Math.max(e.max.x,t.max.x),c[2]=pi-t.min.y>e.max.y?t.min.y-pi:e.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=(e,t,i,r,s,l,c)=>{if(!o)return 0;const u=[[l?i:e,l?e:i,0],[l?i:t,l?t:i,0]],h=c<0?pi+c:c,d=[l?h:(e+t)/2,l?(e+t)/2:h,0];return 0===i&&c<0||0!==i&&c>0?o.getForTilePoints(s,[d],!0,r):u.push(d),o.getForTilePoints(n,u,!0,a),Math.max(u[0][2],u[1][2],d[2])/o.exaggeration()};for(let y=0;y<4;y++){const e=i.borderFeatureIndices[y];if(0===e.length)continue;const t=Yh[y](n),r=l(t);if(!(r&&r instanceof Sb))continue;if(i.borderDoneWithNeighborZ[y]===r.canonical.z)continue;0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const a=o?o.findDEMTileFor(t):null;if(!(a&&a.dem||s))continue;const c=(y<2?1:5)-y,u=r.borderDoneWithNeighborZ[c]!==i.canonical.z,h=r.borderFeatureIndices[c];let _=0;if(i.canonical.z!==r.canonical.z){for(const t of e)i.showCentroid(i.featuresOnBorder[t]);if(u)for(const e of h)r.showCentroid(r.featuresOnBorder[e]);i.borderDoneWithNeighborZ[y]=r.canonical.z,r.borderDoneWithNeighborZ[c]=i.canonical.z}for(const n of e){const e=i.featuresOnBorder[n],o=i.centroidData[e.centroidDataIndex],l=e.borders[y];let u;for(;_<h.length;){u=r.featuresOnBorder[h[_]];const e=u.borders[c];if(e[1]>l[0]+3||e[0]>l[0]-3)break;r.showCentroid(u),_++}if(u&&_<h.length){const n=_;let v=0;for(;!(u.borders[c][0]>l[1]-3)&&(v++,++_!==h.length);)u=r.featuresOnBorder[h[_]];if(u=r.featuresOnBorder[h[n]],v>1){const e=u.borders[c];Math.abs(l[0]-e[0])<3&&Math.abs(l[1]-e[1])<3&&(v=1,_=n+1)}else if(0===v){i.showCentroid(e);continue}const x=r.centroidData[u.centroidDataIndex];s&&1===v&&(((m=o).flags|(g=x).flags)&db?(m.flags|=db,g.flags|=db):(m.flags&=2147483647,g.flags&=2147483647));let w=new b(0,0);if(v>1)_=n;else if(a&&a.dem&&!(e.intersectsCount()>1||u.intersectsCount()>1)){const e=d[y](o,x),n=y%2?pi-1:0;f=p(e[0],Math.min(pi-1,e[1]),n,a,t,y<2,e[2]),w=new b(Math.ceil(7*(f+450)),0)}o.centroidXY=x.centroidXY=w,i.writeCentroidToBuffer(o),r.writeCentroidToBuffer(x)}else i.showCentroid(e)}i.borderDoneWithNeighborZ[y]=r.canonical.z,r.borderDoneWithNeighborZ[c]=i.canonical.z}var f,m,g;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(e)}const oA=[1,0,0],sA=[0,1,0],aA=[0,0,1];function lA(e,t,n){const i=n.transform,r=n.shadowRenderer;if(!r)return!0;const o=e.toUnwrapped(),s=i.tileSize*r._cascades[n.currentShadowCascade].scale;let a=t.maxHeight;if(i.elevation){const t=i.elevation.getMinMaxForTile(e);t&&(a+=t.max)}const l=[...r.shadowDirection];l[2]=-l[2];const c=r.computeSimplifiedTileShadowVolume(o,a,s,l);if(!c)return!1;const u=[oA,sA,aA,l,[l[0],0,l[2]],[0,l[1],l[2]]],h="globe"===i.projection.name,d=i.scaleZoom(s),p=nd.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,d,!h),f=r.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(c.vertices,c.planes,u)||0===f.intersectsPrecise(c.vertices,c.planes,u)}function cA(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),i=n-t,r=.2*e.height,o=t+r;return[t,n,(o-r-t)/i,(o-t)/i]}const uA=new fn(1,0,0,1),hA=new fn(0,1,0,1),dA=new fn(0,0,1,1),pA=new fn(1,0,1,1),fA=new fn(0,1,1,1);function mA(e,t,n){const i=e.context,r=e.transform,o=i.gl,s="globe"===r.projection.name,a=s?["PROJECTION_GLOBE_VIEW"]:[];let l=n.projMatrix;if(s&&Ld(r.zoom)>0){const e=Pd(vd(n.canonical,r));l=Ch.multiply(new Float32Array(16),r.globeMatrix,e),Ch.multiply(l,r.projMatrix,l)}const c=e.getOrCreateProgram("debug",{defines:a}),u=t.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(u,c);const h=kv.disabled,d=Pv.disabled,p=e.colorModeForRenderPass(),f="$debug";i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?u._makeGlobeTileDebugBuffers(e.context,r):u._makeDebugTileBoundsBuffers(e.context,r.projection);const m=u._tileDebugBuffer||e.debugBuffer,g=u._tileDebugIndexBuffer||e.debugIndexBuffer,y=u._tileDebugSegments||e.debugSegments;c.draw(e,o.LINE_STRIP,h,d,p,Lv.disabled,CE(l,fn.red),f,m,g,y,null,null,null,[u._globeTileDebugBorderBuffer]);const _=u.latestRawTileData,v=Math.floor((_&&_.byteLength||0)/1024),x=t.getTile(n).tileSize,b=512/Math.min(x,512)*(n.overscaledZ/r.zoom)*.5;let w=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(w+=" => ".concat(n.overscaledZ)),w+=" ".concat(v,"kb"),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,w);const S=u._tileDebugTextBuffer||e.debugBuffer,T=u._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,E=u._tileDebugTextSegments||e.debugSegments;c.draw(e,o.TRIANGLES,h,d,Dv.alphaBlended,Lv.disabled,CE(l,fn.transparent,b),f,S,T,E,null,null,null,[u._globeTileDebugTextBuffer])}function gA(e,t,n,i){_A(e,0,t+n/2,e.transform.width,n,i)}function yA(e,t,n,i){_A(e,t-n/2,0,n,e.transform.height,i)}function _A(e,t,n,i,r,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*mt.devicePixelRatio,n*mt.devicePixelRatio,i*mt.devicePixelRatio,r*mt.devicePixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}const vA=Ia([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xA}=vA;function bA(e,t,n,i){e.emplaceBack(t,n,i)}class wA{constructor(e){this.vertexArray=new rl,this.indices=new Ka,bA(this.vertexArray,-1,-1,1),bA(this.vertexArray,1,-1,1),bA(this.vertexArray,-1,1,1),bA(this.vertexArray,1,1,1),bA(this.vertexArray,-1,-1,-1),bA(this.vertexArray,1,-1,-1),bA(this.vertexArray,-1,1,-1),bA(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,xA),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=wl.simpleSegment(0,0,36,12)}}function SA(e,t,n,i,r,o){const s=e.context.gl,a=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),c=t.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,n,i,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(Mh.fromMat4(Mh.create(),i),r,c,a,l);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,t.skyboxTexture,0),n.draw(e,s.TRIANGLES,kv.disabled,Pv.disabled,Dv.unblended,Lv.frontCW,u,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const TA=Ia([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class EA{constructor(e){const t=new el;t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1);const n=new Ka;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(t,TA.members),this.indexBuffer=e.createIndexBuffer(n),this.segments=wl.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const AA=Ia([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class MA{constructor(){this.colorModeAlphaBlendedWriteRGB=new Dv([1,Iv,1,Iv],fn.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Dv([1,0,1,0],fn.transparent,[!1,!1,!1,!0])}update(e){const t=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new EA(t);const e=100,n=200,i=function(){const e=$r(30),t=[];for(let n=0;n<16e3;++n){const n=2*Math.PI*e(),i=Math.acos(1-2*e())-.5*Math.PI;t.push(Lh.fromValues(Math.cos(i)*Math.cos(n),Math.cos(i)*Math.sin(n),Math.sin(i)))}return t}(),r=$r(300),o=new tl,s=new Ka;let a=0;for(let t=0;t<i.length;++t){const l=Lh.scale([],i[t],200),c=Math.max(0,1+.01*e*(1*r()-.5)),u=Math.max(0,1+.01*n*(1*r()-.5));o.emplaceBack(l[0],l[1],l[2],-1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,1,c,u),o.emplaceBack(l[0],l[1],l[2],-1,1,c,u),s.emplaceBack(a+0,a+1,a+2),s.emplaceBack(a+0,a+2,a+3),a+=4}this.starsVx=t.createVertexBuffer(o,AA.members),this.starsIdx=t.createIndexBuffer(s),this.starsSegments=wl.simpleSegment(0,0,o.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,t){const n=e.context,i=n.gl,r=e.transform,o=new kv(i.LEQUAL,kv.ReadOnly,[0,1]),s=Ld(r.zoom),a=t.properties.get("color").toArray01(),l=t.properties.get("high-color").toArray01(),c=t.properties.get("space-color").toArray01PremultipliedAlpha(),u=5e-4,h=z((t.properties.get("horizon-blend")-0)/1*.2495+u,5e-4,.25),d=Fd(e,n,r)&&h===u?r.worldSize/(2*Math.PI*1.025)-1:r.globeRadius,p=e.frameCounter/1e3%1,f=Lh.length(r.globeCenterInViewSpace),m=Math.sqrt(Math.pow(f,2)-Math.pow(d,2)),g=Math.acos(m/f),y=t=>{const u="globe"===r.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];t&&u.push("ALPHA_PASS");const d=e.getOrCreateProgram("globeAtmosphere",{defines:u}),f=((e,t,n,i,r,o,s,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:n,u_frustum_bl:i,u_horizon:r,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(r.frustumCorners.TL,r.frustumCorners.TR,r.frustumCorners.BR,r.frustumCorners.BL,r.frustumCorners.horizon,s,h,a,l,c,p,g);e.uploadCommonUniforms(n,d);const m=this.atmosphereBuffer;m&&d.draw(e,i.TRIANGLES,o,Pv.disabled,t?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Lv.backCW,f,t?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(e,t){const n=z(t.properties.get("star-intensity"),0,1);if(0===n)return;const i=e.context,r=i.gl,o=e.transform,s=e.getOrCreateProgram("stars"),a=Ih.identity([]);Ih.rotateX(a,a,-o._pitch),Ih.rotateZ(a,a,-o.angle),Ih.rotateX(a,a,E(o._center.lat)),Ih.rotateY(a,a,-E(o._center.lng));const l=Ch.fromQuat(new Float32Array(16),a),c=Ch.multiply([],o.starsProjMatrix,l),u=Mh.fromMat4([],l),h=Mh.invert([],u),d=[0,1,0];Lh.transformMat3(d,d,h),Lh.scale(d,d,.15);const p=[1,0,0];Lh.transformMat3(p,p,h),Lh.scale(p,p,.15);const f=((e,t,n,i)=>({u_matrix:Float32Array.from(e),u_up:t,u_right:n,u_intensity_multiplier:i}))(c,d,p,n);e.uploadCommonUniforms(i,s),this.starsVx&&this.starsIdx&&s.draw(e,r.TRIANGLES,kv.disabled,Pv.disabled,this.colorModeAlphaBlendedWriteRGB,Lv.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function kA(e,t){const n=[...e],i=t.cameraWorldSizeForFog/t.worldSize,r=Ch.identity([]);return Ch.scale(r,r,[i,i,1]),Ch.multiply(n,r,n),Ch.multiply(n,t.worldToFogMatrix,n),n}function CA(e,t,n,i){const r=n.material,o=i.context,{baseColorTexture:s,metallicRoughnessTexture:a}=r.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=r;function h(t,n,i){if(t&&(e.push(n),o.activeTexture.set(o.gl.TEXTURE0+i),t.gfxTexture)){const{minFilter:e,magFilter:n,wrapS:i,wrapT:r}=t.sampler;t.gfxTexture.bindExtraParam(e,n,i,r)}}h(s,"HAS_TEXTURE_u_baseColorTexture",UE.BaseColor),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",UE.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",UE.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",UE.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",UE.Emission),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),"OPAQUE"!==r.alphaMode&&"MASK"!==r.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),r.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function PA(e,t,n,i,r,o){const s=n.paint.get("model-opacity"),a=t.context,l=new kv(t.context.gl.LEQUAL,kv.ReadWrite,t.depthRangeFor3D),c=t.transform,u=e.mesh,h=u.material,d=h.pbrMetallicRoughness,p=t.style.fog;let f;f="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:Ch.multiply([],i.zScaleMatrix,e.nodeModelMatrix),Ch.multiply(f,i.negCameraPosMatrix,f);const m=Ch.invert([],f);Ch.transpose(m,m);const g=n.paint.get("model-emissive-strength").constantOr(0),y=GE(new Float32Array(e.worldViewProjection),new Float32Array(f),new Float32Array(m),t,s,d.baseColorFactor,h.emissiveFactor,d.metallicFactor,d.roughnessFactor,h,g,n),_={defines:[]},v=[];CA(_.defines,v,u,t);const x=t.shadowRenderer;x&&(x.useNormalOffset=!1);let b=null;if(p){const n=kA(e.nodeModelMatrix,t.transform);if(b=new Float32Array(n),"globe"!==c.projection.name){const e=u.aabb.min,t=u.aabb.max,[i,r]=p.getOpacityForBounds(n,e[0],e[1],t[0],t[1]);_.overrideFog=i>=yw||r>=yw}}const w=iE(t,n.paint.get("model-cutoff-fade-range"));w.shouldRenderCutoff&&_.defines.push("RENDER_CUTOFF");const S=t.getOrCreateProgram("model",_);t.uploadCommonUniforms(a,S,null,b,w),"shadow"!==t.renderPass&&x&&x.setupShadowsFromMatrix(e.nodeModelMatrix,S),S.draw(t,a.gl.TRIANGLES,l,r,o,u.material.doubleSided?Lv.disabled:Lv.backCCW,y,n.id,u.vertexBuffer,u.indexBuffer,u.segments,n.paint,t.transform.zoom,void 0,v)}function IA(e,t,n,i,r,o,s){let a;a="globe"===e.projection.name?Cx(n,e):[...n],Ch.multiply(a,a,t.matrix);const l=Ch.multiply([],i,a);if(t.meshes)for(const c of t.meshes){if("BLEND"!==c.material.alphaMode){s.push({mesh:c,depth:0,modelIndex:r,worldViewProjection:l,nodeModelMatrix:a});continue}const e=Lh.transformMat4([],c.centroid,l);e[2]>0&&o.push({mesh:c,depth:e[2],modelIndex:r,worldViewProjection:l,nodeModelMatrix:a})}if(t.children)for(const c of t.children)IA(e,c,n,i,r,o,s)}function DA(e,t,n,i){const r=n.shadowRenderer;if(!r)return;const o=r.getShadowPassDepthMode(),s=r.getShadowPassColorMode(),a=r.calculateShadowPassMatrixFromMatrix(t),l=WE(a);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,Pv.disabled,s,Lv.backCCW,l,i.id,e.vertexBuffer,e.indexBuffer,e.segments,i.paint,n.transform.zoom,void 0,void 0)}function zA(e,t,n){const i=t.updateZoomBasedPaintProperties(),r=function(e,t,n){let i,r,o,s=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&s>0){const t=e.terrain,r=t.findDEMTileFor(n);r&&r.dem?i=tg.create(t,n,r):s=0}if(0===s&&(t.terrainElevationMin=0,t.terrainElevationMax=0),s===t.validForExaggeration&&(0===s||i&&i._demTile&&i._demTile.tileID===t.validForDEMTile.id&&i._dem._timestamp===t.validForDEMTile.timestamp))return!1;for(const a in t.instancesPerModel){const e=t.instancesPerModel[a];for(let n=0;n<e.instancedDataArray.length;++n){const a=(i?s*i.getElevationAt(0|e.instancedDataArray.float32[16*n],0|e.instancedDataArray.float32[16*n+1],!0,!0):0)+e.instancesEvaluatedElevation[n];e.instancedDataArray.float32[16*n+6]=a,r=r?Math.min(t.terrainElevationMin,a):a,o=o?Math.max(t.terrainElevationMax,a):a}}return t.terrainElevationMin=r||0,t.terrainElevationMax=o||0,t.validForExaggeration=s,t.validForDEMTile=i&&i._demTile?{id:i._demTile.tileID,timestamp:i._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,n);(i||r)&&(t.uploaded=!1,t.upload(e.context))}const RA={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new id([0,0,0],[pi,pi,0])};function LA(e,t){const n=1<<e.canonical.z,i=t.getFreeCameraOptions().position,r=t.elevation,o=e.canonical.x/n,s=(e.canonical.x+1)/n,a=e.canonical.y/n,l=(e.canonical.y+1)/n;let c=t._centerAltitude;if(r){const t=r.getMinMaxForTile(e);t&&t.max>c&&(c=t.max)}const u=z(i.x,o,s)-i.x,h=z(i.y,a,l)-i.y,d=np(c,t.center.lat)-i.z;return t._zoomFromMercatorZ(Math.sqrt(u*u+h*h+d*d))}function OA(e,t,n,i,r,o,s){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new kv(a.gl.LEQUAL,kv.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(o);if(n.meshes)for(const d of n.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,g,y;i.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const _=iE(e,t.paint.get("model-cutoff-fade-range"));if(_.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:p}),g=WE(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(n.matrix)),y=c.getShadowPassColorMode();else{CA(p,f,d,e),m=e.getOrCreateProgram("model",{defines:p,overrideFog:h});const i=d.material,l=i.pbrMetallicRoughness,u=t.paint.get("model-opacity"),v=t.paint.get("model-emissive-strength").constantOr(0);g=GE(o.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),e,u,l.baseColorFactor,i.emissiveFactor,l.metallicFactor,l.roughnessFactor,i,v,t,r),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),y=_.shouldRenderCutoff||u<1||"OPAQUE"!==i.alphaMode?Dv.alphaBlended:Dv.unblended}e.uploadCommonUniforms(a,m,o.toUnwrapped(),null,_);const v=d.material.doubleSided?Lv.disabled:Lv.backCCW;if(i.instancedDataArray.length>20)f.push(i.instancedDataBuffer),m.draw(e,a.gl.TRIANGLES,u,Pv.disabled,y,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f,i.instancedDataArray.length);else{const n=l?"u_instance":"u_normal_matrix";for(let r=0;r<i.instancedDataArray.length;++r)g[n]=new Float32Array(i.instancedDataArray.arrayBuffer,64*r,16),m.draw(e,a.gl.TRIANGLES,u,Pv.disabled,y,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f)}}if(n.children)for(const d of n.children)OA(e,t,d,i,r,o,s)}const FA=[1,-1,1];function BA(e,t,n,i){if(!n.modelManager)return!0;const r=n.modelManager;if(!n.shadowRenderer)return!0;const o=n.shadowRenderer,s=t.aabb;let a=!0,l=e.maxHeight;if(0===l){let t=0;for(const n in e.instancesPerModel){const e=r.getModel(n,i);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):a=!1}l=e.maxScale*t*1.41+e.maxVerticalOffset,a&&(e.maxHeight=l)}s.max[2]=l,s.min[2]+=e.terrainElevationMin,s.max[2]+=e.terrainElevationMax,Lh.transformMat4(s.min,s.min,t.tileMatrix),Lh.transformMat4(s.max,s.max,t.tileMatrix);const c=s.intersects(o.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===c),0===c}class NA{}class jA{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,t,n){{const n=this._storage.get(t.id);if(n)return n.lastUsedFrameIdx=e,n.buf}const i=n.gl,r=i.getBufferParameter(i.ELEMENT_ARRAY_BUFFER,i.BUFFER_SIZE),o=new ArrayBuffer(r),s=new Int16Array(o);i.getBufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const a=new Wa;for(let u=0;u<r/2;u+=3){const e=s[u],t=s[u+1],n=s[u+2];a.emplaceBack(e,t),a.emplaceBack(t,n),a.emplaceBack(n,e)}const l=n.bindVertexArrayOES.current,c=new NA;return c.buf=new V_(n,a),c.lastUsedFrameIdx=e,this._storage.set(t.id,c),n.bindVertexArrayOES.set(l),c.buf}update(e){for(const[t,n]of this._storage)e-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}const VA={symbol:function(e,t,n,i,r){if("translucent"!==e.renderPass)return;const o=Pv.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,t,n,i,r,o,s){const a=t.transform,l="map"===r,c="map"===o;for(const u of e){const e=i.getTile(u),t=e.getBucket(n);if(!t||!t.text||!t.text.segments.get().length)continue;const r=_g(t.textSizeData,a.zoom),o=QS(u,t.getProjection(),a),h=a.calculatePixelsToTileUnitsMatrix(e),d=cx(o,e.tileID.canonical,c,l,a,t.getProjection(),h),p=t.hasIconTextFit()&&t.hasIconData();if(r){const n=Math.pow(2,a.zoom-e.tileID.overscaledZ);JE(t,l,c,s,vg,a,d,u,n,r,p)}}}(i,e,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),r),0!==n.paint.get("icon-opacity").constantOr(1)&&QE(e,t,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),n.paint.get("icon-color-saturation"),o,s),0!==n.paint.get("text-opacity").constantOr(1)&&QE(e,t,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),n.paint.get("icon-color-saturation"),o,s),t.map.showCollisionBoxes&&(XE(e,t,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),XE(e,t,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,n,i){if("translucent"!==e.renderPass)return;const r=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),a=void 0!==n.layout.get("circle-sort-key").constantOr(1),l=n.paint.get("circle-emissive-strength");if(0===r.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const c=e.context,u=c.gl,h=e.transform,d=e.depthModeForSublayer(0,kv.ReadOnly),p=Pv.disabled,f=e.colorModeForDrapableLayerRenderPass(l),m="globe"===h.projection.name,g=[ep(h.center.lng),tp(h.center.lat)],y=[];for(let v=0;v<i.length;v++){const r=i[v],o=t.getTile(r),s=o.getBucket(n);if(!s||s.projection.name!==h.projection.name)continue;const l=s.programConfigurations.get(n.id),c=Zp(n),u=e.isTileAffectedByFog(r);m&&c.push("PROJECTION_GLOBE_VIEW");const d=e.getOrCreateProgram("circle",{config:l,defines:c,overrideFog:u}),p=s.layoutVertexBuffer,f=s.globeExtVertexBuffer,_=s.indexBuffer,x=h.projection.createInversionMatrix(h,r.canonical),b={programConfiguration:l,program:d,layoutVertexBuffer:p,globeExtVertexBuffer:f,indexBuffer:_,uniformValues:Wp(e,r,o,x,g,n),tile:o};if(a){const e=s.segments.get();for(const t of e)y.push({segments:new wl([t]),sortKey:t.sortKey,state:b})}else y.push({segments:s.segments,sortKey:0,state:b})}a&&y.sort((e,t)=>e.sortKey-t.sortKey);const _={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const v of y){const{programConfiguration:t,program:i,layoutVertexBuffer:r,globeExtVertexBuffer:o,indexBuffer:s,uniformValues:a,tile:l}=v.state,m=v.segments;e.terrain&&e.terrain.setupElevationDraw(l,i,_),e.uploadCommonUniforms(c,i,l.tileID.toUnwrapped()),i.draw(e,u.TRIANGLES,d,p,f,Lv.disabled,a,n.id,r,s,m,n.paint,h.zoom,t,[o])}},heatmap:function(e,t,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const r=e.context,o=r.gl,s=Pv.disabled,a=new Dv([o.ONE,o.ONE,o.ONE,o.ONE],fn.transparent,[!0,!0,!0,!0]);!function(e,t,n,i){const r=e.gl,o=t.width*i,s=t.height*i;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,o,s]);let a=n.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=n.heatmapFbo=e.createFramebuffer(o,s,!0,null),function(e,t,n,i,r,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,r,o,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,0,t,a,o,s)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(r,e,n,"globe"===e.transform.projection.name?.5:.25),r.clear({color:fn.transparent});const l=e.transform,c="globe"===l.projection.name,u=c?["PROJECTION_GLOBE_VIEW"]:[],h=c?Lv.frontCCW:Lv.disabled,d=[ep(l.center.lng),tp(l.center.lat)];for(let p=0;p<i.length;p++){const f=i[p];if(t.hasRenderableParent(f))continue;const m=t.getTile(f),g=m.getBucket(n);if(!g||g.projection.name!==l.projection.name)continue;const y=e.isTileAffectedByFog(f),_=g.programConfigurations.get(n.id),v=e.getOrCreateProgram("heatmap",{config:_,defines:u,overrideFog:y}),{zoom:x}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,v),e.uploadCommonUniforms(r,v,f.toUnwrapped());const b=l.projection.createInversionMatrix(l,f.canonical);v.draw(e,o.TRIANGLES,kv.disabled,s,a,h,IE(e,f,m,b,d,x,n.paint.get("heatmap-intensity")),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,_,c?[g.globeExtVertexBuffer]:null)}r.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,t){const n=e.context,i=n.gl,r=t.heatmapFbo;if(!r)return;n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);let o=t.colorRampTexture;o||(o=t.colorRampTexture=new k_(n,t.colorRamp,i.RGBA)),o.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,i.TRIANGLES,kv.disabled,Pv.disabled,e.colorModeForRenderPass(),Lv.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,t),t.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,t.paint,e.transform.zoom)}(e,n))},line:function(e,t,n,i){if("translucent"!==e.renderPass)return;const r=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===r.constantOr(1)||0===o.constantOr(1))return;const s=n.paint.get("line-emissive-strength"),a=e.depthModeForSublayer(0,kv.ReadOnly),l=e.colorModeForDrapableLayerRenderPass(s),c=e.terrain&&e.terrain.renderingToTexture?1:mt.devicePixelRatio,u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),m=n.paint.get("line-pattern").constantOr(1),g=1!==n.paint.get("line-opacity").constantOr(1);let y=!m&&g;const _=n.paint.get("line-gradient"),v=f?"linePattern":"line",x=e.context,b=x.gl,w=Zb(n);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(y=!1);for(const S of i){const i=t.getTile(S);if(f&&!i.patternsLoaded())continue;const r=i.getBucket(n);if(!r)continue;e.prepareDrawTile();const o=r.programConfigurations.get(n.id),s=e.isTileAffectedByFog(S),m=e.getOrCreateProgram(v,{config:o,defines:w,overrideFog:s}),g=p.constantOr(null);if(g&&i.imageAtlas){const e=i.imageAtlas.patternPositions[g.toString()];e&&o.setConstantPatternPositions(e)}const T=u.constantOr(null),E=d.constantOr(null);if(!f&&T&&E&&i.lineAtlas){const e=i.lineAtlas.getDash(T,E);e&&o.setConstantPatternPositions(e)}let[A,M]=n.paint.get("line-trim-offset");if("round"===E||"square"===E){const e=1;A!==M&&(0===A&&(A-=e),1===M&&(M+=e))}const k=e.terrain?S.projMatrix:null,C=f?Gb(e,i,n,k,c):Ub(e,i,n,k,r.lineClipsArray.length,c,[A,M]);if(_){const i=r.gradients[n.id];let o=i.texture;if(n.gradientVersion!==i.version){let s=256;if(n.stepInterpolant){const n=t.getSource().maxzoom,i=S.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-S.canonical.z):1;s=z(G(r.maxLineLength/pi*1024*i),256,x.maxTextureSize)}i.gradient=lf({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:i.gradient||void 0,clips:r.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new k_(x,i.gradient,b.RGBA),i.version=n.gradientVersion,o=i.texture}x.activeTexture.set(b.TEXTURE1),o.bind(n.stepInterpolant?b.NEAREST:b.LINEAR,b.CLAMP_TO_EDGE)}h&&(x.activeTexture.set(b.TEXTURE0),i.lineAtlasTexture&&i.lineAtlasTexture.bind(b.LINEAR,b.REPEAT),o.updatePaintBuffers()),f&&(x.activeTexture.set(b.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),o.updatePaintBuffers()),e.uploadCommonUniforms(x,m,S.toUnwrapped());const P=t=>{m.draw(e,b.TRIANGLES,a,t,l,Lv.disabled,C,n.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,n.paint,e.transform.zoom,o,[r.layoutVertexBuffer2])};if(y){const t=e.stencilModeForClipping(S).ref;0===t&&e.terrain&&x.clear({stencil:0});const n={func:b.EQUAL,mask:255};C.u_alpha_discard_threshold=.8,P(new Pv(n,t,255,b.KEEP,b.KEEP,b.INVERT)),C.u_alpha_discard_threshold=0,P(new Pv(n,t,255,b.KEEP,b.KEEP,b.KEEP))}else P(e.stencilModeForClipping(S))}y&&(e.resetStencilClippingMasks(),e.terrain&&x.clear({stencil:0}))},fill:function(e,t,n,i){const r=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=n.paint.get("fill-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(s),l=n.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===r.constantOr(fn.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const r=e.depthModeForSublayer(1,"opaque"===e.renderPass?kv.ReadWrite:kv.ReadOnly);tA(e,t,n,i,r,a,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const r=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,kv.ReadOnly);tA(e,t,n,i,r,a,!0)}},"fill-extrusion":function(e,t,n,i){const r=n.paint.get("fill-extrusion-opacity"),o=e.context,s=o.gl,a=e.terrain,l=a&&a.renderingToTexture,c=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===r)return;const u=e.conflationActive&&e.layerUsedInConflation(n,t.getSource());if(u&&function(e,t,n,i){for(const r of i){const i=t.getTile(r).getBucket(n);i&&(i.updateReplacement(r,e.replacementSource),i.uploadCentroid(e.context))}}(e,t,n,i),a||u)for(const h of i){const i=t.getTile(h).getBucket(n);i&&rA(e.context,t,h,i,n,a,u)}if("shadow"===e.renderPass&&e.shadowRenderer){const o=e.shadowRenderer;if(a&&r<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Co)return;const s=o.getShadowPassDepthMode(),l=o.getShadowPassColorMode();nA(e,t,n,i,s,Pv.disabled,l,u)}else if("translucent"===e.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!l){const o=new kv(e.context.gl.LEQUAL,kv.ReadWrite,e.depthRangeFor3D);0===c&&1===r&&h?nA(e,t,n,i,o,Pv.disabled,Dv.unblended,u):(nA(e,t,n,i,o,Pv.disabled,Dv.disabled,u),nA(e,t,n,i,o,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&h&&(!a&&"globe"!==e.transform.projection.name||l)){const r=n.paint.get("fill-extrusion-opacity"),c=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),h=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),d=n.paint.get("fill-extrusion-flood-light-intensity"),p=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),f=c>0&&h>0,m=d>0,g=(e,t,n)=>(1-n)*e+n*t,y=o=>{const a=e.depthModeForSublayer(1,kv.ReadOnly,s.LEQUAL,!0),l=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),f=g(.1,3,l),m=e._showOverdrawInspector;if(!m){const l=new Pv({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new Dv([s.ONE,s.ONE,s.ONE,s.ONE],fn.transparent,[!1,!1,!1,!0],s.MIN);iA(e,t,n,i,a,l,m,Lv.disabled,o,"sdf",r,c,h,d,p,f,u,!1)}{const l=m?Pv.disabled:new Pv({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=m?e.colorModeForRenderPass():new Dv([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],fn.transparent,[!0,!0,!0,!0]);iA(e,t,n,i,a,l,g,Lv.disabled,o,"color",r,c,h,d,p,f,u,!1)}};if(l){const l=(o,a,l)=>{const f=e.depthModeForSublayer(1,kv.ReadOnly,s.LEQUAL,!1),m=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=g(.1,3,m);{const l=new Dv([s.ONE,s.ONE,s.ONE,s.ONE],fn.transparent,[!1,!1,!1,!0]);iA(e,t,n,i,f,Pv.disabled,l,Lv.disabled,o,"clear",r,c,h,d,p,y,u,a)}{const l=new Pv({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new Dv([s.ONE,s.ONE,s.ONE,s.ONE],fn.transparent,[!1,!1,!1,!0],s.MIN);iA(e,t,n,i,f,l,m,Lv.disabled,o,"sdf",r,c,h,d,p,y,u,a)}{const l=o?s.ZERO:s.ONE_MINUS_DST_ALPHA,m=new Pv({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=new Dv([l,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],fn.transparent,[!0,!0,!0,!0]);iA(e,t,n,i,f,m,g,Lv.disabled,o,"color",r,c,h,d,p,y,u,a)}{const m=new Dv([s.ONE,s.ONE,s.ONE,o?s.ZERO:s.ONE],fn.transparent,[!1,!1,!1,!0],o?s.FUNC_ADD:s.MAX);iA(e,t,n,i,f,Pv.disabled,m,Lv.disabled,o,"clear",r,c,h,d,p,y,u,a,l)}};if(f||m){let t;if(e.prepareDrawTile(),a){const e=a.drapeBufferSize[0],n=a.drapeBufferSize[1];t=a.framebufferCopyTexture,t&&(!t||t.size[0]===e&&t.size[1]===n)||(t&&t.destroy(),t=a.framebufferCopyTexture=new k_(o,new rf({width:e,height:n}),s.RGBA)),t.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,e,n,0)}f&&l(!0,!1,t),m&&l(!1,!0,t)}}else f&&y(!0),m&&y(!1)}}},hillshade:function(e,t,n,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const r=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]="translucent"!==e.renderPass||o?[{},i]:e.stencilConfigForOverlap(i);for(const l of a){const i=t.getTile(l);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)QT(e,i,n);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,kv.ReadOnly),r=n.paint.get("hillshade-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(r),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):s[l.overscaledZ];JT(e,l,i,n,t,c,a)}}r.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,n,i,r,o){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const s=e.context,a=s.gl,l=t.getSource(),c=function(e,t,n){const i=e.paint.get("raster-color"),r=[],o=e.paint.get("raster-resampling"),s=e.paint.get("raster-color-mix"),a=e.paint.get("raster-color-range"),l=[s[0],s[1],s[2],0],c=s[3],u="nearest"===o?n.NEAREST:n.LINEAR;if(i&&r.push("RASTER_COLOR"),i){t.activeTexture.set(n.TEXTURE2);let i=e.colorRampTexture;i||(i=e.colorRampTexture=new k_(t,e.colorRamp,n.RGBA)),i.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:l,range:a,offset:c,defines:r,resampling:u}}(n,s,a),u=c.defines,h="globe"===e.transform.projection.name;let d=!1;if(l instanceof tw&&!i.length){if(!h)return;if(l.onNorthPole)d=!0,u.push("GLOBE_POLES");else{if(!l.onSouthPole)return;d=!0,u.push("GLOBE_POLES")}}const p=n.paint.get("raster-emissive-strength"),f=e.colorModeForDrapableLayerRenderPass(p),m=e.terrain&&e.terrain.renderingToTexture,g=l instanceof tw&&0!==n.paint.get("raster-elevation"),y=!e.options.moving,_="nearest"===n.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;if(d){const i=t.getSource();if(!(i instanceof tw))return;const r=i.texture;if(!r)return;const o=e.globeSharedBuffers;if(!o)return;const l=new kv(a.LEQUAL,kv.ReadWrite,e.depthRangeFor3D),u=Float32Array.from(e.transform.expandedFarZProjMatrix);let h=Od(0,0,e.transform);const d=Float32Array.from(Cd(yd(new Wh(0,0,0)))),m={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),r.bind(_,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),r.bind(_,a.CLAMP_TO_EDGE),r.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const[g,y,v,x]=o.getPoleBuffers(0,!0);let b;i.onNorthPole?(b=g,e.renderDefaultNorthPole=!1):(h=Ch.scale(Ch.create(),h,[1,-1,1]),b=y,e.renderDefaultSouthPole=!1);const w=((e,t,n,i,r,o,s,a,l,c,u,h)=>DE(e,t,n,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,i,r,o||[0,0],s,2,l,c,u,1,0,h))(u,d,h,m,n,i.perspectiveTransform||[0,0],n.paint.get("raster-elevation"),0,c.mix,c.offset,c.range,p),S=e.getOrCreateProgram("raster",{defines:c.defines});return e.uploadCommonUniforms(s,S,null),void S.draw(e,a.TRIANGLES,l,Pv.disabled,f,Lv.disabled,w,n.id,b,v,x)}if(!i.length)return;const[v,x]=l instanceof tw||m?[{},i]:e.stencilConfigForOverlap(i),b=x[x.length-1].overscaledZ,w=g&&h;w&&c.defines.push("PROJECTION_GLOBE_VIEW"),g&&c.defines.push("RENDER_CUTOFF");for(const S of x){const i=S.toUnwrapped(),r=t.getTile(S);if(m&&(!r||!r.hasData()))continue;if(!r.texture)continue;let u,d;m?(u=kv.disabled,d=S.projMatrix):g?(u=new kv(a.LEQUAL,kv.ReadWrite,e.depthRangeFor3D),d=h?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(i,y)):(u=e.depthModeForSublayer(S.overscaledZ-b,1===n.paint.get("raster-opacity")?kv.ReadWrite:kv.ReadOnly,a.LESS),d=e.transform.calculateProjMatrix(i,y));const x=e.terrain&&m?e.terrain.stencilModeForRTTOverlap(S):v[S.overscaledZ],T=o?0:n.paint.get("raster-fade-duration");r.registerFadeDuration(T);const E=t.findLoadedParent(S,0),A=uE(r,E,t,e.transform,T);let M,k;e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(_,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),E?(E.texture&&E.texture.bind(_,a.CLAMP_TO_EDGE),M=Math.pow(2,E.tileID.overscaledZ-r.tileID.overscaledZ),k=[r.tileID.canonical.x*M%1,r.tileID.canonical.y*M%1]):r.texture&&r.texture.bind(_,a.CLAMP_TO_EDGE),r.texture&&r.texture.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const C=e.transform,P=l instanceof tw?l.perspectiveTransform:[0,0],I=g?cA(C):[0,0,0,0];let D,z,R,L,O,F;if(w&&l instanceof tw&&l.coordinates.length>3){D=Float32Array.from(Cd(yd(new Wh(0,0,0)))),z=Float32Array.from(C.globeMatrix),R=Float32Array.from(Rd(C)),L=[ep(C.center.lng),tp(C.center.lat)],F=[ep(l.coordinates[1][0]),tp(l.coordinates[1][1]),ep(l.coordinates[3][0]),tp(l.coordinates[3][1])];const t=new cc(l.coordinates[1],l.coordinates[3]);O=Float32Array.from(Bd(new Wh(0,0,0),t,0,C.worldSize/e.transform._pixelsPerMercatorPixel))}else D=new Float32Array(16),z=new Float32Array(9),R=new Float32Array(16),L=[0,0],O=new Float32Array(16),F=[0,0,0,0];const B=DE(d,D,z,R,O,k||[0,0],F,Ld(e.transform.zoom),L,I,M||1,A,n,P,g?n.paint.get("raster-elevation"):0,2,c.mix,c.offset,c.range,1,0,p),N=e.isTileAffectedByFog(S),j=e.getOrCreateProgram("raster",{defines:c.defines,overrideFog:N});if(e.uploadCommonUniforms(s,j,i),l instanceof tw){if(m||!h)l.boundsBuffer&&l.boundsSegments&&j.draw(e,a.TRIANGLES,u,Pv.disabled,f,Lv.disabled,B,n.id,l.boundsBuffer,e.quadTriangleIndexBuffer,l.boundsSegments);else if(e.globeSharedBuffers){const[t,i,r]=e.globeSharedBuffers.getGridBuffers(0,!1);j.draw(e,a.TRIANGLES,u,Pv.disabled,f,Lv.frontCCW,B,n.id,t,i,r),j.draw(e,a.TRIANGLES,u,Pv.disabled,f,Lv.backCCW,B,n.id,t,i,r)}}else{const{tileBoundsBuffer:t,tileBoundsIndexBuffer:i,tileBoundsSegments:o}=e.getTileBoundsBuffers(r);j.draw(e,a.TRIANGLES,u,x,f,Lv.disabled,B,n.id,t,i,o)}}e.resetStencilClippingMasks()},background:function(e,t,n,i){const r=n.paint.get("background-color"),o=n.paint.get("background-opacity"),s=n.paint.get("background-emissive-strength");if(0===o)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(e.isPatternMissing(h,n.scope))return;const d=!h&&1===r.a&&1===o&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=Pv.disabled,f=e.depthModeForSublayer(0,"opaque"===d?kv.ReadWrite:kv.ReadOnly),m=e.colorModeForDrapableLayerRenderPass(s),g=h?"backgroundPattern":"background";let y,_=i;_||(y=e.getBackgroundTiles(),_=Object.values(y).map(e=>e.tileID)),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,n.scope));for(const v of _){const d=e.isTileAffectedByFog(v),_=e.getOrCreateProgram(g,{overrideFog:d}),x=v.toUnwrapped(),b=i?v.projMatrix:e.transform.calculateProjMatrix(x);e.prepareDrawTile();const w=t?t.getTile(v):y?y[v.key]:new N_(v,u,c.zoom,e),S=h?VE(b,s,o,e,h,n.scope,{tileID:v,tileSize:u}):jE(b,s,o,r);e.uploadCommonUniforms(a,_,x);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:E,tileBoundsSegments:A}=e.getTileBoundsBuffers(w);_.draw(e,l.TRIANGLES,f,p,m,Lv.disabled,S,n.id,T,E,A)}},sky:function(e,t,n){const i=e._atmosphere?Ld(e.transform.zoom):1,r=n.paint.get("sky-opacity")*i;if(0===r)return;const o=e.context,s=n.paint.get("sky-type"),a=new kv(o.gl.LEQUAL,kv.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,t){const n=e.context,i=n.gl;let r=t.skyboxFbo;if(!r){r=t.skyboxFbo=n.createFramebuffer(32,32,!0,null),t.skyboxGeometry=new wA(n),t.skyboxTexture=n.gl.createTexture(),i.bindTexture(i.TEXTURE_CUBE_MAP,t.skyboxTexture),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);for(let e=0;e<6;++e)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i.RGBA,32,32,0,i.RGBA,i.UNSIGNED_BYTE,null)}n.bindFramebuffer.set(r.framebuffer),n.viewport.set([0,0,32,32]);const o=t.getCenter(e,!0),s=e.getOrCreateProgram("skyboxCapture"),a=new Float64Array(16);Ch.identity(a),Ch.rotateY(a,a,.5*-Math.PI),SA(e,t,s,a,o,0),Ch.identity(a),Ch.rotateY(a,a,.5*Math.PI),SA(e,t,s,a,o,1),Ch.identity(a),Ch.rotateX(a,a,.5*-Math.PI),SA(e,t,s,a,o,2),Ch.identity(a),Ch.rotateX(a,a,.5*Math.PI),SA(e,t,s,a,o,3),Ch.identity(a),SA(e,t,s,a,o,4),Ch.identity(a),Ch.rotateY(a,a,Math.PI),SA(e,t,s,a,o,5),n.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,t,n,i,r){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,n,i,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}))(a.skyboxMatrix,t.getCenter(e,!1),0,i,r);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,Pv.disabled,e.colorModeForRenderPass(),Lv.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,n,a,r,l):"gradient"===s&&"sky"===e.renderPass&&function(e,t,n,i,r){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skyboxGradient");t.skyboxGeometry||(t.skyboxGeometry=new wA(o)),o.activeTexture.set(s.TEXTURE0);let c=t.colorRampTexture;c||(c=t.colorRampTexture=new k_(o,t.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((e,t,n,i,r)=>({u_matrix:e,u_color_ramp:0,u_center_direction:t,u_radius:E(n),u_opacity:i,u_temporal_offset:r}))(a.skyboxMatrix,t.getCenter(e,!1),t.paint.get("sky-gradient-radius"),i,r);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,Pv.disabled,e.colorModeForRenderPass(),Lv.backCW,u,"skyboxGradient",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,n,a,r,l)},debug:function(e,t,n){for(let i=0;i<n.length;i++)mA(e,t,n[i])},custom:function(e,t,n,i){const r=e.context,o=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isLayerDraped(t)){if("offscreen"===e.renderPass){const t=o.prerender;if(t){if(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const n=e.transform.pointMerc;t.call(o,r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Ld(e.transform.zoom),[n.x,n.y],e.transform.pixelsPerMeterRatio)}else t.call(o,r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const t=o.renderToTile;if(t){const n=i[0].canonical,s=new hp(n.x+i[0].wrap*(1<<n.z),n.y,n.z);r.setDepthMode(kv.disabled),r.setStencilMode(Pv.disabled),r.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),t.call(o,r.gl,s),r.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(Pv.disabled);const t="3d"===o.renderingMode?new kv(e.context.gl.LEQUAL,kv.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,kv.ReadOnly);if(r.setDepthMode(t),"globe"===e.transform.projection.name){const t=e.transform.pointMerc;o.render(r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Ld(e.transform.zoom),[t.x,t.y],e.transform.pixelsPerMeterRatio)}else o.render(r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}else J("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,n,r){if("opaque"===e.renderPass)return;const o=n.paint.get("model-opacity");if(0===o)return;const s=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!s)return;if(e.terrain&&o<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof Co)return}const a=e.shadowRenderer,l=n.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=t.getSource();if("light-beam"===e.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(e,t,n,r){const o=e.transform;if("mercator"!==o.projection.name)return void J("Drawing 3D models for ".concat(o.projection.name," projection is not yet implemented"));const s=o.getFreeCameraOptions().position;if(!e.modelManager)return;const a=e.modelManager,l=e.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const c=n._unevaluatedLayout._values["model-id"],u=i({},n.layout.get("model-id").parameters);for(const i of r){const r=t.getTile(i).getBucket(n);if(!r||r.projection.name!==o.projection.name)continue;const h=LA(i,o);u.zoom=h;const d=c.possiblyEvaluate(u);if(zA(e,r,i),RA.shadowUniformsInitialized=!1,RA.useSingleShadowCascade=!!l&&0===l.getMaxCascadeForTile(i.toUnwrapped()),"shadow"===e.renderPass&&l){if(1===e.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const t=o.calculatePosMatrix(i.toUnwrapped(),o.worldSize);if(RA.tileMatrix.set(t),RA.shadowTileMatrix=Float32Array.from(l.calculateShadowPassMatrixFromMatrix(t)),RA.aabb.min.fill(0),RA.aabb.max[0]=RA.aabb.max[1]=pi,RA.aabb.max[2]=0,BA(r,RA,e,n.scope))continue}const p=1<<i.canonical.z,f=[((s.x-i.wrap)*p-i.canonical.x)*pi,(s.y*p-i.canonical.y)*pi,s.z*p*pi];for(let t in r.instancesPerModel){const o=r.instancesPerModel[t];o.features.length>0&&(t=d.evaluate(o.features[0].feature,{}));const s=a.getModel(t,n.scope);if(s&&s.uploaded)for(const t of s.nodes)OA(e,n,t,o,f,i,RA)}}}(e,t,n,r),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(e,t,n,i){const r=e.context,o=e.transform,s=e.style.fog,a=e.shadowRenderer;if("mercator"!==o.projection.name)return void J("Drawing 3D landmark models for ".concat(o.projection.name," projection is not yet implemented"));const l=e.transform.getFreeCameraOptions().position,c=Lh.scale([],[l.x,l.y,l.z],e.transform.worldSize);Lh.negate(c,c);const u=Ch.identity([]),h=lp(o.center.lat,o.zoom),d=Ch.fromScaling([],[1,1,1/h]);Ch.translate(u,u,c);const p=n.paint.get("model-opacity"),f=new kv(r.gl.LEQUAL,kv.ReadWrite,e.depthRangeFor3D),m=new kv(r.gl.LEQUAL,kv.ReadOnly,e.depthRangeFor3D),g=function(l,c){for(const h of i){const i=t.getTile(h).getBucket(n);if(!i||!i.uploaded)continue;let g=!1;a&&(g=0===a.getMaxCascadeForTile(h.toUnwrapped()));const y=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize),_=i.modelTraits;for(const t of i.getNodesInfo()){if(t.hiddenByReplacement)continue;if(!t.node.meshes)continue;const i=t.node,v="light-beam"===e.renderPass,x=[...y],b=t.evaluatedScale;let w=0;e.terrain&&i.elevation&&(w=i.elevation*e.terrain.exaggeration()),Ch.translate(x,x,[(i.anchor?i.anchor[0]:0)*(b[0]-1),(i.anchor?i.anchor[1]:0)*(b[1]-1),w]),b!==Ix&&Ch.scale(x,x,b),Ch.multiply(x,x,i.matrix);const S=Ch.multiply([],d,x);Ch.multiply(S,u,S);const T=Ch.invert([],S);Ch.transpose(T,T),Ch.scale(T,T,FA);const E=Ch.multiply([],o.expandedFarZProjMatrix,x);for(let u=0;u<i.meshes.length;++u){const d=i.meshes[u],y=u===i.lightMeshIndex;if(y){if(!v&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}}else if(v)continue;const b={defines:[]},w=[];CA(b.defines,w,d,e),4&_||b.defines.push("DIFFUSE_SHADED"),g&&b.defines.push("SHADOWS_SINGLE_CASCADE");const A="shadow"===e.renderPass;if(A){DA(d,x,e,n);continue}let M=null;if(s){const t=kA(x,e.transform);if(M=new Float32Array(t),"globe"!==o.projection.name){const e=d.aabb.min,n=d.aabb.max,[i,r]=s.getOpacityForBounds(t,e[0],e[1],n[0],n[1]);b.overrideFog=i>=yw||r>=yw}}const k=e.getOrCreateProgram("model",b);!A&&a&&(a.useNormalOffset=!!d.normalBuffer,a.setupShadowsFromMatrix(x,k,a.useNormalOffset)),e.uploadCommonUniforms(r,k,h.toUnwrapped(),M);const C=d.material,P=C.pbrMetallicRoughness;P.metallicFactor=.9,P.roughnessFactor=.5;const I=0,D=GE(new Float32Array(E),new Float32Array(S),new Float32Array(T),e,p,P.baseColorFactor,C.emissiveFactor,P.metallicFactor,P.roughnessFactor,C,I,n);k.draw(e,r.gl.TRIANGLES,c&&!y?f:m,Pv.disabled,l?y||p<1||t.hasTranslucentParts?Dv.alphaBlended:Dv.unblended:Dv.disabled,Lv.backCCW,D,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,void 0,w)}}}};(function(e,t,n,i){const r=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const s of i){const i=t.getTile(s).getBucket(n);i&&(e.conflationActive&&i.updateReplacement(s,e.replacementSource),i.evaluateScale(e,n),e.terrain&&r>0&&i.elevationUpdate(e.terrain,r,s,n.source),i.needsReEvaluation(e,o,n)&&i.evaluate(n))}})(e,t,n,i),1===p?g(!0,!0):(g(!1,!0),g(!0,!1))}(e,t,n,r),void c();const h=u.getModels(),d=[],p=e.transform.getFreeCameraOptions().position,f=Lh.scale([],[p.x,p.y,p.z],e.transform.worldSize);Lh.negate(f,f);const m=[],g=[];let y=0;for(const i of h){const t=n.paint.get("model-rotation").constantOr(null),r=n.paint.get("model-scale").constantOr(null),o=n.paint.get("model-translation").constantOr(null);i.computeModelMatrix(e,t,r,o,!0,!0,!1);const s=Ch.identity([]),a=lp(i.position.lat,e.transform.zoom),l=Ch.fromScaling([],[1,1,1/a]);Ch.translate(s,s,f),d.push({zScaleMatrix:l,negCameraPosMatrix:s});for(const n of i.nodes)IA(e.transform,n,i.matrix,e.transform.expandedFarZProjMatrix,y,m,g);y++}if(m.sort((e,t)=>t.depth-e.depth),"shadow"!==e.renderPass){if(1===o)for(const t of g)PA(t,e,n,d[t.modelIndex],Pv.disabled,e.colorModeForRenderPass());else{for(const t of g)PA(t,e,n,d[t.modelIndex],Pv.disabled,Dv.disabled);for(const t of g)PA(t,e,n,d[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const t of m)PA(t,e,n,d[t.modelIndex],Pv.disabled,e.colorModeForRenderPass());c()}else{for(const t of g)DA(t.mesh,t.nodeModelMatrix,e,n);for(const t of m)DA(t.mesh,t.nodeModelMatrix,e,n);c()}}},UA={modelUpload:function(e,t,n){const i=t.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(e.modelManager&&e.modelManager.upload(e,n));if("batched-model"===i.type)return;const r=i.getModels();for(const o of r)o.upload(e.context)}};class GA{constructor(e,t,n){this.context=new Ov(e,t),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Fv.maxUnderzooming+Fv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new $x,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new HA(this),this._wireframeDebugCache=new jA,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fE(this,e));const i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=t.getFovAdjustedRange(this.transform._fov);if(n>i)return void(this.transform.fogCullDistSq=null);const r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,t){if(this.width=e*mt.devicePixelRatio,this.height=t*mt.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const n of this.style.order)this.style._mergedLayers[n].resize()}setup(){const e=this.context,n=new za;n.emplaceBack(0,0),n.emplaceBack(pi,0),n.emplaceBack(0,pi),n.emplaceBack(pi,pi),this.tileExtentBuffer=e.createVertexBuffer(n,Uh.members),this.tileExtentSegments=wl.simpleSegment(0,0,4,2);const i=new za;i.emplaceBack(0,0),i.emplaceBack(pi,0),i.emplaceBack(0,pi),i.emplaceBack(pi,pi),this.debugBuffer=e.createVertexBuffer(i,Uh.members),this.debugSegments=wl.simpleSegment(0,0,4,5);const r=new za;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(r,Uh.members),this.viewportSegments=wl.simpleSegment(0,0,4,2);const o=new La;o.emplaceBack(0,0,0,0),o.emplaceBack(pi,0,pi,0),o.emplaceBack(0,pi,0,pi),o.emplaceBack(pi,pi,pi,pi),this.mercatorBoundsBuffer=e.createVertexBuffer(o,F_.members),this.mercatorBoundsSegments=wl.simpleSegment(0,0,4,2);const s=new Ka;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new il;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new k_(e,new rf({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=Ch.create();const l=this.context.gl;this.stencilClearMode=new Pv({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,kv.disabled,this.stencilClearMode,Dv.disabled,Lv.disabled,cE(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,n){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const i=this.context,r=i.gl;this.nextStencilID+n.length>256&&this.clearStencil(),i.setColorMode(Dv.disabled),i.setDepthMode(kv.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of n){const e=t.getTile(s),n=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:i,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);o.draw(this,r.TRIANGLES,kv.disabled,new Pv({func:r.ALWAYS,mask:0},n,255,r.KEEP,r.KEEP,r.REPLACE),Dv.disabled,Lv.disabled,cE(s.projMatrix),"$clipping",i,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Pv({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Pv({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,n=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let n=0;n<r;n++)e[n+i]=new Pv({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,n]}return[{[i]:Pv.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const t=1/8;return new Dv([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new fn(t,t,t,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Dv.unblended:Dv.alphaBlended}colorModeForDrapableLayerRenderPass(e){const t=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Dv([t.ONE,t.ONE_MINUS_SRC_ALPHA,t.CONSTANT_ALPHA,t.ONE_MINUS_SRC_ALPHA],new fn(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.opaquePassEnabledForLayer()&&!i)return kv.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new kv(n||this.context.gl.LEQUAL,t,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;const i=this.style._mergedLayers,r=this.style.order,o=r.map(e=>i[e]),s=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(mt.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const t in s){const e=s[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++a)}const c={},u={},h={},d={},p={};for(const t in s){const e=s[t];c[t]=e.getVisibleCoordinates(),u[t]=c[t].slice().reverse(),h[t]=e.getVisibleCoordinates(!0).reverse(),d[t]=e.getShadowCasterCoordinates(),p[t]=e.sortCoordinatesByDistance(c[t])}const f=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(a){const e=[];for(const t of o)this.layerUsedInConflation(t,f(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const n of e){const e=this.style.getLayerSourceCache(n);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:n.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const t of o){const e=t.cutoffRange();if(this.longestCutoffRange=Math.max(e,this.longestCutoffRange),e>0){const e=f(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let t=0;t<o.length;t++)if(o[t].is3D()){this.opaquePassCutoff=t;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in s)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),g.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new Zd(this.context));for(const t of o){if(t.isHidden(this.transform.zoom))continue;const n=e.getLayerSourceCache(t);this.uploadLayer(this,t,n)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new MA),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Qe.has(this.context.gl))return;this.renderPass="offscreen";for(const t of o){const n=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const i=n?u[n.id]:void 0;("custom"===t.type||"raster"===t.type||t.isSky()||i&&i.length)&&this.renderLayer(this,n,t,i)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const y=this.terrain;y&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&y.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const _="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(n.showOverdrawInspector)return fn.black;if(this.style.fog&&this.transform.projection.supportsFog&&!_){const e=this.style.fog.properties.get("color").toArray01();return new fn(...e)}if(this.style.fog&&this.transform.projection.supportsFog&&_){const e=this.style.fog.properties.get("space-color").toArray01();return new fn(...e)}return fn.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);if(t.isSky())continue;const i=n?(t.is3D()?p:u)[n.id]:void 0;this._renderTileClippingMasks(t,n,i),this.renderLayer(this,n,t,i)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Ld(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,n,t,n?u[n.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let x=0;for(g&&(x=g.getShadowCastingLayerCount());this.currentLayer<r.length;){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(y&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=y.renderBatch(this.currentLayer);continue}let i;if(n&&(i=("symbol"===t.type?h:t.is3D()?p:u)[n.id]),this._renderTileClippingMasks(t,n,n?c[n.id]:void 0),this.renderLayer(this,n,t,i),!y&&g&&x>0&&t.hasShadowPass()&&0==--x&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=o[this.currentLayer];if(!t.hasLightBeamPass())continue;const n=e.getLayerSourceCache(t);this.renderLayer(this,n,t,n?u[n.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let t=null;o.forEach(n=>{const i=e.getLayerSourceCache(n);i&&!n.isHidden(this.transform.zoom)&&i.getVisibleCoordinates().length&&(!t||t.getSource().maxzoom<i.getSource().maxzoom)&&(t=i)}),t&&this.options.showTileBoundaries&&VA.debug(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;gA(e,e.transform.height-(t.top||0),3,uA),gA(e,t.bottom||0,3,hA),yA(e,t.left||0,3,dA),yA(e,e.transform.width-(t.right||0),3,pA);const n=e.transform.centerPoint;!function(e,t,n,i){_A(e,t-1,n-10,2,20,i),_A(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,fA)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}uploadLayer(e,t,n){this.gpuTimingStart(t),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(t.type)||e.terrain&&"custom"===t.type)&&UA["".concat(t.type,"Upload")]&&UA["".concat(t.type,"Upload")](e,n,t.scope),this.gpuTimingEnd()}renderLayer(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||"model"===n.type||"raster"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&VA[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,n=this.context.gl;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:n.createQuery()}),i.calls++,n.beginQuery(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,n=t.createQuery();this.deferredRenderGpuTimeQueries.push(n),t.beginQuery(e.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const n in e){const i=e[n],r=this.context.extTimerQuery,o=r.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(i.query),t[n]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,n=this.context.gl;let i=0;for(const r of e)i+=t.getQueryParameter(r,n.QUERY_RESULT)/1e6,t.deleteQueryEXT(r);return i}translatePosMatrix(e,t,n,i,r){if(!n[0]&&!n[1])return e;const o=r?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const s=[r?n[0]:sx(t,n[0],this.transform.zoom),r?n[1]:sx(t,n[1],this.transform.zoom),0],a=new Float32Array(16);return Ch.translate(a,e,s),a}saveTileTexture(e){const t=e.size[0],n=this._tileTextures[t];n?n.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,n){const i=void 0===n?this.terrain&&this.terrain.renderingToTexture:n,r=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),r&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||i||void 0!==t&&!t||o.push("FOG","FOG_DITHERING"),i&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(e,t){this.cache=this.cache||{};const n=t&&t.defines||[],i=t&&t.config,r=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(n),o=_E.cacheKey(ZT[e],e,r,i);return this.cache[o]||(this.cache[o]=new _E(this.context,e,ZT[e],i,ZE[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new k_(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,t){if(this.style.enable3dLights()){const n=this.style.directionalLight,i=this.style.ambientLight;if(n&&i){const r=((e,t)=>{const n=e.properties.get("direction"),i=e.properties.get("color").toArray01(),r=e.properties.get("intensity"),o=t.properties.get("color").toArray01(),s=t.properties.get("intensity"),a=[n.x,n.y,n.z],l=ce(o,s),c=ce(i,r);return{u_lighting_ambient_color:l,u_lighting_directional_dir:a,u_lighting_directional_color:c,u_ground_radiance:mE(a,c,l)}})(n,i);t.setLightsUniformValues(e,r)}}}uploadCommonUniforms(e,t,n,i,r){if(this.uploadCommonLightUniforms(e,t),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const r=o.getOpacity(this.transform.pitch),s=((e,t,n,i,r,o,s,a,l,c,u,h)=>{const d=e.transform,p=t.properties.get("color").toArray01();p[3]=i;const f=e.frameCounter/1e3%1,[m,g]=t.properties.get("vertical-range");return{u_fog_matrix:n?d.calculateFogTileMatrix(n):h||e.identityMat,u_fog_range:t.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:t.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(m,g),g],u_fog_temporal_offset:f,u_frustum_tl:r,u_frustum_tr:o,u_frustum_br:s,u_frustum_bl:a,u_globe_pos:l,u_globe_radius:c,u_viewport:u,u_globe_transition:Ld(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,o,n,r,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*mt.devicePixelRatio,this.transform.height*mt.devicePixelRatio],i);t.setFogUniformValues(e,s)}r&&t.setCutoffUniformValues(e,r.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const i of n)t[i.key]=e[i.key]||new N_(i,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=yw||t[1]>=yw}}const qA=2048;class WA{constructor(e,t){this.aabb=e,this.lastCascade=t}}class ZA{add(e,t){const n=this.receivers[e.key];void 0!==n?(n.aabb.min[0]=Math.min(n.aabb.min[0],t.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],t.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],t.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],t.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],t.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],t.max[2])):this.receivers[e.key]=new WA(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,t,n){const i=id.fromPoints(e.points);let r=0;for(const o in this.receivers){const e=this.receivers[o];if(!e)continue;if(!i.intersectsAabb(e.aabb))continue;e.aabb.min=i.closestPoint(e.aabb.min),e.aabb.max=i.closestPoint(e.aabb.max);const s=e.aabb.getCorners();for(let i=0;i<n.length;i++){let o=!0;for(const e of s){const r=[e[0]*t,e[1]*t,e[2]];if(Lh.transformMat4(r,r,n[i].matrix),r[0]<-1||r[0]>1||r[1]<-1||r[1]>1){o=!1;break}}if(e.lastCascade=i,r=Math.max(r,i),o)break}}return r+1}}class HA{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ZA,this._depthMode=new kv(e.context.gl.LEQUAL,kv.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,t){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!t||!t.properties)return;const i=t.properties.get("shadow-intensity");if(!t.shadowsEnabled()||i<=0)return;if(this._shadowLayerCount=n.style.order.reduce((t,i)=>{const r=n.style._mergedLayers[i];return t+(r.hasShadowPass()&&!r.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const r=n.context,o=qA,s=qA;if(0===this._cascades.length)for(let d=0;d<2;++d){const e=n._shadowMapDebug,t=r.gl,i=r.createFramebuffer(o,s,e,"texture"),a=new k_(r,{width:o,height:s,data:null},t.DEPTH_COMPONENT);if(i.depthAttachment.set(a.texture),e){const e=new k_(r,{width:o,height:s,data:null},t.RGBA);i.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:i,texture:a,matrix:[],far:0,boundingSphereRadius:0,frustum:new nd,scale:0})}this.shadowDirection=YA(t);let a=0;if(e.elevation){const t=e.elevation,n=[1e4,-1e4];t.visibleDemTiles.filter(e=>e.dem).forEach(e=>{const t=e.dem.tree;n[0]=Math.min(n[0],t.minimums[0]),n[1]=Math.max(n[1],t.maximums[0])}),1e4!==n[0]&&(a=(n[1]-n[0])*t.exaggeration())}const l=1.5*e.cameraToCenterDistance,c=3*l,u=new Float64Array(16);for(let d=0;d<2;++d){const t=this._cascades[d];let n=e.height/50,i=1;0===d?i=l:(n=l,i=c);const[r,o]=JA(e,this.shadowDirection,n,i,qA,a);t.scale=e.scale,t.matrix=r,t.boundingSphereRadius=o,Ch.invert(u,t.matrix),t.frustum=nd.fromInvProjectionMatrix(u,1,0,!0),t.far=i}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=i,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=qA,this._uniformValues.u_shadowmap_0=UE.ShadowMap0,this._uniformValues.u_shadowmap_1=UE.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const h=n.transform.elevation;for(const d of this._groundShadowTiles){let e={min:0,max:0};if(h){const t=h.getMinMaxForTile(d);t&&(e=t)}this.addShadowReceiver(d.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,t){if(!this._enabled)return;const n=this.painter,i=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),i.viewport.set([0,0,qA,qA]);for(let r=0;r<this._numCascadesToRender;++r){n.currentShadowCascade=r,i.bindFramebuffer.set(this._cascades[r].framebuffer.framebuffer),i.clear({color:fn.white,depth:1});for(const i of e.order){const r=e._mergedLayers[i];if(!r.hasShadowPass()||r.isHidden(n.transform.zoom))continue;const o=e.getLayerSourceCache(r),s=o?t[o.id]:void 0;("model"===r.type||s&&s.length)&&n.renderLayer(n,o,r,s)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,t=e.style,n=e.context,i=t.directionalLight,r=t.ambientLight;if(!i||!r)return;const o=[],s=iE(e,e.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const a=KA(i,r),l=new kv(n.gl.LEQUAL,kv.ReadOnly,e.depthRangeFor3D);for(const c of this._groundShadowTiles){const t=c.toUnwrapped(),i=e.isTileAffectedByFog(c),r=e.getOrCreateProgram("groundShadow",{defines:o,overrideFog:i});this.setupShadows(t,r),e.uploadCommonUniforms(n,r,t,null,s);const u={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:a};r.draw(e,n.gl.TRIANGLES,l,Pv.disabled,Dv.multiply,Lv.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Dv.unblended:Dv.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const t=this.painter.transform,n=t.calculatePosMatrix(e,t.worldSize);return Ch.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(e){return Ch.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this._enabled)return;const r=this.painter.transform,o=this.painter.context,s=o.gl,a=this._uniformValues,l=new Float64Array(16),c=r.calculatePosMatrix(e,r.worldSize);for(let u=0;u<2;u++)Ch.multiply(l,this._cascades[u].matrix,c),a[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(s.TEXTURE0+UE.ShadowMap0+u),this._cascades[u].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){const t=up(e.canonical),o=2/r.tileSize*pi/qA,s=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[1].boundingSphereRadius,c=("vector-tile"===n?1:3)/Math.pow(2,i-e.canonical.z-(1-r.zoom+Math.floor(r.zoom)));a.u_shadow_normal_offset=[t,s*c,l*c],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(o,a)}setupShadowsFromMatrix(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._enabled)return;const i=this.painter.context,r=i.gl,o=this._uniformValues,s=new Float64Array(16);for(let a=0;a<2;a++)Ch.multiply(s,this._cascades[a].matrix,e),o[0===a?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),i.activeTexture.set(r.TEXTURE0+UE.ShadowMap0+a),this._cascades[a].texture.bind(r.NEAREST,r.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){const e=5;o.u_shadow_normal_offset=[1,e,e],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(i,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,t,n,i){if(i[2]>=0)return{};const r=function(e,t,n){const i=n/(1<<e.canonical.z);return new id([e.canonical.x*i+e.wrap*n,e.canonical.y*i+e.wrap*n,0],[(e.canonical.x+1)*i+e.wrap*n,(e.canonical.y+1)*i+e.wrap*n,t])}(e,t,n).getCorners(),o=t/-i[2];i[0]<0?(Lh.add(r[0],r[0],[i[0]*o,0,0]),Lh.add(r[3],r[3],[i[0]*o,0,0])):i[0]>0&&(Lh.add(r[1],r[1],[i[0]*o,0,0]),Lh.add(r[2],r[2],[i[0]*o,0,0])),i[1]<0?(Lh.add(r[0],r[0],[0,i[1]*o,0]),Lh.add(r[1],r[1],[0,i[1]*o,0])):i[1]>0&&(Lh.add(r[2],r[2],[0,i[1]*o,0]),Lh.add(r[3],r[3],[0,i[1]*o,0]));const s={};return s.vertices=r,s.planes=[XA(r[1],r[0],r[4]),XA(r[2],r[1],r[5]),XA(r[3],r[2],r[6]),XA(r[0],r[3],r[7])],s}addShadowReceiver(e,t,n){this._receivers.add(e,id.fromTileIdAndHeight(e,t,n))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function XA(e,t,n){const i=Lh.sub([],n,t),r=Lh.sub([],e,t),o=Lh.cross([],i,r),s=Lh.length(o);return 0===s?[0,0,1,0]:(Lh.scale(o,o,1/s),[o[0],o[1],o[2],-Lh.dot(o,t)])}function YA(e){const t=e.properties.get("direction"),n=te(t.x,t.y,t.z);n[2]=z(n[2],0,75);const i=ee([n[0],n[1],n[2]]);return Lh.fromValues(i.x,i.y,i.z)}function KA(e,t){const n=e.properties.get("color"),i=e.properties.get("intensity"),r=e.properties.get("direction"),o=[r.x,r.y,r.z],s=t.properties.get("color"),a=t.properties.get("intensity"),l=Math.max(Lh.dot([0,0,1],o),0),c=[0,0,0];Lh.scale(c,s.toArray01Linear().slice(0,3),a);const u=[0,0,0];return Lh.scale(u,n.toArray01Linear().slice(0,3),l*i),ue([c[0]>0?c[0]/(c[0]+u[0]):0,c[1]>0?c[1]/(c[1]+u[1]):0,c[2]>0?c[2]/(c[2]+u[2]):0])}function JA(e,t,n,i,r,o){const s=e.zoom,a=e.scale,l=e.worldSize,c=1/l,u=e.aspect,h=Math.sqrt(1+u*u)*Math.tan(.5*e.fovX),d=h*h,p=i-n,f=i+n;let m,g;d>p/f?(m=i,g=i*h):(m=.5*f*(1+d),g=.5*Math.sqrt(p*p+2*(i*i+n*n)*d+f*f*d*d));const y=e.projection.pixelsPerMeter(e.center.lat,l),_=e._camera.getCameraToWorldMercator(),v=[0,0,-m*c];Lh.transformMat4(v,v,_);let x=g*c;const b=e._edgeInsets;if(!(0===b.left&&0===b.top&&0===b.right&&0===b.bottom||b.left===b.right&&b.top===b.bottom)){const t=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?y:1),r=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,i);r[8]=2*-e.centerOffset.x/e.width,r[9]=2*e.centerOffset.y/e.height;const o=new Float64Array(16);Ch.mul(o,r,t);const c=new Float64Array(16);Ch.invert(c,o);const u=nd.fromInvProjectionMatrix(c,l,s,!0);for(const n of u.points){const t=((w=n)[0]/=a,w[1]/=a,w[2]=np(w[2],e._center.lat),w);x=Math.max(x,Lh.len(Lh.subtract([],v,t)))}}var w;x*=r/(r-1);const S=Math.acos(t[2]),T=Math.atan2(-t[0],-t[1]),E=new Qv;E.position=v,E.setPitchBearing(S,T);const A=E.getWorldToCamera(l,y),M=x*l,k=Math.min(e._mercatorZfromZoom(17)*l*-2,-2*M),C=E.getCameraToClipOrthographic(-M,M,-M,M,k,(M+o*y)/t[2]),P=new Float64Array(16);Ch.multiply(P,C,A);const I=Lh.fromValues(Math.floor(1e6*v[0])/1e6*l,Math.floor(1e6*v[1])/1e6*l,0),D=.5*r,z=[0,0,0];Lh.transformMat4(z,I,P),Lh.scale(z,z,D);const R=[Math.floor(z[0]),Math.floor(z[1]),Math.floor(z[2])],L=[0,0,0];Lh.sub(L,z,R),Lh.scale(L,L,-1/D);const O=new Float64Array(16);return Ch.identity(O),Ch.translate(O,O,L),Ch.multiply(P,O,P),[P,M]}class $A extends zt{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,t){return yS(this.requestManager.transformRequest(t,be.Model).url).then(t=>{if(!t)return;const n=AS(t),i=new Dx(e,void 0,void 0,n);return i.computeBoundsAndApplyParent(),i}).catch(n=>{this.fire(new Dt(new Error("Could not load model ".concat(e," from ").concat(t,": ").concat(n.message))))})}load(e,t){this.models[t]||(this.models[t]={});const n=Object.keys(e);this.numModelsLoading[t]=(this.numModelsLoading[t]||0)+n.length;const i=[];for(const r of n)i.push(this.loadModel(r,e[r]));Promise.allSettled(i).then(e=>{for(let i=0;i<e.length;i++){const{status:r,value:o}=e[i];"fulfilled"===r&&o&&(this.models[t][n[i]]=o)}this.numModelsLoading[t]-=n.length,this.fire(new It("data",{dataType:"style"}))}).catch(e=>{this.fire(new Dt(new Error("Could not load models: ".concat(e.message))))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,n){this.models[n]||(this.models[n]={}),this.hasModel(e,n)&&this.removeModel(e,n),this.load({[e]:this.requestManager.normalizeModelURL(t)},n)}addModels(e,t){const n={};for(const i in e)n[i]=this.requestManager.normalizeModelURL(e[i]);this.load(n,t)}removeModel(e,t){this.models[t]||(this.models[t]={});const n=this.models[t][e];delete this.models[t][e],n.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const n in this.models[t])this.models[t][n].upload(e.context)}}const QA=(e,t)=>Ps(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),eM=N(NS,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),tM=N(NS,["setCenter","setZoom","setBearing","setPitch"]),nM={version:8,layers:[],sources:{}},iM={duration:300,delay:0},rM=new Set(["fill","line","background","hillshade","raster"]);class oM extends zt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=e,this.scope=t.scope||"",this.fragments=[],this.importDepth=t.importDepth||0,this.importsCache=t.importsCache||new Map,this.resolvedImports=t.resolvedImports||new Set,this.transition=B({},iM),this._buildingIndex=new LS(this),this.crossTileSymbolIndex=new DT,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=t.styleChanges||new Ma,this.dispatcher=t.dispatcher?t.dispatcher:new Mw(Kw(),this),t.imageManager?this.imageManager=t.imageManager:(this.imageManager=new uw,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=t.glyphManager?t.glyphManager:new ly(e._requestManager,t.localFontFamily?2:t.localIdeographFontFamily?1:0,t.localFontFamily||t.localIdeographFontFamily),t.modelManager?this.modelManager=t.modelManager:(this.modelManager=new $A(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=t.config,this.dispatcher.broadcast("setReferrer",Se());const n=this;this._rtlTextPluginCallback=oM.registerForPluginStateChange(e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,t)=>{if(na(e),t&&t.every(e=>e))for(const i in n._sourceCaches){const e=n._sourceCaches[i],t=e.getSource().type;"vector"!==t&&"geojson"!==t||e.reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const n in this._layers){const e=this._layers[n];e.source===t.id&&this._validateLayer(e)}})}loadURL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new It("dataloading",{dataType:"style"}));const n="boolean"==typeof t.validate?t.validate:!Re(e);e=this.map._requestManager.normalizeStyleURL(e,t.accessToken),this.resolvedImports.add(e);const i=this.importsCache.get(e);if(i)return this._load(i,n);const r=this.map._requestManager.transformRequest(e,be.Style);this._request=Ee(r,(t,i)=>{if(this._request=null,t)this.fire(new Dt(t));else if(i)return this.importsCache.set(e,i),this._load(i,n)})}loadJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new It("dataloading",{dataType:"style"})),this._request=mt.frame(()=>{this._request=null,this._load(e,!1!==t.validate)})}loadEmpty(){this.fire(new It("dataloading",{dataType:"style"})),this._load(nM,!1)}_loadImports(e,t){if(this.importDepth>=4)return J("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const i of e){const e=this._createFragmentStyle(i),r=new Promise(t=>{e.once("style.import.load",t),e.once("error",t)}).then(()=>this.mergeAll());if(n.push(r),this.resolvedImports.has(i.url)){e.loadEmpty();continue}const o=i.data||this.importsCache.get(i.url);o?e.loadJSON(o,{validate:t}):i.url?e.loadURL(i.url,{validate:t}):e.loadEmpty(),this.fragments.push({style:e,id:i.id,config:i.config})}return Promise.allSettled(n)}_createFragmentStyle(e){const t=this.scope?Sa(e.id,this.scope):e.id,n=new oM(this.map,{scope:t,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config});return n.setEventedParent(this.map,{style:n}),n}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new It(e?"style.load":"style.import.load"))}_load(e,t){const n=e.schema;if(this.isRootStyle()&&(e.fragment||n&&!1!==e.fragment)){const n=B({},nM,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(n,t)}if(this.setConfig(this._config,n),t&&QA(this,_s(e)))return;this._loaded=!0,this.stylesheet=Y(e);for(const o in e.sources)this.addSource(o,e.sources[o],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const i=BS(this.stylesheet.layers);if(this._order=i.map(e=>e.id),this.stylesheet.light&&J("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new dw(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new dw(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const o of i){const e=lw(o,this.options);e.setScope(this.scope),e.isConfigDependent&&this._configDependentLayers.add(e.fqid),e.setEventedParent(this,{layer:{id:e.id}}),this._layers[e.id]=e,this._serializedLayers[e.id]=e.serialize();const t=this.getOwnLayerSourceCache(e),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();t&&e.canCastShadows()&&n&&(t.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const r=this.stylesheet.terrain;r&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=mt.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?J("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(r,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new It("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,t).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,t,n,i,r,o,s,a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{if(l.stylesheet){if(null!=l.light&&(e=l.light),l.stylesheet.lights)for(const e of l.stylesheet.lights)"ambient"===e.type&&null!=l.ambientLight&&(t=l.ambientLight),"directional"===e.type&&null!=l.directionalLight&&(n=l.directionalLight);i=this._prioritizeTerrain(i,l.terrain,l.stylesheet.terrain),l.stylesheet.fog&&null!=l.fog&&(r=l.fog),null!=l.stylesheet.camera&&(a=l.stylesheet.camera),null!=l.stylesheet.projection&&(o=l.stylesheet.projection),null!=l.stylesheet.transition&&(s=l.stylesheet.transition)}}),this.light=e,this.ambientLight=t,this.directionalLight=n,this.fog=r,null===i?delete this.terrain:this.terrain=i,this.camera=a||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=B({},iM,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=n=>{for(const e of n.fragments)t(e.style);e(n)};t(this)}_prioritizeTerrain(e,t,n){const i=e&&0===e.drapeRenderMode;return null===n?t&&0===t.drapeRenderMode?t:i?e:null:null!=t&&(!e||i||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)}),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const e={},t={},n={};this.forEachFragmentStyle(i=>{for(const t in i._sourceCaches){const n=Sa(t,i.scope);e[n]=i._sourceCaches[t]}for(const e in i._otherSourceCaches){const n=Sa(e,i.scope);t[n]=i._otherSourceCaches[e]}for(const e in i._symbolSourceCaches){const t=Sa(e,i.scope);n[t]=i._symbolSourceCaches[e]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=t,this._mergedSymbolSourceCaches=n}mergeLayers(){var e=this;const t={},n=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(e=>{for(const i of e._order){const r=e._layers[i];if("slot"===r.type){const e=Ta(i);if(t[e])continue;t[e]=[]}r.slot&&t[r.slot]?t[r.slot].push(r):n.push(r)}}),this._mergedOrder=[];const r=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const o of n)if("slot"===o.type){const e=Ta(o.id);t[e]&&r(t[e])}else{const t=Sa(o.id,o.scope);e._mergedOrder.push(t),i[t]=o,o.is3D()&&(e._has3DLayers=!0),"circle"===o.type&&(e._hasCircleLayers=!0),"symbol"===o.type&&(e._hasSymbolLayers=!0)}};r(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=B({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,t,n){let i,r,o;const s=mt.devicePixelRatio>1?"@2x":"";let a=Ee(t.transformRequest(t.normalizeSpriteURL(e,s,".json"),be.SpriteJSON),(e,t)=>{a=null,o||(o=e,i=t,c())}),l=Ie(t.transformRequest(t.normalizeSpriteURL(e,s,".png"),be.SpriteImage),(e,t)=>{l=null,o||(o=e,r=t,c())});function c(){if(o)n(o);else if(i&&r){const e=mt.getImageData(r),t={};for(const n in i){const{width:r,height:o,x:s,y:a,sdf:l,pixelRatio:c,stretchX:u,stretchY:h,content:d}=i[n],p=new rf({width:r,height:o});rf.copy(e,p,{x:s,y:a},{x:0,y:0},{width:r,height:o}),t[n]={data:p,pixelRatio:c,sdf:l,stretchX:u,stretchY:h,content:d}}n(null,t)}}return{cancel(){a&&(a.cancel(),a=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(e,t)=>{if(this._spriteRequest=null,e)this.fire(new Dt(e));else if(t)for(const n in t)this.imageManager.addImage(n,this.scope,t[n]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new It("data",{dataType:"style"}))})}_validateLayer(e){const t=this.getOwnSource(e.source);if(!t)return;const n=e.sourceLayer;n&&("geojson"===t.type||t.vectorLayerIds&&-1===t.vectorLayerIds.indexOf(n))&&this.fire(new Dt(new Error('Source layer "'.concat(n,'" does not exist on source "').concat(t.id,'" as specified by style layer "').concat(e.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,t)=>{const n=this.fragments[t];return n&&n.style&&(e.data=n.style.serialize()),e})}_serializeSources(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return e}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):rM.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const t=this.getOwnLayer(e);if(t)return t;this.fire(new Dt(new Error("The layer '".concat(e,"' does not exist in the map's style."))))}_checkSource(e){const t=this.getOwnSource(e);if(t)return t;this.fire(new Dt(new Error("The source '".concat(e,"' does not exist in the map's style."))))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const t=this.calculateLightsBrightness();e.brightness=t||0,t!==this._brightness&&(this._brightness=t,this.dispatcher.broadcast("setBrightness",t));const n=this._changes.isDirty();if(this._changes.isDirty()){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:n,removedIds:i}=t[e];(n||i)&&this._updateWorkerLayers(e,n,i)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const i={};for(const r in this._mergedSourceCaches){const e=this._mergedSourceCaches[r];i[r]=e.used,e.used=!1}for(const r of this._mergedOrder){const t=this._mergedLayers[r];if(t.recalculate(e,this._availableImages),!t.isHidden(e.zoom)){const e=this.getLayerSourceCache(t);e&&(e.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let n=t.minzoom||0;n<(t.maxzoom||25.5);n++){const n=this.map.painter;if(n){const i=t.getProgramIds();if(!i)continue;for(const r of i){const i=t.getDefaultProgramParams(r,e.zoom);i&&(n.style=this,this.fog&&(n._fogVisible=!0,i.overrideFog=!0,n.getOrCreateProgram(r,i)),n._fogVisible=!1,i.overrideFog=!1,n.getOrCreateProgram(r,i),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(i.overrideRtt=!0,n.getOrCreateProgram(r,i)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const r in i){const e=this._mergedSourceCaches[r];i[r]!==e.used&&e.getSource().fire(new It("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new It("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,n){const i=this.getFragmentStyle(e);i&&this.dispatcher.broadcast("updateLayers",{layers:t?i._serializeLayers(t):[],scope:e,removedIds:n||[],options:i.options})}setState(e){if(this._checkLoaded(),QA(this,_s(e)))return!1;(e=Y(e)).layers=BS(e.layers);const t=function(e,t){if(!e)return[{command:NS.setStyle,args:[t]}];let n=[];try{if(!w(e.version,t.version))return[{command:NS.setStyle,args:[t]}];w(e.center,t.center)||n.push({command:NS.setCenter,args:[t.center]}),w(e.zoom,t.zoom)||n.push({command:NS.setZoom,args:[t.zoom]}),w(e.bearing,t.bearing)||n.push({command:NS.setBearing,args:[t.bearing]}),w(e.pitch,t.pitch)||n.push({command:NS.setPitch,args:[t.pitch]}),w(e.sprite,t.sprite)||n.push({command:NS.setSprite,args:[t.sprite]}),w(e.glyphs,t.glyphs)||n.push({command:NS.setGlyphs,args:[t.glyphs]}),w(e.imports,t.imports)||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;t=t||[];const i=(e=e||[]).map(WS),r=t.map(WS),o=e.reduce(ZS,{}),s=t.reduce(ZS,{}),a=i.slice();let l,c,u,h;for(l=0,c=0;l<i.length;l++)u=i[l],s.hasOwnProperty(u)?c++:(n.push({command:NS.removeImport,args:[u]}),a.splice(a.indexOf(u,c),1));for(l=0,c=0;l<r.length;l++)u=r[r.length-1-l],a[a.length-1-l]!==u&&(o.hasOwnProperty(u)?(n.push({command:NS.removeImport,args:[u]}),a.splice(a.lastIndexOf(u,a.length-c),1)):c++,h=a[a.length-l],n.push({command:NS.addImport,args:[s[u],h]}),a.splice(a.length-l,0,u));for(const d of t){const e=o[d.id];if(!e||w(e,d))continue;w(e.config,d.config)||n.push({command:NS.setImportConfig,args:[d.id,d.config]}),w(e.url,d.url)||n.push({command:NS.setImportUrl,args:[d.id,d.url]});const t=d.data;w(e&&e.data,t)||n.push({command:NS.setImportData,args:[d.id,t]})}}(e.imports,t.imports,n),w(e.transition,t.transition)||n.push({command:NS.setTransition,args:[t.transition]}),w(e.light,t.light)||n.push({command:NS.setLight,args:[t.light]}),w(e.fog,t.fog)||n.push({command:NS.setFog,args:[t.fog]}),w(e.projection,t.projection)||n.push({command:NS.setProjection,args:[t.projection]}),w(e.lights,t.lights)||n.push({command:NS.setLights,args:[t.lights]}),w(e.camera,t.camera)||n.push({command:NS.setCamera,args:[t.camera]});const i={},r=[];!function(e,t,n,i){let r;for(r in t=t||{},e=e||{})e.hasOwnProperty(r)&&(t.hasOwnProperty(r)||VS(r,n,i));for(r in t){if(!t.hasOwnProperty(r))continue;const o=t[r];e.hasOwnProperty(r)?w(e[r],o)||("geojson"===e[r].type&&"geojson"===o.type&&GS(e,t,r)?n.push({command:NS.setGeoJSONSourceData,args:[r,o.data]}):US(r,t,n,i)):jS(r,t,n)}}(e.sources,t.sources,r,i);const o=[];e.layers&&e.layers.forEach(e=>{e.source&&i[e.source]?n.push({command:NS.removeLayer,args:[e.id]}):o.push(e)});let s=e.terrain;s&&i[s.source]&&(n.push({command:NS.setTerrain,args:[void 0]}),s=void 0),n=n.concat(r),w(s,t.terrain)||n.push({command:NS.setTerrain,args:[t.terrain]}),function(e,t,n){t=t||[];const i=(e=e||[]).map(WS),r=t.map(WS),o=e.reduce(ZS,{}),s=t.reduce(ZS,{}),a=i.slice(),l=Object.create(null);let c,u,h,d,p,f,m;for(c=0,u=0;c<i.length;c++)h=i[c],s.hasOwnProperty(h)?u++:(n.push({command:NS.removeLayer,args:[h]}),a.splice(a.indexOf(h,u),1));for(c=0,u=0;c<r.length;c++)h=r[r.length-1-c],a[a.length-1-c]!==h&&(o.hasOwnProperty(h)?(n.push({command:NS.removeLayer,args:[h]}),a.splice(a.lastIndexOf(h,a.length-u),1)):u++,f=a[a.length-c],n.push({command:NS.addLayer,args:[s[h],f]}),a.splice(a.length-c,0,h),l[h]=!0);for(c=0;c<r.length;c++)if(h=r[c],d=o[h],p=s[h],!l[h]&&!w(d,p))if(w(d.source,p.source)&&w(d["source-layer"],p["source-layer"])&&w(d.type,p.type)){for(m in qS(d.layout,p.layout,n,h,null,NS.setLayoutProperty),qS(d.paint,p.paint,n,h,null,NS.setPaintProperty),w(d.slot,p.slot)||n.push({command:NS.setSlot,args:[h,p.slot]}),w(d.filter,p.filter)||n.push({command:NS.setFilter,args:[h,p.filter]}),w(d.minzoom,p.minzoom)&&w(d.maxzoom,p.maxzoom)||n.push({command:NS.setLayerZoomRange,args:[h,p.minzoom,p.maxzoom]}),d)d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?qS(d[m],p[m],n,h,m.slice(6),NS.setPaintProperty):w(d[m],p[m])||n.push({command:NS.setLayerProperty,args:[h,m,p[m]]}));for(m in p)p.hasOwnProperty(m)&&!d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?qS(d[m],p[m],n,h,m.slice(6),NS.setPaintProperty):w(d[m],p[m])||n.push({command:NS.setLayerProperty,args:[h,m,p[m]]}))}else n.push({command:NS.removeLayer,args:[h]}),f=a[a.lastIndexOf(h)+1],n.push({command:NS.addLayer,args:[p,f]})}(o,t.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:NS.setStyle,args:[t]}]}return n}(this.serialize(),e).filter(e=>!(e.command in tM));if(0===t.length)return!1;const n=t.filter(e=>!(e.command in eM));if(n.length>0)throw new Error("Unimplemented: ".concat(n.map(e=>e.command).join(", "),"."));return t.forEach(e=>{this[e.command].apply(this,e.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,t){return this.getImage(e)?this.fire(new Dt(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,t),this._afterImageUpdated(e),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new Dt(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new It("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(ks,"models.".concat(e),t,null,n)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new Dt(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error('There is already a source with ID "'.concat(e,'".'));if(!t.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(t).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(t.type)>=0&&this._validate(vs,"sources.".concat(e),t,null,n))return;this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const i=PS(e,t,this.dispatcher,this);i.scope=this.scope,i.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i.id),source:i.serialize(),sourceId:i.id}));const r=e=>{const t=(e?"symbol:":"other:")+i.id,n=Sa(t,this.scope),r=this._sourceCaches[t]=new Fv(n,i,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[i.id]=r,r.onAdd(this.map)};r(!1),"vector"!==t.type&&"geojson"!==t.type||r(!0),i.onAdd&&i.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const t=this.getOwnSource(e);if(!t)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new Dt(new Error('Source "'.concat(e,'" cannot be removed while layer "').concat(i,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new Dt(new Error('Source "'.concat(e,'" cannot be removed while terrain is using it.'))));const n=this.getOwnSourceCaches(e);for(const i of n){const e=Ta(i.id);delete this._sourceCaches[e],this._changes.discardSourceCacheUpdate(i.id),i.fire(new It("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),t.setEventedParent(null),t.onRemove&&t.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const n=this.getOwnSourceCache(t);n&&e.push(n.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const t=this._getTransitionParameters();for(const i of e){if(this._validate(bs,"lights",i))return;switch(i.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(i),e.updateTransitions(t)}else this.ambientLight=new kw(i,Cw,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(i),e.updateTransitions(t)}else this.directionalLight=new kw(i,Pw,this.scope,this.options)}}const n=new la(this.z||0,t);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,t=this.ambientLight;if(!e||!t)return;const n=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),i=e.properties.get("color").toArray01(),r=e.properties.get("intensity"),o=e.properties.get("direction"),s=1-te(o.x,o.y,o.z)[2]/90,a=n(i)*r*s,l=t.properties.get("color").toArray01(),c=t.properties.get("intensity");return(a+n(l)*c)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(wa(e)){const t=function(e){const t=e.indexOf(ba);return t>=0?e.slice(t+1):""}(e),n=this.fragments.find(e=>{let{id:n}=e;return n===t});if(!n)throw new Error("Style import not found: ".concat(e));const i=Ta(e);return n.style.getFragmentStyle(i)}{const t=this.fragments.find(t=>{let{id:n}=t;return n===e});if(!t)throw new Error("Style import not found: ".concat(e));return t.style}}getConfigProperty(e,t){const n=this.getFragmentStyle(e);if(!n)return null;const i=n.options.get(t),r=i?i.value||i.default:null;return r?r.serialize():null}setConfigProperty(e,t,n){const r=Mo(n);if("success"!==r.result)return void QA(this,r.value);const o=r.value.expression,s=this.getFragmentStyle(e);if(!s)return;const a=s.options.get(t);a&&(s.options.set(t,i(i({},a),{},{value:o})),s.updateConfigDependencies())}setConfig(e,t){if(this._config=e,e||t)if(t){this.options.clear();for(const n in t){let i,r;const o=Mo(t[n].default);if("success"===o.result&&(i=o.value.expression),e&&void 0!==e[n]){const t=Mo(e[n]);"success"===t.result&&(r=t.value.expression)}const{minValue:s,maxValue:a,stepValue:l,type:c,values:u}=t[n];i?this.options.set(n,{default:i,value:r,minValue:s,maxValue:a,stepValue:l,type:c,values:u}):this.fire(new Dt(new Error('No schema defined for config option "'.concat(n,'".'))))}}else this.fire(new Dt(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=e.id;if(this._layers[i])return void this.fire(new Dt(new Error('Layer with id "'.concat(i,'" already exists on this map'))));let r;if("custom"===e.type){if(QA(this,function(e){const t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t}(e)))return;r=lw(e,this.options)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=B(e=Y(e),{source:i})),this._validate(Ts,"layers.".concat(i),e,{arrayIndex:-1},n))return;r=lw(e,this.options),this._validateLayer(r),r.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[r.id]=r.serialize()}r.isConfigDependent&&this._configDependentLayers.add(r.fqid),r.setScope(this.scope);let o=this._order.length;if(t){const e=this._order.indexOf(t);if(-1===e)return void this.fire(new Dt(new Error('Layer with id "'.concat(t,'" does not exist on this map.'))));r.slot===this._layers[t].slot?o=e:J('Layer with id "'.concat(t,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(o,0,i),this._layerOrderChanged=!0,this._layers[i]=r;const s=this.getOwnLayerSourceCache(r),a=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&r.canCastShadows()&&a&&(s.castsShadows=!0);const l=this._changes.getRemovedLayer(r);if(l&&r.source&&s&&"custom"!==r.type){this._changes.discardLayerRemoval(r);const e=Sa(r.source,r.scope);l.type!==r.type?this._changes.updateSourceCache(e,"clear"):(this._changes.updateSourceCache(e,"reload"),s.pause())}this._updateLayer(r),r.onAdd&&r.onAdd(this.map),r.scope=this.scope,this.mergeLayers()}moveLayer(e,t){this._checkLoaded();const n=this._checkLayer(e);if(!n)return;if(e===t)return;const i=this._order.indexOf(e);this._order.splice(i,1);let r=this._order.length;if(t){const e=this._order.indexOf(t);if(-1===e)return void this.fire(new Dt(new Error('Layer with id "'.concat(t,'" does not exist on this map.'))));n.slot===this._layers[t].slot?r=e:J('Layer with id "'.concat(t,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(r,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const i=this.getOwnLayerSourceCache(t);if(i&&i.castsShadows){let e=!1;for(const n in this._layers)if(this._layers[n].source===t.source&&this._layers[n].canCastShadows()){e=!0;break}i.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,n){this._checkLoaded();const i=this._checkLayer(e);i&&(i.minzoom===t&&i.maxzoom===n||(null!=t&&(i.minzoom=t),null!=n&&(i.maxzoom=n),this._updateLayer(i)))}setSlot(e,t){this._checkLoaded();const n=this._checkLayer(e);n&&n.slot!==t&&(n.slot=t,this._updateLayer(n))}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this._checkLayer(e);if(i&&!w(i.filter,t))return null==t?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(Es,"layers.".concat(i.id,".filter"),t,{layerType:i.type},n)||(i.filter=Y(t),this._updateLayer(i)))}getFilter(e){const t=this._checkLayer(e);if(t)return Y(t.filter)}setLayoutProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const r=this._checkLayer(e);r&&(w(r.getLayoutProperty(t),n)||(r.setLayoutProperty(t,n,i),r.isConfigDependent&&this._configDependentLayers.add(r.fqid),this._updateLayer(r)))}getLayoutProperty(e,t){const n=this._checkLayer(e);if(n)return n.getLayoutProperty(t)}setPaintProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const r=this._checkLayer(e);if(!r)return;if(w(r.getPaintProperty(t),n))return;const o=r.setPaintProperty(t,n,i);r.isConfigDependent&&this._configDependentLayers.add(r.fqid),o&&this._updateLayer(r),this._changes.updatePaintProperties(r)}getPaintProperty(e,t){const n=this._checkLayer(e);if(n)return n.getPaintProperty(t)}setFeatureState(e,t){this._checkLoaded();const n=e.source,i=e.sourceLayer,r=this._checkSource(n);if(!r)return;const o=r.type;if("geojson"===o&&i)return void this.fire(new Dt(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!i)return void this.fire(new Dt(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new Dt(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(n);for(const a of s)a.setFeatureState(i,e.id,t)}removeFeatureState(e,t){this._checkLoaded();const n=e.source,i=this._checkSource(n);if(!i)return;const r=i.type,o="vector"===r?e.sourceLayer:void 0;if("vector"===r&&!o)return void this.fire(new Dt(new Error("The sourceLayer parameter must be provided for vector source types.")));if(t&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new Dt(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(n);for(const a of s)a.removeFeatureState(o,e.id,t)}getFeatureState(e){this._checkLoaded();const t=e.source,n=e.sourceLayer,i=this._checkSource(t);if(i){if("vector"!==i.type||n)return void 0===e.id&&this.fire(new Dt(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(t)[0].getFeatureState(n,e.id);this.fire(new Dt(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=B({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return B({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),t=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return X({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:t,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateLayer(e){this._changes.updateLayer(e);const t=this.getLayerSourceCache(e),n=Sa(e.source,e.scope),i=this._changes.getUpdatedSourceCaches();e.source&&!i[n]&&t&&"raster"!==t.getSource().type&&(this._changes.updateSourceCache(n,"reload"),t.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type,n=this.order,i={},r=[];for(let s=n.length-1;s>=0;s--){const o=n[s];if(t(o)){i[o]=s;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort((e,t)=>t.intersectionZ-e.intersectionZ);const o=[];for(let s=n.length-1;s>=0;s--){const a=n[s];if(t(a))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<s)break;o.push(t),r.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(e,t,n){t&&t.filter&&this._validate(Es,"queryRenderedFeatures.filter",t.filter,null,t),t.scope=this.scope,t.availableImages=this._availableImages,t.serializedLayers=this._serializedLayers;const i={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new Dt(new Error("parameters.layers must be an Array."))),[];for(const e of t.layers){const t=this._mergedLayers[e];if(!t)return this.fire(new Dt(new Error("The layer '".concat(e,"' does not exist in the map's style and cannot be queried for features.")))),[];i[t.source]=!0}}const r=[],o=t.serializedLayers||{},s=t&&t.layers?t.layers.some(e=>{const t=this.getLayer(e);return t&&t.is3D()}):this.has3DLayers(),a=Iw.createFromScreenPoints(e,n);for(const l in this._mergedSourceCaches){const e=this._mergedSourceCaches[l].getSource();if(!e||e.scope!==t.scope)continue;const c=this._mergedSourceCaches[l].getSource().id;t.layers&&!i[c]||r.push(DS(this._mergedSourceCaches[l],this._mergedLayers,o,a,t,n,s,!!this.map._showQueryGeometry))}return this.placement&&r.push(function(e,t,n,i,r,o,s){const a={},l=o.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(s[u]);c.sort(RS);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=a[e]=a[e]||[],i=n[e];i.sort((e,t)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex});for(const e of i)t.push(e)}}for(const u in a)a[u].forEach(t=>{const i=t.feature,r=n(e[u]);if(!r)return;const o=r.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o});return a}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),a.screenGeometry,t,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(r)}querySourceFeatures(e,t){t&&t.filter&&this._validate(Es,"querySourceFeatures.filter",t.filter,null,t);const n=this.getOwnSourceCaches(e);let i=[];for(const r of n)i=i.concat(zS(r,t));return i}addSourceType(e,t,n){return oM.getSourceType(e)?n(new Error('A source type called "'.concat(e,'" already exists.'))):(oM.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this.light.getLight();let r=!1;for(const s in e)if(!w(e[s],i[s])){r=!0;break}if(!r)return;const o=this._getTransitionParameters();this.light.setLight(e,t,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!e)return delete this.terrain,null===e?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=e;const i=null==e.source;if(1===t){if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=Y(n),n=B(n,{source:e})}const e=B({},n),t={};if(this.terrain&&i){e.source=this.terrain.get().source;const n=this.terrain?this.getFragmentStyle(this.terrain.scope):null;n&&(t.style=n.serialize())}if(this._validate(ws,"terrain",e,t))return}if(!this.terrain||this.terrain.scope!==this.scope&&!i||this.terrain&&t!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,t),this.fire(new It("data",{dataType:"style"}))}else{const t=this.terrain,i=t.get();for(const e of Object.keys(Rt.terrain))!n.hasOwnProperty(e)&&Rt.terrain[e].default&&(n[e]=Rt.terrain[e].default);for(const n in e)if(!w(e[n],i[n])){t.set(e,this.options),this.stylesheet.terrain=e;const n=this._getTransitionParameters({duration:0});t.updateTransitions(n),this.fire(new It("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new Sw(e,this.map.transform);this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const t=this.fog;if(!w(t.get(),e)){t.set(e),this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:mt.now(),transition:B(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const n in this._mergedLayers)this.isLayerDraped(this._mergedLayers[n])?e.push(n):t.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const n=this.terrain=new fw(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(r&&!1===r.validate)return!1;const o=B({},this.serialize());return QA(this,e.call(_s,B({key:t,style:o,value:n,styleSpec:Rt},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),ra.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const n of t)n.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const n of t)n.resume(),n.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=YA(this.directionalLight));for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=!1,s=!1;const a={},l={};for(const c of this._mergedOrder){const t=this._mergedLayers[c];if("symbol"!==t.type)continue;const n=Sa(t.source,t.scope);let i=a[n];if(!i){const e=this.getLayerSourceCache(t);if(!e)continue;const r=e.getRenderableIds(!0).map(t=>e.getTileByID(t));l[n]=r.slice(),i=a[n]=r.sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const r=this.crossTileSymbolIndex.addLayer(t,i,e.center.lng,e.projection);o=o||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),r=r||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new It("neworder")),(r||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(mt.now(),e.zoom))&&(this.pauseablePlacement=new xT(e,this._mergedOrder,r,t,n,i,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,a,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(mt.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(const c of this._mergedOrder){const e=this._mergedLayers[c];"symbol"===e.type&&this.placement.updateLayerOpacities(e,a[Sa(e.source,e.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(mt.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const t=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==t.findIndex(t=>{let{id:n}=t;return n===e.id})?this.fire(new Dt(new Error("Import with id '".concat(e.id,"' already exists in the map's style.")))):(t.push(e),this._loadImports([e],!0),this)}setImportUrl(e,t){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);if(-1===i)return this;n[i].url=t;const r=this.fragments[i];return r.style=this._createFragmentStyle(n[i]),r.style.on("style.import.load",()=>this.mergeAll()),r.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];return-1===n?this:t?(this.fragments[n].style.setState(t),this._reloadImports(),this):(delete i[n].data,this.setImportUrl(e,i[n].url))}setImportConfig(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];if(-1===n)return this;t?i[n].config=t:delete i[n].config;const r=this.fragments[n],o=r.style.stylesheet&&r.style.stylesheet.schema;return r.config=t,r.style.setConfig(t,o),r.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],n=this.getImportIndex(e);return-1===n||(t.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports()),this}getImportIndex(e){const t=(this.stylesheet.imports||[]).findIndex(t=>t.id===e);return-1===t&&this.fire(new Dt(new Error("Import '".concat(e,"' does not exist in the map's style and cannot be updated.")))),t}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const n=this._mergedOtherSourceCaches[t];n&&e.push(n.getSource())}return e}getSource(e,t){const n=this.getSourceCache(e,t);return n&&n.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(e,t){const n=Sa(e,t);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(e){const t=Sa(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[t]:this._mergedOtherSourceCaches[t]}getSourceCaches(e){const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const n=e[t];"reload"===n?this.reloadSource(t):"clear"===n&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const n of t){const t=this.getLayer(n);t&&t.updateTransitions(e)}}getImages(e,t,n){this.imageManager.getImages(t.icons,t.scope,n),this._updateTilesForChangedImages();const i=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,t.scope,n)}getResource(e,t,n){return Te(t,n)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(e){const t=this.getOwnSourceCaches(e);return 0===t.length?(this.fire(new Dt(new Error("There is no source with ID '".concat(e,"'")))),!1):t.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function sM(e,t){let n=!1,i=null;const r=()=>{i=null,n&&(e(),i=setTimeout(r,t),n=!1)};return()=>(n=!0,i||r(),i)}oM.getSourceType=function(e){return CS[e]},oM.setSourceType=function(e,t){CS[e]=t},oM.registerForPluginStateChange=function(e){return e({pluginStatus:ea,pluginURL:ta}),ra.on("pluginStateChange",e),e};class aM{constructor(e){this._hashName=e&&encodeURIComponent(e),W(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=sM(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const n=lM(e);if(this._hashName){const e=this._hashName;let i=!1;const r=t.location.hash.slice(1).split("&").map(t=>{const r=t.split("=")[0];return r===e?(i=!0,"".concat(r,"=").concat(n)):t}).filter(e=>e);return i||r.push("".concat(e,"=").concat(n)),"#".concat(r.join("&"))}return"#".concat(n)}_getCurrentHash(){const e=t.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some(e=>isNaN(e))){const n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.location.href.replace(/(#.+)?$/,this.getHashString());t.history.replaceState(t.history.state,null,e)}}function lM(e,t){const n=e.getCenter(),i=Math.round(100*e.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?"/".concat(s,"/").concat(a,"/").concat(i):"".concat(i,"/").concat(a,"/").concat(s);return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/".concat(Math.round(c))),u}const cM={linearity:.3,easing:I(0,0,.3,1)},uM=B({deceleration:2500,maxSpeed:1400},cM),hM=B({deceleration:20,maxSpeed:1400},cM),dM=B({deceleration:1e3,maxSpeed:360},cM),pM=B({deceleration:1e3,maxSpeed:90},cM);class fM{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:mt.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=mt.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const t={zoom:0,bearing:0,pitch:0,pan:new b(0,0),pinchAround:void 0,around:void 0};for(const{settings:r}of this._inertiaBuffer)t.zoom+=r.zoomDelta||0,t.bearing+=r.bearingDelta||0,t.pitch+=r.pitchDelta||0,r.panDelta&&t.pan._add(r.panDelta),r.around&&(t.around=r.around),r.pinchAround&&(t.pinchAround=r.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(t.pan.mag()){const r=gM(t.pan.mag(),n,B({},uM,e||{}));i.offset=t.pan.mult(r.amount/t.pan.mag()),i.center=this._map.transform.center,mM(i,r)}if(t.zoom){const e=gM(t.zoom,n,hM);i.zoom=this._map.transform.zoom+e.amount,mM(i,e)}if(t.bearing){const e=gM(t.bearing,n,dM);i.bearing=this._map.transform.bearing+z(e.amount,-179,179),mM(i,e)}if(t.pitch){const e=gM(t.pitch,n,pM);i.pitch=this._map.transform.pitch+e.amount,mM(i,e)}if(i.zoom||i.bearing){const e=void 0===t.pinchAround?t.around:t.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),i.noMoveStart=!0,i}}function mM(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function gM(e,t,n){const{maxSpeed:i,linearity:r,deceleration:o}=n,s=z(e*r/(t/1e3),-i,i),a=Math.abs(s)/(o*r);return{easing:n.easing,duration:1e3*a,amount:s*(a/2)}}class yM extends It{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=Et(t.getCanvasContainer(),n);super(e,B({point:r,lngLat:t.unproject(r),originalEvent:n},i)),this._defaultPrevented=!1,this.target=t}}class _M extends It{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){const i="touchend"===e?n.changedTouches:n.touches,r=At(t.getCanvasContainer(),i),o=r.map(e=>t.unproject(e)),s=r.reduce((e,t,n,i)=>e.add(t.div(i.length)),new b(0,0));super(e,{points:r,point:s,lngLats:o,lngLat:t.unproject(s),originalEvent:n}),this._defaultPrevented=!1}}class vM extends It{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class xM{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new vM(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new yM(e.type,this._map,e))}mouseup(e){this._map.fire(new yM(e.type,this._map,e))}preclick(e){const t=B({},e);t.type="preclick",this._map.fire(new yM(t.type,this._map,t))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new yM(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new yM(e.type,this._map,e))}mouseover(e){this._map.fire(new yM(e.type,this._map,e))}mouseout(e){this._map.fire(new yM(e.type,this._map,e))}touchstart(e){return this._firePreventable(new _M(e.type,this._map,e))}touchmove(e){this._map.fire(new _M(e.type,this._map,e))}touchend(e){this._map.fire(new _M(e.type,this._map,e))}touchcancel(e){this._map.fire(new _M(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bM{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new yM(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yM("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new yM(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wM{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(bt(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t,i=this._startPos,r=this._lastPos;if(!i||!r||r.equals(n)||!this._box&&n.dist(i)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=gt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(i.x,n.x),s=Math.max(i.x,n.x),a=Math.min(i.y,n.y),l=Math.max(i.y,n.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform="translate(".concat(o,"px,").concat(a,"px)"),this._box.style.width=s-o+"px",this._box.style.height=l-a+"px")})}mouseupWindow(e,t){if(!this._active)return;const n=this._startPos,i=t;if(n&&0===e.button){if(this.reset(),Tt(),n.x!==i.x||n.y!==i.y)return this._map.fire(new It("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(n,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),wt(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new It(e,{originalEvent:t}))}}function SM(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class TM{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const t=new b(0,0);for(const n of e)t._add(n);return t.div(e.length)}(t),this.touches=SM(n,t)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=SM(n,t);for(const r in this.touches){const e=i[r];(!e||e.dist(this.touches[r])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class EM{constructor(e){this.singleTap=new TM(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class AM{constructor(){this._zoomIn=new EM({numTouches:1,numTaps:2}),this._zoomOut=new EM({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const MM={0:1,2:2};class kM{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=Mt(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const n=MM[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&Mt(e)===this._eventButton&&(this._moved&&Tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class CM extends kM{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class PM extends kM{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){e.preventDefault()}}class IM extends kM{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){e.preventDefault()}}class DM{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset(),W(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new b(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!oe())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,t,n)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,n){n.length>0&&(this._active=!0);const i=SM(n,t),r=new b(0,0),o=new b(0,0);let s=0;for(const l in i){const e=i[l],t=this._touches[l];t&&(r._add(e),o._add(e.sub(t)),s++,i[l]=e)}if(this._touches=i,s<this._minTouches||!o.mag())return;const a=o.div(s);return this._sum._add(a),this._sum.mag()<this._clickTolerance?void 0:{around:r.div(s),panDelta:a}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class zM{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){const i=this._firstTwoTouches;if(!i)return;e.preventDefault();const[r,o]=i,s=RM(n,t,r),a=RM(n,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=RM(n,t,i),s=RM(n,t,r);o&&s||(this._active&&Tt(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function RM(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function LM(e,t){return Math.log(e/t)/Math.LN2}class OM extends zM{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(LM(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:LM(this._distance,n),pinchAround:t}}}function FM(e,t){return 180*e.angleWith(t)/Math.PI}class BM extends zM{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:FM(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;const i=FM(e,n);return Math.abs(i)<t}}function NM(e){return Math.abs(e.y)>Math.abs(e.x)}class jM extends zM{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,NM(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){const i=this._lastPoints;if(!i)return;const r=e[0].sub(i[0]),o=e[1].sub(i[1]);return this._map._cooperativeGestures&&!oe()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(r,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return NM(e)&&NM(t)&&o}}const VM={panStep:100,bearingStep:15,pitchStep:10};class UM{constructor(){const e=VM;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:GM,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function GM(e){return e*(2-e)}const qM=4.000244140625;class WM{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._handler=t,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,W(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||oe()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===t.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=mt.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%qM==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=Et(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const t=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>qM?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);const r=t(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*i))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:t(),i=this._startZoom,r=this._easing;let o,s=!1;if("wheel"===this._type&&i&&r){const e=Math.min((mt.now()-this._lastWheelEventTime)/200,1);o=tr(i,n,r(e)),e<1?this._frameId||(this._frameId=!0):s=!0}else o=n,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let a=o-t();return a*this._lastDelta<0&&(a=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:a,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let t=D;if(this._prevEase){const e=this._prevEase,n=(mt.now()-e.start)/e.duration,i=e.easing(n+.01)-e.easing(n),r=.27/Math.sqrt(i*i+1e-4)*.01;t=I(r,Math.sqrt(.0729-r*r),.25,1)}return this._prevEase={start:mt.now(),duration:e,easing:t},t}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ZM{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class HM{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class XM{constructor(){this._tap=new EM({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class YM{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class KM{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class JM{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $M=e=>e.zoom||e.drag||e.pitch||e.rotate;class QM extends It{}class ek{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,t){const n=Lh.sub([],t,e);this.radius=Lh.length(n[2]<0?Lh.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){Lh.div(e,e,this.constants),Lh.normalize(e,e),Lh.mul(e,e,this.constants);const t=Lh.scale([],e,this.radius);if(t[2]>0){const e=Lh.scale([],[0,0,1],Lh.dot(t,[0,0,1])),n=Lh.scale([],Lh.normalize([],[t[0],t[1],0]),this.radius),i=Lh.add([],t,Lh.scale([],Lh.sub([],Lh.add([],n,e),t),2));t[0]=i[0],t[1]=i[1]}return t}}function tk(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class nk{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fM(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ek,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),W(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.document,"mousemove",{capture:!0}],[t.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t,"blur",void 0]];for(const[r,o,s]of this._listeners)r.addEventListener(o,r===t.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[e,n,i]of this._listeners)e.removeEventListener(n,e===t.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new xM(t,e));const i=t.boxZoom=new wM(t,e);this._add("boxZoom",i);const r=new AM,o=new HM;t.doubleClickZoom=new ZM(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new XM;this._add("tapDragZoom",s);const a=t.touchPitch=new jM(t);this._add("touchPitch",a);const l=new PM(e),c=new IM(e);t.dragRotate=new KM(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new CM(e),h=new DM(t,e);t.dragPan=new YM(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new BM,p=new OM;t.touchZoomRotate=new JM(n,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new bM(t));const f=t.scrollZoom=new WM(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new UM;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$M(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){this._updatingCamera=!0;const n="renderFrame"===e.type,i=n?void 0:e,r={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?At(this._el,a):n?void 0:Et(this._el,e);for(const{handlerName:h,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(s,p,h)?d.reset():d[t||e.type]&&(n=d[t||e.type](e,l,a),this.mergeHandlerResult(r,o,n,h,i),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(s[h]=d)}const c={};for(const h in this._previousActiveHandlers)s[h]||(c[h]=i);this._previousActiveHandlers=s,(Object.keys(c).length||tk(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||tk(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,t,n,i,r){if(!n)return;B(e,n);const o={handlerName:i,originalEvent:n.originalEvent||r};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}_applyChanges(){const e={},t={},n={};for(const[i,r,o]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new b(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.aroundCoord&&(e.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),B(t,r),B(n,o);this._updateMapTransform(e,t,n),this._changes=[]}_updateMapTransform(e,t,n){const i=this._map,r=i.transform,o=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!tk(e)){const e=r.zoom;r.cameraElevationReference="sea",null!=this._originalZoom&&r._orthographicProjectionAtLowPitch&&"globe"!==r.projection.name&&0===r.pitch?(r.cameraElevationReference="ground",r.zoom=this._originalZoom):(r.recenterOnTerrain(),r.cameraElevationReference="ground"),e!==r.zoom&&this._map._update(!0)}if(r._isCameraConstrained&&i._stop(!0),!tk(e))return void this._fireEvents(t,n,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,aroundCoord:h,pinchAround:d}=e;r._isCameraConstrained&&(a>0&&(a=0),r._isCameraConstrained=!1),void 0!==d&&(u=d),(a||(e=>t[e]&&!this._eventsInProgress[e])("drag"))&&u&&(this._dragOrigin=o(r.pointCoordinate3D(u)),this._originalZoom=r.zoom,this._trackingEllipsoid.setup(r._camera.position,this._dragOrigin)),r.cameraElevationReference="sea",i._stop(!0),u=u||i.transform.centerPoint,l&&(r.bearing+=l),c&&(r.pitch+=c),r._updateCameraState();const p=[0,0,0];if(s)if("mercator"===r.projection.name){const e=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(u).dir),t=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(u.sub(s)).dir);p[0]=t[0]-e[0],p[1]=t[1]-e[1]}else{const e=r.pointCoordinate(u);if("globe"===r.projection.name){s=s.rotate(-r.angle);const t=r._pixelsPerMercatorPixel/r.worldSize;p[0]=-s.x*cp(rp(e.y))*t,p[1]=-s.y*cp(r.center.lat)*t}else{const t=r.pointCoordinate(u.sub(s));e&&t&&(p[0]=t.x-e.x,p[1]=t.y-e.y)}}const f=r.zoom,m=[0,0,0];if(a){const e=o(h||r.pointCoordinate3D(u)),t={dir:Lh.normalize([],Lh.sub([],e,r._camera.position))};if(t.dir[2]<0){const n=r.zoomDeltaToMovement(e,a);Lh.scale(m,t.dir,n)}}const g=Lh.add(p,p,m);r._translateCameraConstrained(g),a&&Math.abs(r.zoom-f)>1e-4&&r.recenterOnTerrain(),r.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_fireEvents(e,t,n){const i=$M(this._eventsInProgress),r=$M(e),o={};for(const c in e){const{originalEvent:t}=e[c];this._eventsInProgress[c]||(o["".concat(c,"start")]=t),this._eventsInProgress[c]=e[c]}!i&&r&&this._fireEvent("movestart",r.originalEvent);for(const c in o)this._fireEvent(c,o[c]);r&&this._fireEvent("move",r.originalEvent);for(const c in e){const{originalEvent:t}=e[c];this._fireEvent(c,t)}const s={};let a;for(const c in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[c];this._handlersById[e].isActive()||(delete this._eventsInProgress[c],a=t[e]||n,s["".concat(c,"end")]=a)}for(const c in s)this._fireEvent(c,s[c]);const l=$M(this._eventsInProgress);if(n&&(i||r)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;e?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:a})):(this._map.fire(new It("moveend",{originalEvent:a})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new It(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new QM("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ik="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class rk extends zt{constructor(e,t){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,this._respectPrefersReducedMotion=!1!==t.respectPrefersReducedMotion,W(["_renderFrameCallback"],this)}getCenter(){return new Kd(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,n){return e=b.convert(e).mult(-1),this.panTo(this.transform.center,B({offset:e},t),n)}panTo(e,t,n){return this.easeTo(B({center:e},t),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,n){return this.easeTo(B({zoom:e},t),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,n){return this.easeTo(B({bearing:e},t),n)}resetNorth(e,t){return this.rotateTo(0,B({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(B({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=cc.convert(e);const n=t&&t.bearing||0,i=t&&t.pitch||0,r=e.getNorthWest(),o=e.getSouthEast();return this._cameraForBounds(this.transform,r,o,n,i,t)}_extendCameraOptions(e){const t={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=B({padding:t,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=B(t,e.padding),e}_minimumAABBFrustumDistance(e,t){const n=t.max[0]-t.min[0],i=t.max[1]-t.min[1];return n/i>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):i/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,t,n,i,r,o){const s=e.clone(),a=this._extendCameraOptions(o);s.bearing=i,s.pitch=r;const l=Kd.convert(t),c=Kd.convert(n),u=.5*(l.lat+c.lat),h=.5*(l.lng+c.lng),d=Ed(u,h),p=Lh.normalize([],d),f=Lh.normalize([],Lh.cross([],p,[0,1,0])),m=Lh.cross([],f,p),g=[f[0],f[1],f[2],0,m[0],m[1],m[2],0,p[0],p[1],p[2],0,0,0,0,1],y=[d,Ed(l.lat,l.lng),Ed(c.lat,l.lng),Ed(c.lat,c.lng),Ed(l.lat,c.lng),Ed(u,l.lng),Ed(u,c.lng),Ed(l.lat,h),Ed(c.lat,h)];let _=id.fromPoints(y.map(e=>[Lh.dot(f,e),Lh.dot(m,e),Lh.dot(p,e)]));const v=Lh.transformMat4([],_.center,g);0===Lh.squaredLength(v)&&Lh.set(v,0,0,1),Lh.normalize(v,v),Lh.scale(v,v,sd),s.center=function(e){let[t,n,i]=e;const r=Math.hypot(t,n,i),o=Math.atan2(t,i),s=.5*Math.PI-Math.acos(-n/r);return new Kd(A(o),A(s))}(v);const x=s.getWorldToCameraMatrix(),b=Ch.invert(new Float64Array(16),x);_=id.applyTransform(_,Ch.multiply([],x,g)),Lh.transformMat4(v,v,x);const w=.5*(_.max[2]-_.min[2]),S=this._minimumAABBFrustumDistance(s,_),T=Lh.scale([],[0,0,1],w),E=Lh.add(T,v,T),M=S+(0===s.pitch?0:Lh.distance(v,E)),k=s.globeCenterInViewSpace,C=Lh.sub([],v,[k[0],k[1],k[2]]);Lh.normalize(C,C),Lh.scale(C,C,M);const P=Lh.add([],v,C);Lh.transformMat4(P,P,b);const I=Hd/sd,D=Lh.length(P),z=np(Math.max(D*I-Hd,Number.EPSILON),0),R=Math.min(s.zoomFromMercatorZAdjusted(z),a.maxZoom);return R>.5*(rd+od)?(s.setProjection({name:"mercator"}),s.zoom=R,this._cameraForBounds(s,t,n,i,r,o)):{center:s.center,zoom:R,bearing:i,pitch:r}}queryTerrainElevation(e,t){const n=this.transform.elevation;return n?(t=B({},{exaggerated:!0},t),n.getAtPoint(hp.fromLngLat(e),null,t.exaggerated)):null}_cameraForBounds(e,t,n,i,r,o){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,t,n,i,r,o);const s=e.clone(),a=this._extendCameraOptions(o),l=s.padding;s.bearing=i,s.pitch=r;const c=Kd.convert(t),u=Kd.convert(n),h=new Kd(c.lng,u.lat),d=new Kd(u.lng,c.lat),p=s.project(c),f=s.project(u),m=this.queryTerrainElevation(c),g=this.queryTerrainElevation(u),y=this.queryTerrainElevation(h),_=this.queryTerrainElevation(d),v=[[p.x,p.y,Math.min(m||0,g||0,y||0,_||0)],[f.x,f.y,Math.max(m||0,g||0,y||0,_||0)]];let x=id.fromPoints(v);const w=s.getWorldToCameraMatrix(),S=Ch.invert(new Float64Array(16),w);x=id.applyTransform(x,w);const T=Lh.sub([],x.max,x.min),A=l.left||0,M=l.right||0,k=l.bottom||0,C=l.top||0,{left:P,right:I,top:D,bottom:z}=a.padding,R=.5*(A+M),L=.5*(C+k),O=Math.min(s.scaleZoom(s.scale*Math.min((s.width-(A+M+P+I))/T[0],(s.height-(k+C+z+D))/T[1])),a.maxZoom),F=s.scale/s.zoomScale(O);x=new id([x.min[0]-(P+R)*F,x.min[1]-(z+L)*F,x.min[2]],[x.max[0]+(I+R)*F,x.max[1]+(D+L)*F,x.max[2]]);const B=.5*T[2],N=this._minimumAABBFrustumDistance(s,x),j=[0,0,1,0];bh.transformMat4(j,j,w),bh.normalize(j,j);const V=Lh.scale([],j,N+B),U=Lh.add([],x.center,V),G=("number"==typeof a.offset.x&&"number"==typeof a.offset.y?new b(a.offset.x,a.offset.y):b.convert(a.offset)).rotate(-E(i));x.center[0]-=G.x*F,x.center[1]+=G.y*F,Lh.transformMat4(x.center,x.center,S),Lh.transformMat4(U,U,S);const q=[x.center[0],x.center[1],U[2]*s.pixelsPerMeter];Lh.scale(q,q,1/s.worldSize);const W=ip(q[0]),Z=rp(q[1]),H=Math.min(s._zoomFromMercatorZ(q[2]),a.maxZoom),X=new Kd(W,Z);return s.mercatorFromTransition&&H<.5*(rd+od)?(s.setProjection({name:"globe"}),s.zoom=H,this._cameraForBounds(s,t,n,i,r,o)):{center:X,zoom:H,bearing:i,pitch:r}}fitBounds(e,t,n){const i=this.cameraForBounds(e,t);return this._fitInternal(i,t,n)}fitScreenCoordinates(e,t,n,i,r){const o=b.convert(e),s=b.convert(t),a=new b(Math.min(o.x,s.x),Math.min(o.y,s.y)),l=new b(Math.max(o.x,s.x),Math.max(o.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,s))return this;const c=this.transform.pointLocation3D(a),u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(new b(a.x,l.y)),d=this.transform.pointLocation3D(new b(l.x,a.y)),p=[Math.min(c.lng,u.lng,h.lng,d.lng),Math.min(c.lat,u.lat,h.lat,d.lat)],f=[Math.max(c.lng,u.lng,h.lng,d.lng),Math.max(c.lat,u.lat,h.lat,d.lat)],m=i&&i.pitch?i.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,p,f,n,m,i);return this._fitInternal(g,i,r)}_fitInternal(e,t,n){return e?(delete(t=B(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}jumpTo(e,t){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let i=!1,r=!1,o=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(i=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=Kd.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(r=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new It("movestart",t)).fire(new It("move",t)),i&&this.fire(new It("zoomstart",t)).fire(new It("zoom",t)).fire(new It("zoomend",t)),r&&this.fire(new It("rotatestart",t)).fire(new It("rotate",t)).fire(new It("rotateend",t)),o&&this.fire(new It("pitchstart",t)).fire(new It("pitch",t)).fire(new It("pitchend",t)),this.fire(new It("moveend",t)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||J(ik),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,t){const n=this.transform;if(!n.projection.supportsFreeCamera)return J(ik),this;this.stop();const i=n.zoom,r=n.pitch,o=n.bearing;n.setFreeCameraOptions(e);const s=i!==n.zoom,a=r!==n.pitch,l=o!==n.bearing;return this.fire(new It("movestart",t)).fire(new It("move",t)),s&&this.fire(new It("zoomstart",t)).fire(new It("zoom",t)).fire(new It("zoomend",t)),l&&this.fire(new It("rotatestart",t)).fire(new It("rotate",t)).fire(new It("rotateend",t)),a&&this.fire(new It("pitchstart",t)).fire(new It("pitch",t)).fire(new It("pitchend",t)),this.fire(new It("moveend",t)),this}easeTo(e,t){this._stop(!1,e.easeId),(!1===(e=B({offset:[0,0],duration:500,easing:D},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const n=this.transform,i=this.getZoom(),r=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in e?+e.zoom:i,l="bearing"in e?this._normalizeBearing(e.bearing,r):r,c="pitch"in e?+e.pitch:o,u="padding"in e?e.padding:n.padding,h=b.convert(e.offset);let d,p,f;if("globe"===n.projection.name){const t=hp.fromLngLat(n.center),i=h.rotate(-n.angle);t.x+=i.x/n.worldSize,t.y+=i.y/n.worldSize;const r=t.toLngLat(),o=Kd.convert(e.center||r);this._normalizeCenter(o),d=n.centerPoint.add(i),p=new b(t.x,t.y).mult(n.worldSize),f=new b(ep(o.lng),tp(o.lat)).mult(n.worldSize).sub(p)}else{d=n.centerPoint.add(h);const t=n.pointLocation(d),i=Kd.convert(e.center||t);this._normalizeCenter(i),p=n.project(t),f=n.project(i).sub(p)}const m=n.zoomScale(a-i);let g,y;e.around&&(g=Kd.convert(e.around),y=n.locationPoint(g));const _=this._zooming||a!==i,v=this._rotating||r!==l,x=this._pitching||c!==o,w=!n.isPaddingEqual(u),S=n=>b=>{if(_&&(n.zoom=tr(i,a,b)),v&&(n.bearing=tr(r,l,b)),x&&(n.pitch=tr(o,c,b)),w&&(n.interpolatePadding(s,u,b),d=n.centerPoint.add(h)),g)n.setLocationAtPoint(g,y);else{const e=n.zoomScale(n.zoom-i),t=a>i?Math.min(2,m):Math.max(.5,m),r=Math.pow(t,1-b),o=n.unproject(p.add(f.mult(b*r)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,d)}return e.preloadOnly||this._fireMoveEvents(t),n};if(e.preloadOnly){const t=this._emulate(S,e.duration,n);return this._preloadTiles(t),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_,this._rotating=v,this._pitching=x,this._padding=w,this._easeId=e.easeId,this._prepareEase(t,e.noMoveStart,T),this._ease(S(n),e=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(t,e)},e),this}_prepareEase(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),t||n.moving||this.fire(new It("movestart",e)),this._zooming&&!n.zooming&&this.fire(new It("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new It("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new It("pitchstart",e))}_fireMoveEvents(e){this.fire(new It("move",e)),this._zooming&&this.fire(new It("zoom",e)),this._rotating&&this.fire(new It("rotate",e)),this._pitching&&this.fire(new It("pitch",e))}_afterEase(e,t){if(this._easeId&&t&&this._easeId===t)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,i=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new It("zoomend",e)),i&&this.fire(new It("rotateend",e)),r&&this.fire(new It("pitchend",e)),this.fire(new It("moveend",e))}flyTo(e,t){if(this._prefersReducedMotion(e)){const n=N(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,t)}this.stop(),e=B({offset:[0,0],speed:1.2,curve:1.42,easing:D},e);const n=this.transform,i=this.getZoom(),r=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in e?z(+e.zoom,n.minZoom,n.maxZoom):i,l="bearing"in e?this._normalizeBearing(e.bearing,r):r,c="pitch"in e?+e.pitch:o,u="padding"in e?e.padding:n.padding,h=n.zoomScale(a-i),d=b.convert(e.offset);let p=n.centerPoint.add(d);const f=n.pointLocation(p),m=Kd.convert(e.center||f);this._normalizeCenter(m);const g=n.project(f),y=n.project(m).sub(g);let _=e.curve;const v=Math.max(n.width,n.height),x=v/h,w=y.mag();if("minZoom"in e){const t=z(Math.min(e.minZoom,i,a),n.minZoom,n.maxZoom),r=v/n.zoomScale(t-i);_=Math.sqrt(r/w*2)}const S=_*_;function T(e){const t=(x*x-v*v+(e?-1:1)*S*S*w*w)/(2*(e?x:v)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function A(e){return(Math.exp(e)+Math.exp(-e))/2}const M=T(0);let k=function(e){return A(M)/A(M+_*e)},C=function(e){return v*((A(M)*(E(t=M+_*e)/A(t))-E(M))/S)/w;var t},P=(T(1)-M)/_;if(Math.abs(w)<1e-6||!isFinite(P)){if(Math.abs(v-x)<1e-6)return this.easeTo(e,t);const n=x<v?-1:1;P=Math.abs(Math.log(x/v))/_,C=function(){return 0},k=function(e){return Math.exp(n*_*e)}}e.duration="duration"in e?+e.duration:1e3*P/("screenSpeed"in e?+e.screenSpeed/_:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const I=r!==l,R=c!==o,L=!n.isPaddingEqual(u),O=n=>h=>{const f=h*P,_=1/k(f);n.zoom=1===h?a:i+n.scaleZoom(_),I&&(n.bearing=tr(r,l,h)),R&&(n.pitch=tr(o,c,h)),L&&(n.interpolatePadding(s,u,h),p=n.centerPoint.add(d));const v=1===h?m:n.unproject(g.add(y.mult(C(f))).mult(_));return n.setLocationAtPoint(n.renderWorldCopies?v.wrap():v,p),n._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(t),n};if(e.preloadOnly){const t=this._emulate(O,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=I,this._pitching=R,this._padding=L,this._prepareEase(t,!1),this._ease(O(n),()=>this._afterEase(t),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=mt.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((mt.now()-this._easeStart)/this._easeOptions.duration,1),t=this._onEaseFrame;t&&t(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,t){e=L(e,-180,180);const n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&mt.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,t,n){const i=Math.ceil(15*t/1e3),r=[],o=e(n.clone());for(let s=0;s<=i;s++){const e=o(s/i);r.push(e.clone())}return r}}class ok{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,W(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=gt("button","mapboxgl-ctrl-attrib-button",this._container),gt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gt("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString("AttributionControl.".concat(t));e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.ACCESS_TOKEN}];if(e){const n=t.reduce((e,n,i)=>(n.value&&(e+="".concat(n.key,"=").concat(n.value).concat(i<t.length-1?"&":"")),e),"?");e.href="".concat(a.FEEDBACK_URL,"/").concat(n,"#").concat(lM(this._map,!0)),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort((e,t)=>e.length-t.length),e=e.filter((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class sk{constructor(){W(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=gt("div","mapboxgl-ctrl");const t=gt("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class ak{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const i of n)if(i.id===e)return void(i.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function lk(e,t,n){if(e=new Kd(e.lng,e.lat),t){const i=new Kd(e.lng-360,e.lat),r=new Kd(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),s=n.locationPoint(e).distSqr(t),a=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(i).distSqr(t)<s&&(a||Math.abs(i.lng-n.center.lng)<o)?e=i:n.locationPoint(r).distSqr(t)<s&&(a||Math.abs(r.lng-n.center.lng)<o)&&(e=r)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const ck={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class uk extends zt{constructor(e,n){if(super(),(e instanceof t.HTMLElement||n)&&(e=B({element:e},n)),W(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=b.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=gt("div");const t=41,n=27,i=yt("svg",{display:"block",height:t*this._scale+"px",width:n*this._scale+"px",viewBox:"0 0 ".concat(n," ").concat(t)},this._element),r=yt("radialGradient",{id:"shadowGradient"},yt("defs",{},i));yt("stop",{offset:"10%","stop-opacity":.4},r),yt("stop",{offset:"100%","stop-opacity":.05},r),yt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i),yt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),yt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),yt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),this._offset=b.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const i=this._element.classList;for(const t in ck)i.remove("mapboxgl-marker-anchor-".concat(t));i.add("mapboxgl-marker-anchor-".concat(this._anchor));const r=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...r),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=Kd.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const n=e.unproject(t),i=e.getFreeCameraOptions();if(!i.position)return!1;const r=i.position.toLngLat();return r.distanceTo(n)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const t=this._pos;if(!t||t.x<0||t.x>e.transform.width||t.y<0||t.y>e.transform.height)return void this._clearFadeTimer();const n=e.unproject(t);let i;e._showingGlobe()&&Ud(e.transform,this._lngLat)?i=0:(i=1-e._queryFogOpacity(n),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity="".concat(i),this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(ck[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const e=this._pos,t=this._map,n=this.getPitchAlignment();if(!t||!e||"map"!==n)return"";if(!t._showingGlobe()){const e=t.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const i=A(Vd(t.transform,this._lngLat)),r=e.sub(jd(t.transform)),o=Math.abs(r.x)+Math.abs(r.y);if(0===o)return"";const s=i/o;return"rotateX(".concat(-r.y*s,"deg) rotateY(").concat(r.x*s,"deg)")}_calculateZTransform(){const e=this._pos,t=this._map;if(!t||!e)return"";let n=0;const i=this.getRotationAlignment();if("map"===i)if(t._showingGlobe()){const e=t.project(new Kd(this._lngLat.lng,this._lngLat.lat+.001)),i=t.project(new Kd(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);n=A(Math.atan2(i.y,i.x))-90}else n=-t.getBearing();else if("horizon"===i){const i=R(4,6,t.getZoom()),r=jd(t.transform);r.y+=i*t.transform.height;const o=e.sub(r),s=A(Math.atan2(o.y,o.x));n=(s>90?s-270:s+90)*(1-i)}return n+=this._rotation,n?"rotateZ(".concat(n,"deg)"):""}_update(e){t.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=lk(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===e?this._updateFrameId=t.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=b.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const t=this._map;if(!t)return;const n=this._pointerdownPos,i=this._positionDelta;if(n&&i){if(!this._isDragging){const i=this._clickTolerance||t._clickTolerance;if(e.point.dist(n)<i)return;this._isDragging=!0}this._pos=e.point.sub(i),this._lngLat=t.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new It("dragstart"))),this.fire(new It("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new It("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const hk={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},dk=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pk(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new b(0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new b(0,e);case"top-left":return new b(n,n);case"top-right":return new b(-n,n);case"bottom":return new b(0,-e);case"bottom-left":return new b(n,-n);case"bottom-right":return new b(-n,-n);case"left":return new b(e,0);case"right":return new b(-e,0)}return new b(0,0)}return e instanceof b||Array.isArray(e)?b.convert(e):b.convert(e[t]||[0,0])}class fk{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const t=k((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-t)+this._end*t}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const mk={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},gk={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},yk={showCompass:!0,showZoom:!0,visualizePitch:!1};class _k{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=t,this.mouseRotate=new PM({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new IM({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),W(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),t.addEventListener("mousedown",this.mousedown),t.addEventListener("touchstart",this.touchstart,{passive:!1}),t.addEventListener("touchmove",this.touchmove),t.addEventListener("touchend",this.touchend),t.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),bt()}move(e,t){const n=this.map,i=this.mouseRotate.mousemoveWindow(e,t),r=i&&i.bearingDelta;if(r&&n.setBearing(n.getBearing()+r),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t),r=i&&i.pitchDelta;r&&n.setPitch(n.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){wt(),t.removeEventListener("mousemove",this.mousemove),t.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(B({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),Et(this.element,e)),t.addEventListener("mousemove",this.mousemove),t.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,Et(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=At(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=At(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vk={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xk={maxWidth:100,unit:"metric"},bk={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},wk={version:n,supported:st,setRTLTextPlugin:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ea===Ks||ea===Js||ea===$s)throw new Error("setRTLTextPlugin cannot be called multiple times.");ta=mt.resolveURL(e),ea=Ks,Qs=t,ia(),n||sa()},getRTLTextPluginStatus:oa,Map:class extends rk{constructor(e){nt.mark(tt.create);const n=e;if(null!=(e=B({},gk,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==re){const t=e.navigator?e.navigator.userAgent:null;re=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return re}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(t)&&(e.antialias=!1,J("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ax(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new ak,this._domRenderTaskQueue=new ak,this._controls=[],this._markers=[],this._popups=[],this._mapId=V(),this._locale=B({},mk,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fk(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new ze(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?i({},e.contextCreateOptions):{},"string"==typeof e.container){if(this._container=t.document.getElementById(e.container),!this._container)throw new Error("Container '".concat(e.container.toString(),"' not found."))}else{if(!(e.container instanceof t.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&J("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),W(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==t&&(this._fullscreenchangeEvent="onfullscreenchange"in t.document?"fullscreenchange":"webkitfullscreenchange",t.addEventListener("online",this._onWindowOnline,!1),t.addEventListener("resize",this._onWindowResize,!1),t.addEventListener("orientationchange",this._onWindowResize,!1),t.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new nk(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||a.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new aM("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==n.center&&null==n.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const t=e.bounds;t&&(this.resize(),this.fitBounds(t,B({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new ok({customAttribution:e.customAttribution})),this._logoControl=new sk,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new It("".concat(e.dataType,"data"),e))}),this.on("dataloading",e=>{this.fire(new It("".concat(e.dataType,"dataloading"),e))})}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new Dt(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[t];return-1!==t.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new Dt(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new It("movestart",e)).fire(new It("move",e)),this.fire(new It("resize",e)),t&&this.fire(new It("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(cc.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new It("zoomstart")).fire(new It("zoom")).fire(new It("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new It("zoomstart")).fire(new It("zoom")).fire(new It("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new It("pitchstart")).fire(new It("pitch")).fire(new It("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new It("pitchstart")).fire(new It("pitch")).fire(new It("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?t.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?t.navigator.language:e):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,t=e.projection.name;let n;"globe"===t&&e.zoom>=od?(e.setMercatorFromTransition(),n=!0):"mercator"===t&&e.zoom<od&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t="globe"===e.name&&this.transform.zoom>=od?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Kd.convert(e))}unproject(e){return this.transform.pointLocation3D(b.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const r=r=>{const o=t.filter(e=>this.getLayer(e)),s=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?i||(i=!0,n.call(this,new yM(e,this,r.originalEvent,{features:s}))):i=!1},o=()=>{i=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const r=r=>{const o=t.filter(e=>this.getLayer(e));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?i=!0:i&&(i=!1,n.call(this,new yM(e,this,r.originalEvent)))},o=t=>{i&&(i=!1,n.call(this,new yM(e,this,t.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:r,mouseout:o}}}{const i=e=>{const i=t.filter(e=>this.getLayer(e)),r=i.length?this.queryRenderedFeatures(e.point,{layers:i}):[];r.length&&(e.features=r,n.call(this,e),delete e.features)};return{layers:new Set(t),listener:n,delegates:{[e]:i}}}}on(e,t,n){if(void 0===n)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const r of t)if(!this._isValidId(r))return this;const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const r of t)if(!this._isValidId(r))return this;const i=this._createDelegatedListener(e,t,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(e,t,n){if(void 0===n)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const o of t)if(!this._isValidId(o))return this;const i=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const o=e[r];if(o.listener===n&&i(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof b||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const n of t.layers)if(!this._isValidId(n))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&J("".concat(t," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(b.convert(e))}setStyle(e,t){return!1!==(t=B({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new oM(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new oM(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),i=this._requestManager.transformRequest(n,be.Style);Ee(i,(e,n)=>{e?this.fire(new Dt(e)):n&&this._updateDiff(n,t)})}else"object"==typeof e&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(n){J("Unable to perform style diff: ".concat(n.message||n.error||n,".  Rebuilding the style from scratch.")),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(J("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new Dt(new Error("IDs can't be empty."))),!1):!wa(e)||(this.fire(new Dt(new Error("IDs can't contain special symbols: \"".concat(e,'".')))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,n){let{pixelRatio:i=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._lazyInitEmptyStyle(),n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap){const{width:t,height:l,data:c}=mt.getImageData(n);this.style.addImage(e,{data:new rf({width:t,height:l},c),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new Dt(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:t,height:l}=n,c=n;this.style.addImage(e,{data:new rf({width:t,height:l},new Uint8Array(c.data)),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}}updateImage(e,n){this._lazyInitEmptyStyle();const i=this.style.getImage(e);if(!i)return void this.fire(new Dt(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap?mt.getImageData(n):n,{width:o,height:s}=r;void 0!==o&&void 0!==s?o===i.data.width&&s===i.data.height?(i.data.replace(r.data,!(n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap)),this.style.updateImage(e,i)):this.fire(new Dt(new Error("The width and height of the updated image (".concat(o,", ").concat(s,")\n                must be that same as the previous version of the image\n                (").concat(i.data.width,", ").concat(i.data.height,")")))):this.fire(new Dt(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Dt(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,n){Ie(this._requestManager.transformRequest(e,be.Image),(e,i)=>{n(e,i instanceof t.HTMLImageElement?mt.getImageData(i):i)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Dt(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,i),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,i),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Kd.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let i,r,o,s=this._container;for(;s&&(!r||!o);){const e=t.getComputedStyle(s).transform;e&&"none"!==e&&(i=e.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(r=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(o=i[3])),s=s.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=o?Math.abs(n/o):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&J("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=gt("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=gt("div","mapboxgl-canvas-container",e);this._canvas=gt("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=gt("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(e=>{i[e]=gt("div","mapboxgl-ctrl-".concat(e),n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const n=mt.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(t),this._canvas.style.width="".concat(e,"px"),this._canvas.style.height="".concat(t,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const e=B({},st.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(et(t,!0),this.painter=new GA(t,this._contextCreateOptions,this.transform),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),l.testSupport(t)):this.fire(new Dt(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new It("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new It("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let n;this.fire(new It("renderstart"));const i=this.painter.context.extTimerQuery,r=mt.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=o.createQuery(),o.beginQuery(i.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],t.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],t.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,t=this.transform.pitch,n=mt.now(),i=new la(e,{now:n,fadeDuration:s,pitch:t,transition:this.style.transition});this.style.update(i)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new It("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new It("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const e=mt.now()-r;o.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const i=o.getQueryParameter(n,o.QUERY_RESULT)/1e6;o.deleteQuery(n),this.fire(new It("gpu-timing-frame",{cpuTime:e,gpuTime:i})),t.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:i}})},50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout(()=>{const t=this.painter.queryGpuTimers(e);this.fire(new It("gpu-timing-layer",{layerTimes:t}))},50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const t=this.painter.queryGpuTimeDeferredRender(e);this.fire(new It("gpu-timing-deferred-render",{gpuTime:t}))},50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new It("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new It("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,nt.mark(tt.fullLoad),this._performanceMetricsCollection&&Ke(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-r);if(o>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(r),n(r);this._averageElevation.easeTo(r,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),n(r)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){$e(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===De||401===e.status)){const e=this.painter.context.gl;et(e,!1),this._logoControl instanceof sk&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Dt(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Xe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const r=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);i+=(n[o+2]-n[o+1])*(1-a/r)}return i}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t&&(t.removeEventListener("resize",this._onWindowResize,!1),t.removeEventListener("orientationchange",this._onWindowResize,!1),t.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.removeEventListener("online",this._onWindowOnline,!1),t.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Qe.delete(this.painter.context.gl),this._removed=!0,this.fire(new It("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=mt.frame(e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(e){return O(this.style?Object.values(this.style._sourceCaches):[],(t,n)=>t._preloadTiles(e,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===t.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){!function(e,t){fe=e,me=t}(e,t)}get version(){return n}},NavigationControl:class{constructor(e){this.options=B({},yk,e),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(W(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),gt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),gt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(W(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=gt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _k(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=gt("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends zt{constructor(e){super(),this.options=B({geolocation:t.navigator.geolocation},vk,e),W(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=sM(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var n=this;const i=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!n.options.geolocation;n._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==t.navigator.permissions?t.navigator.permissions.query({name:"geolocation"}).then(e=>i("denied"!==e.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new It("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new It("geolocate",e)),this._finish()}}_updateCamera(e){const t=new Kd(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=B({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),i,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new Kd(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=np(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width="".concat(n,"px"),this._circleElement.style.height="".concat(n,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new It("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=gt("button","mapboxgl-ctrl-geolocate",this._container),gt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){J("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gt("div","mapboxgl-user-location"),this._dotElement.appendChild(gt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(gt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new uk({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=gt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new uk({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new It("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return J("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new It("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new It("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new It("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.addEventListener("ondeviceorientationabsolute"in t?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==t.DeviceMotionEvent&&"function"==typeof t.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.removeEventListener("deviceorientation",this._onDeviceOrientation),t.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ok,ScaleControl:class{constructor(e){this.options=B({},xk,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),W(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,i=t._containerWidth/2-e/2,r=t.unproject([i,n]),o=t.unproject([i+e,n]),s=r.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,n){this._map._requestDomTask(()=>{const i=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),r=i/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):"".concat(i,"&nbsp;").concat(bk[n]),this._container.style.width=e*r+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.HTMLElement?this._container=e.container:J("Full screen control 'container' must be a DOM element.")),W(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",J("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.document.fullscreenEnabled&&!t.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=gt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);gt("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.document.fullscreenElement||t.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.document.exitFullscreen?t.document.exitFullscreen():t.document.webkitCancelFullScreen&&t.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends zt{constructor(e){super(),this.options=B(Object.create(hk),e),W(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new It("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new It("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Kd.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.document.createTextNode(e))}setHTML(e){const n=t.document.createDocumentFragment(),i=t.document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)n.appendChild(r);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=gt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=gt("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,i=this._pos;if(!t||!n||!i)return"bottom";const r=n.offsetWidth,o=n.offsetHeight,s=i.x<r/2,a=i.x>t.transform.width-r/2;if(i.y+e<o)return s?"top-left":a?"top-right":"top";if(i.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=gt("div","mapboxgl-popup",t.getContainer()),this._tip=gt("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=lk(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const n=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),i=pk(this.options.offset),r=this._anchor=this._getAnchor(i.y),o=pk(this.options.offset,r),s=n.add(o).round();t._requestDomTask(()=>{this._container&&r&&(this._container.style.transform="".concat(ck[r]," translate(").concat(s.x,"px,").concat(s.y,"px)"))})}if(!this._marker&&t._showingGlobe()){const e=Ud(t.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(dk);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:uk,Style:oM,LngLat:Kd,LngLatBounds:cc,Point:b,MercatorCoordinate:hp,FreeCameraOptions:$v,Evented:zt,config:a,prewarm:function(){Kw().acquire(Hw)},clearPrewarmedResources:function(){const e=Yw;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Hw),Yw=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.ACCESS_TOKEN},set accessToken(e){a.ACCESS_TOKEN=e},get baseApiUrl(){return a.API_URL},set baseApiUrl(e){a.API_URL=e},get workerCount(){return Xw.workerCount},set workerCount(e){Xw.workerCount=e},get maxParallelImageRequests(){return a.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){a.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){!function(e){if(!ge())return;const n=t.caches.delete(he);e&&n.catch(e).then(()=>e())}(e)},workerUrl:"",workerClass:null,get dracoUrl(){return tS()},set dracoUrl(e){!function(e){$w=mt.resolveURL(e),eS||(eS=new Mw(Kw(),new zt)),eS.broadcast("setDracoUrl",$w)}(e)},setNow:mt.setNow,restoreNow:mt.restoreNow};e.A=Aw,e.D=Qm,e.E=pi,e.F=ng,e.K=wT,e.O=Hh,e.P=b,e.T=Xx,e.V=pm,e.a=em,e.b=ym,e.c=lw,e.d=class extends zt{constructor(e,t,n,i,r,o){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||Gw,this.loading={},this.loaded={},this.deduped=new Uw(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler,this.brightness=o}loadTile(e,t){const n=e.uid,i=e&&e.request,r=i&&i.collectResourceTiming,o=this.loading[n]=new jw(e);o.abort=this.loadVectorData(e,(s,a)=>{const l=!this.loading[n];if(delete this.loading[n],l||s||!a)return o.status="done",l||(this.loaded[n]=o),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new dm(new Bm(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,(e,n)=>{if(e||!n)return t(e);const o={};if(r){const e=ot(i);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,B({rawTileData:c.slice(0)},n,u,o))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[n]=o})}reloadTile(e,t){const n=this.loaded,i=e.uid,r=this;if(n&&n[i]){const o=n[i];o.showCollisionBoxes=e.showCollisionBoxes,o.projection=e.projection,o.brightness=e.brightness,o.tileTransform=Ry(e.tileID.canonical,e.projection),o.extraShadowCaster=e.extraShadowCaster;const s=(e,n)=>{const i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),t(e,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else t(null,void 0)}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}},e.e=Mo,e.f=ot,e.g=m,e.h=Ee,e.i=Ae,e.j=function(e,t){const n=AS(e);for(const i of n){for(const e of i.meshes)MS(e);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(kS(i.lights,t)))}return n},e.k=la,e.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==uS){const n=new Uint32Array(e,0,7),[,,i,r,o,s]=n;t=n.byteLength+r+o+s+o,(i!==e.byteLength||t>=e.byteLength)&&J("Invalid b3dm header information.")}return gS(e,t)},e.m=r_,e.n=aa,e.o=It,e.p=v,e.q=function(e){ye(),de&&de.then(t=>{t.keys().then(n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i])})})},e.r=OS,e.s=wk,e.t=up,e.v=F,e.w=t}),s(["./shared"],function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let n="[";for(const i of e)n+="".concat(t(i),",");return"".concat(n,"]")}let n="{";for(const i of Object.keys(e).sort())n+="".concat(i,":").concat(t(e[i]),",");return"".concat(n,"}")}function n(n){let i="";for(const r of e.r)i+="/".concat(t(n[r]));return i}class i{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,r){this._options=r;for(const n of t){this._layerConfigs[n.id]=n;const t=this._layers[n.id]=e.c(n,this._options);t.setScope(this.scope),t.compileFilter(),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const o=function(e,t){const i={};for(let o=0;o<e.length;o++){const r=t&&t[e[o].id]||n(e[o]);t&&(t[e[o].id]=r);let s=i[r];s||(s=i[r]=[]),s.push(e[o])}const r=[];for(const n in i)r.push(i[n]);return r}(e.v(this._layerConfigs),this.keyCache);for(const e of o){const t=e.map(e=>this._layers[e.id]),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}class r{loadTile(t,n){const{uid:i,encoding:r,rawImageData:o,padding:s}=t,a=e.w.ImageBitmap&&o instanceof e.w.ImageBitmap?this.getImageData(o,s):o;n(null,new e.D(i,a,r,s<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}function o(e,t){if(0!==e.length){s(e[0],t);for(var n=1;n<e.length;n++)s(e[n],!t)}}function s(e,t){for(var n=0,i=0,r=0,o=e.length,s=o-1;r<o;s=r++){var a=(e[r][0]-e[s][0])*(e[s][1]+e[r][1]),l=n+a;i+=Math.abs(n)>=Math.abs(a)?n-l+a:a-l+n,n=l}n+i>=0!=!!t&&e.reverse()}var a=e.g(function e(t,n){var i,r=t&&t.type;if("FeatureCollection"===r)for(i=0;i<t.features.length;i++)e(t.features[i],n);else if("GeometryCollection"===r)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],n);else if("Feature"===r)e(t.geometry,n);else if("Polygon"===r)o(t.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<t.coordinates.length;i++)o(t.coordinates[i],n);return t});const l=e.V.prototype.toGeoJSON;var c={exports:{}},u=e.p,h=e.a.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var n=e[t],i=[],r=0;r<n.length;r++)i.push(new u(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[t,i,n,r]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=e.b,g=d;function y(e){var t=new m;return function(e,t){for(var n in e.layers)t.writeMessage(3,_,e.layers[n])}(e,t),t.finish()}function _(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)i.feature=e.feature(n),t.writeMessage(2,v,i);var r=i.keys;for(n=0;n<r.length;n++)t.writeStringField(3,r[n]);var o=i.values;for(n=0;n<o.length;n++)t.writeMessage(4,T,o[n])}function v(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,x,e),t.writeVarintField(3,n.type),t.writeMessage(4,S,n)}function x(e,t){var n=e.feature,i=e.keys,r=e.values,o=e.keycache,s=e.valuecache;for(var a in n.properties){var l=n.properties[a],c=o[a];if(null!==l){void 0===c&&(i.push(a),o[a]=c=i.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(r.push(l),s[h]=d=r.length-1),t.writeVarint(d)}}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function S(e,t){for(var n=e.loadGeometry(),i=e.type,r=0,o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=1;1===i&&(c=l.length),t.writeVarint(b(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&t.writeVarint(b(2,u-1));var d=l[h].x-r,p=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(p)),r+=d,o+=p}3===i&&t.writeVarint(b(7,1))}}function T(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}c.exports=y,c.exports.fromVectorTileJs=y,c.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var i in e)n[i]=new g(e[i].features,t),n[i].name=i,n[i].version=t.version,n[i].extent=t.extent;return y({layers:n})},c.exports.GeoJSONWrapper=g;var E=e.g(c.exports);const A={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},M=Math.fround||(k=new Float32Array(1),e=>(k[0]=+e,k[0]));var k;const C=3,P=5,I=6;class D{constructor(e){this.options=Object.assign(Object.create(A),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r="prepare ".concat(e.length," points");t&&console.time(r),this.points=e;const o=[];for(let a=0;a<e.length;a++){const t=e[a];if(!t.geometry)continue;const[n,i]=t.geometry.coordinates,r=M(L(n)),s=M(O(i));o.push(r,s,1/0,a,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let a=i;a>=n;a--){const e=+Date.now();s=this.trees[a]=this._createTree(this._cluster(s,a)),t&&console.log("z%d: %d clusters in %dms",a,s.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(L(n),O(o),L(r),O(i)),l=s.data,c=[];for(const u of a){const e=this.stride*u;c.push(l[e+P]>1?z(l,e,this.clusterProps):this.points[l[e+C]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const c of a){const t=c*this.stride;o[t+4]===e&&l.push(o[t+P]>1?z(o,t,this.clusterProps):this.points[o[t+C]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const s of o){const t=s.properties;if(t&&t.cluster?r+t.point_count<=i?r+=t.point_count:r=this._appendLeaves(e,t.cluster_id,n,i,r):r<i?r++:e.push(s),e.length===n)break}return r}_createTree(t){const n=new e.K(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=s*this.stride,a=t[e+P]>1;let l,c,u;if(a)l=R(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+C]];l=n.properties;const[i,r]=n.geometry.coordinates;c=L(i),u=O(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=a||this.options.generateId?t[e+C]:this.points[t[e+C]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,s=n/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let u=0;u<a.length;u+=c){if(a[u+2]<=t)continue;a[u+2]=t;const n=a[u],i=a[u+1],h=e.within(a[u],a[u+1],s),d=a[u+P];let p=d;for(const e of h){const n=e*c;a[n+2]>t&&(p+=a[n+P])}if(p>d&&p>=o){let e,o=n*d,s=i*d,f=-1;const m=(u/c<<5)+(t+1)+this.points.length;for(const n of h){const i=n*c;if(a[i+2]<=t)continue;a[i+2]=t;const l=a[i+P];o+=a[i]*l,s+=a[i+1]*l,a[i+4]=m,r&&(e||(e=this._map(a,u,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,i)))}a[u+4]=m,l.push(o/p,s/p,1/0,m,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[u+e]);if(p>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+P]>1){const i=this.clusterProps[e[t+I]];return n?Object.assign({},i):i}const i=this.points[e[t+C]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function z(e,t,n){return{type:"Feature",id:e[t+C],properties:R(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),F(e[t+1])]}};var i}function R(e,t,n){const i=e[t+P],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+I],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+C],point_count:i,point_count_abbreviated:r})}function L(e){return e/360+.5}function O(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function F(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var B={exports:{}};B.exports=function(){function e(n,i,r,o){for(var s,a=o,l=r-i>>1,c=r-i,u=n[i],h=n[i+1],d=n[r],p=n[r+1],f=i+3;f<r;f+=3){var m=t(n[f],n[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(s=f,c=g)}}a>o&&(s-i>3&&e(n,i,s,o),n[s+2]=a,r-s>3&&e(n,s,r,o))}function t(e,t,n,i,r,o){var s=r-n,a=o-i;if(0!==s||0!==a){var l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return(s=e-n)*s+(a=t-i)*a}function n(e,t,n,r){var o={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)i(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)i(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)i(e,t[r][o])}(o),o}function i(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function r(e,t,i,l){if(t.geometry){var c=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),d=[],p=t.id;if(i.promoteId?p=t.properties[i.promoteId]:i.generateId&&(p=l||0),"Point"===u)o(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],d);else if("LineString"===u)s(c,d,h,!1);else if("MultiLineString"===u){if(i.lineMetrics){for(f=0;f<c.length;f++)s(c[f],d=[],h,!1),e.push(n(p,"LineString",d,t.properties));return}a(c,d,h,!1)}else if("Polygon"===u)a(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<t.geometry.geometries.length;f++)r(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},i,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),d.push(m)}}e.push(n(p,u,d,t.properties))}}function o(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function s(t,n,i,r){for(var o,s,a=0,u=0;u<t.length;u++){var h=l(t[u][0]),d=c(t[u][1]);n.push(h),n.push(d),n.push(0),u>0&&(a+=r?(o*d-h*s)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(d-s,2))),o=h,s=d}var p=n.length-3;n[2]=1,e(n,0,p,i),n[p+2]=1,n.size=Math.abs(a),n.start=0,n.end=n.size}function a(e,t,n,i){for(var r=0;r<e.length;r++){var o=[];s(e[r],o,n,i),t.push(o)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function u(e,t,i,r,o,s,a,l){if(r/=t,s>=(i/=t)&&a<r)return e;if(a<i||s>=r)return null;for(var c=[],u=0;u<e.length;u++){var p=e[u],m=p.geometry,g=p.type,y=0===o?p.minX:p.minY,_=0===o?p.maxX:p.maxY;if(y>=i&&_<r)c.push(p);else if(!(_<i||y>=r)){var v=[];if("Point"===g||"MultiPoint"===g)h(m,v,i,r,o);else if("LineString"===g)d(m,v,i,r,o,!1,l.lineMetrics);else if("MultiLineString"===g)f(m,v,i,r,o,!1);else if("Polygon"===g)f(m,v,i,r,o,!0);else if("MultiPolygon"===g)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,i,r,o,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===g){for(x=0;x<v.length;x++)c.push(n(p.id,g,v[x],p.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===v.length?(g="LineString",v=v[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===v.length?"Point":"MultiPoint"),c.push(n(p.id,g,v,p.tags))}}}return c.length?c:null}function h(e,t,n,i,r){for(var o=0;o<e.length;o+=3){var s=e[o+r];s>=n&&s<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function d(e,t,n,i,r,o,s){for(var a,l,c=p(e),u=0===r?g:y,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],_=e[d+1],v=e[d+2],x=e[d+3],b=e[d+4],w=0===r?f:_,S=0===r?x:b,T=!1;s&&(a=Math.sqrt(Math.pow(f-x,2)+Math.pow(_-b,2))),w<n?S>n&&(l=u(c,f,_,x,b,n),s&&(c.start=h+a*l)):w>i?S<i&&(l=u(c,f,_,x,b,i),s&&(c.start=h+a*l)):m(c,f,_,v),S<n&&w>=n&&(l=u(c,f,_,x,b,n),T=!0),S>i&&w<=i&&(l=u(c,f,_,x,b,i),T=!0),!o&&T&&(s&&(c.end=h+a*l),t.push(c),c=p(e)),s&&(h+=a)}var E=e.length-3;f=e[E],_=e[E+1],v=e[E+2],(w=0===r?f:_)>=n&&w<=i&&m(c,f,_,v),E=c.length-3,o&&E>=3&&(c[E]!==c[0]||c[E+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&t.push(c)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function f(e,t,n,i,r,o){for(var s=0;s<e.length;s++)d(e[s],t,n,i,r,o,!1)}function m(e,t,n,i){e.push(t),e.push(n),e.push(i)}function g(e,t,n,i,r,o){var s=(o-t)/(i-t);return e.push(o),e.push(n+(r-n)*s),e.push(1),s}function y(e,t,n,i,r,o){var s=(o-n)/(r-n);return e.push(t+(i-t)*s),e.push(o),e.push(1),s}function _(e,t){for(var i=[],r=0;r<e.length;r++){var o,s=e[r],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=v(s.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(v(s.geometry[l],t))}else if("MultiPolygon"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(v(s.geometry[l][u],t));o.push(c)}i.push(n(s.id,a,o,s.tags))}return i}function v(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function x(e,t){if(e.transformed)return e;var n,i,r,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(b(c[i],c[i+1],t,o,s,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(b(c[i][r],c[i][r+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function b(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function w(e,t,n,i,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,S(s,e[a],o,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function S(e,t,n,i){var r=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)T(s,r,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)T(s,r[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)T(s,c[a],e,n,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function T(e,t,n,i,r,o){var s=i*i;if(i>0&&t.size<(r?s:i))n.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var s=e[i],a=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=s,e[r-1-i]=a}}(a,o),e.push(a)}}function E(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)r(n,e.features[i],t,i);else r(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var n=t.buffer/t.extent,i=e,r=u(e,1,-1-n,n,0,-1,2,t),o=u(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=u(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=_(r,1).concat(i)),o&&(i=i.concat(_(o,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function A(e,t,n){return 32*((1<<e)*n+t)+e}return E.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},E.prototype.splitTile=function(e,t,n,i,r,o,s){for(var a=[e,t,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,d=A(t,n,i),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,r){if(t===l.maxZoom||t===r)continue;var m=1<<r-t;if(n!==Math.floor(o/m)||i!==Math.floor(s/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var g,y,_,v,x,b,S=.5*l.buffer/l.extent,T=.5-S,E=.5+S,M=1+S;g=y=_=v=null,x=u(e,h,n-S,n+E,0,p.minX,p.maxX,l),b=u(e,h,n+T,n+M,0,p.minX,p.maxX,l),e=null,x&&(g=u(x,h,i-S,i+E,1,p.minY,p.maxY,l),y=u(x,h,i+T,i+M,1,p.minY,p.maxY,l),x=null),b&&(_=u(b,h,i-S,i+E,1,p.minY,p.maxY,l),v=u(b,h,i+T,i+M,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*n,2*i),a.push(y||[],t+1,2*n,2*i+1),a.push(_||[],t+1,2*n+1,2*i),a.push(v||[],t+1,2*n+1,2*i+1)}}},E.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,o=i.debug;if(e<0||e>24)return null;var s=1<<e,a=A(e,t=(t%s+s)%s,n);if(this.tiles[a])return x(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[A(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?x(this.tiles[a],r):null):null},function(e,t){return new E(e,t)}}();var N=e.g(B.exports);function j(t,n){const i=t.tileID.canonical;if(!this._geoJSONIndex)return n(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return n(null,null);const o=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.E,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.E,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return l.call(this,e,t,n)}}(this._features[t])}}(r.features);let s=E(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),n(null,{vectorTile:o,rawData:s.buffer})}class V extends e.d{constructor(e,t,n,i,r,o){super(e,t,n,i,j,o),r&&(this.loadGeoJSON=r)}loadData(t,n){const i=t&&t.request,r=i&&i.collectResourceTiming;this.loadGeoJSON(t,(o,s)=>{if(o||!s)return n(o);if("object"!=typeof s)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));{a(s,!0);try{if(t.filter){const n=e.e(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));const i=s.features.filter(e=>n.value.evaluate({zoom:0},e));s={type:"FeatureCollection",features:i}}this._geoJSONIndex=t.cluster?new D(function(t){let{superclusterOptions:n,clusterProperties:i}=t;if(!i||!n)return n;const r={},o={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(i);for(const c of l){const[t,n]=i[c],s=e.e(n),a=e.e("string"==typeof t?[t,["accumulated"],["get",c]]:t);r[c]=s.value,o[c]=a.value}return n.map=e=>{a.properties=e;const t={};for(const n of l)t[n]=r[n].evaluate(s,a);return t},n.reduce=(e,t)=>{a.properties=t;for(const n of l)s.accumulated=e[n],e[n]=o[n].evaluate(s,a)},n}(t)).load(s.features):N(s,t.geojsonVtOptions)}catch(o){return n(o)}this.loaded={};const l={};if(r){const n=e.f(i);n&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(n)))}n(null,l)}})}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.h(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class U{constructor(t,n){this.tileID=new e.O(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=n}parse(t,n,i,r){this.status="parsing";const o=new e.O(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),s={},a=n.familiesBySource[i.source],l=new e.F(o,i.promoteId);return l.bucketLayerIDs=[],e.l(t).then(t=>{if(!t)return r(new Error("Could not parse tile"));const n=e.j(t,1/e.t(i.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features"),u=new e.k(this.zoom,{brightness:this.brightness});for(const i in a)for(const r of a[i]){const i=r[0],a=t.json.extensionsUsed;i.recalculate(u,[]);const l=new e.T(n,o,a&&a.includes("MAPBOX_mesh_features"),this.brightness);c||(l.needsUpload=!0),s[i.fqid]=l,l.evaluate(i)}this.status="done",r(null,{buckets:s,featureIndex:l})}).catch(e=>r(new Error(e.message)))}}class G{constructor(e,t,n,i,r,o){this.actor=e,this.layerIndex=t,this.brightness=o,this.loading={},this.loaded={}}loadTile(t,n){const i=t.uid,r=this.loading[i]=new U(t,this.brightness);e.i(t.request,(e,o)=>{const s=!this.loading[i];return delete this.loading[i],s||e?(r.status="done",s||(this.loaded[i]=r),n(e)):o&&0!==o.byteLength?void r.parse(o,this.layerIndex,t,(e,t)=>{r.status="done",this.loaded=this.loaded||{},this.loaded[i]=r,e||!t?n(e):n(null,t)}):(r.status="done",this.loaded[i]=r,n())})}reloadTile(e,t){const n=this.loaded,i=e.uid;if(n&&n[i]){const r=n[i];r.projection=e.projection,r.brightness=e.brightness;const o=(n,i)=>{r.reloadCallback&&(delete r.reloadCallback,this.loadTile(e,t)),t(n,i)};"parsing"===r.status?r.reloadCallback=o:"done"===r.status&&this.loadTile(e,t)}}abortTile(e,t){const n=e.uid;this.loading[n]&&delete this.loading[n],t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class q{constructor(t){this.self=t,this.actor=new e.A(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.m({name:"mercator"}),this.workerSourceTypes={vector:e.d,geojson:V,"batched-model":G},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.n.isParsed())throw new Error("RTL text plugin already registered.");e.n.applyArabicShaping=t.applyArabicShaping,e.n.processBidirectionalText=t.processBidirectionalText,e.n.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){let{scope:i,isLoaded:r}=n;if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][i]=r,this.workerSources[t]&&this.workerSources[t][i])for(const o in this.workerSources[t][i]){const n=this.workerSources[t][i][o];for(const t in n)n[t]instanceof e.d&&(n[t].isSpriteLoaded=r,n[t].fire(new e.o("isSpriteLoaded")))}}setImages(e,t,n){let{scope:i,images:r}=t;if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const n=this.workerSources[e][i][t];for(const e in n)n[e].availableImages=r}n()}else n()}setProjection(t,n){this.projections[t]=e.m(n)}setBrightness(e,t,n){this.brightness=t,n()}setLayers(e,t,n){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),n()}updateLayers(e,t,n){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),n()}loadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,n)}loadDEMTile(e,t,n){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,n)}reloadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,n)}removeSource(e,t,n){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const i=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,i){try{e.n.setState(n);const t=e.n.getPluginURL();if(e.n.isLoaded()&&!e.n.isParsed()&&null!=t){this.self.importScripts(t);const n=e.n.isParsed();i(n?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(t)),n)}}catch(e){i(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let n=this.availableImages[e][t];return n||(n=[]),n}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let n=this.layerIndexes[e][t];return n||(n=this.layerIndexes[e][t]=new i,n.scope=t),n}getWorkerSource(e,t,n,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][i]||(this.workerSources[e][i]={}),this.workerSources[e][i][t]||(this.workerSources[e][i][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][i][t][n]){const r={send:(t,n,i,r,o,s)=>{this.actor.send(t,n,i,e,o,s)},scheduler:this.actor.scheduler};this.workerSources[e][i][t][n]=new this.workerSourceTypes[t](r,this.getLayerIndex(e,i),this.getAvailableImages(e,i),this.isSpriteLoaded[e][i],void 0,this.brightness)}return this.workerSources[e][i][t][n]}getDEMWorkerSource(e,t,n){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][n]||(this.demWorkerSources[e][n]={}),this.demWorkerSources[e][n][t]||(this.demWorkerSources[e][n][t]=new r),this.demWorkerSources[e][n][t]}enforceCacheSizeLimit(t,n){e.q(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new q(self)),q}),s(["./shared"],function(e){return e.s}),n}()},893:e=>{e.exports=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y=!1,_="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function w(e){if(g=!1,b(e),!m)if(null!==i(c))m=!0,T||(T=!0,S());else{var t=i(u);null!==t&&D(w,t.startTime-e)}}var S,T=!1,E=-1,A=5,M=-1;function k(){return!!y||!(t.unstable_now()-M<A)}function C(){if(y=!1,T){var e=t.unstable_now();M=e;var n=!0;try{e:{m=!1,g&&(g=!1,v(E),E=-1),f=!0;var o=p;try{t:{for(b(e),d=i(c);null!==d&&!(d.expirationTime>e&&k());){var s=d.callback;if("function"===typeof s){d.callback=null,p=d.priorityLevel;var a=s(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof a){d.callback=a,b(e),n=!0;break t}d===i(c)&&r(c),b(e)}else r(c);d=i(c)}if(null!==d)n=!0;else{var l=i(u);null!==l&&D(w,l.startTime-e),n=!1}}break e}finally{d=null,p=o,f=!1}n=void 0}}finally{n?S():T=!1}}}if("function"===typeof x)S=function(){x(C)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,I=P.port2;P.port1.onmessage=C,S=function(){I.postMessage(null)}}else S=function(){_(C,0)};function D(e,n){E=_(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_requestPaint=function(){y=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(g?(v(E),E=-1):g=!0,D(w,o-s))):(e.sortIndex=a,n(c,e),m||f||(m=!0,T||(T=!0,S()))),e},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},897:(e,t,n)=>{var i=n(693);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e},e.exports.__esModule=!0,e.exports.default=e.exports},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)},983:(e,t)=>{"use strict";var n="function"===typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,d=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,y=n?Symbol.for("react.block"):60121,_=n?Symbol.for("react.fundamental"):60117,v=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function b(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case h:case o:case a:case s:case p:return e;default:switch(e=e&&e.$$typeof){case c:case d:case g:case m:case l:return e;default:return t}}case r:return t}}}function w(e){return b(e)===h}t.AsyncMode=u,t.ConcurrentMode=h,t.ContextConsumer=c,t.ContextProvider=l,t.Element=i,t.ForwardRef=d,t.Fragment=o,t.Lazy=g,t.Memo=m,t.Portal=r,t.Profiler=a,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return w(e)||b(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return b(e)===c},t.isContextProvider=function(e){return b(e)===l},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return b(e)===d},t.isFragment=function(e){return b(e)===o},t.isLazy=function(e){return b(e)===g},t.isMemo=function(e){return b(e)===m},t.isPortal=function(e){return b(e)===r},t.isProfiler=function(e){return b(e)===a},t.isStrictMode=function(e){return b(e)===s},t.isSuspense=function(e){return b(e)===p},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===o||e===h||e===a||e===s||e===p||e===f||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===c||e.$$typeof===d||e.$$typeof===_||e.$$typeof===v||e.$$typeof===x||e.$$typeof===y)},t.typeOf=b}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var o=Object.create(null);n.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&i;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>s[e]=()=>i[e]);return s.default=()=>i,n.d(o,s),o}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=n(43),t=n.t(e,2),i=n(391);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function s(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}function u(e,t){if(null==e)return{};var n,i,r=c(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const h=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},d=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var p={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const f=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],m=(0,e.forwardRef)((t,n)=>{let{color:i="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:s,className:a="",children:c,iconNode:h}=t,m=u(t,f);return(0,e.createElement)("svg",l(l(l({ref:n},p),{},{width:r,height:r,stroke:i,strokeWidth:s?24*Number(o)/Number(r):o,className:d("lucide",a)},!c&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"}),m),[...h.map(t=>{let[n,i]=t;return(0,e.createElement)(n,i)}),...Array.isArray(c)?c:[c]])}),g=["className"],y=(t,n)=>{const i=(0,e.forwardRef)((i,r)=>{let{className:o}=i,s=u(i,g);return(0,e.createElement)(m,l({ref:r,iconNode:n,className:d("lucide-".concat((a=h(t),a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(t),o)},s));var a});return i.displayName=h(t),i},_=y("menu",[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]]),v=y("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),x=y("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),b=y("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),w=y("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),S=y("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),T=y("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),E=y("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),A=y("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),M=y("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),k=y("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var C=n(579);const P=(0,e.createContext)({});function I(t){const n=(0,e.useRef)(null);return null===n.current&&(n.current=t()),n.current}const D="undefined"!==typeof window,z=D?e.useLayoutEffect:e.useEffect,R=(0,e.createContext)(null);function L(e){return"object"===typeof e&&null!==e}function O(e){return L(e)&&"offsetHeight"in e}const F=(0,e.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class B extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=O(e)&&e.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=n-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function N(t){let{children:n,isPresent:i,anchorX:r,root:o}=t;const s=(0,e.useId)(),a=(0,e.useRef)(null),l=(0,e.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,e.useContext)(F);return(0,e.useInsertionEffect)(()=>{const{width:e,height:t,top:n,left:u,right:h}=l.current;if(i||!a.current||!e||!t)return;const d="left"===r?"left: ".concat(u):"right: ".concat(h);a.current.dataset.motionPopId=s;const p=document.createElement("style");c&&(p.nonce=c);const f=null!==o&&void 0!==o?o:document.head;return f.appendChild(p),p.sheet&&p.sheet.insertRule('\n          [data-motion-pop-id="'.concat(s,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat(d,"px !important;\n            top: ").concat(n,"px !important;\n          }\n        ")),()=>{f.contains(p)&&f.removeChild(p)}},[i]),(0,C.jsx)(B,{isPresent:i,childRef:a,sizeRef:l,children:e.cloneElement(n,{ref:a})})}const j=t=>{let{children:n,initial:i,isPresent:r,onExitComplete:o,custom:s,presenceAffectsLayout:a,mode:c,anchorX:u,root:h}=t;const d=I(V),p=(0,e.useId)();let f=!0,m=(0,e.useMemo)(()=>(f=!1,{id:p,initial:i,isPresent:r,custom:s,onExitComplete:e=>{d.set(e,!0);for(const t of d.values())if(!t)return;o&&o()},register:e=>(d.set(e,!1),()=>d.delete(e))}),[r,d,o]);return a&&f&&(m=l({},m)),(0,e.useMemo)(()=>{d.forEach((e,t)=>d.set(t,!1))},[r]),e.useEffect(()=>{!r&&!d.size&&o&&o()},[r]),"popLayout"===c&&(n=(0,C.jsx)(N,{isPresent:r,anchorX:u,root:h,children:n})),(0,C.jsx)(R.Provider,{value:m,children:n})};function V(){return new Map}function U(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=(0,e.useContext)(R);if(null===n)return[!0,null];const{isPresent:i,onExitComplete:r,register:o}=n,s=(0,e.useId)();(0,e.useEffect)(()=>{if(t)return o(s)},[t]);const a=(0,e.useCallback)(()=>t&&r&&r(s),[s,r,t]);return!i&&r?[!1,a]:[!0]}const G=e=>e.key||"";function q(t){const n=[];return e.Children.forEach(t,t=>{(0,e.isValidElement)(t)&&n.push(t)}),n}const W=t=>{let{children:n,custom:i,initial:r=!0,onExitComplete:o,presenceAffectsLayout:s=!0,mode:a="sync",propagate:l=!1,anchorX:c="left",root:u}=t;const[h,d]=U(l),p=(0,e.useMemo)(()=>q(n),[n]),f=l&&!h?[]:p.map(G),m=(0,e.useRef)(!0),g=(0,e.useRef)(p),y=I(()=>new Map),[_,v]=(0,e.useState)(p),[x,b]=(0,e.useState)(p);z(()=>{m.current=!1,g.current=p;for(let e=0;e<x.length;e++){const t=G(x[e]);f.includes(t)?y.delete(t):!0!==y.get(t)&&y.set(t,!1)}},[x,f.length,f.join("-")]);const w=[];if(p!==_){let e=[...p];for(let t=0;t<x.length;t++){const n=x[t],i=G(n);f.includes(i)||(e.splice(t,0,n),w.push(n))}return"wait"===a&&w.length&&(e=w),b(q(e)),v(p),null}const{forceRender:S}=(0,e.useContext)(P);return(0,C.jsx)(C.Fragment,{children:x.map(e=>{const t=G(e),n=!(l&&!h)&&(p===x||f.includes(t));return(0,C.jsx)(j,{isPresent:n,initial:!(m.current&&!r)&&void 0,custom:i,presenceAffectsLayout:s,mode:a,root:u,onExitComplete:n?void 0:()=>{if(!y.has(t))return;y.set(t,!0);let e=!0;y.forEach(t=>{t||(e=!1)}),e&&(null===S||void 0===S||S(),b(g.current),l&&(null===d||void 0===d||d()),o&&o())},anchorX:c,children:e},t)})})},Z=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],H=(()=>new Set(Z))(),X=e=>180*e/Math.PI,Y=e=>{const t=X(Math.atan2(e[1],e[0]));return J(t)},K={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Y,rotateZ:Y,skewX:e=>X(Math.atan(e[1])),skewY:e=>X(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},J=e=>((e%=360)<0&&(e+=360),e),$=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Q=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),ee={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:$,scaleY:Q,scale:e=>($(e)+Q(e))/2,rotateX:e=>J(X(Math.atan2(e[6],e[5]))),rotateY:e=>J(X(Math.atan2(-e[2],e[0]))),rotateZ:Y,rotate:Y,skewX:e=>X(Math.atan(e[4])),skewY:e=>X(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function te(e){return e.includes("scale")?1:0}function ne(e,t){if(!e||"none"===e)return te(t);const n=e.match(/^matrix3d\(([\t-\r ,-\.0-9e\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)\)$/);let i,r;if(n)i=ee,r=n;else{const t=e.match(/^matrix\(([\t-\r ,-\.0-9e\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)\)$/);i=K,r=t}if(!r)return te(t);const o=i[t],s=r[1].split(",").map(ie);return"function"===typeof o?o(s):s[o]}function ie(e){return parseFloat(e.trim())}const re=e=>t=>"string"===typeof t&&t.startsWith(e),oe=re("--"),se=re("var(--"),ae=e=>!!se(e)&&le.test(e.split("/*")[0].trim()),le=/var\(--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)$/i;function ce(e){let{top:t,left:n,right:i,bottom:r}=e;return{x:{min:n,max:i},y:{min:t,max:r}}}const ue=(e,t,n)=>e+(t-e)*n;function he(e){return void 0===e||1===e}function de(e){let{scale:t,scaleX:n,scaleY:i}=e;return!he(t)||!he(n)||!he(i)}function pe(e){return de(e)||fe(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function fe(e){return me(e.x)||me(e.y)}function me(e){return e&&"0%"!==e}function ge(e,t,n){return n+t*(e-n)}function ye(e,t,n,i,r){return void 0!==r&&(e=ge(e,r,i)),ge(e,n,i)+t}function _e(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;e.min=ye(e.min,t,n,i,r),e.max=ye(e.max,t,n,i,r)}function ve(e,t){let{x:n,y:i}=t;_e(e.x,n.translate,n.scale,n.originPoint),_e(e.y,i.translate,i.scale,i.originPoint)}const xe=.999999999999,be=1.0000000000001;function we(e,t){e.min=e.min+t,e.max=e.max+t}function Se(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;_e(e,t,n,ue(e.min,e.max,r),i)}function Te(e,t){Se(e.x,t.x,t.scaleX,t.scale,t.originX),Se(e.y,t.y,t.scaleY,t.scale,t.originY)}function Ee(e,t){return ce(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}const Ae=new Set(["width","height","top","left","right","bottom",...Z]),Me=(e,t,n)=>n>t?t:n<e?e:n,ke={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},Ce=l(l({},ke),{},{transform:e=>Me(0,1,e)}),Pe=l(l({},ke),{},{default:1}),Ie=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>"".concat(t).concat(e)}),De=Ie("deg"),ze=Ie("%"),Re=Ie("px"),Le=Ie("vh"),Oe=Ie("vw"),Fe=(()=>l(l({},ze),{},{parse:e=>ze.parse(e)/100,transform:e=>ze.transform(100*e)}))(),Be=e=>t=>t.test(e),Ne=[ke,Re,ze,De,Oe,Le,{test:e=>"auto"===e,parse:e=>e}],je=e=>Ne.find(Be(e));const Ve=e=>/^-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)$/.test(e),Ue=/^var\(--(?:([\x2D0-9A-Z_a-z]+)|([\x2D0-9A-Z_a-z]+), ?([ #%\(\),-\.0-9A-Za-z]+))\)/;function Ge(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;'Max CSS variable fallback depth detected in property "'.concat(e,'". This may indicate a circular fallback dependency.');const[i,r]=function(e){const t=Ue.exec(e);if(!t)return[,];const[,n,i,r]=t;return["--".concat(null!==n&&void 0!==n?n:i),r]}(e);if(!i)return;const o=window.getComputedStyle(t).getPropertyValue(i);if(o){const e=o.trim();return Ve(e)?parseFloat(e):e}return ae(r)?Ge(r,t,n+1):r}const qe=e=>e===ke||e===Re,We=new Set(["x","y","z"]),Ze=Z.filter(e=>!We.has(e));const He={width:(e,t)=>{let{x:n}=e,{paddingLeft:i="0",paddingRight:r="0"}=t;return n.max-n.min-parseFloat(i)-parseFloat(r)},height:(e,t)=>{let{y:n}=e,{paddingTop:i="0",paddingBottom:r="0"}=t;return n.max-n.min-parseFloat(i)-parseFloat(r)},top:(e,t)=>{let{top:n}=t;return parseFloat(n)},left:(e,t)=>{let{left:n}=t;return parseFloat(n)},bottom:(e,t)=>{let{y:n}=e,{top:i}=t;return parseFloat(i)+(n.max-n.min)},right:(e,t)=>{let{x:n}=e,{left:i}=t;return parseFloat(i)+(n.max-n.min)},x:(e,t)=>{let{transform:n}=t;return ne(n,"x")},y:(e,t)=>{let{transform:n}=t;return ne(n,"y")}};He.translateX=He.x,He.translateY=He.y;const Xe=e=>e,Ye={},Ke=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],Je={value:null,addProjectionMetrics:null};function $e(e,t){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,s=Ke.reduce((e,n)=>(e[n]=function(e,t){let n=new Set,i=new Set,r=!1,o=!1;const s=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1},l=0;function c(t){s.has(t)&&(u.schedule(t),e()),l++,t(a)}const u={schedule:function(e){const t=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r?n:i;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&s.add(e),t.has(e)||t.add(e),e},cancel:e=>{i.delete(e),s.delete(e)},process:e=>{a=e,r?o=!0:(r=!0,[n,i]=[i,n],n.forEach(c),t&&Je.value&&Je.value.frameloop[t].push(l),l=0,n.clear(),r=!1,o&&(o=!1,u.process(e)))}};return u}(o,t?n:void 0),e),{}),{setup:a,read:l,resolveKeyframes:c,preUpdate:u,update:h,preRender:d,render:p,postRender:f}=s,m=()=>{const o=Ye.useManualTiming?r.timestamp:performance.now();n=!1,Ye.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(o-r.timestamp,40),1)),r.timestamp=o,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),u.process(r),h.process(r),d.process(r),p.process(r),f.process(r),r.isProcessing=!1,n&&t&&(i=!1,e(m))},g=Ke.reduce((t,o)=>{const a=s[o];return t[o]=function(t){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,i=!0,r.isProcessing||e(m)),a.schedule(t,o,s)},t},{});return{schedule:g,cancel:e=>{for(let t=0;t<Ke.length;t++)s[Ke[t]].cancel(e)},state:r,steps:s}}const{schedule:Qe,cancel:et,state:tt,steps:nt}=$e("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:Xe,!0),it=new Set;let rt=!1,ot=!1,st=!1;function at(){if(ot){const e=Array.from(it).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),n=new Map;t.forEach(e=>{const t=function(e){const t=[];return Ze.forEach(n=>{const i=e.getValue(n);void 0!==i&&(t.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),t}(e);t.length&&(n.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=n.get(e);t&&t.forEach(t=>{var n;let[i,r]=t;null===(n=e.getValue(i))||void 0===n||n.set(r)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}ot=!1,rt=!1,it.forEach(e=>e.complete(st)),it.clear()}function lt(){it.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(ot=!0)})}class ct{constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=i,this.element=r,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(it.add(this),rt||(rt=!0,Qe.read(lt),Qe.resolveKeyframes(at))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:i}=this;if(null===e[0]){const r=null===i||void 0===i?void 0:i.get(),o=e[e.length-1];if(void 0!==r)e[0]=r;else if(n&&t){const i=n.readValue(t,o);void 0!==i&&null!==i&&(e[0]=i)}void 0===e[0]&&(e[0]=o),i&&void 0===r&&i.set(e[0])}!function(e){for(let n=1;n<e.length;n++){var t;null!==(t=e[n])&&void 0!==t||(e[n]=e[n-1])}}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),it.delete(this)}cancel(){"scheduled"===this.state&&(it.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const ut=e=>/^0(?:[\0-\x08\x0E-\x1F!-\x2D\/-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+$/.test(e);function ht(e){return"number"===typeof e?0===e:null===e||("none"===e||"0"===e||ut(e))}const dt=e=>Math.round(1e5*e)/1e5,pt=/-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/g;const ft=/^(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))$/i,mt=(e,t)=>n=>Boolean("string"===typeof n&&ft.test(n)&&n.startsWith(e)||t&&!function(e){return null==e}(n)&&Object.prototype.hasOwnProperty.call(n,t)),gt=(e,t,n)=>i=>{if("string"!==typeof i)return i;const[r,o,s,a]=i.match(pt);return{[e]:parseFloat(r),[t]:parseFloat(o),[n]:parseFloat(s),alpha:void 0!==a?parseFloat(a):1}},yt=l(l({},ke),{},{transform:e=>Math.round((e=>Me(0,255,e))(e))}),_t={test:mt("rgb","red"),parse:gt("red","green","blue"),transform:e=>{let{red:t,green:n,blue:i,alpha:r=1}=e;return"rgba("+yt.transform(t)+", "+yt.transform(n)+", "+yt.transform(i)+", "+dt(Ce.transform(r))+")"}};const vt={test:mt("#"),parse:function(e){let t="",n="",i="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:_t.transform},xt={test:mt("hsl","hue"),parse:gt("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:n,lightness:i,alpha:r=1}=e;return"hsla("+Math.round(t)+", "+ze.transform(dt(n))+", "+ze.transform(dt(i))+", "+dt(Ce.transform(r))+")"}},bt={test:e=>_t.test(e)||vt.test(e)||xt.test(e),parse:e=>_t.test(e)?_t.parse(e):xt.test(e)?xt.parse(e):vt.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?_t.transform(e):xt.transform(e),getAnimatableNone:e=>{const t=bt.parse(e);return t.alpha=0,bt.transform(t)}},wt=/(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))/gi;const St="number",Tt="color",Et=/var[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)|#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\)|-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/gi;function At(e){const t=e.toString(),n=[],i={color:[],number:[],var:[]},r=[];let o=0;const s=t.replace(Et,e=>(bt.test(e)?(i.color.push(o),r.push(Tt),n.push(bt.parse(e))):e.startsWith("var(")?(i.var.push(o),r.push("var"),n.push(e)):(i.number.push(o),r.push(St),n.push(parseFloat(e))),++o,"${}")).split("${}");return{values:n,split:s,indexes:i,types:r}}function Mt(e){return At(e).values}function kt(e){const{split:t,types:n}=At(e),i=t.length;return e=>{let r="";for(let o=0;o<i;o++)if(r+=t[o],void 0!==e[o]){const t=n[o];r+=t===St?dt(e[o]):t===Tt?bt.transform(e[o]):e[o]}return r}}const Ct=e=>"number"===typeof e?0:bt.test(e)?bt.getAnimatableNone(e):e;const Pt={test:function(e){var t,n;return isNaN(e)&&"string"===typeof e&&((null===(t=e.match(pt))||void 0===t?void 0:t.length)||0)+((null===(n=e.match(wt))||void 0===n?void 0:n.length)||0)>0},parse:Mt,createTransformer:kt,getAnimatableNone:function(e){const t=Mt(e);return kt(e)(t.map(Ct))}},It=new Set(["brightness","contrast","saturate","opacity"]);function Dt(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[i]=n.match(pt)||[];if(!i)return e;const r=n.replace(i,"");let o=It.has(t)?1:0;return i!==n&&(o*=100),t+"("+o+r+")"}const zt=/\b([\x2Da-z]*)\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\)/g,Rt=l(l({},Pt),{},{getAnimatableNone:e=>{const t=e.match(zt);return t?t.map(Dt).join(" "):e}}),Lt=l(l({},ke),{},{transform:Math.round}),Ot=l(l({borderWidth:Re,borderTopWidth:Re,borderRightWidth:Re,borderBottomWidth:Re,borderLeftWidth:Re,borderRadius:Re,radius:Re,borderTopLeftRadius:Re,borderTopRightRadius:Re,borderBottomRightRadius:Re,borderBottomLeftRadius:Re,width:Re,maxWidth:Re,height:Re,maxHeight:Re,top:Re,right:Re,bottom:Re,left:Re,padding:Re,paddingTop:Re,paddingRight:Re,paddingBottom:Re,paddingLeft:Re,margin:Re,marginTop:Re,marginRight:Re,marginBottom:Re,marginLeft:Re,backgroundPositionX:Re,backgroundPositionY:Re},{rotate:De,rotateX:De,rotateY:De,rotateZ:De,scale:Pe,scaleX:Pe,scaleY:Pe,scaleZ:Pe,skew:De,skewX:De,skewY:De,distance:Re,translateX:Re,translateY:Re,translateZ:Re,x:Re,y:Re,z:Re,perspective:Re,transformPerspective:Re,opacity:Ce,originX:Fe,originY:Fe,originZ:Re}),{},{zIndex:Lt,fillOpacity:Ce,strokeOpacity:Ce,numOctaves:Lt}),Ft=l(l({},Ot),{},{color:bt,backgroundColor:bt,outlineColor:bt,fill:bt,stroke:bt,borderColor:bt,borderTopColor:bt,borderRightColor:bt,borderBottomColor:bt,borderLeftColor:bt,filter:Rt,WebkitFilter:Rt}),Bt=e=>Ft[e];function Nt(e,t){let n=Bt(e);return n!==Rt&&(n=Pt),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const jt=new Set(["auto","none","0"]);class Vt extends ct{constructor(e,t,n,i,r){super(e,t,n,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let a=0;a<e.length;a++){let n=e[a];if("string"===typeof n&&(n=n.trim(),ae(n))){const i=Ge(n,t.current);void 0!==i&&(e[a]=i),a===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!Ae.has(n)||2!==e.length)return;const[i,r]=e,o=je(i),s=je(r);if(o!==s)if(qe(o)&&qe(s))for(let a=0;a<e.length;a++){const t=e[a];"string"===typeof t&&(e[a]=parseFloat(t))}else He[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let i=0;i<e.length;i++)(null===e[i]||ht(e[i]))&&n.push(i);n.length&&function(e,t,n){let i,r=0;for(;r<e.length&&!i;){const t=e[r];"string"===typeof t&&!jt.has(t)&&At(t).values.length&&(i=e[r]),r++}if(i&&n)for(const o of t)e[o]=Nt(n,i)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=He[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];void 0!==i&&e.getValue(n,i).jump(i,!1)}measureEndState(){var e;const{element:t,name:n,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const r=t.getValue(n);r&&r.jump(this.measuredOrigin,!1);const o=i.length-1,s=i[o];i[o]=He[n](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==s&&void 0===this.finalKeyframe&&(this.finalKeyframe=s),null!==(e=this.removedTransforms)&&void 0!==e&&e.length&&this.removedTransforms.forEach(e=>{let[n,i]=e;t.getValue(n).set(i)}),this.resolveNoneKeyframes()}}const Ut=e=>Boolean(e&&e.getVelocity);let Gt;function qt(){Gt=void 0}const Wt={now:()=>(void 0===Gt&&Wt.set(tt.isProcessing||Ye.useManualTiming?tt.timestamp:performance.now()),Gt),set:e=>{Gt=e,queueMicrotask(qt)}};function Zt(e,t){-1===e.indexOf(t)&&e.push(t)}function Ht(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Xt{constructor(){this.subscriptions=[]}add(e){return Zt(this.subscriptions,e),()=>Ht(this.subscriptions,e)}notify(e,t,n){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,n);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Yt(e,t){return t?e*(1e3/t):0}const Kt={current:void 0};class Jt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{const t=Wt.now();var n;if((this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev)&&(null===(n=this.events.change)||void 0===n||n.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Wt.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Xt);const n=this.events[e].add(t);return"change"===e?()=>{n(),Qe.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;null===(e=this.events.change)||void 0===e||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return Kt.current&&Kt.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Wt.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Yt(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;null===(e=this.dependents)||void 0===e||e.clear(),null===(t=this.events.destroy)||void 0===t||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function $t(e,t){return new Jt(e,t)}const Qt=[...Ne,bt,Pt],{schedule:en,cancel:tn}=$e(queueMicrotask,!1),nn={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},rn={};for(const n in nn)rn[n]={isEnabled:e=>nn[n].some(t=>!!e[t])};const on=()=>({x:{min:0,max:0},y:{min:0,max:0}}),sn={current:null},an={current:!1};const ln=new WeakMap;function cn(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}function un(e){return"string"===typeof e||Array.isArray(e)}const hn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],dn=["initial",...hn];function pn(e){return cn(e.animate)||dn.some(t=>un(e[t]))}function fn(e){return Boolean(pn(e)||e.variants)}function mn(e){const t=[{},{}];return null===e||void 0===e||e.values.forEach((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()}),t}function gn(e,t,n,i){if("function"===typeof t){const[r,o]=mn(i);t=t(void 0!==n?n:e.custom,r,o)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[r,o]=mn(i);t=t(void 0!==n?n:e.custom,r,o)}return t}const yn=["willChange"],_n=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class vn{scrapeMotionValuesFromProps(e,t,n){return{}}constructor(e){let{parent:t,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:o,visualState:s}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=ct,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Wt.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Qe.render(this.render,!1,!0))};const{latestValues:c,renderState:h}=s;this.latestValues=c,this.baseTarget=l({},c),this.initialValues=n.initial?l({},c):{},this.renderState=h,this.parent=t,this.props=n,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=Boolean(o),this.isControllingVariants=pn(n),this.isVariantNode=fn(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const d=this.scrapeMotionValuesFromProps(n,{},this),{willChange:p}=d,f=u(d,yn);for(const l in f){const e=f[l];void 0!==c[l]&&Ut(e)&&e.set(c[l])}}mount(e){var t;this.current=e,ln.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),an.current||function(){if(an.current=!0,D)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>sn.current=e.matches;e.addEventListener("change",t),t()}else sn.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||sn.current),null===(t=this.parent)||void 0===t||t.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),et(this.notifyUpdate),et(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),null===(e=this.parent)||void 0===e||e.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const e=this.features[t];e&&(e.unmount(),e.isMounted=!1)}this.current=null}addChild(e){var t;this.children.add(e),null!==(t=this.enteringChildren)&&void 0!==t||(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=H.has(e);n&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&Qe.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),r&&r(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in rn){const t=rn[e];if(!t)continue;const{isEnabled:n,Feature:i}=t;if(!this.features[e]&&i&&n(this.props)&&(this.features[e]=new i(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<_n.length;n++){const t=_n[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,t,n){for(const i in t){const r=t[i],o=n[i];if(Ut(r))e.addValue(i,r);else if(Ut(o))e.addValue(i,$t(r,{owner:e}));else if(o!==r)if(e.hasValue(i)){const t=e.getValue(i);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(i);e.addValue(i,$t(void 0!==t?t:r,{owner:e}))}}for(const i in n)void 0===t[i]&&e.removeValue(i);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=$t(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){var n;let i=void 0===this.latestValues[e]&&this.current?null!==(n=this.getBaseTargetFromProps(this.props,e))&&void 0!==n?n:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return void 0!==i&&null!==i&&("string"===typeof i&&(Ve(i)||ut(i))?i=parseFloat(i):(r=i,!Qt.find(Be(r))&&Pt.test(t)&&(i=Nt(e,t))),this.setBaseTarget(e,Ut(i)?i.get():i)),Ut(i)?i.get():i}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let n;if("string"===typeof t||"object"===typeof t){var i;const r=gn(this.props,t,null===(i=this.presenceContext)||void 0===i?void 0:i.custom);r&&(n=r[e])}if(t&&void 0!==n)return n;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||Ut(r)?void 0!==this.initialValues[e]&&void 0===n?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new Xt),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.events[e].notify(...n)}}scheduleRenderMicrotask(){en.render(this.render)}}class xn extends vn{constructor(){super(...arguments),this.KeyframeResolver=Vt}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:n,style:i}=t;delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ut(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent="".concat(e))}))}}const bn=(e,t)=>t&&"number"===typeof e?t.transform(e):e,wn={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Sn=Z.length;function Tn(e,t,n){const{style:i,vars:r,transformOrigin:o}=e;let s=!1,a=!1;for(const l in t){const e=t[l];if(H.has(l))s=!0;else if(oe(l))r[l]=e;else{const t=bn(e,Ot[l]);l.startsWith("origin")?(a=!0,o[l]=t):i[l]=t}}if(t.transform||(s||n?i.transform=function(e,t,n){let i="",r=!0;for(let o=0;o<Sn;o++){const s=Z[o],a=e[s];if(void 0===a)continue;let l=!0;if(l="number"===typeof a?a===(s.startsWith("scale")?1:0):0===parseFloat(a),!l||n){const e=bn(a,Ot[s]);l||(r=!1,i+="".concat(wn[s]||s,"(").concat(e,") ")),n&&(t[s]=e)}}return i=i.trim(),n?i=n(t,r?"":i):r&&(i="none"),i}(t,e.transform,n):i.transform&&(i.transform="none")),a){const{originX:e="50%",originY:t="50%",originZ:n=0}=o;i.transformOrigin="".concat(e," ").concat(t," ").concat(n)}}function En(e,t,n,i){let{style:r,vars:o}=t;const s=e.style;let a;for(a in r)s[a]=r[a];for(a in null===i||void 0===i||i.applyProjectionStyles(s,n),o)s.setProperty(a,o[a])}const An={};function Mn(e,t){let{layout:n,layoutId:i}=t;return H.has(e)||e.startsWith("origin")||(n||void 0!==i)&&(!!An[e]||"opacity"===e)}function kn(e,t,n){const{style:i}=e,r={};for(const s in i){var o;(Ut(i[s])||t.style&&Ut(t.style[s])||Mn(s,e)||void 0!==(null===n||void 0===n||null===(o=n.getValue(s))||void 0===o?void 0:o.liveStyle))&&(r[s]=i[s])}return r}class Cn extends xn{constructor(){super(...arguments),this.type="html",this.renderInstance=En}readValueFromInstance(e,t){var n,i;if(H.has(t))return null!==(n=this.projection)&&void 0!==n&&n.isProjecting?te(t):((e,t)=>{const{transform:n="none"}=getComputedStyle(e);return ne(n,t)})(e,t);{const n=(i=e,window.getComputedStyle(i)),r=(oe(t)?n.getPropertyValue(t):n[t])||0;return"string"===typeof r?r.trim():r}}measureInstanceViewportBox(e,t){let{transformPagePoint:n}=t;return Ee(e,n)}build(e,t,n){Tn(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return kn(e,t,n)}}const Pn=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),In={offset:"stroke-dashoffset",array:"stroke-dasharray"},Dn={offset:"strokeDashoffset",array:"strokeDasharray"};const zn=["attrX","attrY","attrScale","pathLength","pathSpacing","pathOffset"];function Rn(e,t,n,i,r){let{attrX:o,attrY:s,attrScale:a,pathLength:l,pathSpacing:c=1,pathOffset:h=0}=t;if(Tn(e,u(t,zn),i),n)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:d,style:p}=e;var f,m;(d.transform&&(p.transform=d.transform,delete d.transform),p.transform||d.transformOrigin)&&(p.transformOrigin=null!==(f=d.transformOrigin)&&void 0!==f?f:"50% 50%",delete d.transformOrigin);p.transform&&(p.transformBox=null!==(m=null===r||void 0===r?void 0:r.transformBox)&&void 0!==m?m:"fill-box",delete d.transformBox);void 0!==o&&(d.x=o),void 0!==s&&(d.y=s),void 0!==a&&(d.scale=a),void 0!==l&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const o=r?In:Dn;e[o.offset]=Re.transform(-i);const s=Re.transform(t),a=Re.transform(n);e[o.array]="".concat(s," ").concat(a)}(d,l,c,h,!1)}const Ln=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),On=e=>"string"===typeof e&&"svg"===e.toLowerCase();function Fn(e,t,n){const i=kn(e,t,n);for(const r in e)if(Ut(e[r])||Ut(t[r])){i[-1!==Z.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return i}class Bn extends xn{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=on}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(H.has(t)){const e=Bt(t);return e&&e.default||0}return t=Ln.has(t)?t:Pn(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return Fn(e,t,n)}build(e,t,n){Rn(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,i){!function(e,t,n,i){En(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(Ln.has(r)?r:Pn(r),t.attrs[r])}(e,t,0,i)}mount(e){this.isSVGTag=On(e.tagName),super.mount(e)}}const Nn=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jn(e){return"string"===typeof e&&!e.includes("-")&&!!(Nn.indexOf(e)>-1||/[A-Z]/.test(e))}const Vn=(t,n)=>jn(t)?new Bn(n):new Cn(n,{allowProjection:t!==e.Fragment}),Un=(0,e.createContext)({strict:!1}),Gn=(0,e.createContext)({});function qn(t){const{initial:n,animate:i}=function(e,t){if(pn(e)){const{initial:t,animate:n}=e;return{initial:!1===t||un(t)?t:void 0,animate:un(n)?n:void 0}}return!1!==e.inherit?t:{}}(t,(0,e.useContext)(Gn));return(0,e.useMemo)(()=>({initial:n,animate:i}),[Wn(n),Wn(i)])}function Wn(e){return Array.isArray(e)?e.join(" "):e}const Zn=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Hn(e,t,n){for(const i in t)Ut(t[i])||Mn(i,n)||(e[i]=t[i])}function Xn(t,n){const i={};return Hn(i,t.style||{},t),Object.assign(i,function(t,n){let{transformTemplate:i}=t;return(0,e.useMemo)(()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return Tn(e,n,i),Object.assign({},e.vars,e.style)},[n])}(t,n)),i}function Yn(e,t){const n={},i=Xn(e,t);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-".concat("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=i,n}const Kn=()=>l(l({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}});function Jn(t,n,i,r){const o=(0,e.useMemo)(()=>{const e=Kn();return Rn(e,n,On(r),t.transformTemplate,t.style),l(l({},e.attrs),{},{style:l({},e.style)})},[n]);if(t.style){const e={};Hn(e,t.style,t),o.style=l(l({},e),o.style)}return o}const $n=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Qn(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||$n.has(e)}let ei=e=>!Qn(e);try{"function"===typeof(ti=require("@emotion/is-prop-valid").default)&&(ei=e=>e.startsWith("on")?!Qn(e):ti(e))}catch(Dy){}var ti;function ni(t,n,i,r,o){let{latestValues:s}=r,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const c=(jn(t)?Jn:Yn)(n,s,o,t),u=function(e,t,n){const i={};for(const r in e)"values"===r&&"object"===typeof e.values||(ei(r)||!0===n&&Qn(r)||!t&&!Qn(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(n,"string"===typeof t,a),h=t!==e.Fragment?l(l(l({},u),c),{},{ref:i}):{},{children:d}=n,p=(0,e.useMemo)(()=>Ut(d)?d.get():d,[d]);return(0,e.createElement)(t,l(l({},h),{},{children:p}))}function ii(e){return Ut(e)?e.get():e}const ri=["transitionEnd","transition"];function oi(e,t,n,i){const r={},o=i(e,{});for(const u in o)r[u]=ii(o[u]);let{initial:s,animate:a}=e;const l=pn(e),c=fn(e);t&&c&&!l&&!1!==e.inherit&&(void 0===s&&(s=t.initial),void 0===a&&(a=t.animate));let h=!!n&&!1===n.initial;h=h||!1===s;const d=h?a:s;if(d&&"boolean"!==typeof d&&!cn(d)){const t=Array.isArray(d)?d:[d];for(let n=0;n<t.length;n++){const i=gn(e,t[n]);if(i){const{transitionEnd:e,transition:t}=i,n=u(i,ri);for(const i in n){let e=n[i];if(Array.isArray(e)){e=e[h?e.length-1:0]}null!==e&&(r[i]=e)}for(const i in e)r[i]=e[i]}}}return r}const si=t=>(n,i)=>{const r=(0,e.useContext)(Gn),o=(0,e.useContext)(R),s=()=>function(e,t,n,i){let{scrapeMotionValuesFromProps:r,createRenderState:o}=e;return{latestValues:oi(t,n,i,r),renderState:o()}}(t,n,r,o);return i?s():I(s)},ai=si({scrapeMotionValuesFromProps:kn,createRenderState:Zn}),li=si({scrapeMotionValuesFromProps:Fn,createRenderState:Kn});const ci=Symbol.for("motionComponentSymbol");function ui(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function hi(t,n,i){return(0,e.useCallback)(e=>{e&&t.onMount&&t.onMount(e),n&&(e?n.mount(e):n.unmount()),i&&("function"===typeof i?i(e):ui(i)&&(i.current=e))},[n])}const di="data-"+Pn("framerAppearId"),pi=(0,e.createContext)({});function fi(t,n,i,r,o){var s,a,l,c;const{visualElement:u}=(0,e.useContext)(Gn),h=(0,e.useContext)(Un),d=(0,e.useContext)(R),p=(0,e.useContext)(F).reducedMotion,f=(0,e.useRef)(null);r=r||h.renderer,!f.current&&r&&(f.current=r(t,{visualState:n,parent:u,props:i,presenceContext:d,blockInitialAnimation:!!d&&!1===d.initial,reducedMotionConfig:p}));const m=f.current,g=(0,e.useContext)(pi);!m||m.projection||!o||"html"!==m.type&&"svg"!==m.type||function(e,t,n,i){const{layoutId:r,layout:o,drag:s,dragConstraints:a,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:mi(e.parent)),e.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:Boolean(s)||a&&ui(a),visualElement:e,animationType:"string"===typeof o?o:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:l,layoutRoot:c})}(f.current,i,o,g);const y=(0,e.useRef)(!1);(0,e.useInsertionEffect)(()=>{m&&y.current&&m.update(i,d)});const _=i[di],v=(0,e.useRef)(Boolean(_)&&!(null!==(s=(a=window).MotionHandoffIsComplete)&&void 0!==s&&s.call(a,_))&&(null===(l=(c=window).MotionHasOptimisedAnimation)||void 0===l?void 0:l.call(c,_)));return z(()=>{m&&(y.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),m.scheduleRenderMicrotask(),v.current&&m.animationState&&m.animationState.animateChanges())}),(0,e.useEffect)(()=>{m&&(!v.current&&m.animationState&&m.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{var e,t;null===(e=(t=window).MotionHandoffMarkAsComplete)||void 0===e||e.call(t,_)}),v.current=!1),m.enteringChildren=void 0)}),m}function mi(e){if(e)return!1!==e.options.allowProjection?e.projection:mi(e.parent)}function gi(t){var n,i;let{forwardMotionProps:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;o&&function(e){for(const t in e)rn[t]=l(l({},rn[t]),e[t])}(o);const a=jn(t)?li:ai;function c(n,i){let o;const c=l(l(l({},(0,e.useContext)(F)),n),{},{layoutId:yi(n)}),{isStatic:u}=c,h=qn(n),d=a(n,u);if(!u&&D){!function(){(0,e.useContext)(Un).strict;0}();const n=function(e){const{drag:t,layout:n}=rn;if(!t&&!n)return{};const i=l(l({},t),n);return{MeasureLayout:null!==t&&void 0!==t&&t.isEnabled(e)||null!==n&&void 0!==n&&n.isEnabled(e)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(c);o=n.MeasureLayout,h.visualElement=fi(t,d,c,s,n.ProjectionNode)}return(0,C.jsxs)(Gn.Provider,{value:h,children:[o&&h.visualElement?(0,C.jsx)(o,l({visualElement:h.visualElement},c)):null,ni(t,n,hi(d,h.visualElement,i),d,u,r)]})}c.displayName="motion.".concat("string"===typeof t?t:"create(".concat(null!==(n=null!==(i=t.displayName)&&void 0!==i?i:t.name)&&void 0!==n?n:"",")"));const u=(0,e.forwardRef)(c);return u[ci]=t,u}function yi(t){let{layoutId:n}=t;const i=(0,e.useContext)(P).id;return i&&void 0!==n?i+"-"+n:n}function _i(e,t){if("undefined"===typeof Proxy)return gi;const n=new Map,i=(n,i)=>gi(n,i,e,t);return new Proxy((e,t)=>i(e,t),{get:(r,o)=>"create"===o?i:(n.has(o)||n.set(o,gi(o,void 0,e,t)),n.get(o))})}function vi(e,t,n){const i=e.getProps();return gn(i,t,void 0!==n?n:i.custom,e)}function xi(e,t){var n,i;return null!==(n=null!==(i=null===e||void 0===e?void 0:e[t])&&void 0!==i?i:null===e||void 0===e?void 0:e.default)&&void 0!==n?n:e}const bi=e=>Array.isArray(e),wi=["transitionEnd","transition"];function Si(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,$t(n))}function Ti(e){return bi(e)?e[e.length-1]||0:e}function Ei(e,t){const n=e.getValue("willChange");if(i=n,Boolean(Ut(i)&&i.add))return n.add(t);if(!n&&Ye.WillChange){const n=new Ye.WillChange("auto");e.addValue("willChange",n),n.add(t)}var i}function Ai(e){return e.props[di]}function Mi(e){e.duration=0,e.type}const ki=(e,t)=>n=>t(e(n)),Ci=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(ki)},Pi=e=>1e3*e,Ii=e=>e/1e3,Di={layout:0,mainThread:0,waapi:0};function zi(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Ri(e,t){return n=>n>0?t:e}const Li=(e,t,n)=>{const i=e*e,r=n*(t*t-i)+i;return r<0?0:Math.sqrt(r)},Oi=[vt,_t,xt];function Fi(e){const t=(n=e,Oi.find(e=>e.test(n)));var n;if(Boolean(t),"'".concat(e,"' is not an animatable color. Use the equivalent color code instead."),!Boolean(t))return!1;let i=t.parse(e);return t===xt&&(i=function(e){let{hue:t,saturation:n,lightness:i,alpha:r}=e;t/=360,n/=100,i/=100;let o=0,s=0,a=0;if(n){const e=i<.5?i*(1+n):i+n-i*n,r=2*i-e;o=zi(r,e,t+1/3),s=zi(r,e,t),a=zi(r,e,t-1/3)}else o=s=a=i;return{red:Math.round(255*o),green:Math.round(255*s),blue:Math.round(255*a),alpha:r}}(i)),i}const Bi=(e,t)=>{const n=Fi(e),i=Fi(t);if(!n||!i)return Ri(e,t);const r=l({},n);return e=>(r.red=Li(n.red,i.red,e),r.green=Li(n.green,i.green,e),r.blue=Li(n.blue,i.blue,e),r.alpha=ue(n.alpha,i.alpha,e),_t.transform(r))},Ni=new Set(["none","hidden"]);function ji(e,t){return n=>ue(e,t,n)}function Vi(e){return"number"===typeof e?ji:"string"===typeof e?ae(e)?Ri:bt.test(e)?Bi:qi:Array.isArray(e)?Ui:"object"===typeof e?bt.test(e)?Bi:Gi:Ri}function Ui(e,t){const n=[...e],i=n.length,r=e.map((e,n)=>Vi(e)(e,t[n]));return e=>{for(let t=0;t<i;t++)n[t]=r[t](e);return n}}function Gi(e,t){const n=l(l({},e),t),i={};for(const r in n)void 0!==e[r]&&void 0!==t[r]&&(i[r]=Vi(e[r])(e[r],t[r]));return e=>{for(const t in i)n[t]=i[t](e);return n}}const qi=(e,t)=>{const n=Pt.createTransformer(t),i=At(e),r=At(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Ni.has(e)&&!r.values.length||Ni.has(t)&&!i.values.length?function(e,t){return Ni.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):Ci(Ui(function(e,t){const n=[],i={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){var r;const s=t.types[o],a=e.indexes[s][i[s]],l=null!==(r=e.values[a])&&void 0!==r?r:0;n[o]=l,i[s]++}return n}(i,r),r.values),n):("Complex values '".concat(e,"' and '").concat(t,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition."),Ri(e,t))};function Wi(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return ue(e,t,n);return Vi(e)(e,t)}const Zi=e=>{const t=t=>{let{timestamp:n}=t;return e(n)};return{start:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Qe.update(t,e)},stop:()=>et(t),now:()=>tt.isProcessing?tt.timestamp:Wt.now()}},Hi=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i="";const r=Math.max(Math.round(t/n),2);for(let o=0;o<r;o++)i+=Math.round(1e4*e(o/(r-1)))/1e4+", ";return"linear(".concat(i.substring(0,i.length-2),")")},Xi=2e4;function Yi(e){let t=0;let n=e.next(t);for(;!n.done&&t<Xi;)t+=50,n=e.next(t);return t>=Xi?1/0:t}function Ki(e,t,n){const i=Math.max(t-5,0);return Yt(n-e(i),t-i)}const Ji={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},$i=.001;function Qi(e){let t,n,{duration:i=Ji.duration,bounce:r=Ji.bounce,velocity:o=Ji.velocity,mass:s=Ji.mass}=e;Pi(Ji.maxDuration);let a=1-r;a=Me(Ji.minDamping,Ji.maxDamping,a),i=Me(Ji.minDuration,Ji.maxDuration,Ii(i)),a<1?(t=e=>{const t=e*a,n=t*i,r=t-o,s=tr(e,a),l=Math.exp(-n);return $i-r/s*l},n=e=>{const n=e*a*i,r=n*o+o,s=Math.pow(a,2)*Math.pow(e,2)*i,l=Math.exp(-n),c=tr(Math.pow(e,2),a);return(-t(e)+$i>0?-1:1)*((r-s)*l)/c}):(t=e=>Math.exp(-e*i)*((e-o)*i+1)-.001,n=e=>Math.exp(-e*i)*(i*i*(o-e)));const l=function(e,t,n){let i=n;for(let r=1;r<er;r++)i-=e(i)/t(i);return i}(t,n,5/i);if(i=Pi(i),isNaN(l))return{stiffness:Ji.stiffness,damping:Ji.damping,duration:i};{const e=Math.pow(l,2)*s;return{stiffness:e,damping:2*a*Math.sqrt(s*e),duration:i}}}const er=12;function tr(e,t){return e*Math.sqrt(1-t*t)}const nr=["duration","bounce"],ir=["stiffness","damping","mass"];function rr(e,t){return t.some(t=>void 0!==e[t])}function or(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ji.visualDuration,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ji.bounce;const n="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=n;const o=n.keyframes[0],s=n.keyframes[n.keyframes.length-1],a={done:!1,value:o},{stiffness:c,damping:u,mass:h,duration:d,velocity:p,isResolvedFromDuration:f}=function(e){let t=l({velocity:Ji.velocity,stiffness:Ji.stiffness,damping:Ji.damping,mass:Ji.mass,isResolvedFromDuration:!1},e);if(!rr(e,ir)&&rr(e,nr))if(e.visualDuration){const n=e.visualDuration,i=2*Math.PI/(1.2*n),r=i*i,o=2*Me(.05,1,1-(e.bounce||0))*Math.sqrt(r);t=l(l({},t),{},{mass:Ji.mass,stiffness:r,damping:o})}else{const n=Qi(e);t=l(l(l({},t),n),{},{mass:Ji.mass}),t.isResolvedFromDuration=!0}return t}(l(l({},n),{},{velocity:-Ii(n.velocity||0)})),m=p||0,g=u/(2*Math.sqrt(c*h)),y=s-o,_=Ii(Math.sqrt(c/h)),v=Math.abs(y)<5;let x;if(i||(i=v?Ji.restSpeed.granular:Ji.restSpeed.default),r||(r=v?Ji.restDelta.granular:Ji.restDelta.default),g<1){const e=tr(_,g);x=t=>{const n=Math.exp(-g*_*t);return s-n*((m+g*_*y)/e*Math.sin(e*t)+y*Math.cos(e*t))}}else if(1===g)x=e=>s-Math.exp(-_*e)*(y+(m+_*y)*e);else{const e=_*Math.sqrt(g*g-1);x=t=>{const n=Math.exp(-g*_*t),i=Math.min(e*t,300);return s-n*((m+g*_*y)*Math.sinh(i)+e*y*Math.cosh(i))/e}}const b={calculatedDuration:f&&d||null,next:e=>{const t=x(e);if(f)a.done=e>=d;else{let n=0===e?m:0;g<1&&(n=0===e?Pi(m):Ki(x,e,t));const o=Math.abs(n)<=i,l=Math.abs(s-t)<=r;a.done=o&&l}return a.value=a.done?s:t,a},toString:()=>{const e=Math.min(Yi(b),Xi),t=Hi(t=>b.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return b}function sr(e){let{keyframes:t,velocity:n=0,power:i=.8,timeConstant:r=325,bounceDamping:o=10,bounceStiffness:s=500,modifyTarget:a,min:l,max:c,restDelta:u=.5,restSpeed:h}=e;const d=t[0],p={done:!1,value:d},f=e=>void 0===l?c:void 0===c||Math.abs(l-e)<Math.abs(c-e)?l:c;let m=i*n;const g=d+m,y=void 0===a?g:a(g);y!==g&&(m=y-d);const _=e=>-m*Math.exp(-e/r),v=e=>y+_(e),x=e=>{const t=_(e),n=v(e);p.done=Math.abs(t)<=u,p.value=p.done?y:n};let b,w;const S=e=>{var t;(t=p.value,void 0!==l&&t<l||void 0!==c&&t>c)&&(b=e,w=or({keyframes:[p.value,f(p.value)],velocity:Ki(v,e,p.value),damping:o,stiffness:s,restDelta:u,restSpeed:h}))};return S(0),{calculatedDuration:null,next:e=>{let t=!1;return w||void 0!==b||(t=!0,x(e),S(e)),void 0!==b&&e>=b?w.next(e-b):(!t&&x(e),p)}}}or.applyToOptions=e=>{const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const n=(arguments.length>2?arguments[2]:void 0)(l(l({},e),{},{keyframes:[0,t]})),i=Math.min(Yi(n),Xi);return{type:"keyframes",ease:e=>n.next(i*e).value/t,duration:Ii(i)}}(e,100,or);return e.ease=t.ease,e.duration=Pi(t.duration),e.type="keyframes",e};const ar=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function lr(e,t,n,i){if(e===t&&n===i)return Xe;const r=t=>function(e,t,n,i,r){let o,s,a=0;do{s=t+(n-t)/2,o=ar(s,i,r)-e,o>0?n=s:t=s}while(Math.abs(o)>1e-7&&++a<12);return s}(t,0,1,e,n);return e=>0===e||1===e?e:ar(r(e),t,i)}const cr=lr(.42,0,1,1),ur=lr(0,0,.58,1),hr=lr(.42,0,.58,1),dr=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,pr=e=>t=>1-e(1-t),fr=lr(.33,1.53,.69,.99),mr=pr(fr),gr=dr(mr),yr=e=>(e*=2)<1?.5*mr(e):.5*(2-Math.pow(2,-10*(e-1))),_r=e=>1-Math.sin(Math.acos(e)),vr=pr(_r),xr=dr(_r),br=e=>Array.isArray(e)&&"number"===typeof e[0],wr={linear:Xe,easeIn:cr,easeInOut:hr,easeOut:ur,circIn:_r,circInOut:xr,circOut:vr,backIn:mr,backInOut:gr,backOut:fr,anticipate:yr},Sr=e=>{if(br(e)){e.length;const[t,n,i,r]=e;return lr(t,n,i,r)}return(e=>"string"===typeof e)(e)?("Invalid easing type '".concat(e,"'"),wr[e]):e},Tr=(e,t,n)=>{const i=t-e;return 0===i?1:(n-e)/i};function Er(e,t){let{clamp:n=!0,ease:i,mixer:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=e.length;if(t.length,1===o)return()=>t[0];if(2===o&&t[0]===t[1])return()=>t[1];const s=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=function(e,t,n){const i=[],r=n||Ye.mix||Wi,o=e.length-1;for(let s=0;s<o;s++){let n=r(e[s],e[s+1]);if(t){const e=Array.isArray(t)?t[s]||Xe:t;n=Ci(e,n)}i.push(n)}return i}(t,i,r),l=a.length,c=n=>{if(s&&n<e[0])return t[0];let i=0;if(l>1)for(;i<e.length-2&&!(n<e[i+1]);i++);const r=Tr(e[i],e[i+1],n);return a[i](r)};return n?t=>c(Me(e[0],e[o-1],t)):c}function Ar(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let i=1;i<=t;i++){const r=Tr(0,t,i);e.push(ue(n,1,r))}}(t,e.length-1),t}function Mr(e,t){return e.map(()=>t||hr).splice(0,e.length-1)}function kr(e){let{duration:t=300,keyframes:n,times:i,ease:r="easeInOut"}=e;const o=(e=>Array.isArray(e)&&"number"!==typeof e[0])(r)?r.map(Sr):Sr(r),s={done:!1,value:n[0]},a=function(e,t){return e.map(e=>e*t)}(i&&i.length===n.length?i:Ar(n),t),l=Er(a,n,{ease:Array.isArray(o)?o:Mr(n,o)});return{calculatedDuration:t,next:e=>(s.value=l(e),s.done=e>=t,s)}}const Cr=e=>null!==e;function Pr(e,t,n){let{repeat:i,repeatType:r="loop"}=t,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const s=e.filter(Cr),a=o<0||i&&"loop"!==r&&i%2===1?0:s.length-1;return a&&void 0!==n?n:s[a]}const Ir={decay:sr,inertia:sr,tween:kr,keyframes:kr,spring:or};function Dr(e){"string"===typeof e.type&&(e.type=Ir[e.type])}class zr{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const Rr=e=>e/100;class Lr extends zr{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var e,t;const{motionValue:n}=this.options;n&&n.updatedAt!==Wt.now()&&this.tick(Wt.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),null===(e=(t=this.options).onStop)||void 0===e||e.call(t))},Di.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;Dr(e);const{type:t=kr,repeat:n=0,repeatDelay:i=0,repeatType:r,velocity:o=0}=e;let{keyframes:s}=e;const a=t||kr;a!==kr&&"number"!==typeof s[0]&&(this.mixKeyframes=Ci(Rr,Wi(s[0],s[1])),s=[0,100]);const c=a(l(l({},e),{},{keyframes:s}));"mirror"===r&&(this.mirroredGenerator=a(l(l({},e),{},{keyframes:[...s].reverse(),velocity:-o}))),null===c.calculatedDuration&&(c.calculatedDuration=Yi(c));const{calculatedDuration:u}=c;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(n+1)-i,this.generator=c}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{generator:n,totalDuration:i,mixKeyframes:r,mirroredGenerator:o,resolvedDuration:s,calculatedDuration:a}=this;if(null===this.startTime)return n.next(0);const{delay:l=0,keyframes:c,repeat:u,repeatType:h,repeatDelay:d,type:p,onUpdate:f,finalKeyframe:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),y=this.playbackSpeed>=0?g<0:g>i;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=i);let _=this.currentTime,v=n;if(u){const e=Math.min(this.currentTime,i)/s;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,u+1);Boolean(t%2)&&("reverse"===h?(n=1-n,d&&(n-=d/s)):"mirror"===h&&(v=o)),_=Me(0,1,n)*s}const x=y?{done:!1,value:c[0]}:v.next(_);r&&(x.value=r(x.value));let{done:b}=x;y||null===a||(b=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&b);return w&&p!==sr&&(x.value=Pr(c,this.options,m,this.speed)),f&&f(x.value),w&&this.finish(),x}then(e,t){return this.finished.then(e,t)}get duration(){return Ii(this.calculatedDuration)}get time(){return Ii(this.currentTime)}set time(e){var t;e=Pi(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),null===(t=this.driver)||void 0===t||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Wt.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Ii(this.currentTime))}play(){var e,t;if(this.isStopped)return;const{driver:n=Zi,startTime:i}=this.options;this.driver||(this.driver=n(e=>this.tick(e))),null===(e=(t=this.options).onPlay)||void 0===e||e.call(t);const r=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=r):null!==this.holdTime?this.startTime=r-this.holdTime:this.startTime||(this.startTime=null!==i&&void 0!==i?i:r),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Wt.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",null===(e=(t=this.options).onComplete)||void 0===e||e.call(t)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),null===(e=(t=this.options).onCancel)||void 0===e||e.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,Di.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),null===(t=this.driver)||void 0===t||t.stop(),e.observe(this)}}function Or(e){let t;return()=>(void 0===t&&(t=e()),t)}const Fr=Or(()=>void 0!==window.ScrollTimeline),Br={};function Nr(e,t){const n=Or(e);return()=>{var e;return null!==(e=Br[t])&&void 0!==e?e:n()}}const jr=Nr(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),Vr=e=>{let[t,n,i,r]=e;return"cubic-bezier(".concat(t,", ").concat(n,", ").concat(i,", ").concat(r,")")},Ur={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Vr([0,.65,.55,1]),circOut:Vr([.55,0,1,.45]),backIn:Vr([.31,.01,.66,-.59]),backOut:Vr([.33,1.53,.69,.99])};function Gr(e,t){return e?"function"===typeof e?jr()?Hi(e,t):"ease-out":br(e)?Vr(e):Array.isArray(e)?e.map(e=>Gr(e,t)||Ur.easeOut):Ur[e]:void 0}function qr(e,t,n){let{delay:i=0,duration:r=300,repeat:o=0,repeatType:s="loop",ease:a="easeOut",times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const u={[t]:n};l&&(u.offset=l);const h=Gr(a,r);Array.isArray(h)&&(u.easing=h),Je.value&&Di.waapi++;const d={delay:i,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:"reverse"===s?"alternate":"normal"};c&&(d.pseudoElement=c);const p=e.animate(u,d);return Je.value&&p.finished.finally(()=>{Di.waapi--}),p}function Wr(e){return"function"===typeof e&&"applyToOptions"in e}const Zr=["type"];class Hr extends zr{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:n,keyframes:i,pseudoElement:r,allowFlatten:o=!1,finalKeyframe:s,onComplete:a}=e;this.isPseudoElement=Boolean(r),this.allowFlatten=o,this.options=e,e.type;const l=function(e){let{type:t}=e,n=u(e,Zr);return Wr(t)&&jr()?t.applyToOptions(n):(null!==(i=n.duration)&&void 0!==i||(n.duration=300),null!==(r=n.ease)&&void 0!==r||(n.ease="easeOut"),n);var i,r}(e);this.animation=qr(t,n,i,l,r),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const e=Pr(i,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,n){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,n):e.style[t]=n}(t,n,e),this.animation.cancel()}null===a||void 0===a||a(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;null===(e=(t=this.animation).finish)||void 0===e||e.call(t)}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,t;this.isPseudoElement||(null===(e=(t=this.animation).commitStyles)||void 0===e||e.call(t))}get duration(){var e,t;const n=(null===(e=this.animation.effect)||void 0===e||null===(t=e.getComputedTiming)||void 0===t?void 0:t.call(e).duration)||0;return Ii(Number(n))}get time(){return Ii(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Pi(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline(e){let{timeline:t,observe:n}=e;var i;this.allowFlatten&&(null===(i=this.animation.effect)||void 0===i||i.updateTiming({easing:"linear"}));return this.animation.onfinish=null,t&&Fr()?(this.animation.timeline=t,Xe):n(this)}}const Xr={anticipate:yr,backInOut:gr,circInOut:xr};function Yr(e){"string"===typeof e.ease&&e.ease in Xr&&(e.ease=Xr[e.ease])}const Kr=["motionValue","onUpdate","onComplete","element"];class Jr extends Hr{constructor(e){Yr(e),Dr(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){var t;const n=this.options,{motionValue:i,onUpdate:r,onComplete:o,element:s}=n,a=u(n,Kr);if(!i)return;if(void 0!==e)return void i.set(e);const c=new Lr(l(l({},a),{},{autoplay:!1})),h=Pi(null!==(t=this.finishedTime)&&void 0!==t?t:this.time);i.setWithVelocity(c.sample(h-10).value,c.sample(h).value,10),c.stop()}}const $r=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!Pt.test(e)&&"0"!==e||e.startsWith("url(")));const Qr=new Set(["opacity","clipPath","filter","transform"]),eo=Or(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));const to=["autoplay","delay","type","repeat","repeatDelay","repeatType","keyframes","name","motionValue","element"];class no extends zr{constructor(e){var t;let{autoplay:n=!0,delay:i=0,type:r="keyframes",repeat:o=0,repeatDelay:s=0,repeatType:a="loop",keyframes:c,name:h,motionValue:d,element:p}=e,f=u(e,to);super(),this.stop=()=>{var e,t;this._animation&&(this._animation.stop(),null===(t=this.stopTimeline)||void 0===t||t.call(this));null===(e=this.keyframeResolver)||void 0===e||e.cancel()},this.createdAt=Wt.now();const m=l({autoplay:n,delay:i,type:r,repeat:o,repeatDelay:s,repeatType:a,name:h,motionValue:d,element:p},f),g=(null===p||void 0===p?void 0:p.KeyframeResolver)||ct;this.keyframeResolver=new g(c,(e,t,n)=>this.onKeyframesResolved(e,t,m,!n),h,d,p),null===(t=this.keyframeResolver)||void 0===t||t.scheduleResolve()}onKeyframesResolved(e,t,n,i){this.keyframeResolver=void 0;const{name:r,type:o,velocity:s,delay:a,isHandoff:c,onUpdate:u}=n;this.resolvedAt=Wt.now(),function(e,t,n,i){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const o=e[e.length-1],s=$r(r,t),a=$r(o,t);return"You are trying to animate ".concat(t,' from "').concat(r,'" to "').concat(o,'". "').concat(s?o:r,'" is not an animatable value.'),!(!s||!a)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||Wr(n))&&i)}(e,r,o,s)||(!Ye.instantAnimations&&a||null===u||void 0===u||u(Pr(e,n,t)),e[0]=e[e.length-1],Mi(n),n.repeat=0);const h=l(l({startTime:i?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t},n),{},{keyframes:e}),d=!c&&function(e){var t;const{motionValue:n,name:i,repeatDelay:r,repeatType:o,damping:s,type:a}=e;if(!((null===n||void 0===n||null===(t=n.owner)||void 0===t?void 0:t.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=n.owner.getProps();return eo()&&i&&Qr.has(i)&&("transform"!==i||!c)&&!l&&!r&&"mirror"!==o&&0!==s&&"inertia"!==a}(h)?new Jr(l(l({},h),{},{element:h.motionValue.owner.current})):new Lr(h);d.finished.then(()=>this.notifyFinished()).catch(Xe),this.pendingTimeline&&(this.stopTimeline=d.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=d}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){var e;this._animation||(null===(e=this.keyframeResolver)||void 0===e||e.resume(),st=!0,lt(),at(),st=!1);return this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),null===(e=this.keyframeResolver)||void 0===e||e.cancel()}}const io=e=>null!==e;const ro={type:"spring",stiffness:500,damping:25,restSpeed:10},oo={type:"keyframes",duration:.8},so={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ao=(e,t)=>{let{keyframes:n}=t;return n.length>2?oo:H.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:ro:so},lo=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];const co=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;return s=>{const a=xi(i,e)||{},c=a.delay||i.delay||0;let{elapsed:h=0}=i;h-=Pi(c);const d=l(l({keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity()},a),{},{delay:-h,onUpdate:e=>{t.set(e),a.onUpdate&&a.onUpdate(e)},onComplete:()=>{s(),a.onComplete&&a.onComplete()},name:e,motionValue:t,element:o?void 0:r});(function(e){let{when:t,delay:n,delayChildren:i,staggerChildren:r,staggerDirection:o,repeat:s,repeatType:a,repeatDelay:l,from:c,elapsed:h}=e,d=u(e,lo);return!!Object.keys(d).length})(a)||Object.assign(d,ao(e,d)),d.duration&&(d.duration=Pi(d.duration)),d.repeatDelay&&(d.repeatDelay=Pi(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let p=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(Mi(d),0===d.delay&&(p=!0)),(Ye.instantAnimations||Ye.skipAnimations)&&(p=!0,Mi(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,p&&!o&&void 0!==t.get()){const e=function(e,t,n){let{repeat:i,repeatType:r="loop"}=t;const o=e.filter(io),s=i&&"loop"!==r&&i%2===1?0:o.length-1;return s&&void 0!==n?n:o[s]}(d.keyframes,a);if(void 0!==e)return void Qe.update(()=>{d.onUpdate(e),d.onComplete()})}return a.isSync?new Lr(d):new no(d)}},uo=["transition","transitionEnd"];function ho(e,t){let{protectedKeys:n,needsAnimating:i}=e;const r=n.hasOwnProperty(t)&&!0!==i[t];return i[t]=!1,r}function po(e,t){let{delay:n=0,transitionOverride:i,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{transition:o=e.getDefaultTransition(),transitionEnd:s}=t,a=u(t,uo);i&&(o=i);const c=[],h=r&&e.animationState&&e.animationState.getState()[r];for(const u in a){var d;const t=e.getValue(u,null!==(d=e.latestValues[u])&&void 0!==d?d:null),i=a[u];if(void 0===i||h&&ho(h,u))continue;const r=l({delay:n},xi(o||{},u)),s=t.get();if(void 0!==s&&!t.isAnimating&&!Array.isArray(i)&&i===s&&!r.velocity)continue;let p=!1;if(window.MotionHandoffAnimation){const t=Ai(e);if(t){const e=window.MotionHandoffAnimation(t,u,Qe);null!==e&&(r.startTime=e,p=!0)}}Ei(e,u),t.start(co(u,t,i,e.shouldReduceMotion&&Ae.has(u)?{type:!1}:r,e,p));const f=t.animation;f&&c.push(f)}return s&&Promise.all(c).then(()=>{Qe.update(()=>{s&&function(e,t){let n=vi(e,t)||{},{transitionEnd:i={},transition:r={}}=n,o=u(n,wi);o=l(l({},o),i);for(const s in o)Si(e,s,Ti(o[s]))}(e,s)})}),c}function fo(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const o=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),s=e.size,a=(s-1)*i;return"function"===typeof n?n(o,s):1===r?o*i:a-o*i}function mo(e,t){var n;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=vi(e,t,"exit"===i.type?null===(n=e.presenceContext)||void 0===n?void 0:n.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=r||{};i.transitionOverride&&(o=i.transitionOverride);const s=r?()=>Promise.all(po(e,r,i)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:r=0,staggerChildren:s,staggerDirection:a}=o;return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0;const a=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),a.push(mo(c,t,l(l({},s),{},{delay:n+("function"===typeof i?0:i)+fo(e.variantChildren,c,i,r,o)})).then(()=>c.notify("AnimationComplete",t)));return Promise.all(a)}(e,t,n,r,s,a,i)}:()=>Promise.resolve(),{when:c}=o;if(c){const[e,t]="beforeChildren"===c?[s,a]:[a,s];return e().then(()=>t())}return Promise.all([s(),a(i.delay)])}function go(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}const yo=dn.length;function _o(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&_o(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let n=0;n<yo;n++){const i=dn[n],r=e.props[i];(un(r)||!1===r)&&(t[i]=r)}return t}const vo=["transition","transitionEnd"],xo=[...hn].reverse(),bo=hn.length;function wo(e){return t=>Promise.all(t.map(t=>{let{animation:n,options:i}=t;return function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map(t=>mo(e,t,i));n=Promise.all(r)}else if("string"===typeof t)n=mo(e,t,i);else{const r="function"===typeof t?vi(e,t,i.custom):t;n=Promise.all(po(e,r,i))}return n.then(()=>{e.notify("AnimationComplete",t)})}(e,n,i)}))}function So(e){let t=wo(e),n=Ao(),i=!0;const r=t=>(n,i)=>{var r;const o=vi(e,i,"exit"===t?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);if(o){const{transition:e,transitionEnd:t}=o,i=u(o,vo);n=l(l(l({},n),i),t)}return n};function o(o){const{props:s}=e,a=_o(e.parent)||{},c=[],u=new Set;let h={},d=1/0;for(let t=0;t<bo;t++){const p=xo[t],f=n[p],m=void 0!==s[p]?s[p]:a[p],g=un(m),y=p===o?f.isActive:null;!1===y&&(d=t);let _=m===a[p]&&m!==s[p]&&g;if(_&&i&&e.manuallyAnimateOnMount&&(_=!1),f.protectedKeys=l({},h),!f.isActive&&null===y||!m&&!f.prevProp||cn(m)||"boolean"===typeof m)continue;const v=To(f.prevProp,m);let x=v||p===o&&f.isActive&&!_&&g||t>d&&g,b=!1;const w=Array.isArray(m)?m:[m];let S=w.reduce(r(p),{});!1===y&&(S={});const{prevResolvedValues:T={}}=f,E=l(l({},T),S),A=t=>{x=!0,u.has(t)&&(b=!0,u.delete(t)),f.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in E){const t=S[e],n=T[e];if(h.hasOwnProperty(e))continue;let i=!1;i=bi(t)&&bi(n)?!go(t,n):t!==n,i?void 0!==t&&null!==t?A(e):u.add(e):void 0!==t&&u.has(e)?A(e):f.protectedKeys[e]=!0}f.prevProp=m,f.prevResolvedValues=S,f.isActive&&(h=l(l({},h),S)),i&&e.blockInitialAnimation&&(x=!1);const M=_&&v;x&&(!M||b)&&c.push(...w.map(t=>{const n={type:p};if("string"===typeof t&&i&&!M&&e.manuallyAnimateOnMount&&e.parent){const{parent:i}=e,r=vi(i,t);if(i.enteringChildren&&r){const{delayChildren:t}=r.transition||{};n.delay=fo(i.enteringChildren,e,t)}}return{animation:t,options:n}}))}if(u.size){const t={};if("boolean"!==typeof s.initial){const n=vi(e,Array.isArray(s.initial)?s.initial[0]:s.initial);n&&n.transition&&(t.transition=n.transition)}u.forEach(n=>{const i=e.getBaseTarget(n),r=e.getValue(n);r&&(r.liveStyle=!0),t[n]=null!==i&&void 0!==i?i:null}),c.push({animation:t})}let p=Boolean(c.length);return!i||!1!==s.initial&&s.initial!==s.animate||e.manuallyAnimateOnMount||(p=!1),i=!1,p?t(c):Promise.resolve()}return{animateChanges:o,setActive:function(t,i){var r;if(n[t].isActive===i)return Promise.resolve();null===(r=e.variantChildren)||void 0===r||r.forEach(e=>{var n;return null===(n=e.animationState)||void 0===n?void 0:n.setActive(t,i)}),n[t].isActive=i;const s=o(t);for(const e in n)n[e].protectedKeys={};return s},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=Ao(),i=!0}}}function To(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!go(t,e)}function Eo(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ao(){return{animate:Eo(!0),whileInView:Eo(),whileHover:Eo(),whileTap:Eo(),whileDrag:Eo(),whileFocus:Eo(),exit:Eo()}}class Mo{constructor(e){this.isMounted=!1,this.node=e}update(){}}let ko=0;const Co={animation:{Feature:class extends Mo{constructor(e){super(e),e.animationState||(e.animationState=So(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();cn(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends Mo{constructor(){super(...arguments),this.id=ko++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}},Po={x:!1,y:!1};function Io(){return Po.x||Po.y}function Do(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}const zo=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary;function Ro(e){return{point:{x:e.pageX,y:e.pageY}}}function Lo(e,t,n,i){return Do(e,t,(e=>t=>zo(t)&&e(t,Ro(t)))(n),i)}function Oo(e){return e.max-e.min}function Fo(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=i,e.originPoint=ue(t.min,t.max,e.origin),e.scale=Oo(n)/Oo(t),e.translate=ue(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Bo(e,t,n,i){Fo(e.x,t.x,n.x,i?i.originX:void 0),Fo(e.y,t.y,n.y,i?i.originY:void 0)}function No(e,t,n){e.min=n.min+t.min,e.max=e.min+Oo(t)}function jo(e,t,n){e.min=t.min-n.min,e.max=e.min+Oo(t)}function Vo(e,t,n){jo(e.x,t.x,n.x),jo(e.y,t.y,n.y)}function Uo(e){return[e("x"),e("y")]}const Go=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null},qo=(e,t)=>Math.abs(e-t);class Wo{constructor(e,t){let{transformPagePoint:n,contextWindow:i=window,dragSnapToOrigin:r=!1,distanceThreshold:o=3}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Xo(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=qo(e.x,t.x),i=qo(e.y,t.y);return Math.sqrt(n**2+i**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!n)return;const{point:i}=e,{timestamp:r}=tt;this.history.push(l(l({},i),{},{timestamp:r}));const{onStart:o,onMove:s}=this.handlers;t||(o&&o(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),s&&s(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Zo(t,this.transformPagePoint),Qe.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const o=Xo("pointercancel"===e.type?this.lastMoveEventInfo:Zo(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,o),i&&i(e,o)},!zo(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=o,this.contextWindow=i||window;const s=Zo(Ro(e),this.transformPagePoint),{point:a}=s,{timestamp:c}=tt;this.history=[l(l({},a),{},{timestamp:c})];const{onSessionStart:u}=t;u&&u(e,Xo(s,this.history)),this.removeListeners=Ci(Lo(this.contextWindow,"pointermove",this.handlePointerMove),Lo(this.contextWindow,"pointerup",this.handlePointerUp),Lo(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),et(this.updatePoint)}}function Zo(e,t){return t?{point:t(e.point)}:e}function Ho(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Xo(e,t){let{point:n}=e;return{point:n,delta:Ho(n,Ko(t)),offset:Ho(n,Yo(t)),velocity:Jo(t,.1)}}function Yo(e){return e[0]}function Ko(e){return e[e.length-1]}function Jo(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null;const r=Ko(e);for(;n>=0&&(i=e[n],!(r.timestamp-i.timestamp>Pi(t)));)n--;if(!i)return{x:0,y:0};const o=Ii(r.timestamp-i.timestamp);if(0===o)return{x:0,y:0};const s={x:(r.x-i.x)/o,y:(r.y-i.y)/o};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function $o(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function Qo(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}const es=.35;function ts(e,t,n){return{min:ns(e,t),max:ns(e,n)}}function ns(e,t){return"number"===typeof e?e:e[t]||0}const is=new WeakMap;class rs{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e){let{snapToCursor:t=!1,distanceThreshold:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:i}=this.visualElement;if(i&&!1===i.isPresent)return;const{dragSnapToOrigin:r}=this.getProps();this.panSession=new Wo(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Ro(e).point)},onStart:(e,t)=>{const{drag:n,dragPropagation:i,onDragStart:r}=this.getProps();if(n&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(o=n)||"y"===o?Po[o]?null:(Po[o]=!0,()=>{Po[o]=!1}):Po.x||Po.y?null:(Po.x=Po.y=!0,()=>{Po.x=Po.y=!1}),!this.openDragLock))return;var o;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Uo(e=>{let t=this.getAxisMotionValue(e).get()||0;if(ze.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const i=n.layout.layoutBox[e];if(i){t=Oo(i)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),r&&Qe.postRender(()=>r(e,t)),Ei(this.visualElement,"transform");const{animationState:s}=this.visualElement;s&&s.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;const{dragPropagation:n,dragDirectionLock:i,onDirectionLock:r,onDrag:o}=this.getProps();if(!n&&!this.openDragLock)return;const{offset:s}=t;if(i&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(s),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,s),this.updateAxis("y",t.point,s),this.visualElement.render(),o&&o(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>Uo(e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:r,distanceThreshold:n,contextWindow:Go(this.visualElement)})}stop(e,t){const n=e||this.latestPointerEvent,i=t||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!i||!n)return;const{velocity:o}=i;this.startAnimation(o);const{onDragEnd:s}=this.getProps();s&&Qe.postRender(()=>s(n,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:i}=this.getProps();if(!n||!os(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let o=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(o=function(e,t,n){let{min:i,max:r}=t;return void 0!==i&&e<i?e=n?ue(i,e,n.min):Math.max(e,i):void 0!==r&&e>r&&(e=n?ue(r,e,n.max):Math.min(e,r)),e}(o,this.constraints[e],this.elastic[e])),r.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;t&&ui(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!i)&&function(e,t){let{top:n,left:i,bottom:r,right:o}=t;return{x:$o(e.x,i,o),y:$o(e.y,n,r)}}(i.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:es;return!1===e?e=0:!0===e&&(e=es),{x:ts(e,"left","right"),y:ts(e,"top","bottom")}}(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Uo(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(i.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!ui(e))return!1;const n=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,t,n){const i=Ee(e,n),{scroll:r}=t;return r&&(we(i.x,r.offset.x),we(i.y,r.offset.y)),i}(n,i.root,this.visualElement.getTransformPagePoint());let o=function(e,t){return{x:Qo(e.x,t.x),y:Qo(e.y,t.y)}}(i.layout.layoutBox,r);if(t){const e=t(function(e){let{x:t,y:n}=e;return{top:n.min,right:t.max,bottom:n.max,left:t.min}}(o));this.hasMutatedConstraints=!!e,e&&(o=ce(e))}return o}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:o,onDragTransitionEnd:s}=this.getProps(),a=this.constraints||{},c=Uo(s=>{if(!os(s,t,this.currentDirection))return;let c=a&&a[s]||{};o&&(c={min:0,max:0});const u=i?200:1e6,h=i?40:1e7,d=l(l({type:"inertia",velocity:n?e[s]:0,bounceStiffness:u,bounceDamping:h,timeConstant:750,restDelta:1,restSpeed:10},r),c);return this.startAxisValueAnimation(s,d)});return Promise.all(c).then(s)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return Ei(this.visualElement,e),n.start(co(e,n,0,t,this.visualElement,!1))}stopAnimation(){Uo(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Uo(e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()})}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag".concat(e.toUpperCase()),n=this.visualElement.getProps(),i=n[t];return i||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){Uo(t=>{const{drag:n}=this.getProps();if(!os(t,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:n,max:o}=i.layout.layoutBox[t];r.set(e[t]-ue(n,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!ui(t)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Uo(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();i[e]=function(e,t){let n=.5;const i=Oo(e),r=Oo(t);return r>i?n=Tr(t.min,t.max-i,e.min):i>r&&(n=Tr(e.min,e.max-r,t.min)),Me(0,1,n)}({min:n,max:n},this.constraints[e])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Uo(t=>{if(!os(t,e,null))return;const n=this.getAxisMotionValue(t),{min:r,max:o}=this.constraints[t];n.set(ue(r,o,i[t]))})}addListeners(){if(!this.visualElement.current)return;is.set(this.visualElement,this);const e=Lo(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();ui(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Qe.read(t);const r=Do(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:n}=e;this.isDragging&&n&&(Uo(e=>{const n=this.getAxisMotionValue(e);n&&(this.originPoint[e]+=t[e].translate,n.set(n.get()+t[e].translate))}),this.visualElement.render())});return()=>{r(),e(),i(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:o=es,dragMomentum:s=!0}=e;return l(l({},e),{},{drag:t,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:o,dragMomentum:s})}}function os(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}const ss=e=>(t,n)=>{e&&Qe.postRender(()=>e(t,n))};const as={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ls(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const cs={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!Re.test(e))return e;e=parseFloat(e)}const n=ls(e,t.target.x),i=ls(e,t.target.y);return"".concat(n,"% ").concat(i,"%")}},us={correct:(e,t)=>{let{treeScale:n,projectionDelta:i}=t;const r=e,o=Pt.parse(e);if(o.length>5)return r;const s=Pt.createTransformer(e),a="number"!==typeof o[0]?1:0,l=i.x.scale*n.x,c=i.y.scale*n.y;o[0+a]/=l,o[1+a]/=c;const u=ue(l,c,.5);return"number"===typeof o[2+a]&&(o[2+a]/=u),"number"===typeof o[3+a]&&(o[3+a]/=u),s(o)}};let hs=!1;class ds extends e.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=e;!function(e){for(const t in e)An[t]=e[t],oe(t)&&(An[t].isCSSVariable=!0)}(fs),r&&(t.group&&t.group.add(r),n&&n.register&&i&&n.register(r),hs&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions(l(l({},r.options),{},{onExitComplete:()=>this.safeToRemove()}))),as.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:i,isPresent:r}=this.props,{projection:o}=n;return o?(o.isPresent=r,hs=!0,i||e.layoutDependency!==t||void 0===t||e.isPresent!==r?o.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?o.promote():o.relegate()||Qe.postRender(()=>{const e=o.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),en.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:i}=e;hs=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ps(t){const[n,i]=U(),r=(0,e.useContext)(P);return(0,C.jsx)(ds,l(l({},t),{},{layoutGroup:r,switchLayoutGroup:(0,e.useContext)(pi),isPresent:n,safeToRemove:i}))}const fs={borderRadius:l(l({},cs),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:cs,borderTopRightRadius:cs,borderBottomLeftRadius:cs,borderBottomRightRadius:cs,boxShadow:us};function ms(e){return L(e)&&"ownerSVGElement"in e}const gs=(e,t)=>e.depth-t.depth;class ys{constructor(){this.children=[],this.isDirty=!1}add(e){Zt(this.children,e),this.isDirty=!0}remove(e){Ht(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(gs),this.isDirty=!1,this.children.forEach(e)}}function _s(e,t){const n=Wt.now(),i=r=>{let{timestamp:o}=r;const s=o-n;s>=t&&(et(i),e(s-t))};return Qe.setup(i,!0),()=>et(i)}const vs=["TopLeft","TopRight","BottomLeft","BottomRight"],xs=vs.length,bs=e=>"string"===typeof e?parseFloat(e):e,ws=e=>"number"===typeof e||Re.test(e);function Ss(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Ts=As(0,.5,vr),Es=As(.5,.95,Xe);function As(e,t,n){return i=>i<e?0:i>t?1:n(Tr(e,t,i))}function Ms(e,t){e.min=t.min,e.max=t.max}function ks(e,t){Ms(e.x,t.x),Ms(e.y,t.y)}function Cs(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Ps(e,t,n,i,r){return e=ge(e-=t,1/n,i),void 0!==r&&(e=ge(e,1/r,i)),e}function Is(e,t,n,i,r){let[o,s,a]=n;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;ze.test(t)&&(t=parseFloat(t),t=ue(s.min,s.max,t/100)-s.min);if("number"!==typeof t)return;let a=ue(o.min,o.max,i);e===o&&(a-=t),e.min=Ps(e.min,t,n,a,r),e.max=Ps(e.max,t,n,a,r)}(e,t[o],t[s],t[a],t.scale,i,r)}const Ds=["x","scaleX","originX"],zs=["y","scaleY","originY"];function Rs(e,t,n,i){Is(e.x,t,Ds,n?n.x:void 0,i?i.x:void 0),Is(e.y,t,zs,n?n.y:void 0,i?i.y:void 0)}function Ls(e){return 0===e.translate&&1===e.scale}function Os(e){return Ls(e.x)&&Ls(e.y)}function Fs(e,t){return e.min===t.min&&e.max===t.max}function Bs(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Ns(e,t){return Bs(e.x,t.x)&&Bs(e.y,t.y)}function js(e){return Oo(e.x)/Oo(e.y)}function Vs(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Us{constructor(){this.members=[]}add(e){Zt(this.members,e),e.scheduleRender()}remove(e){if(Ht(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let n;for(let i=t;i>=0;i--){const e=this.members[i];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Gs={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},qs=["","X","Y","Z"];let Ws=0;function Zs(e,t,n,i){const{latestValues:r}=t;r[e]&&(n[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function Hs(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=Ai(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:t,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Qe,!(t||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&Hs(i)}function Xs(e){let{attachResizeListener:t,defaultParent:n,measureScroll:i,checkIsScrollRoot:r,resetTransform:o}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===n||void 0===n?void 0:n();this.id=Ws++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Je.value&&(Gs.nodes=Gs.calculatedTargetDeltas=Gs.calculatedProjections=0),this.nodes.forEach(Js),this.nodes.forEach(ra),this.nodes.forEach(oa),this.nodes.forEach($s),Je.addProjectionMetrics&&Je.addProjectionMetrics(Gs)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new ys)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Xt),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t&&t.notify(...i)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){if(this.instance)return;var n;this.isSVG=ms(e)&&!(ms(n=e)&&"svg"===n.tagName),this.instance=e;const{layoutId:i,layout:r,visualElement:o}=this.options;if(o&&!o.current&&o.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(r||i)&&(this.isLayoutDirty=!0),t){let n,i=0;const r=()=>this.root.updateBlockedByResize=!1;Qe.read(()=>{i=window.innerWidth}),t(e,()=>{const e=window.innerWidth;e!==i&&(i=e,this.root.updateBlockedByResize=!0,n&&n(),n=_s(r,250),as.hasAnimatedSinceResize&&(as.hasAnimatedSinceResize=!1,this.nodes.forEach(ia)))})}i&&this.root.registerSharedNode(i,this),!1!==this.options.animate&&o&&(i||r)&&this.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:n,hasRelativeLayoutChanged:i,layout:r}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const s=this.options.transition||o.getDefaultTransition()||ha,{onLayoutAnimationStart:a,onLayoutAnimationComplete:c}=o.getProps(),u=!this.targetLayout||!Ns(this.targetLayout,r),h=!n&&i;if(this.options.layoutRoot||this.resumeFrom||h||n&&(u||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const e=l(l({},xi(s,"layout")),{},{onPlay:a,onComplete:c});(o.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e),this.setAnimationOrigin(t,h)}else n||ia(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),et(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(sa),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Hs(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(ea);if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(ta);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(na),this.nodes.forEach(Ys),this.nodes.forEach(Ks)):this.nodes.forEach(ta),this.clearAllSnapshots();const e=Wt.now();tt.delta=Me(0,1e3/60,e-tt.timestamp),tt.timestamp=e,tt.isProcessing=!0,nt.update.process(tt),nt.preRender.process(tt),nt.render.process(tt),tt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,en.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Qs),this.sharedNodes.forEach(aa)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Qe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Qe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||Oo(this.snapshot.measuredBox.x)||Oo(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!o)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Os(this.projectionDelta),n=this.getTransformTemplate(),i=n?n(this.latestValues,""):void 0,r=i!==this.prevTransformTemplateValue;e&&this.instance&&(t||pe(this.latestValues)||r)&&(o(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let n=this.removeElementScroll(t);var i;return e&&(n=this.removeTransform(n)),fa((i=n).x),fa(i.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const n=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(ga))){const{scroll:e}=this.root;e&&(we(n.x,e.offset.x),we(n.y,e.offset.y))}return n}removeElementScroll(e){var t;const n={x:{min:0,max:0},y:{min:0,max:0}};if(ks(n,e),null!==(t=this.scroll)&&void 0!==t&&t.wasRoot)return n;for(let i=0;i<this.path.length;i++){const t=this.path[i],{scroll:r,options:o}=t;t!==this.root&&r&&o.layoutScroll&&(r.wasRoot&&ks(n,e),we(n.x,r.offset.x),we(n.y,r.offset.y))}return n}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={x:{min:0,max:0},y:{min:0,max:0}};ks(n,e);for(let i=0;i<this.path.length;i++){const e=this.path[i];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&Te(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),pe(e.latestValues)&&Te(n,e.latestValues)}return pe(this.latestValues)&&Te(n,this.latestValues),n}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};ks(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!pe(e.latestValues))continue;de(e.latestValues)&&e.updateSnapshot();const i=on();ks(i,e.measurePageBox()),Rs(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,i)}return pe(this.latestValues)&&Rs(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options=l(l(l({},this.options),e),{},{crossfade:void 0===e.crossfade||e.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==tt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==n;if(!(t||i&&this.isSharedProjectionDirty||this.isProjectionDirty||null!==(e=this.parent)&&void 0!==e&&e.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:o}=this.options;if(this.layout&&(r||o)){if(this.resolvedRelativeTargetAt=tt.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Vo(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),ks(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var s,a,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),s=this.target,a=this.relativeTarget,l=this.relativeParent.target,No(s.x,a.x,l.x),No(s.y,a.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):ks(this.target,this.layout.layoutBox),ve(this.target,this.targetDelta)):ks(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Vo(this.relativeTargetOrigin,this.target,e.target),ks(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Je.value&&Gs.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!de(this.parent.latestValues)&&!fe(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let i=!0;if((this.isProjectionDirty||null!==(e=this.parent)&&void 0!==e&&e.isProjectionDirty)&&(i=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===tt.timestamp&&(i=!1),i)return;const{layout:r,layoutId:o}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!o)return;ks(this.layoutCorrected,this.layout.layoutBox);const s=this.treeScale.x,a=this.treeScale.y;!function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n.length;if(!r)return;let o,s;t.x=t.y=1;for(let a=0;a<r;a++){o=n[a],s=o.projectionDelta;const{visualElement:r}=o.options;r&&r.props.style&&"contents"===r.props.style.display||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Te(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,ve(e,s)),i&&pe(o.latestValues)&&Te(e,o.latestValues))}t.x<be&&t.x>xe&&(t.x=1),t.y<be&&t.y>xe&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(Cs(this.prevProjectionDelta.x,this.projectionDelta.x),Cs(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Bo(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===s&&this.treeScale.y===a&&Vs(this.projectionDelta.x,this.prevProjectionDelta.x)&&Vs(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Je.value&&Gs.calculatedProjections++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){var e;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(null===(e=this.options.visualElement)||void 0===e||e.scheduleRender(),t){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,i=n?n.latestValues:{},r=l({},this.latestValues),o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const s={x:{min:0,max:0},y:{min:0,max:0}},a=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),c=this.getStack(),u=!c||c.members.length<=1,h=Boolean(a&&!u&&!0===this.options.crossfade&&!this.path.some(ua));let d;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;var l,c;la(o.x,e.x,n),la(o.y,e.y,n),this.setTargetDelta(o),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Vo(s,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,i){ca(e.x,t.x,n.x,i),ca(e.y,t.y,n.y,i)}(this.relativeTarget,this.relativeTargetOrigin,s,n),d&&(l=this.relativeTarget,c=d,Fs(l.x,c.x)&&Fs(l.y,c.y))&&(this.isProjectionDirty=!1),d||(d={x:{min:0,max:0},y:{min:0,max:0}}),ks(d,this.relativeTarget)),a&&(this.animationValues=r,function(e,t,n,i,r,o){var s,a;if(r)e.opacity=ue(0,null!==(s=n.opacity)&&void 0!==s?s:1,Ts(i)),e.opacityExit=ue(null!==(a=t.opacity)&&void 0!==a?a:1,0,Es(i));else if(o){var l,c;e.opacity=ue(null!==(l=t.opacity)&&void 0!==l?l:1,null!==(c=n.opacity)&&void 0!==c?c:1,i)}for(let u=0;u<xs;u++){const r="border".concat(vs[u],"Radius");let o=Ss(t,r),s=Ss(n,r);void 0===o&&void 0===s||(o||(o=0),s||(s=0),0===o||0===s||ws(o)===ws(s)?(e[r]=Math.max(ue(bs(o),bs(s),i),0),(ze.test(s)||ze.test(o))&&(e[r]+="%")):e[r]=s)}(t.rotate||n.rotate)&&(e.rotate=ue(t.rotate||0,n.rotate||0,i))}(r,i,this.latestValues,n,h,u)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){var t,n;this.notifyListeners("animationStart"),null===(t=this.currentAnimation)||void 0===t||t.stop(),null===(n=this.resumingFrom)||void 0===n||null===(n=n.currentAnimation)||void 0===n||n.stop(),this.pendingAnimation&&(et(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Qe.update(()=>{as.hasAnimatedSinceResize=!0,Di.layout++,this.motionValue||(this.motionValue=$t(0)),this.currentAnimation=function(e,t,n){const i=Ut(e)?e:$t(e);return i.start(co("",i,t,n)),i.animation}(this.motionValue,[0,1e3],l(l({},e),{},{velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{Di.layout--},onComplete:()=>{Di.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:i,latestValues:r}=e;if(t&&n&&i){if(this!==e&&this.layout&&i&&ma(this.options.animationType,this.layout.layoutBox,i.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Oo(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const i=Oo(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+i}ks(t,n),Te(t,r),Bo(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Us);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=this.getStack();i&&i.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const i={};n.z&&Zs("z",e,i,this.animationValues);for(let r=0;r<qs.length;r++)Zs("rotate".concat(qs[r]),e,i,this.animationValues),Zs("skew".concat(qs[r]),e,i,this.animationValues);e.render();for(const r in i)e.setStaticValue(r,i[r]),this.animationValues&&(this.animationValues[r]=i[r]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible)return void(e.visibility="hidden");const n=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=ii(null===t||void 0===t?void 0:t.pointerEvents)||"",void(e.transform=n?n(this.latestValues,""):"none");const i=this.getLead();if(!this.projectionDelta||!this.layout||!i.target)return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=ii(null===t||void 0===t?void 0:t.pointerEvents)||""),void(this.hasProjected&&!pe(this.latestValues)&&(e.transform=n?n({},""):"none",this.hasProjected=!1));e.visibility="";const r=i.animationValues||i.latestValues;this.applyTransformsToTarget();let o=function(e,t,n){let i="";const r=e.x.translate/t.x,o=e.y.translate/t.y,s=(null===n||void 0===n?void 0:n.z)||0;if((r||o||s)&&(i="translate3d(".concat(r,"px, ").concat(o,"px, ").concat(s,"px) ")),1===t.x&&1===t.y||(i+="scale(".concat(1/t.x,", ").concat(1/t.y,") ")),n){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:o,skewX:s,skewY:a}=n;e&&(i="perspective(".concat(e,"px) ").concat(i)),t&&(i+="rotate(".concat(t,"deg) ")),r&&(i+="rotateX(".concat(r,"deg) ")),o&&(i+="rotateY(".concat(o,"deg) ")),s&&(i+="skewX(".concat(s,"deg) ")),a&&(i+="skewY(".concat(a,"deg) "))}const a=e.x.scale*t.x,l=e.y.scale*t.y;return 1===a&&1===l||(i+="scale(".concat(a,", ").concat(l,")")),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,r);n&&(o=n(r,o)),e.transform=o;const{x:s,y:a}=this.projectionDelta;var l,c;(e.transformOrigin="".concat(100*s.origin,"% ").concat(100*a.origin,"% 0"),i.animationValues)?e.opacity=i===this?null!==(l=null!==(c=r.opacity)&&void 0!==c?c:this.latestValues.opacity)&&void 0!==l?l:1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:e.opacity=i===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0;for(const u in An){if(void 0===r[u])continue;const{correct:t,applyTo:n,isCSSVariable:s}=An[u],a="none"===o?r[u]:t(r[u],i);if(n){const t=n.length;for(let i=0;i<t;i++)e[n[i]]=a}else s?this.options.visualElement.renderState.vars[u]=a:e[u]=a}this.options.layoutId&&(e.pointerEvents=i===this?ii(null===t||void 0===t?void 0:t.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()}),this.root.nodes.forEach(ea),this.root.sharedNodes.clear()}}}function Ys(e){e.updateLayout()}function Ks(e){var t;const n=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=e.layout,{animationType:r}=e.options,o=n.source!==e.layout.source;"size"===r?Uo(e=>{const i=o?n.measuredBox[e]:n.layoutBox[e],r=Oo(i);i.min=t[e].min,i.max=i.min+r}):ma(r,n.layoutBox,t)&&Uo(i=>{const r=o?n.measuredBox[i]:n.layoutBox[i],s=Oo(t[i]);r.max=r.min+s,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+s)});const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Bo(s,t,n.layoutBox);const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};o?Bo(a,e.applyTransform(i,!0),n.measuredBox):Bo(a,t,n.layoutBox);const l=!Os(s);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:o}=i;if(r&&o){const s={x:{min:0,max:0},y:{min:0,max:0}};Vo(s,n.layoutBox,r.layoutBox);const a={x:{min:0,max:0},y:{min:0,max:0}};Vo(a,t,o.layoutBox),Ns(s,a)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=a,e.relativeTargetOrigin=s,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:a,layoutDelta:s,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function Js(e){Je.value&&Gs.nodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function $s(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Qs(e){e.clearSnapshot()}function ea(e){e.clearMeasurements()}function ta(e){e.isLayoutDirty=!1}function na(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function ia(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function ra(e){e.resolveTargetDelta()}function oa(e){e.calcProjection()}function sa(e){e.resetSkewAndRotation()}function aa(e){e.removeLeadSnapshot()}function la(e,t,n){e.translate=ue(t.translate,0,n),e.scale=ue(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function ca(e,t,n,i){e.min=ue(t.min,n.min,i),e.max=ue(t.max,n.max,i)}function ua(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const ha={duration:.45,ease:[.4,0,.1,1]},da=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),pa=da("applewebkit/")&&!da("chrome/")?Math.round:Xe;function fa(e){e.min=pa(e.min),e.max=pa(e.max)}function ma(e,t,n){return"position"===e||"preserve-aspect"===e&&(i=js(t),r=js(n),o=.2,!(Math.abs(i-r)<=o));var i,r,o}function ga(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const ya=Xs({attachResizeListener:(e,t)=>Do(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),_a={current:void 0},va=Xs({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!_a.current){const e=new ya({});e.mount(window),e.setOptions({layoutScroll:!0}),_a.current=e}return _a.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),xa={pan:{Feature:class extends Mo{constructor(){super(...arguments),this.removePointerDownListener=Xe}onPointerDown(e){this.session=new Wo(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Go(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:ss(e),onStart:ss(t),onMove:n,onEnd:(e,t)=>{delete this.session,i&&Qe.postRender(()=>i(e,t))}}}mount(){this.removePointerDownListener=Lo(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Mo{constructor(e){super(e),this.removeGroupControls=Xe,this.removeListeners=Xe,this.controls=new rs(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xe}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:va,MeasureLayout:ps}};function ba(e,t){const n=function(e,t,n){if(e instanceof EventTarget)return[e];if("string"===typeof e){var i;let r=document;t&&(r=t.current);const o=null!==(i=null===n||void 0===n?void 0:n[e])&&void 0!==i?i:r.querySelectorAll(e);return o?Array.from(o):[]}return Array.from(e)}(e),i=new AbortController;return[n,l(l({passive:!0},t),{},{signal:i.signal}),()=>i.abort()]}function wa(e){return!("touch"===e.pointerType||Io())}function Sa(e,t,n){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===n);const r=i["onHover"+n];r&&Qe.postRender(()=>r(t,Ro(t)))}const Ta=(e,t)=>!!t&&(e===t||Ta(e,t.parentElement)),Ea=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Aa=new WeakSet;function Ma(e){return t=>{"Enter"===t.key&&e(t)}}function ka(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Ca(e){return zo(e)&&!Io()}function Pa(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[i,r,o]=ba(e,n),s=e=>{const i=e.currentTarget;if(!Ca(e))return;Aa.add(i);const o=t(i,e),s=(e,t)=>{window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",l),Aa.has(i)&&Aa.delete(i),Ca(e)&&"function"===typeof o&&o(e,{success:t})},a=e=>{s(e,i===window||i===document||n.useGlobalTarget||Ta(i,e.target))},l=e=>{s(e,!1)};window.addEventListener("pointerup",a,r),window.addEventListener("pointercancel",l,r)};return i.forEach(e=>{var t;(n.useGlobalTarget?window:e).addEventListener("pointerdown",s,r),O(e)&&(e.addEventListener("focus",e=>((e,t)=>{const n=e.currentTarget;if(!n)return;const i=Ma(()=>{if(Aa.has(n))return;ka(n,"down");const e=Ma(()=>{ka(n,"up")});n.addEventListener("keyup",e,t),n.addEventListener("blur",()=>ka(n,"cancel"),t)});n.addEventListener("keydown",i,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),t)})(e,r)),t=e,Ea.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))}),o}function Ia(e,t,n){const{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===n);const r=i["onTap"+("End"===n?"":n)];r&&Qe.postRender(()=>r(t,Ro(t)))}const Da=["root"],za=new WeakMap,Ra=new WeakMap,La=e=>{const t=za.get(e.target);t&&t(e)},Oa=e=>{e.forEach(La)};function Fa(e,t,n){const i=function(e){let{root:t}=e,n=u(e,Da);const i=t||document;Ra.has(i)||Ra.set(i,{});const r=Ra.get(i),o=JSON.stringify(n);return r[o]||(r[o]=new IntersectionObserver(Oa,l({root:t},n))),r[o]}(t);return za.set(e,n),i.observe(e),()=>{za.delete(e),i.unobserve(e)}}const Ba={some:0,all:1};const Na={inView:{Feature:class extends Mo{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:i="some",once:r}=e,o={root:t?t.current:void 0,rootMargin:n,threshold:"number"===typeof i?i:Ba[i]};return Fa(this.node.current,o,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:i}=this.node.getProps(),o=t?n:i;o&&o(e)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,n=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==n[e]}(e,t));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Mo{mount(){const{current:e}=this.node;e&&(this.unmount=Pa(e,(e,t)=>(Ia(this.node,t,"Start"),(e,t)=>{let{success:n}=t;return Ia(this.node,e,n?"End":"Cancel")}),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Mo{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ci(Do(this.node.current,"focus",()=>this.onFocus()),Do(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends Mo{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[i,r,o]=ba(e,n),s=e=>{if(!wa(e))return;const{target:n}=e,i=t(n,e);if("function"!==typeof i||!n)return;const o=e=>{wa(e)&&(i(e),n.removeEventListener("pointerleave",o))};n.addEventListener("pointerleave",o,r)};return i.forEach(e=>{e.addEventListener("pointerenter",s,r)}),o}(e,(e,t)=>(Sa(this.node,t,"Start"),e=>Sa(this.node,e,"End"))))}unmount(){}}}},ja={layout:{ProjectionNode:va,MeasureLayout:ps}},Va=_i(l(l(l(l({},Co),Na),xa),ja),Vn);var Ua=n(879),Ga=n.n(Ua),qa=n(142),Wa=n.n(qa);function Za(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=Za(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}const Ha=function(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=Za(e))&&(i&&(i+=" "),i+=t);return i};function Xa(){return Xa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Xa.apply(null,arguments)}var Ya=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(i){}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach(function(e){var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)}),this.tags=[],this.ctr=0},e}(),Ka=Math.abs,Ja=String.fromCharCode,$a=Object.assign;function Qa(e){return e.trim()}function el(e,t,n){return e.replace(t,n)}function tl(e,t){return e.indexOf(t)}function nl(e,t){return 0|e.charCodeAt(t)}function il(e,t,n){return e.slice(t,n)}function rl(e){return e.length}function ol(e){return e.length}function sl(e,t){return t.push(e),e}var al=1,ll=1,cl=0,ul=0,hl=0,dl="";function pl(e,t,n,i,r,o,s){return{value:e,root:t,parent:n,type:i,props:r,children:o,line:al,column:ll,length:s,return:""}}function fl(e,t){return $a(pl("",null,null,"",null,null,0),e,{length:-e.length},t)}function ml(){return hl=ul>0?nl(dl,--ul):0,ll--,10===hl&&(ll=1,al--),hl}function gl(){return hl=ul<cl?nl(dl,ul++):0,ll++,10===hl&&(ll=1,al++),hl}function yl(){return nl(dl,ul)}function _l(){return ul}function vl(e,t){return il(dl,e,t)}function xl(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function bl(e){return al=ll=1,cl=rl(dl=e),ul=0,[]}function wl(e){return dl="",e}function Sl(e){return Qa(vl(ul-1,Al(91===e?e+2:40===e?e+1:e)))}function Tl(e){for(;(hl=yl())&&hl<33;)gl();return xl(e)>2||xl(hl)>3?"":" "}function El(e,t){for(;--t&&gl()&&!(hl<48||hl>102||hl>57&&hl<65||hl>70&&hl<97););return vl(e,_l()+(t<6&&32==yl()&&32==gl()))}function Al(e){for(;gl();)switch(hl){case e:return ul;case 34:case 39:34!==e&&39!==e&&Al(hl);break;case 40:41===e&&Al(e);break;case 92:gl()}return ul}function Ml(e,t){for(;gl()&&e+hl!==57&&(e+hl!==84||47!==yl()););return"/*"+vl(t,ul-1)+"*"+Ja(47===e?e:gl())}function kl(e){for(;!xl(yl());)gl();return vl(e,ul)}var Cl="-ms-",Pl="-moz-",Il="-webkit-",Dl="comm",zl="rule",Rl="decl",Ll="@keyframes";function Ol(e,t){for(var n="",i=ol(e),r=0;r<i;r++)n+=t(e[r],r,e,t)||"";return n}function Fl(e,t,n,i){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case Rl:return e.return=e.return||e.value;case Dl:return"";case Ll:return e.return=e.value+"{"+Ol(e.children,i)+"}";case zl:e.value=e.props.join(",")}return rl(n=Ol(e.children,i))?e.return=e.value+"{"+n+"}":""}function Bl(e){return wl(Nl("",null,null,null,[""],e=bl(e),0,[0],e))}function Nl(e,t,n,i,r,o,s,a,l){for(var c=0,u=0,h=s,d=0,p=0,f=0,m=1,g=1,y=1,_=0,v="",x=r,b=o,w=i,S=v;g;)switch(f=_,_=gl()){case 40:if(108!=f&&58==nl(S,h-1)){-1!=tl(S+=el(Sl(_),"&","&\f"),"&\f")&&(y=-1);break}case 34:case 39:case 91:S+=Sl(_);break;case 9:case 10:case 13:case 32:S+=Tl(f);break;case 92:S+=El(_l()-1,7);continue;case 47:switch(yl()){case 42:case 47:sl(Vl(Ml(gl(),_l()),t,n),l);break;default:S+="/"}break;case 123*m:a[c++]=rl(S)*y;case 125*m:case 59:case 0:switch(_){case 0:case 125:g=0;case 59+u:-1==y&&(S=el(S,/\f/g,"")),p>0&&rl(S)-h&&sl(p>32?Ul(S+";",i,n,h-1):Ul(el(S," ","")+";",i,n,h-2),l);break;case 59:S+=";";default:if(sl(w=jl(S,t,n,c,u,r,a,v,x=[],b=[],h),o),123===_)if(0===u)Nl(S,t,w,w,x,o,h,a,b);else switch(99===d&&110===nl(S,3)?100:d){case 100:case 108:case 109:case 115:Nl(e,w,w,i&&sl(jl(e,w,w,0,0,r,a,v,r,x=[],h),b),r,b,h,a,i?x:b);break;default:Nl(S,w,w,w,[""],b,0,a,b)}}c=u=p=0,m=y=1,v=S="",h=s;break;case 58:h=1+rl(S),p=f;default:if(m<1)if(123==_)--m;else if(125==_&&0==m++&&125==ml())continue;switch(S+=Ja(_),_*m){case 38:y=u>0?1:(S+="\f",-1);break;case 44:a[c++]=(rl(S)-1)*y,y=1;break;case 64:45===yl()&&(S+=Sl(gl())),d=yl(),u=h=rl(v=S+=kl(_l())),_++;break;case 45:45===f&&2==rl(S)&&(m=0)}}return o}function jl(e,t,n,i,r,o,s,a,l,c,u){for(var h=r-1,d=0===r?o:[""],p=ol(d),f=0,m=0,g=0;f<i;++f)for(var y=0,_=il(e,h+1,h=Ka(m=s[f])),v=e;y<p;++y)(v=Qa(m>0?d[y]+" "+_:el(_,/&\f/g,d[y])))&&(l[g++]=v);return pl(e,t,n,0===r?zl:a,l,c,u)}function Vl(e,t,n){return pl(e,t,n,Dl,Ja(hl),il(e,2,-2),0)}function Ul(e,t,n,i){return pl(e,t,n,Rl,il(e,0,i),il(e,i+1,-1),i)}var Gl=function(e,t,n){for(var i=0,r=0;i=r,r=yl(),38===i&&12===r&&(t[n]=1),!xl(r);)gl();return vl(e,ul)},ql=function(e,t){return wl(function(e,t){var n=-1,i=44;do{switch(xl(i)){case 0:38===i&&12===yl()&&(t[n]=1),e[n]+=Gl(ul-1,t,n);break;case 2:e[n]+=Sl(i);break;case 4:if(44===i){e[++n]=58===yl()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=Ja(i)}}while(i=gl());return e}(bl(e),t))},Wl=new WeakMap,Zl=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,i=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||Wl.get(n))&&!i){Wl.set(e,!0);for(var r=[],o=ql(t,r),s=n.props,a=0,l=0;a<o.length;a++)for(var c=0;c<s.length;c++,l++)e.props[l]=r[a]?o[a].replace(/&\f/g,s[c]):s[c]+" "+o[a]}}},Hl=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function Xl(e,t){switch(function(e,t){return 45^nl(e,0)?(((t<<2^nl(e,0))<<2^nl(e,1))<<2^nl(e,2))<<2^nl(e,3):0}(e,t)){case 5103:return Il+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Il+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Il+e+Pl+e+Cl+e+e;case 6828:case 4268:return Il+e+Cl+e+e;case 6165:return Il+e+Cl+"flex-"+e+e;case 5187:return Il+e+el(e,/(\w+).+(:[^]+)/,Il+"box-$1$2"+Cl+"flex-$1$2")+e;case 5443:return Il+e+Cl+"flex-item-"+el(e,/flex-|-self/,"")+e;case 4675:return Il+e+Cl+"flex-line-pack"+el(e,/align-content|flex-|-self/,"")+e;case 5548:return Il+e+Cl+el(e,"shrink","negative")+e;case 5292:return Il+e+Cl+el(e,"basis","preferred-size")+e;case 6060:return Il+"box-"+el(e,"-grow","")+Il+e+Cl+el(e,"grow","positive")+e;case 4554:return Il+el(e,/([^-])(transform)/g,"$1"+Il+"$2")+e;case 6187:return el(el(el(e,/(zoom-|grab)/,Il+"$1"),/(image-set)/,Il+"$1"),e,"")+e;case 5495:case 3959:return el(e,/(image-set\([^]*)/,Il+"$1$`$1");case 4968:return el(el(e,/(.+:)(flex-)?(.*)/,Il+"box-pack:$3"+Cl+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Il+e+e;case 4095:case 3583:case 4068:case 2532:return el(e,/(.+)-inline(.+)/,Il+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(rl(e)-1-t>6)switch(nl(e,t+1)){case 109:if(45!==nl(e,t+4))break;case 102:return el(e,/(.+:)(.+)-([^]+)/,"$1"+Il+"$2-$3$1"+Pl+(108==nl(e,t+3)?"$3":"$2-$3"))+e;case 115:return~tl(e,"stretch")?Xl(el(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==nl(e,t+1))break;case 6444:switch(nl(e,rl(e)-3-(~tl(e,"!important")&&10))){case 107:return el(e,":",":"+Il)+e;case 101:return el(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Il+(45===nl(e,14)?"inline-":"")+"box$3$1"+Il+"$2$3$1"+Cl+"$2box$3")+e}break;case 5936:switch(nl(e,t+11)){case 114:return Il+e+Cl+el(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Il+e+Cl+el(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Il+e+Cl+el(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return Il+e+Cl+e+e}return e}var Yl=[function(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case Rl:e.return=Xl(e.value,e.length);break;case Ll:return Ol([fl(e,{value:el(e.value,"@","@"+Il)})],i);case zl:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Ol([fl(e,{props:[el(t,/:(read-\w+)/,":-moz-$1")]})],i);case"::placeholder":return Ol([fl(e,{props:[el(t,/:(plac\w+)/,":"+Il+"input-$1")]}),fl(e,{props:[el(t,/:(plac\w+)/,":-moz-$1")]}),fl(e,{props:[el(t,/:(plac\w+)/,Cl+"input-$1")]})],i)}return""})}}],Kl=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))})}var i,r,o=e.stylisPlugins||Yl,s={},a=[];i=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)s[t[n]]=!0;a.push(e)});var l,c,u=[Fl,(c=function(e){l.insert(e)},function(e){e.root||(e=e.return)&&c(e)})],h=function(e){var t=ol(e);return function(n,i,r,o){for(var s="",a=0;a<t;a++)s+=e[a](n,i,r,o)||"";return s}}([Zl,Hl].concat(o,u));r=function(e,t,n,i){l=n,function(e){Ol(Bl(e),h)}(e?e+"{"+t.styles+"}":t.styles),i&&(d.inserted[t.name]=!0)};var d={key:t,sheet:new Ya({key:t,container:i,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:r};return d.sheet.hydrate(a),d};function Jl(e,t,n){var i="";return n.split(" ").forEach(function(n){void 0!==e[n]?t.push(e[n]+";"):n&&(i+=n+" ")}),i}var $l=function(e,t,n){var i=e.key+"-"+t.name;!1===n&&void 0===e.registered[i]&&(e.registered[i]=t.styles)},Ql=function(e,t,n){$l(e,t,n);var i=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var r=t;do{e.insert(t===r?"."+i:"",r,e.sheet,!0),r=r.next}while(void 0!==r)}};var ec={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};function tc(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}var nc=/[A-Z]|^ms/g,ic=/_EMO_([^_]+?)_([^]*?)_EMO_/g,rc=function(e){return 45===e.charCodeAt(1)},oc=function(e){return null!=e&&"boolean"!==typeof e},sc=tc(function(e){return rc(e)?e:e.replace(nc,"-$&").toLowerCase()}),ac=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(ic,function(e,t,n){return cc={name:t,styles:n,next:cc},t})}return 1===ec[e]||rc(e)||"number"!==typeof t||0===t?t:t+"px"};function lc(e,t,n){if(null==n)return"";var i=n;if(void 0!==i.__emotion_styles)return i;switch(typeof n){case"boolean":return"";case"object":var r=n;if(1===r.anim)return cc={name:r.name,styles:r.styles,next:cc},r.name;var o=n;if(void 0!==o.styles){var s=o.next;if(void 0!==s)for(;void 0!==s;)cc={name:s.name,styles:s.styles,next:cc},s=s.next;return o.styles+";"}return function(e,t,n){var i="";if(Array.isArray(n))for(var r=0;r<n.length;r++)i+=lc(e,t,n[r])+";";else for(var o in n){var s=n[o];if("object"!==typeof s){var a=s;null!=t&&void 0!==t[a]?i+=o+"{"+t[a]+"}":oc(a)&&(i+=sc(o)+":"+ac(o,a)+";")}else if(!Array.isArray(s)||"string"!==typeof s[0]||null!=t&&void 0!==t[s[0]]){var l=lc(e,t,s);switch(o){case"animation":case"animationName":i+=sc(o)+":"+l+";";break;default:i+=o+"{"+l+"}"}}else for(var c=0;c<s.length;c++)oc(s[c])&&(i+=sc(o)+":"+ac(o,s[c])+";")}return i}(e,t,n);case"function":if(void 0!==e){var a=cc,l=n(e);return cc=a,lc(e,t,l)}}var c=n;if(null==t)return c;var u=t[c];return void 0!==u?u:c}var cc,uc=/label:\s*([^\s;{]+)\s*(;|$)/g;function hc(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var i=!0,r="";cc=void 0;var o=e[0];null==o||void 0===o.raw?(i=!1,r+=lc(n,t,o)):r+=o[0];for(var s=1;s<e.length;s++){if(r+=lc(n,t,e[s]),i)r+=o[s]}uc.lastIndex=0;for(var a,l="";null!==(a=uc.exec(r));)l+="-"+a[1];var c=function(e){for(var t,n=0,i=0,r=e.length;r>=4;++i,r-=4)t=1540483477*(65535&(t=255&e.charCodeAt(i)|(255&e.charCodeAt(++i))<<8|(255&e.charCodeAt(++i))<<16|(255&e.charCodeAt(++i))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(r){case 3:n^=(255&e.charCodeAt(i+2))<<16;case 2:n^=(255&e.charCodeAt(i+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(i)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(r)+l;return{name:c,styles:r,next:cc}}var dc=!!t.useInsertionEffect&&t.useInsertionEffect,pc=dc||function(e){return e()},fc=(dc||e.useLayoutEffect,e.createContext("undefined"!==typeof HTMLElement?Kl({key:"css"}):null)),mc=(fc.Provider,function(t){return(0,e.forwardRef)(function(n,i){var r=(0,e.useContext)(fc);return t(n,r,i)})}),gc=e.createContext({});var yc={}.hasOwnProperty,_c="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",vc=function(e){var t=e.cache,n=e.serialized,i=e.isStringTag;return $l(t,n,i),pc(function(){return Ql(t,n,i)}),null},xc=mc(function(t,n,i){var r=t.css;"string"===typeof r&&void 0!==n.registered[r]&&(r=n.registered[r]);var o=t[_c],s=[r],a="";"string"===typeof t.className?a=Jl(n.registered,s,t.className):null!=t.className&&(a=t.className+" ");var l=hc(s,void 0,e.useContext(gc));a+=n.key+"-"+l.name;var c={};for(var u in t)yc.call(t,u)&&"css"!==u&&u!==_c&&(c[u]=t[u]);return c.className=a,i&&(c.ref=i),e.createElement(e.Fragment,null,e.createElement(vc,{cache:n,serialized:l,isStringTag:"string"===typeof o}),e.createElement(o,c))}),bc=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,wc=tc(function(e){return bc.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91}),Sc=function(e){return"theme"!==e},Tc=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?wc:Sc},Ec=function(e,t,n){var i;if(t){var r=t.shouldForwardProp;i=e.__emotion_forwardProp&&r?function(t){return e.__emotion_forwardProp(t)&&r(t)}:r}return"function"!==typeof i&&n&&(i=e.__emotion_forwardProp),i},Ac=function(e){var t=e.cache,n=e.serialized,i=e.isStringTag;return $l(t,n,i),pc(function(){return Ql(t,n,i)}),null},Mc=function t(n,i){var r,o,s=n.__emotion_real===n,a=s&&n.__emotion_base||n;void 0!==i&&(r=i.label,o=i.target);var l=Ec(n,i,s),c=l||Tc(a),u=!c("as");return function(){var h=arguments,d=s&&void 0!==n.__emotion_styles?n.__emotion_styles.slice(0):[];if(void 0!==r&&d.push("label:"+r+";"),null==h[0]||void 0===h[0].raw)d.push.apply(d,h);else{var p=h[0];d.push(p[0]);for(var f=h.length,m=1;m<f;m++)d.push(h[m],p[m])}var g=mc(function(t,n,i){var r=u&&t.as||a,s="",h=[],p=t;if(null==t.theme){for(var f in p={},t)p[f]=t[f];p.theme=e.useContext(gc)}"string"===typeof t.className?s=Jl(n.registered,h,t.className):null!=t.className&&(s=t.className+" ");var m=hc(d.concat(h),n.registered,p);s+=n.key+"-"+m.name,void 0!==o&&(s+=" "+o);var g=u&&void 0===l?Tc(r):c,y={};for(var _ in t)u&&"as"===_||g(_)&&(y[_]=t[_]);return y.className=s,i&&(y.ref=i),e.createElement(e.Fragment,null,e.createElement(Ac,{cache:n,serialized:m,isStringTag:"string"===typeof r}),e.createElement(r,y))});return g.displayName=void 0!==r?r:"Styled("+("string"===typeof a?a:a.displayName||a.name||"Component")+")",g.defaultProps=n.defaultProps,g.__emotion_real=g,g.__emotion_base=a,g.__emotion_styles=d,g.__emotion_forwardProp=l,Object.defineProperty(g,"toString",{value:function(){return"."+o}}),g.withComponent=function(e,n){return t(e,Xa({},i,n,{shouldForwardProp:Ec(g,n,!0)})).apply(void 0,d)},g}}.bind(null);function kc(e,t){return Mc(e,t)}["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach(function(e){Mc[e]=Mc(e)});const Cc=[];function Pc(e){return Cc[0]=e,hc(Cc)}function Ic(e){const t=new URL("https://mui.com/production-error/?code=".concat(e));for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.forEach(e=>t.searchParams.append("args[]",e)),"Minified MUI error #".concat(e,"; visit ").concat(t," for the full message.")}function Dc(e){if("string"!==typeof e)throw new Error(Ic(7));return e.charAt(0).toUpperCase()+e.slice(1)}var zc=n(191);function Rc(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Lc(t){if(e.isValidElement(t)||(0,zc.Hy)(t)||!Rc(t))return t;const n={};return Object.keys(t).forEach(e=>{n[e]=Lc(t[e])}),n}function Oc(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0};const r=i.clone?l({},t):t;return Rc(t)&&Rc(n)&&Object.keys(n).forEach(o=>{e.isValidElement(n[o])||(0,zc.Hy)(n[o])?r[o]=n[o]:Rc(n[o])&&Object.prototype.hasOwnProperty.call(t,o)&&Rc(t[o])?r[o]=Oc(t[o],n[o],i):i.clone?r[o]=Rc(n[o])?Lc(n[o]):n[o]:r[o]=n[o]}),r}const Fc=function(e,t){return t?Oc(e,t,{clone:!1}):e};function Bc(e,t){if(!e.containerQueries)return t;const n=Object.keys(t).filter(e=>e.startsWith("@container")).sort((e,t)=>{var n,i;const r=/min-width:\s*([0-9.]+)/;return+((null===(n=e.match(r))||void 0===n?void 0:n[1])||0)-+((null===(i=t.match(r))||void 0===i?void 0:i[1])||0)});return n.length?n.reduce((e,n)=>{const i=t[n];return delete e[n],e[n]=i,e},l({},t)):t}const Nc={xs:0,sm:600,md:900,lg:1200,xl:1536},jc={keys:["xs","sm","md","lg","xl"],up:e=>"@media (min-width:".concat(Nc[e],"px)")},Vc={containerQueries:e=>({up:t=>{let n="number"===typeof t?t:Nc[t]||t;return"number"===typeof n&&(n="".concat(n,"px")),e?"@container ".concat(e," (min-width:").concat(n,")"):"@container (min-width:".concat(n,")")}})};function Uc(e,t,n){const i=e.theme||{};if(Array.isArray(t)){const e=i.breakpoints||jc;return t.reduce((i,r,o)=>(i[e.up(e.keys[o])]=n(t[o]),i),{})}if("object"===typeof t){const e=i.breakpoints||jc;return Object.keys(t).reduce((r,o)=>{if(function(e,t){return"@"===t||t.startsWith("@")&&(e.some(e=>t.startsWith("@".concat(e)))||!!t.match(/^@\d/))}(e.keys,o)){const e=function(e,t){const n=t.match(/^@([^/]+)?\/?(.+)?$/);if(!n)return null;const[,i,r]=n,o=Number.isNaN(+i)?i||0:+i;return e.containerQueries(r).up(o)}(i.containerQueries?i:Vc,o);e&&(r[e]=n(t[o],o))}else if(Object.keys(e.values||Nc).includes(o)){r[e.up(o)]=n(t[o],o)}else{const e=o;r[e]=t[e]}return r},{})}return n(t)}function Gc(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(null===(e=t.keys)||void 0===e?void 0:e.reduce((e,n)=>(e[t.up(n)]={},e),{}))||{}}function qc(e,t){return e.reduce((e,t)=>{const n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e},t)}function Wc(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){const n="vars.".concat(t).split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e);if(null!=n)return n}return t.split(".").reduce((e,t)=>e&&null!=e[t]?e[t]:null,e)}function Zc(e,t,n){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return i="function"===typeof e?e(n):Array.isArray(e)?e[n]||r:Wc(e,n)||r,t&&(i=t(i,r,e)),i}const Hc=function(e){const{prop:t,cssProperty:n=e.prop,themeKey:i,transform:r}=e,o=e=>{if(null==e[t])return null;const o=e[t],s=Wc(e.theme,i)||{};return Uc(e,o,e=>{let i=Zc(s,r,e);return e===i&&"string"===typeof e&&(i=Zc(s,r,"".concat(t).concat("default"===e?"":Dc(e)),e)),!1===n?i:{[n]:i}})};return o.propTypes={},o.filterProps=[t],o};const Xc={m:"margin",p:"padding"},Yc={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},Kc={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},Jc=function(e){const t={};return n=>(void 0===t[n]&&(t[n]=e(n)),t[n])}(e=>{if(e.length>2){if(!Kc[e])return[e];e=Kc[e]}const[t,n]=e.split(""),i=Xc[t],r=Yc[n]||"";return Array.isArray(r)?r.map(e=>i+e):[i+r]}),$c=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],Qc=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],eu=[...$c,...Qc];function tu(e,t,n,i){var r;const o=null!==(r=Wc(e,t,!0))&&void 0!==r?r:n;return"number"===typeof o||"string"===typeof o?e=>"string"===typeof e?e:"string"===typeof o?o.startsWith("var(")&&0===e?0:o.startsWith("var(")&&1===e?o:"calc(".concat(e," * ").concat(o,")"):o*e:Array.isArray(o)?e=>{if("string"===typeof e)return e;const t=Math.abs(e);const n=o[t];return e>=0?n:"number"===typeof n?-n:"string"===typeof n&&n.startsWith("var(")?"calc(-1 * ".concat(n,")"):"-".concat(n)}:"function"===typeof o?o:()=>{}}function nu(e){return tu(e,"spacing",8)}function iu(e,t){return"string"===typeof t||null==t?t:e(t)}function ru(e,t,n,i){if(!t.includes(n))return null;const r=function(e,t){return n=>e.reduce((e,i)=>(e[i]=iu(t,n),e),{})}(Jc(n),i);return Uc(e,e[n],r)}function ou(e,t){const n=nu(e.theme);return Object.keys(e).map(i=>ru(e,t,i,n)).reduce(Fc,{})}function su(e){return ou(e,$c)}function au(e){return ou(e,Qc)}function lu(e){return ou(e,eu)}su.propTypes={},su.filterProps=$c,au.propTypes={},au.filterProps=Qc,lu.propTypes={},lu.filterProps=eu;const cu=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.reduce((e,t)=>(t.filterProps.forEach(n=>{e[n]=t}),e),{}),r=e=>Object.keys(e).reduce((t,n)=>i[n]?Fc(t,i[n](e)):t,{});return r.propTypes={},r.filterProps=t.reduce((e,t)=>e.concat(t.filterProps),[]),r};function uu(e){return"number"!==typeof e?e:"".concat(e,"px solid")}function hu(e,t){return Hc({prop:e,themeKey:"borders",transform:t})}const du=hu("border",uu),pu=hu("borderTop",uu),fu=hu("borderRight",uu),mu=hu("borderBottom",uu),gu=hu("borderLeft",uu),yu=hu("borderColor"),_u=hu("borderTopColor"),vu=hu("borderRightColor"),xu=hu("borderBottomColor"),bu=hu("borderLeftColor"),wu=hu("outline",uu),Su=hu("outlineColor"),Tu=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=tu(e.theme,"shape.borderRadius",4),n=e=>({borderRadius:iu(t,e)});return Uc(e,e.borderRadius,n)}return null};Tu.propTypes={},Tu.filterProps=["borderRadius"];cu(du,pu,fu,mu,gu,yu,_u,vu,xu,bu,Tu,wu,Su);const Eu=e=>{if(void 0!==e.gap&&null!==e.gap){const t=tu(e.theme,"spacing",8),n=e=>({gap:iu(t,e)});return Uc(e,e.gap,n)}return null};Eu.propTypes={},Eu.filterProps=["gap"];const Au=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=tu(e.theme,"spacing",8),n=e=>({columnGap:iu(t,e)});return Uc(e,e.columnGap,n)}return null};Au.propTypes={},Au.filterProps=["columnGap"];const Mu=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=tu(e.theme,"spacing",8),n=e=>({rowGap:iu(t,e)});return Uc(e,e.rowGap,n)}return null};Mu.propTypes={},Mu.filterProps=["rowGap"];cu(Eu,Au,Mu,Hc({prop:"gridColumn"}),Hc({prop:"gridRow"}),Hc({prop:"gridAutoFlow"}),Hc({prop:"gridAutoColumns"}),Hc({prop:"gridAutoRows"}),Hc({prop:"gridTemplateColumns"}),Hc({prop:"gridTemplateRows"}),Hc({prop:"gridTemplateAreas"}),Hc({prop:"gridArea"}));function ku(e,t){return"grey"===t?t:e}cu(Hc({prop:"color",themeKey:"palette",transform:ku}),Hc({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:ku}),Hc({prop:"backgroundColor",themeKey:"palette",transform:ku}));function Cu(e){return e<=1&&0!==e?"".concat(100*e,"%"):e}const Pu=Hc({prop:"width",transform:Cu}),Iu=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var n,i;const r=(null===(n=e.theme)||void 0===n||null===(n=n.breakpoints)||void 0===n||null===(n=n.values)||void 0===n?void 0:n[t])||Nc[t];return r?"px"!==(null===(i=e.theme)||void 0===i||null===(i=i.breakpoints)||void 0===i?void 0:i.unit)?{maxWidth:"".concat(r).concat(e.theme.breakpoints.unit)}:{maxWidth:r}:{maxWidth:Cu(t)}};return Uc(e,e.maxWidth,t)}return null};Iu.filterProps=["maxWidth"];const Du=Hc({prop:"minWidth",transform:Cu}),zu=Hc({prop:"height",transform:Cu}),Ru=Hc({prop:"maxHeight",transform:Cu}),Lu=Hc({prop:"minHeight",transform:Cu}),Ou=(Hc({prop:"size",cssProperty:"width",transform:Cu}),Hc({prop:"size",cssProperty:"height",transform:Cu}),cu(Pu,Iu,Du,zu,Ru,Lu,Hc({prop:"boxSizing"})),{border:{themeKey:"borders",transform:uu},borderTop:{themeKey:"borders",transform:uu},borderRight:{themeKey:"borders",transform:uu},borderBottom:{themeKey:"borders",transform:uu},borderLeft:{themeKey:"borders",transform:uu},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:uu},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:Tu},color:{themeKey:"palette",transform:ku},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:ku},backgroundColor:{themeKey:"palette",transform:ku},p:{style:au},pt:{style:au},pr:{style:au},pb:{style:au},pl:{style:au},px:{style:au},py:{style:au},padding:{style:au},paddingTop:{style:au},paddingRight:{style:au},paddingBottom:{style:au},paddingLeft:{style:au},paddingX:{style:au},paddingY:{style:au},paddingInline:{style:au},paddingInlineStart:{style:au},paddingInlineEnd:{style:au},paddingBlock:{style:au},paddingBlockStart:{style:au},paddingBlockEnd:{style:au},m:{style:su},mt:{style:su},mr:{style:su},mb:{style:su},ml:{style:su},mx:{style:su},my:{style:su},margin:{style:su},marginTop:{style:su},marginRight:{style:su},marginBottom:{style:su},marginLeft:{style:su},marginX:{style:su},marginY:{style:su},marginInline:{style:su},marginInlineStart:{style:su},marginInlineEnd:{style:su},marginBlock:{style:su},marginBlockStart:{style:su},marginBlockEnd:{style:su},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:Eu},rowGap:{style:Mu},columnGap:{style:Au},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Cu},maxWidth:{style:Iu},minWidth:{transform:Cu},height:{transform:Cu},maxHeight:{transform:Cu},minHeight:{transform:Cu},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}});const Fu=function(){function e(e,t,n,i){const r={[e]:t,theme:n},o=i[e];if(!o)return{[e]:t};const{cssProperty:s=e,themeKey:a,transform:l,style:c}=o;if(null==t)return null;if("typography"===a&&"inherit"===t)return{[e]:t};const u=Wc(n,a)||{};if(c)return c(r);return Uc(r,t,t=>{let n=Zc(u,l,t);return t===n&&"string"===typeof t&&(n=Zc(u,l,"".concat(e).concat("default"===t?"":Dc(t)),t)),!1===s?n:{[s]:n}})}return function t(n){var i;const{sx:r,theme:o={},nested:s}=n||{};if(!r)return null;const a=null!==(i=o.unstable_sxConfig)&&void 0!==i?i:Ou;function l(n){let i=n;if("function"===typeof n)i=n(o);else if("object"!==typeof n)return n;if(!i)return null;const r=Gc(o.breakpoints),l=Object.keys(r);let c=r;return Object.keys(i).forEach(n=>{const r=function(e,t){return"function"===typeof e?e(t):e}(i[n],o);if(null!==r&&void 0!==r)if("object"===typeof r)if(a[n])c=Fc(c,e(n,r,o,a));else{const e=Uc({theme:o},r,e=>({[n]:e}));!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.reduce((e,t)=>e.concat(Object.keys(t)),[]),r=new Set(i);return t.every(e=>r.size===Object.keys(e).length)}(e,r)?c=Fc(c,e):c[n]=t({sx:r,theme:o,nested:!0})}else c=Fc(c,e(n,r,o,a))}),!s&&o.modularCssLayers?{"@layer sx":Bc(o,qc(l,c))}:Bc(o,qc(l,c))}return Array.isArray(r)?r.map(l):l(r)}}();Fu.filterProps=["sx"];const Bu=Fu,Nu=["sx"];function ju(e){const{sx:t}=e,n=u(e,Nu),{systemProps:i,otherProps:r}=(e=>{var t,n;const i={systemProps:{},otherProps:{}},r=null!==(t=null===e||void 0===e||null===(n=e.theme)||void 0===n?void 0:n.unstable_sxConfig)&&void 0!==t?t:Ou;return Object.keys(e).forEach(t=>{r[t]?i.systemProps[t]=e[t]:i.otherProps[t]=e[t]}),i})(n);let o;return o=Array.isArray(t)?[i,...t]:"function"===typeof t?function(){const e=t(...arguments);return Rc(e)?l(l({},i),e):i}:l(l({},i),t),l(l({},r),{},{sx:o})}const Vu=["values","unit","step"];function Uu(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:i=5}=e,r=u(e,Vu),o=(e=>{const t=Object.keys(e).map(t=>({key:t,val:e[t]}))||[];return t.sort((e,t)=>e.val-t.val),t.reduce((e,t)=>l(l({},e),{},{[t.key]:t.val}),{})})(t),s=Object.keys(o);function a(e){const i="number"===typeof t[e]?t[e]:e;return"@media (min-width:".concat(i).concat(n,")")}function c(e){const r="number"===typeof t[e]?t[e]:e;return"@media (max-width:".concat(r-i/100).concat(n,")")}function h(e,r){const o=s.indexOf(r);return"@media (min-width:".concat("number"===typeof t[e]?t[e]:e).concat(n,") and ")+"(max-width:".concat((-1!==o&&"number"===typeof t[s[o]]?t[s[o]]:r)-i/100).concat(n,")")}return l({keys:s,values:o,up:a,down:c,between:h,only:function(e){return s.indexOf(e)+1<s.length?h(e,s[s.indexOf(e)+1]):a(e)},not:function(e){const t=s.indexOf(e);return 0===t?a(s[1]):t===s.length-1?c(s[t]):h(e,s[s.indexOf(e)+1]).replace("@media","@media not all and")},unit:n},r)}const Gu={borderRadius:4};function qu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nu({spacing:e});if(e.mui)return e;const n=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0===n.length?[1]:n).map(e=>{const n=t(e);return"number"===typeof n?"".concat(n,"px"):n}).join(" ")};return n.mui=!0,n}function Wu(e,t){const n=this;if(n.vars){var i;if(null===(i=n.colorSchemes)||void 0===i||!i[e]||"function"!==typeof n.getColorSchemeSelector)return{};let r=n.getColorSchemeSelector(e);return"&"===r?t:((r.includes("data-")||r.includes("."))&&(r="*:where(".concat(r.replace(/\s*&$/,""),") &")),{[r]:t})}return n.palette.mode===e?t:{}}const Zu=["breakpoints","palette","spacing","shape"];const Hu=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t={},palette:n={},spacing:i,shape:r={}}=e,o=u(e,Zu),s=Uu(t),a=qu(i);let c=Oc({breakpoints:s,direction:"ltr",components:{},palette:l({mode:"light"},n),spacing:a,shape:l(l({},Gu),r)},o);c=function(e){const t=(e,t)=>e.replace("@media",t?"@container ".concat(t):"@container");function n(n,i){n.up=function(){return t(e.breakpoints.up(...arguments),i)},n.down=function(){return t(e.breakpoints.down(...arguments),i)},n.between=function(){return t(e.breakpoints.between(...arguments),i)},n.only=function(){return t(e.breakpoints.only(...arguments),i)},n.not=function(){const n=t(e.breakpoints.not(...arguments),i);return n.includes("not all and")?n.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):n}}const i={},r=e=>(n(i,e),i);return n(r),l(l({},e),{},{containerQueries:r})}(c),c.applyStyles=Wu;for(var h=arguments.length,d=new Array(h>1?h-1:0),p=1;p<h;p++)d[p-1]=arguments[p];return c=d.reduce((e,t)=>Oc(e,t),c),c.unstable_sxConfig=l(l({},Ou),null===o||void 0===o?void 0:o.unstable_sxConfig),c.unstable_sx=function(e){return Bu({sx:e,theme:this})},c};const Xu=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n=e.useContext(gc);return n&&(i=n,0!==Object.keys(i).length)?n:t;var i},Yu=Hu();const Ku=function(){return Xu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yu)},Ju=["className","component"];const $u=e=>e,Qu=(()=>{let e=$u;return{configure(t){e=t},generate:t=>e(t),reset(){e=$u}}})();const eh=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MIN_SAFE_INTEGER,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER;return Math.max(t,Math.min(e,n))};function th(e){return eh(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)}function nh(e){if(e.type)return e;if("#"===e.charAt(0))return nh(function(e){e=e.slice(1);const t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map(e=>e+e)),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3).join(", "),")"):""}(e));const t=e.indexOf("("),n=e.substring(0,t);if(!["rgb","rgba","hsl","hsla","color"].includes(n))throw new Error(Ic(9,e));let i,r=e.substring(t+1,e.length-1);if("color"===n){if(r=r.split(" "),i=r.shift(),4===r.length&&"/"===r[3].charAt(0)&&(r[3]=r[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(i))throw new Error(Ic(10,i))}else r=r.split(",");return r=r.map(e=>parseFloat(e)),{type:n,values:r,colorSpace:i}}const ih=(e,t)=>{try{return(e=>{const t=nh(e);return t.values.slice(0,3).map((e,n)=>t.type.includes("hsl")&&0!==n?"".concat(e,"%"):e).join(" ")})(e)}catch(n){return e}};function rh(e){const{type:t,colorSpace:n}=e;let{values:i}=e;return t.includes("rgb")?i=i.map((e,t)=>t<3?parseInt(e,10):e):t.includes("hsl")&&(i[1]="".concat(i[1],"%"),i[2]="".concat(i[2],"%")),i=t.includes("color")?"".concat(n," ").concat(i.join(" ")):"".concat(i.join(", ")),"".concat(t,"(").concat(i,")")}function oh(e){e=nh(e);const{values:t}=e,n=t[0],i=t[1]/100,r=t[2]/100,o=i*Math.min(r,1-r),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return r-o*Math.max(Math.min(t-3,9-t,1),-1)};let a="rgb";const l=[Math.round(255*s(0)),Math.round(255*s(8)),Math.round(255*s(4))];return"hsla"===e.type&&(a+="a",l.push(t[3])),rh({type:a,values:l})}function sh(e){let t="hsl"===(e=nh(e)).type||"hsla"===e.type?nh(oh(e)).values:e.values;return t=t.map(t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4)),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function ah(e,t){return e=nh(e),t=th(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]="/".concat(t):e.values[3]=t,rh(e)}function lh(e,t,n){try{return ah(e,t)}catch(i){return e}}function ch(e,t){if(e=nh(e),t=th(t),e.type.includes("hsl"))e.values[2]*=1-t;else if(e.type.includes("rgb")||e.type.includes("color"))for(let n=0;n<3;n+=1)e.values[n]*=1-t;return rh(e)}function uh(e,t,n){try{return ch(e,t)}catch(i){return e}}function hh(e,t){if(e=nh(e),t=th(t),e.type.includes("hsl"))e.values[2]+=(100-e.values[2])*t;else if(e.type.includes("rgb"))for(let n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(e.type.includes("color"))for(let n=0;n<3;n+=1)e.values[n]+=(1-e.values[n])*t;return rh(e)}function dh(e,t,n){try{return hh(e,t)}catch(i){return e}}function ph(e,t,n){try{return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;return sh(e)>.5?ch(e,t):hh(e,t)}(e,t)}catch(i){return e}}const fh={black:"#000",white:"#fff"},mh={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},gh={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},yh={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},_h={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},vh={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},xh={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},bh={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},wh=["mode","contrastThreshold","tonalOffset","colorSpace"];function Sh(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:fh.white,default:fh.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const Th=Sh();function Eh(){return{text:{primary:fh.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:fh.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const Ah=Eh();function Mh(e,t,n,i){const r=i.light||i,o=i.dark||1.5*i;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=hh(e.main,r):"dark"===t&&(e.dark=ch(e.main,o)))}function kh(e,t,n,i,r){const o=r.light||r,s=r.dark||1.5*r;t[n]||(t.hasOwnProperty(i)?t[n]=t[i]:"light"===n?t.light="color-mix(in ".concat(e,", ").concat(t.main,", #fff ").concat((100*o).toFixed(0),"%)"):"dark"===n&&(t.dark="color-mix(in ".concat(e,", ").concat(t.main,", #000 ").concat((100*s).toFixed(0),"%)")))}function Ch(e){const{mode:t="light",contrastThreshold:n=3,tonalOffset:i=.2,colorSpace:r}=e,o=u(e,wh),s=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:vh[200],light:vh[50],dark:vh[400]}:{main:vh[700],light:vh[400],dark:vh[800]}}(t),a=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:gh[200],light:gh[50],dark:gh[400]}:{main:gh[500],light:gh[300],dark:gh[700]}}(t),c=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:yh[500],light:yh[300],dark:yh[700]}:{main:yh[700],light:yh[400],dark:yh[800]}}(t),h=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:xh[400],light:xh[300],dark:xh[700]}:{main:xh[700],light:xh[500],dark:xh[900]}}(t),d=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:bh[400],light:bh[300],dark:bh[700]}:{main:bh[800],light:bh[500],dark:bh[900]}}(t),p=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:_h[400],light:_h[300],dark:_h[700]}:{main:"#ed6c02",light:_h[500],dark:_h[900]}}(t);function f(e){if(r)return function(e){return"oklch(from ".concat(e," var(--__l) 0 h / var(--__a))")}(e);const t=function(e,t){const n=sh(e),i=sh(t);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)}(e,Ah.text.primary)>=n?Ah.text.primary:Th.text.primary;return t}const m=e=>{let{color:t,name:n,mainShade:o=500,lightShade:s=300,darkShade:a=700}=e;if(t=l({},t),!t.main&&t[o]&&(t.main=t[o]),!t.hasOwnProperty("main"))throw new Error(Ic(11,n?" (".concat(n,")"):"",o));if("string"!==typeof t.main)throw new Error(Ic(12,n?" (".concat(n,")"):"",JSON.stringify(t.main)));return r?(kh(r,t,"light",s,i),kh(r,t,"dark",a,i)):(Mh(t,"light",s,i),Mh(t,"dark",a,i)),t.contrastText||(t.contrastText=f(t.main)),t};let g;"light"===t?g=Sh():"dark"===t&&(g=Eh());return Oc(l({common:l({},fh),mode:t,primary:m({color:s,name:"primary"}),secondary:m({color:a,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:m({color:c,name:"error"}),warning:m({color:p,name:"warning"}),info:m({color:h,name:"info"}),success:m({color:d,name:"success"}),grey:mh,contrastThreshold:n,getContrastText:f,augmentColor:m,tonalOffset:i},g),o)}function Ph(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";function t(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];if(!i.length)return"";const o=i[0];return"string"!==typeof o||o.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?", ".concat(o):", var(--".concat(e?"".concat(e,"-"):"").concat(o).concat(t(...i.slice(1)),")")}return function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return"var(--".concat(e?"".concat(e,"-"):"").concat(n).concat(t(...r),")")}}function Ih(e){const t={};return Object.entries(e).forEach(e=>{const[n,i]=e;"object"===typeof i&&(t[n]="".concat(i.fontStyle?"".concat(i.fontStyle," "):"").concat(i.fontVariant?"".concat(i.fontVariant," "):"").concat(i.fontWeight?"".concat(i.fontWeight," "):"").concat(i.fontStretch?"".concat(i.fontStretch," "):"").concat(i.fontSize||"").concat(i.lineHeight?"/".concat(i.lineHeight," "):"").concat(i.fontFamily||""))}),t}const Dh=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=e;t.forEach((e,o)=>{o===t.length-1?Array.isArray(r)?r[Number(e)]=n:r&&"object"===typeof r&&(r[e]=n):r&&"object"===typeof r&&(r[e]||(r[e]=i.includes(e)?[]:{}),r=r[e])})};function zh(e,t){const{prefix:n,shouldSkipGeneratingVar:i}=t||{},r={},o={},s={};var a,l;return a=(e,t,a)=>{if(("string"===typeof t||"number"===typeof t)&&(!i||!i(e,t))){const i="--".concat(n?"".concat(n,"-"):"").concat(e.join("-")),l=((e,t)=>"number"===typeof t?["lineHeight","fontWeight","opacity","zIndex"].some(t=>e.includes(t))||e[e.length-1].toLowerCase().includes("opacity")?t:"".concat(t,"px"):t)(e,t);Object.assign(r,{[i]:l}),Dh(o,e,"var(".concat(i,")"),a),Dh(s,e,"var(".concat(i,", ").concat(l,")"),a)}},l=e=>"vars"===e[0],function e(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object.entries(t).forEach(t=>{let[r,o]=t;(!l||l&&!l([...n,r]))&&void 0!==o&&null!==o&&("object"===typeof o&&Object.keys(o).length>0?e(o,[...n,r],Array.isArray(o)?[...i,r]:i):a([...n,r],o,i))})}(e),{css:r,vars:o,varsWithDefaults:s}}const Rh=["colorSchemes","components","defaultColorScheme"];const Lh=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{getSelector:n=x,disableCssColorScheme:i,colorSchemeSelector:r,enableContrastVars:s}=t,{colorSchemes:a={},components:c,defaultColorScheme:h="light"}=e,d=u(e,Rh),{vars:p,css:f,varsWithDefaults:m}=zh(d,t);let g=m;const y={},{[h]:_}=a,v=u(a,[h].map(o));if(Object.entries(v||{}).forEach(e=>{let[n,i]=e;const{vars:r,css:o,varsWithDefaults:s}=zh(i,t);g=Oc(g,s),y[n]={css:o,vars:r}}),_){const{css:e,vars:n,varsWithDefaults:i}=zh(_,t);g=Oc(g,i),y[h]={css:e,vars:n}}function x(t,n){let i=r;if("class"===r&&(i=".%s"),"data"===r&&(i="[data-%s]"),null!==r&&void 0!==r&&r.startsWith("data-")&&!r.includes("%s")&&(i="[".concat(r,'="%s"]')),t){if("media"===i){var o;if(e.defaultColorScheme===t)return":root";const i=(null===(o=a[t])||void 0===o||null===(o=o.palette)||void 0===o?void 0:o.mode)||t;return{["@media (prefers-color-scheme: ".concat(i,")")]:{":root":n}}}if(i)return e.defaultColorScheme===t?":root, ".concat(i.replace("%s",String(t))):i.replace("%s",String(t))}return":root"}return{vars:g,generateThemeVars:()=>{let e=l({},p);return Object.entries(y).forEach(t=>{let[,{vars:n}]=t;e=Oc(e,n)}),e},generateStyleSheets:()=>{const t=[],r=e.defaultColorScheme||"light";function c(e,n){Object.keys(n).length&&t.push("string"===typeof e?{[e]:l({},n)}:e)}c(n(void 0,l({},f)),f);const{[r]:h}=y,d=u(y,[r].map(o));if(h){var p;const{css:e}=h,t=null===(p=a[r])||void 0===p||null===(p=p.palette)||void 0===p?void 0:p.mode,o=l(!i&&t?{colorScheme:t}:{},e);c(n(r,l({},o)),o)}return Object.entries(d).forEach(e=>{var t;let[r,{css:o}]=e;const s=null===(t=a[r])||void 0===t||null===(t=t.palette)||void 0===t?void 0:t.mode,u=l(!i&&s?{colorScheme:s}:{},o);c(n(r,l({},u)),u)}),s&&t.push({":root":{"--__l-threshold":"0.7","--__l":"clamp(0, (l / var(--__l-threshold) - 1) * -infinity, 1)","--__a":"clamp(0.87, (l / var(--__l-threshold) - 1) * -infinity, 1)"}}),t}}};function Oh(e,t){return l({toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}}},t)}const Fh=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];const Bh={textTransform:"uppercase"},Nh='"Roboto", "Helvetica", "Arial", sans-serif';function jh(e,t){const n="function"===typeof t?t(e):t,{fontFamily:i=Nh,fontSize:r=14,fontWeightLight:o=300,fontWeightRegular:s=400,fontWeightMedium:a=500,fontWeightBold:c=700,htmlFontSize:h=16,allVariants:d,pxToRem:p}=n,f=u(n,Fh);const m=r/14,g=p||(e=>"".concat(e/h*m,"rem")),y=(e,t,n,r,o)=>{return l(l(l({fontFamily:i,fontWeight:e,fontSize:g(t),lineHeight:n},i===Nh?{letterSpacing:"".concat((s=r/t,Math.round(1e5*s)/1e5),"em")}:{}),o),d);var s},_={h1:y(o,96,1.167,-1.5),h2:y(o,60,1.2,-.5),h3:y(s,48,1.167,0),h4:y(s,34,1.235,.25),h5:y(s,24,1.334,0),h6:y(a,20,1.6,.15),subtitle1:y(s,16,1.75,.15),subtitle2:y(a,14,1.57,.1),body1:y(s,16,1.5,.15),body2:y(s,14,1.43,.15),button:y(a,14,1.75,.4,Bh),caption:y(s,12,1.66,.4),overline:y(s,12,2.66,1,Bh),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Oc(l({htmlFontSize:h,pxToRem:g,fontFamily:i,fontSize:r,fontWeightLight:o,fontWeightRegular:s,fontWeightMedium:a,fontWeightBold:c},_),f,{clone:!1})}function Vh(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}const Uh=["none",Vh(0,2,1,-1,0,1,1,0,0,1,3,0),Vh(0,3,1,-2,0,2,2,0,0,1,5,0),Vh(0,3,3,-2,0,3,4,0,0,1,8,0),Vh(0,2,4,-1,0,4,5,0,0,1,10,0),Vh(0,3,5,-1,0,5,8,0,0,1,14,0),Vh(0,3,5,-1,0,6,10,0,0,1,18,0),Vh(0,4,5,-2,0,7,10,1,0,2,16,1),Vh(0,5,5,-3,0,8,10,1,0,3,14,2),Vh(0,5,6,-3,0,9,12,1,0,3,16,2),Vh(0,6,6,-3,0,10,14,1,0,4,18,3),Vh(0,6,7,-4,0,11,15,1,0,4,20,3),Vh(0,7,8,-4,0,12,17,2,0,5,22,4),Vh(0,7,8,-4,0,13,19,2,0,5,24,4),Vh(0,7,9,-4,0,14,21,2,0,5,26,4),Vh(0,8,9,-5,0,15,22,2,0,6,28,5),Vh(0,8,10,-5,0,16,24,2,0,6,30,5),Vh(0,8,11,-5,0,17,26,2,0,6,32,5),Vh(0,9,11,-5,0,18,28,2,0,7,34,6),Vh(0,9,12,-6,0,19,29,2,0,7,36,6),Vh(0,10,13,-6,0,20,31,3,0,8,38,7),Vh(0,10,13,-6,0,21,33,3,0,8,40,7),Vh(0,10,14,-6,0,22,35,3,0,8,42,7),Vh(0,11,14,-7,0,23,36,3,0,9,44,8),Vh(0,11,15,-7,0,24,38,3,0,9,46,8)],Gh=["duration","easing","delay"],qh={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},Wh={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function Zh(e){return"".concat(Math.round(e),"ms")}function Hh(e){if(!e)return 0;const t=e/36;return Math.min(Math.round(10*(4+15*t**.25+t/5)),3e3)}function Xh(e){const t=l(l({},qh),e.easing),n=l(l({},Wh),e.duration);return l(l({getAutoHeightDuration:Hh,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:r=n.standard,easing:o=t.easeInOut,delay:s=0}=i;u(i,Gh);return(Array.isArray(e)?e:[e]).map(e=>"".concat(e," ").concat("string"===typeof r?r:Zh(r)," ").concat(o," ").concat("string"===typeof s?s:Zh(s))).join(",")}},e),{},{easing:t,duration:n})}const Yh={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function Kh(e){return Rc(e)||"undefined"===typeof e||"string"===typeof e||"boolean"===typeof e||"number"===typeof e||Array.isArray(e)}function Jh(){const e=l({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return function e(t){const n=Object.entries(t);for(let i=0;i<n.length;i++){const[r,o]=n[i];!Kh(o)||r.startsWith("unstable_")?delete t[r]:Rc(o)&&(t[r]=l({},o),e(t[r]))}}(e),"import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';\n\nconst theme = ".concat(JSON.stringify(e,null,2),";\n\ntheme.breakpoints = createBreakpoints(theme.breakpoints || {});\ntheme.transitions = createTransitions(theme.transitions || {});\n\nexport default theme;")}const $h=["breakpoints","mixins","spacing","palette","transitions","typography","shape","colorSpace"];function Qh(e){return"number"===typeof e?"".concat((100*e).toFixed(0),"%"):"calc((".concat(e,") * 100%)")}function ed(e){Object.assign(e,{alpha(t,n){const i=this||e;return i.colorSpace?"oklch(from ".concat(t," l c h / ").concat("string"===typeof n?"calc(".concat(n,")"):n,")"):i.vars?"rgba(".concat(t.replace(/var\(--([^,\s)]+)(?:,[^)]+)?\)+/g,"var(--$1Channel)")," / ").concat("string"===typeof n?"calc(".concat(n,")"):n,")"):ah(t,(e=>{if(!Number.isNaN(+e))return+e;const t=e.match(/\d*\.?\d+/g);if(!t)return 0;let n=0;for(let i=0;i<t.length;i+=1)n+=+t[i];return n})(n))},lighten(t,n){const i=this||e;return i.colorSpace?"color-mix(in ".concat(i.colorSpace,", ").concat(t,", #fff ").concat(Qh(n),")"):hh(t,n)},darken(t,n){const i=this||e;return i.colorSpace?"color-mix(in ".concat(i.colorSpace,", ").concat(t,", #000 ").concat(Qh(n),")"):ch(t,n)}})}const td=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t,mixins:n={},spacing:i,palette:r={},transitions:o={},typography:s={},shape:a,colorSpace:c}=e,h=u(e,$h);if(e.vars&&void 0===e.generateThemeVars)throw new Error(Ic(20));const d=Ch(l(l({},r),{},{colorSpace:c})),p=Hu(e);let f=Oc(p,{mixins:Oh(p.breakpoints,n),palette:d,shadows:Uh.slice(),typography:jh(d,s),transitions:Xh(o),zIndex:l({},Yh)});f=Oc(f,h);for(var m=arguments.length,g=new Array(m>1?m-1:0),y=1;y<m;y++)g[y-1]=arguments[y];return f=g.reduce((e,t)=>Oc(e,t),f),f.unstable_sxConfig=l(l({},Ou),null===h||void 0===h?void 0:h.unstable_sxConfig),f.unstable_sx=function(e){return Bu({sx:e,theme:this})},f.toRuntimeSource=Jh,ed(f),f};function nd(e){let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,Math.round(10*t)/1e3}const id=["palette","opacity","overlays","colorSpace"],rd=[...Array(25)].map((e,t)=>{if(0===t)return"none";const n=nd(t);return"linear-gradient(rgba(255 255 255 / ".concat(n,"), rgba(255 255 255 / ").concat(n,"))")});function od(e){return{inputPlaceholder:"dark"===e?.5:.42,inputUnderline:"dark"===e?.7:.42,switchTrackDisabled:"dark"===e?.2:.12,switchTrack:"dark"===e?.3:.38}}function sd(e){return"dark"===e?rd:[]}function ad(e){var t;return!!e[0].match(/(cssVarPrefix|colorSchemeSelector|modularCssLayers|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!e[0].match(/sxConfig$/)||"palette"===e[0]&&!(null===(t=e[1])||void 0===t||!t.match(/(mode|contrastThreshold|tonalOffset)/))}const ld=e=>[...[...Array(25)].map((t,n)=>"--".concat(e?"".concat(e,"-"):"","overlays-").concat(n)),"--".concat(e?"".concat(e,"-"):"","palette-AppBar-darkBg"),"--".concat(e?"".concat(e,"-"):"","palette-AppBar-darkColor")],cd=e=>(t,n)=>{const i=e.rootSelector||":root",r=e.colorSchemeSelector;let o=r;if("class"===r&&(o=".%s"),"data"===r&&(o="[data-%s]"),null!==r&&void 0!==r&&r.startsWith("data-")&&!r.includes("%s")&&(o="[".concat(r,'="%s"]')),e.defaultColorScheme===t){if("dark"===t){const r={};return ld(e.cssVarPrefix).forEach(e=>{r[e]=n[e],delete n[e]}),"media"===o?{[i]:n,"@media (prefers-color-scheme: dark)":{[i]:r}}:o?{[o.replace("%s",t)]:r,["".concat(i,", ").concat(o.replace("%s",t))]:n}:{[i]:l(l({},n),r)}}if(o&&"media"!==o)return"".concat(i,", ").concat(o.replace("%s",String(t)))}else if(t){if("media"===o)return{["@media (prefers-color-scheme: ".concat(String(t),")")]:{[i]:n}};if(o)return o.replace("%s",String(t))}return i},ud=["palette"],hd=["colorSchemes","defaultColorScheme","disableCssColorScheme","cssVarPrefix","nativeColor","shouldSkipGeneratingVar","colorSchemeSelector","rootSelector"];function dd(e,t,n){!e[t]&&n&&(e[t]=n)}function pd(e){return"string"===typeof e&&e.startsWith("hsl")?oh(e):e}function fd(e,t){"".concat(t,"Channel")in e||(e["".concat(t,"Channel")]=ih(pd(e[t]),("MUI: Can't create `palette.".concat(t,"Channel` because `palette.").concat(t,"` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color()."),"To suppress this warning, you need to explicitly provide the `palette.".concat(t,'Channel` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.'))))}const md=e=>{try{return e()}catch(t){}};function gd(e,t,n,i,r){var o,s,a;if(!n)return;n=!0===n?{}:n;const c="dark"===r?"dark":"light";var h;if(!i)return void(t[r]=function(e){const{palette:t={mode:"light"},opacity:n,overlays:i,colorSpace:r}=e,o=u(e,id),s=Ch(l(l({},t),{},{colorSpace:r}));return l({palette:s,opacity:l(l({},od(s.mode)),n),overlays:i||sd(s.mode)},o)}(l(l({},n),{},{palette:l({mode:c},null===(h=n)||void 0===h?void 0:h.palette),colorSpace:e})));const d=td(l(l({},i),{},{palette:l({mode:c},null===(o=n)||void 0===o?void 0:o.palette),colorSpace:e})),{palette:p}=d,f=u(d,ud);return t[r]=l(l({},n),{},{palette:p,opacity:l(l({},od(c)),null===(s=n)||void 0===s?void 0:s.opacity),overlays:(null===(a=n)||void 0===a?void 0:a.overlays)||sd(c)}),f}function yd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{colorSchemes:t={light:!0},defaultColorScheme:n,disableCssColorScheme:i=!1,cssVarPrefix:r="mui",nativeColor:s=!1,shouldSkipGeneratingVar:a=ad,colorSchemeSelector:c=(t.light&&t.dark?"media":void 0),rootSelector:h=":root"}=e,d=u(e,hd),p=Object.keys(t)[0],f=n||(t.light&&"light"!==p?"light":p),m=function(){return Ph(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mui")}(r),{[f]:g,light:y,dark:_}=t,v=l({},u(t,[f,"light","dark"].map(o)));let x,b=g;if(("dark"===f&&!("dark"in t)||"light"===f&&!("light"in t))&&(b=!0),!b)throw new Error(Ic(21,f));s&&(x="oklch");const w=gd(x,v,b,d,f);y&&!v.light&&gd(x,v,y,void 0,"light"),_&&!v.dark&&gd(x,v,_,void 0,"dark");let S=l(l({defaultColorScheme:f},w),{},{cssVarPrefix:r,colorSchemeSelector:c,rootSelector:h,getCssVar:m,colorSchemes:v,font:l(l({},Ih(w.typography)),w.font),spacing:(T=d.spacing,"number"===typeof T?"".concat(T,"px"):"string"===typeof T||"function"===typeof T||Array.isArray(T)?T:"8px")});var T;Object.keys(S.colorSchemes).forEach(e=>{const t=S.colorSchemes[e].palette,n=e=>{const n=e.split("-"),i=n[1],r=n[2];return m(e,t[i][r])};function i(e,t,n){if(x){let i;return e===lh&&(i="transparent ".concat((100*(1-n)).toFixed(0),"%")),e===uh&&(i="#000 ".concat((100*n).toFixed(0),"%")),e===dh&&(i="#fff ".concat((100*n).toFixed(0),"%")),"color-mix(in ".concat(x,", ").concat(t,", ").concat(i,")")}return e(t,n)}var r;if("light"===t.mode&&(dd(t.common,"background","#fff"),dd(t.common,"onBackground","#000")),"dark"===t.mode&&(dd(t.common,"background","#000"),dd(t.common,"onBackground","#fff")),r=t,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"].forEach(e=>{r[e]||(r[e]={})}),"light"===t.mode){dd(t.Alert,"errorColor",i(uh,t.error.light,.6)),dd(t.Alert,"infoColor",i(uh,t.info.light,.6)),dd(t.Alert,"successColor",i(uh,t.success.light,.6)),dd(t.Alert,"warningColor",i(uh,t.warning.light,.6)),dd(t.Alert,"errorFilledBg",n("palette-error-main")),dd(t.Alert,"infoFilledBg",n("palette-info-main")),dd(t.Alert,"successFilledBg",n("palette-success-main")),dd(t.Alert,"warningFilledBg",n("palette-warning-main")),dd(t.Alert,"errorFilledColor",md(()=>t.getContrastText(t.error.main))),dd(t.Alert,"infoFilledColor",md(()=>t.getContrastText(t.info.main))),dd(t.Alert,"successFilledColor",md(()=>t.getContrastText(t.success.main))),dd(t.Alert,"warningFilledColor",md(()=>t.getContrastText(t.warning.main))),dd(t.Alert,"errorStandardBg",i(dh,t.error.light,.9)),dd(t.Alert,"infoStandardBg",i(dh,t.info.light,.9)),dd(t.Alert,"successStandardBg",i(dh,t.success.light,.9)),dd(t.Alert,"warningStandardBg",i(dh,t.warning.light,.9)),dd(t.Alert,"errorIconColor",n("palette-error-main")),dd(t.Alert,"infoIconColor",n("palette-info-main")),dd(t.Alert,"successIconColor",n("palette-success-main")),dd(t.Alert,"warningIconColor",n("palette-warning-main")),dd(t.AppBar,"defaultBg",n("palette-grey-100")),dd(t.Avatar,"defaultBg",n("palette-grey-400")),dd(t.Button,"inheritContainedBg",n("palette-grey-300")),dd(t.Button,"inheritContainedHoverBg",n("palette-grey-A100")),dd(t.Chip,"defaultBorder",n("palette-grey-400")),dd(t.Chip,"defaultAvatarColor",n("palette-grey-700")),dd(t.Chip,"defaultIconColor",n("palette-grey-700")),dd(t.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),dd(t.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),dd(t.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),dd(t.LinearProgress,"primaryBg",i(dh,t.primary.main,.62)),dd(t.LinearProgress,"secondaryBg",i(dh,t.secondary.main,.62)),dd(t.LinearProgress,"errorBg",i(dh,t.error.main,.62)),dd(t.LinearProgress,"infoBg",i(dh,t.info.main,.62)),dd(t.LinearProgress,"successBg",i(dh,t.success.main,.62)),dd(t.LinearProgress,"warningBg",i(dh,t.warning.main,.62)),dd(t.Skeleton,"bg",x?i(lh,t.text.primary,.11):"rgba(".concat(n("palette-text-primaryChannel")," / 0.11)")),dd(t.Slider,"primaryTrack",i(dh,t.primary.main,.62)),dd(t.Slider,"secondaryTrack",i(dh,t.secondary.main,.62)),dd(t.Slider,"errorTrack",i(dh,t.error.main,.62)),dd(t.Slider,"infoTrack",i(dh,t.info.main,.62)),dd(t.Slider,"successTrack",i(dh,t.success.main,.62)),dd(t.Slider,"warningTrack",i(dh,t.warning.main,.62));const e=x?i(uh,t.background.default,.6825):ph(t.background.default,.8);dd(t.SnackbarContent,"bg",e),dd(t.SnackbarContent,"color",md(()=>x?Ah.text.primary:t.getContrastText(e))),dd(t.SpeedDialAction,"fabHoverBg",ph(t.background.paper,.15)),dd(t.StepConnector,"border",n("palette-grey-400")),dd(t.StepContent,"border",n("palette-grey-400")),dd(t.Switch,"defaultColor",n("palette-common-white")),dd(t.Switch,"defaultDisabledColor",n("palette-grey-100")),dd(t.Switch,"primaryDisabledColor",i(dh,t.primary.main,.62)),dd(t.Switch,"secondaryDisabledColor",i(dh,t.secondary.main,.62)),dd(t.Switch,"errorDisabledColor",i(dh,t.error.main,.62)),dd(t.Switch,"infoDisabledColor",i(dh,t.info.main,.62)),dd(t.Switch,"successDisabledColor",i(dh,t.success.main,.62)),dd(t.Switch,"warningDisabledColor",i(dh,t.warning.main,.62)),dd(t.TableCell,"border",i(dh,i(lh,t.divider,1),.88)),dd(t.Tooltip,"bg",i(lh,t.grey[700],.92))}if("dark"===t.mode){dd(t.Alert,"errorColor",i(dh,t.error.light,.6)),dd(t.Alert,"infoColor",i(dh,t.info.light,.6)),dd(t.Alert,"successColor",i(dh,t.success.light,.6)),dd(t.Alert,"warningColor",i(dh,t.warning.light,.6)),dd(t.Alert,"errorFilledBg",n("palette-error-dark")),dd(t.Alert,"infoFilledBg",n("palette-info-dark")),dd(t.Alert,"successFilledBg",n("palette-success-dark")),dd(t.Alert,"warningFilledBg",n("palette-warning-dark")),dd(t.Alert,"errorFilledColor",md(()=>t.getContrastText(t.error.dark))),dd(t.Alert,"infoFilledColor",md(()=>t.getContrastText(t.info.dark))),dd(t.Alert,"successFilledColor",md(()=>t.getContrastText(t.success.dark))),dd(t.Alert,"warningFilledColor",md(()=>t.getContrastText(t.warning.dark))),dd(t.Alert,"errorStandardBg",i(uh,t.error.light,.9)),dd(t.Alert,"infoStandardBg",i(uh,t.info.light,.9)),dd(t.Alert,"successStandardBg",i(uh,t.success.light,.9)),dd(t.Alert,"warningStandardBg",i(uh,t.warning.light,.9)),dd(t.Alert,"errorIconColor",n("palette-error-main")),dd(t.Alert,"infoIconColor",n("palette-info-main")),dd(t.Alert,"successIconColor",n("palette-success-main")),dd(t.Alert,"warningIconColor",n("palette-warning-main")),dd(t.AppBar,"defaultBg",n("palette-grey-900")),dd(t.AppBar,"darkBg",n("palette-background-paper")),dd(t.AppBar,"darkColor",n("palette-text-primary")),dd(t.Avatar,"defaultBg",n("palette-grey-600")),dd(t.Button,"inheritContainedBg",n("palette-grey-800")),dd(t.Button,"inheritContainedHoverBg",n("palette-grey-700")),dd(t.Chip,"defaultBorder",n("palette-grey-700")),dd(t.Chip,"defaultAvatarColor",n("palette-grey-300")),dd(t.Chip,"defaultIconColor",n("palette-grey-300")),dd(t.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),dd(t.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),dd(t.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),dd(t.LinearProgress,"primaryBg",i(uh,t.primary.main,.5)),dd(t.LinearProgress,"secondaryBg",i(uh,t.secondary.main,.5)),dd(t.LinearProgress,"errorBg",i(uh,t.error.main,.5)),dd(t.LinearProgress,"infoBg",i(uh,t.info.main,.5)),dd(t.LinearProgress,"successBg",i(uh,t.success.main,.5)),dd(t.LinearProgress,"warningBg",i(uh,t.warning.main,.5)),dd(t.Skeleton,"bg",x?i(lh,t.text.primary,.13):"rgba(".concat(n("palette-text-primaryChannel")," / 0.13)")),dd(t.Slider,"primaryTrack",i(uh,t.primary.main,.5)),dd(t.Slider,"secondaryTrack",i(uh,t.secondary.main,.5)),dd(t.Slider,"errorTrack",i(uh,t.error.main,.5)),dd(t.Slider,"infoTrack",i(uh,t.info.main,.5)),dd(t.Slider,"successTrack",i(uh,t.success.main,.5)),dd(t.Slider,"warningTrack",i(uh,t.warning.main,.5));const e=x?i(dh,t.background.default,.985):ph(t.background.default,.98);dd(t.SnackbarContent,"bg",e),dd(t.SnackbarContent,"color",md(()=>x?Th.text.primary:t.getContrastText(e))),dd(t.SpeedDialAction,"fabHoverBg",ph(t.background.paper,.15)),dd(t.StepConnector,"border",n("palette-grey-600")),dd(t.StepContent,"border",n("palette-grey-600")),dd(t.Switch,"defaultColor",n("palette-grey-300")),dd(t.Switch,"defaultDisabledColor",n("palette-grey-600")),dd(t.Switch,"primaryDisabledColor",i(uh,t.primary.main,.55)),dd(t.Switch,"secondaryDisabledColor",i(uh,t.secondary.main,.55)),dd(t.Switch,"errorDisabledColor",i(uh,t.error.main,.55)),dd(t.Switch,"infoDisabledColor",i(uh,t.info.main,.55)),dd(t.Switch,"successDisabledColor",i(uh,t.success.main,.55)),dd(t.Switch,"warningDisabledColor",i(uh,t.warning.main,.55)),dd(t.TableCell,"border",i(uh,i(lh,t.divider,1),.68)),dd(t.Tooltip,"bg",i(lh,t.grey[700],.92))}fd(t.background,"default"),fd(t.background,"paper"),fd(t.common,"background"),fd(t.common,"onBackground"),fd(t,"divider"),Object.keys(t).forEach(e=>{const n=t[e];"tonalOffset"!==e&&n&&"object"===typeof n&&(n.main&&dd(t[e],"mainChannel",ih(pd(n.main))),n.light&&dd(t[e],"lightChannel",ih(pd(n.light))),n.dark&&dd(t[e],"darkChannel",ih(pd(n.dark))),n.contrastText&&dd(t[e],"contrastTextChannel",ih(pd(n.contrastText))),"text"===e&&(fd(t[e],"primary"),fd(t[e],"secondary")),"action"===e&&(n.active&&fd(t[e],"active"),n.selected&&fd(t[e],"selected")))})});for(var E=arguments.length,A=new Array(E>1?E-1:0),M=1;M<E;M++)A[M-1]=arguments[M];S=A.reduce((e,t)=>Oc(e,t),S);const k={prefix:r,disableCssColorScheme:i,shouldSkipGeneratingVar:a,getSelector:cd(S),enableContrastVars:s},{vars:C,generateThemeVars:P,generateStyleSheets:I}=Lh(S,k);return S.vars=C,Object.entries(S.colorSchemes[S.defaultColorScheme]).forEach(e=>{let[t,n]=e;S[t]=n}),S.generateThemeVars=P,S.generateStyleSheets=I,S.generateSpacing=function(){return qu(d.spacing,nu(this))},S.getColorSchemeSelector=function(e){return function(t){return"media"===e?"@media (prefers-color-scheme: ".concat(t,")"):e?e.startsWith("data-")&&!e.includes("%s")?"[".concat(e,'="').concat(t,'"] &'):"class"===e?".".concat(t," &"):"data"===e?"[data-".concat(t,"] &"):"".concat(e.replace("%s",t)," &"):"&"}}(c),S.spacing=S.generateSpacing(),S.shouldSkipGeneratingVar=a,S.unstable_sxConfig=l(l({},Ou),null===d||void 0===d?void 0:d.unstable_sxConfig),S.unstable_sx=function(e){return Bu({sx:e,theme:this})},S.toRuntimeSource=Jh,S}const _d=["palette","cssVariables","colorSchemes","defaultColorScheme"];function vd(e,t,n){e.colorSchemes&&n&&(e.colorSchemes[t]=l(l({},!0!==n&&n),{},{palette:Ch(l(l({},!0===n?{}:n.palette),{},{mode:t}))}))}function xd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{palette:t,cssVariables:n=!1,colorSchemes:i=(t?void 0:{light:!0}),defaultColorScheme:r=(null===t||void 0===t?void 0:t.mode)}=e,o=u(e,_d),s=r||"light",a=null===i||void 0===i?void 0:i[s],c=l(l({},i),t?{[s]:l(l({},"boolean"!==typeof a&&a),{},{palette:t})}:void 0);for(var h=arguments.length,d=new Array(h>1?h-1:0),p=1;p<h;p++)d[p-1]=arguments[p];if(!1===n){if(!("colorSchemes"in e))return td(e,...d);let n=t;"palette"in e||c[s]&&(!0!==c[s]?n=c[s].palette:"dark"===s&&(n={mode:"dark"}));const i=td(l(l({},e),{},{palette:n}),...d);return i.defaultColorScheme=s,i.colorSchemes=c,"light"===i.palette.mode&&(i.colorSchemes.light=l(l({},!0!==c.light&&c.light),{},{palette:i.palette}),vd(i,"dark",c.dark)),"dark"===i.palette.mode&&(i.colorSchemes.dark=l(l({},!0!==c.dark&&c.dark),{},{palette:i.palette}),vd(i,"light",c.light)),i}return t||"light"in c||"light"!==s||(c.light=!0),yd(l(l({},o),{},{colorSchemes:c,defaultColorScheme:s},"boolean"!==typeof n&&n),...d)}const bd="$$material",wd={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Sd(e,t){const n=wd[t];return n?"".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui","-").concat(n):"".concat(Qu.generate(e),"-").concat(t)}function Td(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const i={};return t.forEach(t=>{i[t]=Sd(e,t,n)}),i}const Ed=Td("MuiBox",["root"]),Ad=xd(),Md=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:n,defaultTheme:i,defaultClassName:r="MuiBox-root",generateClassName:o}=t,s=kc("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(Bu);return e.forwardRef(function(e,t){const a=Ku(i),c=ju(e),{className:h,component:d="div"}=c,p=u(c,Ju);return(0,C.jsx)(s,l({as:d,ref:t,className:Ha(h,o?o(r):r),theme:n&&a[n]||a},p))})}({themeId:bd,defaultTheme:Ad,defaultClassName:Ed.root,generateClassName:Qu.generate}),kd=Md;var Cd=6371008.8,Pd={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*Cd,kilometers:6371.0088,kilometres:6371.0088,meters:Cd,metres:Cd,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:Cd/1852,radians:1,yards:6967335.223679999};function Id(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function Dd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Fd(e[0])||!Fd(e[1]))throw new Error("coordinates must contain numbers");return Id({type:"Point",coordinates:e},t,n)}function zd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(const i of e){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<i[i.length-1].length;e++)if(i[i.length-1][e]!==i[0][e])throw new Error("First and last Position are not equivalent.")}return Id({type:"Polygon",coordinates:e},t,n)}function Rd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"kilometers";const n=Pd[t];if(!n)throw new Error(t+" units is invalid");return e/n}function Ld(e){return 180*(e%(2*Math.PI))/Math.PI}function Od(e){return e%360*Math.PI/180}function Fd(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function Bd(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}(e),o=Od(r[0]),s=Od(r[1]),a=Od(n),l=Rd(t,i.units),c=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a));return Dd([Ld(o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(c))),Ld(c)],i.properties)}function Nd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=n.steps||64,r=n.properties?n.properties:!Array.isArray(e)&&"Feature"===e.type&&e.properties?e.properties:{},o=[];for(let s=0;s<i;s++)o.push(Bd(e,t,-360*s/i,n).geometry.coordinates);return o.push(o[0]),zd([o],r)}class jd extends Ga().Marker{constructor(){super(...arguments),this._onClick=void 0}onClick(e){this._onClick=e;const t=this.getElement();return t.style.cursor="pointer",t.addEventListener("click",e=>{e.stopPropagation(),this._onClick&&this._onClick()}),this}}function Vd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const i={};for(const r in e){const o=e[r];let s="",a=!0;for(let e=0;e<o.length;e+=1){const i=o[e];i&&(s+=(!0===a?"":" ")+t(i),a=!1,n&&n[i]&&(s+=" "+n[i]))}i[r]=s}return i}let Ud=0;const Gd=l({},t).useId;function qd(t){if(void 0!==Gd){const e=Gd();return null!==t&&void 0!==t?t:e}return function(t){const[n,i]=e.useState(t),r=t||n;return e.useEffect(()=>{null==n&&(Ud+=1,i("mui-".concat(Ud)))},[n]),r}(t)}const Wd=Dc;function Zd(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];const r=e.useRef(void 0),o=e.useCallback(e=>{const t=n.map(t=>{if(null==t)return null;if("function"===typeof t){const n=t,i=n(e);return"function"===typeof i?i:()=>{n(null)}}return t.current=e,()=>{t.current=null}});return()=>{t.forEach(e=>null===e||void 0===e?void 0:e())}},n);return e.useMemo(()=>n.every(e=>null==e)?null:e=>{r.current&&(r.current(),r.current=void 0),null!=e&&(r.current=o(e))},n)}function Hd(e){return e&&e.ownerDocument||document}function Xd(t){var n;return parseInt(e.version,10)>=19?(null===t||void 0===t||null===(n=t.props)||void 0===n?void 0:n.ref)||null:(null===t||void 0===t?void 0:t.ref)||null}const Yd=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function Kd(e){const t=[],n=[];return Array.from(e.querySelectorAll(Yd)).forEach((e,i)=>{const r=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==r&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector('input[type="radio"]'.concat(t));let n=t('[name="'.concat(e.name,'"]:checked'));return n||(n=t('[name="'.concat(e.name,'"]'))),n!==e}(e))}(e)&&(0===r?t.push(e):n.push({documentOrder:i,tabIndex:r,node:e}))}),n.sort((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex).map(e=>e.node).concat(t)}function Jd(){return!0}const $d=function(t){const{children:n,disableAutoFocus:i=!1,disableEnforceFocus:r=!1,disableRestoreFocus:o=!1,getTabbable:s=Kd,isEnabled:a=Jd,open:l}=t,c=e.useRef(!1),u=e.useRef(null),h=e.useRef(null),d=e.useRef(null),p=e.useRef(null),f=e.useRef(!1),m=e.useRef(null),g=Zd(Xd(n),m),y=e.useRef(null);e.useEffect(()=>{l&&m.current&&(f.current=!i)},[i,l]),e.useEffect(()=>{if(!l||!m.current)return;const e=Hd(m.current);return m.current.contains(e.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),f.current&&m.current.focus()),()=>{o||(d.current&&d.current.focus&&(c.current=!0,d.current.focus()),d.current=null)}},[l]),e.useEffect(()=>{if(!l||!m.current)return;const e=Hd(m.current),t=t=>{y.current=t,!r&&a()&&"Tab"===t.key&&e.activeElement===m.current&&t.shiftKey&&(c.current=!0,h.current&&h.current.focus())},n=()=>{const t=m.current;if(null===t)return;if(!e.hasFocus()||!a()||c.current)return void(c.current=!1);if(t.contains(e.activeElement))return;if(r&&e.activeElement!==u.current&&e.activeElement!==h.current)return;if(e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!f.current)return;let n=[];if(e.activeElement!==u.current&&e.activeElement!==h.current||(n=s(m.current)),n.length>0){var i,o;const e=Boolean((null===(i=y.current)||void 0===i?void 0:i.shiftKey)&&"Tab"===(null===(o=y.current)||void 0===o?void 0:o.key)),t=n[0],r=n[n.length-1];"string"!==typeof t&&"string"!==typeof r&&(e?r.focus():t.focus())}else t.focus()};e.addEventListener("focusin",n),e.addEventListener("keydown",t,!0);const i=setInterval(()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&n()},50);return()=>{clearInterval(i),e.removeEventListener("focusin",n),e.removeEventListener("keydown",t,!0)}},[i,r,o,a,l,s]);const _=e=>{null===d.current&&(d.current=e.relatedTarget),f.current=!0};return(0,C.jsxs)(e.Fragment,{children:[(0,C.jsx)("div",{tabIndex:l?0:-1,onFocus:_,ref:u,"data-testid":"sentinelStart"}),e.cloneElement(n,{ref:g,onFocus:e=>{null===d.current&&(d.current=e.relatedTarget),f.current=!0,p.current=e.target;const t=n.props.onFocus;t&&t(e)}}),(0,C.jsx)("div",{tabIndex:l?0:-1,onFocus:_,ref:h,"data-testid":"sentinelEnd"})]})};var Qd=n(950);const ep="undefined"!==typeof window?e.useLayoutEffect:e.useEffect;function tp(e,t){"function"===typeof e?e(t):e&&(e.current=t)}const np=e.forwardRef(function(t,n){const{children:i,container:r,disablePortal:o=!1}=t,[s,a]=e.useState(null),l=Zd(e.isValidElement(i)?Xd(i):null,n);if(ep(()=>{o||a(function(e){return"function"===typeof e?e():e}(r)||document.body)},[r,o]),ep(()=>{if(s&&!o)return tp(n,s),()=>{tp(n,null)}},[n,s,o]),o){if(e.isValidElement(i)){const t={ref:l};return e.cloneElement(i,t)}return i}return s?Qd.createPortal(i,s):s});const ip=np,rp=["variants"];function op(e){const{variants:t}=e,n=u(e,rp),i={variants:t,style:Pc(n),isProcessed:!0};return i.style===n||t&&t.forEach(e=>{"function"!==typeof e.style&&(e.style=Pc(e.style))}),i}const sp=["variants"],ap=["name","slot","skipVariantsResolver","skipSx","overridesResolver"],lp=Hu();function cp(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}function up(e,t){return t&&e&&"object"===typeof e&&e.styles&&!e.styles.startsWith("@layer")&&(e.styles="@layer ".concat(t,"{").concat(String(e.styles),"}")),e}function hp(e){return e?(t,n)=>n[e]:null}function dp(e,t,n){const i="function"===typeof t?t(e):t;if(Array.isArray(i))return i.flatMap(t=>dp(e,t,n));if(Array.isArray(null===i||void 0===i?void 0:i.variants)){let t;if(i.isProcessed)t=n?up(i.style,n):i.style;else{const{variants:e}=i,r=u(i,sp);t=n?up(Pc(r),n):r}return pp(e,i.variants,[t],n)}return null!==i&&void 0!==i&&i.isProcessed?n?up(Pc(i.style),n):i.style:n?up(Pc(i),n):i}function pp(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;e:for(let s=0;s<t.length;s+=1){const a=t[s];if("function"===typeof a.props){if(null!==n&&void 0!==n||(n=l(l(l({},e),e.ownerState),{},{ownerState:e.ownerState})),!a.props(n))continue}else for(const t in a.props){var o;if(e[t]!==a.props[t]&&(null===(o=e.ownerState)||void 0===o?void 0:o[t])!==a.props[t])continue e}"function"===typeof a.style?(null!==n&&void 0!==n||(n=l(l(l({},e),e.ownerState),{},{ownerState:e.ownerState})),i.push(r?up(Pc(a.style(n)),r):a.style(n))):i.push(r?up(Pc(a.style),r):a.style)}return i}function fp(e,t){}function mp(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}const gp=xd();const yp=function(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e},_p=e=>yp(e)&&"classes"!==e,vp=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=lp,rootShouldForwardProp:i=cp,slotShouldForwardProp:r=cp}=e;function o(e){!function(e,t,n){e.theme=function(e){for(const t in e)return!1;return!0}(e.theme)?n:e.theme[t]||e.theme}(e,t,n)}return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}(e,e=>e.filter(e=>e!==Bu));const{name:n,slot:s,skipVariantsResolver:a,skipSx:c,overridesResolver:h=hp(mp(s))}=t,d=u(t,ap),p=n&&n.startsWith("Mui")||s?"components":"custom",f=void 0!==a?a:s&&"Root"!==s&&"root"!==s||!1,m=c||!1;let g=cp;"Root"===s||"root"===s?g=i:s?g=r:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(g=void 0);const y=kc(e,l({shouldForwardProp:g,label:fp(n,s)},d)),_=e=>{if(e.__emotion_real===e)return e;if("function"===typeof e)return function(t){return dp(t,e,t.theme.modularCssLayers?p:void 0)};if(Rc(e)){const t=op(e);return function(e){return t.variants?dp(e,t,e.theme.modularCssLayers?p:void 0):e.theme.modularCssLayers?up(t.style,p):t.style}}return e},v=function(){const t=[];for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];const a=r.map(_),l=[];if(t.push(o),n&&h&&l.push(function(e){var t;const i=null===(t=e.theme.components)||void 0===t||null===(t=t[n])||void 0===t?void 0:t.styleOverrides;if(!i)return null;const r={};for(const n in i)r[n]=dp(e,i[n],e.theme.modularCssLayers?"theme":void 0);return h(e,r)}),n&&!f&&l.push(function(e){var t;const i=e.theme,r=null===i||void 0===i||null===(t=i.components)||void 0===t||null===(t=t[n])||void 0===t?void 0:t.variants;return r?pp(e,r,[],e.theme.modularCssLayers?"theme":void 0):null}),m||l.push(Bu),Array.isArray(a[0])){const e=a.shift(),n=new Array(t.length).fill(""),i=new Array(l.length).fill("");let r;r=[...n,...e,...i],r.raw=[...n,...e.raw,...i],t.unshift(r)}const c=[...t,...a,...l],u=y(...c);return e.muiName&&(u.muiName=e.muiName),u};return y.withConfig&&(v.withConfig=y.withConfig),v}}({themeId:bd,defaultTheme:gp,rootShouldForwardProp:_p}),xp=vp,bp={theme:void 0};const wp=function(e){let t,n;return function(i){let r=t;return void 0!==r&&i.theme===n||(bp.theme=i.theme,r=op(e(bp)),t=r,n=i.theme),r}};function Sp(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=l({},t);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const o=r;if("components"===o||"slots"===o)i[o]=l(l({},e[o]),i[o]);else if("componentsProps"===o||"slotProps"===o){const r=e[o],s=t[o];if(s)if(r){i[o]=l({},s);for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e)){const t=e;i[o][t]=Sp(r[t],s[t],n)}}else i[o]=s;else i[o]=r||{}}else"className"===o&&n&&t.className?i.className=Ha(null===e||void 0===e?void 0:e.className,null===t||void 0===t?void 0:t.className):"style"===o&&n&&t.style?i.style=l(l({},null===e||void 0===e?void 0:e.style),null===t||void 0===t?void 0:t.style):void 0===i[o]&&(i[o]=e[o])}return i}const Tp=e.createContext(void 0);function Ep(t){let{props:n,name:i}=t;return function(e){const{theme:t,name:n,props:i}=e;if(!t||!t.components||!t.components[n])return i;const r=t.components[n];return r.defaultProps?Sp(r.defaultProps,i,t.components.mergeClassNameAndStyle):r.styleOverrides||r.variants?i:Sp(r,i,t.components.mergeClassNameAndStyle)}({props:n,name:i,theme:{components:e.useContext(Tp)}})}function Ap(e){return Ep(e)}const Mp=function(e){return"string"===typeof e};const kp=function(e,t,n){return void 0===e||Mp(e)?t:l(l({},t),{},{ownerState:l(l({},t.ownerState),n)})};const Cp=function(e,t,n){return"function"===typeof e?e(t,n):e};const Pp=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const n={};return Object.keys(e).filter(n=>n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n)).forEach(t=>{n[t]=e[t]}),n};const Ip=function(e){if(void 0===e)return{};const t={};return Object.keys(e).filter(t=>!(t.match(/^on[A-Z]/)&&"function"===typeof e[t])).forEach(n=>{t[n]=e[n]}),t};const Dp=function(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:i,externalForwardedProps:r,className:o}=e;if(!t){const e=Ha(null===n||void 0===n?void 0:n.className,o,null===r||void 0===r?void 0:r.className,null===i||void 0===i?void 0:i.className),t=l(l(l({},null===n||void 0===n?void 0:n.style),null===r||void 0===r?void 0:r.style),null===i||void 0===i?void 0:i.style),s=l(l(l({},n),r),i);return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const s=Pp(l(l({},r),i)),a=Ip(i),c=Ip(r),u=t(s),h=Ha(null===u||void 0===u?void 0:u.className,null===n||void 0===n?void 0:n.className,o,null===r||void 0===r?void 0:r.className,null===i||void 0===i?void 0:i.className),d=l(l(l(l({},null===u||void 0===u?void 0:u.style),null===n||void 0===n?void 0:n.style),null===r||void 0===r?void 0:r.style),null===i||void 0===i?void 0:i.style),p=l(l(l(l({},u),n),c),a);return h.length>0&&(p.className=h),Object.keys(d).length>0&&(p.style=d),{props:p,internalRef:u.ref}},zp=["className","elementType","ownerState","externalForwardedProps","internalForwardedProps","shouldForwardComponentProp"],Rp=["component","slots","slotProps"],Lp=["component"];function Op(e,t){const{className:n,elementType:i,ownerState:r,externalForwardedProps:o,internalForwardedProps:s,shouldForwardComponentProp:a=!1}=t,c=u(t,zp),{component:h,slots:d={[e]:void 0},slotProps:p={[e]:void 0}}=o,f=u(o,Rp),m=d[e]||i,g=Cp(p[e],r),y=Dp(l(l({className:n},c),{},{externalForwardedProps:"root"===e?f:void 0,externalSlotProps:g})),{props:{component:_},internalRef:v}=y,x=u(y.props,Lp),b=Zd(v,null===g||void 0===g?void 0:g.ref,t.ref),w="root"===e?_||h:_;return[m,kp(m,l(l(l(l(l(l({},"root"===e&&!h&&!d[e]&&s),"root"!==e&&!d[e]&&s),x),w&&!a&&{as:w}),w&&a&&{component:w}),{},{ref:b}),r)]}function Fp(e,t){return Fp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Fp(e,t)}function Bp(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Fp(e,t)}const Np=!1,jp=e.createContext(null);var Vp="unmounted",Up="exited",Gp="entering",qp="entered",Wp="exiting",Zp=function(t){function n(e,n){var i;i=t.call(this,e,n)||this;var r,o=n&&!n.isMounting?e.enter:e.appear;return i.appearStatus=null,e.in?o?(r=Up,i.appearStatus=Gp):r=qp:r=e.unmountOnExit||e.mountOnEnter?Vp:Up,i.state={status:r},i.nextCallback=null,i}Bp(n,t),n.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Vp?{status:Up}:null};var i=n.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==Gp&&n!==qp&&(t=Gp):n!==Gp&&n!==qp||(t=Wp)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,n,i=this.props.timeout;return e=t=n=i,null!=i&&"number"!==typeof i&&(e=i.exit,t=i.enter,n=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:n}},i.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===Gp){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:Qd.findDOMNode(this);n&&function(e){e.scrollTop}(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Up&&this.setState({status:Vp})},i.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[Qd.findDOMNode(this),i],o=r[0],s=r[1],a=this.getTimeouts(),l=i?a.appear:a.enter;!e&&!n||Np?this.safeSetState({status:qp},function(){t.props.onEntered(o)}):(this.props.onEnter(o,s),this.safeSetState({status:Gp},function(){t.props.onEntering(o,s),t.onTransitionEnd(l,function(){t.safeSetState({status:qp},function(){t.props.onEntered(o,s)})})}))},i.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:Qd.findDOMNode(this);t&&!Np?(this.props.onExit(i),this.safeSetState({status:Wp},function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,function(){e.safeSetState({status:Up},function(){e.props.onExited(i)})})})):this.safeSetState({status:Up},function(){e.props.onExited(i)})},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(i){n&&(n=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:Qd.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(n&&!i){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=r[0],s=r[1];this.props.addEndListener(o,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},i.render=function(){var t=this.state.status;if(t===Vp)return null;var n=this.props,i=n.children,r=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,c(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return e.createElement(jp.Provider,{value:null},"function"===typeof i?i(t,r):e.cloneElement(e.Children.only(i),r))},n}(e.Component);function Hp(){}Zp.contextType=jp,Zp.propTypes={},Zp.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Hp,onEntering:Hp,onEntered:Hp,onExit:Hp,onExiting:Hp,onExited:Hp},Zp.UNMOUNTED=Vp,Zp.EXITED=Up,Zp.ENTERING=Gp,Zp.ENTERED=qp,Zp.EXITING=Wp;const Xp=Zp;function Yp(){const e=Ku(gp);return e[bd]||e}function Kp(e,t){var n,i;const{timeout:r,easing:o,style:s={}}=e;return{duration:null!==(n=s.transitionDuration)&&void 0!==n?n:"number"===typeof r?r:r[t.mode]||0,easing:null!==(i=s.transitionTimingFunction)&&void 0!==i?i:"object"===typeof o?o[t.mode]:o,delay:s.transitionDelay}}const Jp=Zd,$p=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],Qp=["ownerState"],ef={entering:{opacity:1},entered:{opacity:1}},tf=e.forwardRef(function(t,n){const i=Yp(),r={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{addEndListener:o,appear:s=!0,children:a,easing:c,in:h,onEnter:d,onEntered:p,onEntering:f,onExit:m,onExited:g,onExiting:y,style:_,timeout:v=r,TransitionComponent:x=Xp}=t,b=u(t,$p),w=e.useRef(null),S=Jp(w,Xd(a),n),T=e=>t=>{if(e){const n=w.current;void 0===t?e(n):e(n,t)}},E=T(f),A=T((e,t)=>{(e=>{e.scrollTop})(e);const n=Kp({style:_,timeout:v,easing:c},{mode:"enter"});e.style.webkitTransition=i.transitions.create("opacity",n),e.style.transition=i.transitions.create("opacity",n),d&&d(e,t)}),M=T(p),k=T(y),P=T(e=>{const t=Kp({style:_,timeout:v,easing:c},{mode:"exit"});e.style.webkitTransition=i.transitions.create("opacity",t),e.style.transition=i.transitions.create("opacity",t),m&&m(e)}),I=T(g);return(0,C.jsx)(x,l(l({appear:s,in:h,nodeRef:w,onEnter:A,onEntered:M,onEntering:E,onExit:P,onExited:I,onExiting:k,addEndListener:e=>{o&&o(w.current,e)},timeout:v},b),{},{children:(t,n)=>{let{ownerState:i}=n,r=u(n,Qp);return e.cloneElement(a,l({style:l(l(l({opacity:0,visibility:"exited"!==t||h?void 0:"hidden"},ef[t]),_),a.props.style),ref:S},r))}}))}),nf=tf;function rf(e){return Sd("MuiBackdrop",e)}Td("MuiBackdrop",["root","invisible"]);const of=["children","className","component","invisible","open","components","componentsProps","slotProps","slots","TransitionComponent","transitionDuration"],sf=xp("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.invisible&&t.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),af=e.forwardRef(function(e,t){const n=Ap({props:e,name:"MuiBackdrop"}),{children:i,className:r,component:o="div",invisible:s=!1,open:a,components:c={},componentsProps:h={},slotProps:d={},slots:p={},TransitionComponent:f,transitionDuration:m}=n,g=u(n,of),y=l(l({},n),{},{component:o,invisible:s}),_=(e=>{const{classes:t,invisible:n}=e;return Vd({root:["root",n&&"invisible"]},rf,t)})(y),v={component:o,slots:l({transition:f,root:c.Root},p),slotProps:l(l({},h),d)},[x,b]=Op("root",{elementType:sf,externalForwardedProps:v,className:Ha(_.root,r),ownerState:y}),[w,S]=Op("transition",{elementType:nf,externalForwardedProps:v,ownerState:y});return(0,C.jsx)(w,l(l(l({in:a,timeout:m},g),S),{},{children:(0,C.jsx)(x,l(l({"aria-hidden":!0},b),{},{classes:_,ref:t,children:i}))}))});const lf=function(t){const n=e.useRef(t);return ep(()=>{n.current=t}),e.useRef(function(){return(0,n.current)(...arguments)}).current};function cf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>null==t?e:function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];e.apply(this,i),t.apply(this,i)},()=>{})}function uf(e){return Hd(e).defaultView||window}function hf(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function df(e){return parseInt(uf(e).getComputedStyle(e).paddingRight,10)||0}function pf(e,t,n,i,r){const o=[t,n,...i];[].forEach.call(e.children,e=>{const t=!o.includes(e),n=!function(e){const t=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}(e);t&&n&&hf(e,r)})}function ff(e,t){let n=-1;return e.some((e,i)=>!!t(e)&&(n=i,!0)),n}function mf(e,t){const n=[],i=e.container;if(!t.disableScrollLock){if(function(e){const t=Hd(e);return t.body===e?uf(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(i)){const e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;const t=e.document.documentElement.clientWidth;return e.innerWidth-t}(uf(i));n.push({value:i.style.paddingRight,property:"padding-right",el:i}),i.style.paddingRight="".concat(df(i)+e,"px");const t=Hd(i).querySelectorAll(".mui-fixed");[].forEach.call(t,t=>{n.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight="".concat(df(t)+e,"px")})}let e;if(i.parentNode instanceof DocumentFragment)e=Hd(i).body;else{const t=i.parentElement,n=uf(i);e="HTML"===(null===t||void 0===t?void 0:t.nodeName)&&"scroll"===n.getComputedStyle(t).overflowY?t:i}n.push({value:e.style.overflow,property:"overflow",el:e},{value:e.style.overflowX,property:"overflow-x",el:e},{value:e.style.overflowY,property:"overflow-y",el:e}),e.style.overflow="hidden"}return()=>{n.forEach(e=>{let{value:t,el:n,property:i}=e;t?n.style.setProperty(i,t):n.style.removeProperty(i)})}}const gf=()=>{},yf=new class{constructor(){this.modals=[],this.containers=[]}add(e,t){let n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&hf(e.modalRef,!1);const i=function(e){const t=[];return[].forEach.call(e.children,e=>{"true"===e.getAttribute("aria-hidden")&&t.push(e)}),t}(t);pf(t,e.mount,e.modalRef,i,!0);const r=ff(this.containers,e=>e.container===t);return-1!==r?(this.containers[r].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:i}),n)}mount(e,t){const n=ff(this.containers,t=>t.modals.includes(e)),i=this.containers[n];i.restore||(i.restore=mf(i,t))}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.modals.indexOf(e);if(-1===n)return n;const i=ff(this.containers,t=>t.modals.includes(e)),r=this.containers[i];if(r.modals.splice(r.modals.indexOf(e),1),this.modals.splice(n,1),0===r.modals.length)r.restore&&r.restore(),e.modalRef&&hf(e.modalRef,t),pf(r.container,e.mount,e.modalRef,r.hiddenSiblings,!1),this.containers.splice(i,1);else{const e=r.modals[r.modals.length-1];e.modalRef&&hf(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};const _f=function(t){const{container:n,disableEscapeKeyDown:i=!1,disableScrollLock:r=!1,closeAfterTransition:o=!1,onTransitionEnter:s,onTransitionExited:a,children:c,onClose:u,open:h,rootRef:d}=t,p=e.useRef({}),f=e.useRef(null),m=e.useRef(null),g=Zd(m,d),[y,_]=e.useState(!h),v=function(e){return!!e&&e.props.hasOwnProperty("in")}(c);let x=!0;"false"!==t["aria-hidden"]&&!1!==t["aria-hidden"]||(x=!1);const b=()=>(p.current.modalRef=m.current,p.current.mount=f.current,p.current),w=()=>{yf.mount(b(),{disableScrollLock:r}),m.current&&(m.current.scrollTop=0)},S=lf(()=>{const e=function(e){return"function"===typeof e?e():e}(n)||Hd(f.current).body;yf.add(b(),e),m.current&&w()}),T=()=>yf.isTopModal(b()),E=lf(e=>{f.current=e,e&&(h&&T()?w():m.current&&hf(m.current,x))}),A=e.useCallback(()=>{yf.remove(b(),x)},[x]);e.useEffect(()=>()=>{A()},[A]),e.useEffect(()=>{h?S():v&&o||A()},[h,A,v,o,S]);const M=e=>t=>{var n;null===(n=e.onKeyDown)||void 0===n||n.call(e,t),"Escape"===t.key&&229!==t.which&&T()&&(i||(t.stopPropagation(),u&&u(t,"escapeKeyDown")))},k=e=>t=>{var n;null===(n=e.onClick)||void 0===n||n.call(e,t),t.target===t.currentTarget&&u&&u(t,"backdropClick")};return{getRootProps:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=Pp(t);delete n.onTransitionEnter,delete n.onTransitionExited;const i=l(l({},n),e);return l(l({role:"presentation"},i),{},{onKeyDown:M(i),ref:g})},getBackdropProps:function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l(l({"aria-hidden":!0},e),{},{onClick:k(e),open:h})},getTransitionProps:()=>{var e,t;return{onEnter:cf(()=>{_(!1),s&&s()},null!==(e=null===c||void 0===c?void 0:c.props.onEnter)&&void 0!==e?e:gf),onExited:cf(()=>{_(!0),a&&a(),o&&A()},null!==(t=null===c||void 0===c?void 0:c.props.onExited)&&void 0!==t?t:gf)}},rootRef:g,portalRef:E,isTopModal:T,exited:y,hasTransition:v}};function vf(e){return Sd("MuiModal",e)}Td("MuiModal",["root","hidden","backdrop"]);const xf=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],bf=xp("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.open&&n.exited&&t.hidden]}})(wp(e=>{let{theme:t}=e;return{position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:e=>{let{ownerState:t}=e;return!t.open&&t.exited},style:{visibility:"hidden"}}]}})),wf=xp(af,{name:"MuiModal",slot:"Backdrop"})({zIndex:-1}),Sf=e.forwardRef(function(t,n){const i=Ap({name:"MuiModal",props:t}),{BackdropComponent:r=wf,BackdropProps:o,classes:s,className:a,closeAfterTransition:c=!1,children:h,container:d,component:p,components:f={},componentsProps:m={},disableAutoFocus:g=!1,disableEnforceFocus:y=!1,disableEscapeKeyDown:_=!1,disablePortal:v=!1,disableRestoreFocus:x=!1,disableScrollLock:b=!1,hideBackdrop:w=!1,keepMounted:S=!1,onClose:T,onTransitionEnter:E,onTransitionExited:A,open:M,slotProps:k={},slots:P={},theme:I}=i,D=u(i,xf),z=l(l({},i),{},{closeAfterTransition:c,disableAutoFocus:g,disableEnforceFocus:y,disableEscapeKeyDown:_,disablePortal:v,disableRestoreFocus:x,disableScrollLock:b,hideBackdrop:w,keepMounted:S}),{getRootProps:R,getBackdropProps:L,getTransitionProps:O,portalRef:F,isTopModal:B,exited:N,hasTransition:j}=_f(l(l({},z),{},{rootRef:n})),V=l(l({},z),{},{exited:N}),U=(e=>{const{open:t,exited:n,classes:i}=e;return Vd({root:["root",!t&&n&&"hidden"],backdrop:["backdrop"]},vf,i)})(V),G={};if(void 0===h.props.tabIndex&&(G.tabIndex="-1"),j){const{onEnter:e,onExited:t}=O();G.onEnter=e,G.onExited=t}const q={slots:l({root:f.Root,backdrop:f.Backdrop},P),slotProps:l(l({},m),k)},[W,Z]=Op("root",{ref:n,elementType:bf,externalForwardedProps:l(l(l({},q),D),{},{component:p}),getSlotProps:R,ownerState:V,className:Ha(a,null===U||void 0===U?void 0:U.root,!V.open&&V.exited&&(null===U||void 0===U?void 0:U.hidden))}),[H,X]=Op("backdrop",{ref:null===o||void 0===o?void 0:o.ref,elementType:r,externalForwardedProps:q,shouldForwardComponentProp:!0,additionalProps:o,getSlotProps:e=>L(l(l({},e),{},{onClick:t=>{null!==e&&void 0!==e&&e.onClick&&e.onClick(t)}})),className:Ha(null===o||void 0===o?void 0:o.className,null===U||void 0===U?void 0:U.backdrop),ownerState:V});return S||M||j&&!N?(0,C.jsx)(ip,{ref:F,container:d,disablePortal:v,children:(0,C.jsxs)(W,l(l({},Z),{},{children:[!w&&r?(0,C.jsx)(H,l({},X)):null,(0,C.jsx)($d,{disableEnforceFocus:y,disableAutoFocus:g,disableRestoreFocus:x,isEnabled:B,open:M,children:e.cloneElement(h,G)})]}))}):null}),Tf=Sf;function Ef(e){return Sd("MuiPaper",e)}Td("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const Af=["className","component","elevation","square","variant"],Mf=xp("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t["elevation".concat(n.elevation)]]}})(wp(e=>{let{theme:t}=e;return{backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:e=>{let{ownerState:t}=e;return!t.square},style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:"1px solid ".concat((t.vars||t).palette.divider)}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}})),kf=e.forwardRef(function(e,t){var n;const i=Ap({props:e,name:"MuiPaper"}),r=Yp(),{className:o,component:s="div",elevation:a=1,square:c=!1,variant:h="elevation"}=i,d=u(i,Af),p=l(l({},i),{},{component:s,elevation:a,square:c,variant:h}),f=(e=>{const{square:t,elevation:n,variant:i,classes:r}=e;return Vd({root:["root",i,!t&&"rounded","elevation"===i&&"elevation".concat(n)]},Ef,r)})(p);return(0,C.jsx)(Mf,l(l({as:s,ownerState:p,className:Ha(f.root,o),ref:t},d),{},{style:l(l({},"elevation"===h&&l(l({"--Paper-shadow":(r.vars||r).shadows[a]},r.vars&&{"--Paper-overlay":null===(n=r.vars.overlays)||void 0===n?void 0:n[a]}),!r.vars&&"dark"===r.palette.mode&&{"--Paper-overlay":"linear-gradient(".concat(ah("#fff",nd(a)),", ").concat(ah("#fff",nd(a)),")")})),d.style)}))});function Cf(e){return Sd("MuiDialog",e)}const Pf=Td("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]);const If=e.createContext({}),Df=["aria-describedby","aria-labelledby","aria-modal","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onClick","onClose","open","PaperComponent","PaperProps","scroll","slots","slotProps","TransitionComponent","transitionDuration","TransitionProps"],zf=xp(af,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),Rf=xp(Tf,{name:"MuiDialog",slot:"Root"})({"@media print":{position:"absolute !important"}}),Lf=xp("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.container,t["scroll".concat(Wd(n.scroll))]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),Of=xp(kf,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.paper,t["scrollPaper".concat(Wd(n.scroll))],t["paperWidth".concat(Wd(String(n.maxWidth)))],n.fullWidth&&t.paperFullWidth,n.fullScreen&&t.paperFullScreen]}})(wp(e=>{let{theme:t}=e;return{margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:e=>{let{ownerState:t}=e;return!t.maxWidth},style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:"px"===t.breakpoints.unit?Math.max(t.breakpoints.values.xs,444):"max(".concat(t.breakpoints.values.xs).concat(t.breakpoints.unit,", 444px)"),["&.".concat(Pf.paperScrollBody)]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(t.breakpoints.values).filter(e=>"xs"!==e).map(e=>({props:{maxWidth:e},style:{maxWidth:"".concat(t.breakpoints.values[e]).concat(t.breakpoints.unit),["&.".concat(Pf.paperScrollBody)]:{[t.breakpoints.down(t.breakpoints.values[e]+64)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:e=>{let{ownerState:t}=e;return t.fullWidth},style:{width:"calc(100% - 64px)"}},{props:e=>{let{ownerState:t}=e;return t.fullScreen},style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,["&.".concat(Pf.paperScrollBody)]:{margin:0,maxWidth:"100%"}}}]}})),Ff=e.forwardRef(function(t,n){const i=Ap({props:t,name:"MuiDialog"}),r=Yp(),o={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{"aria-describedby":s,"aria-labelledby":a,"aria-modal":c=!0,BackdropComponent:h,BackdropProps:d,children:p,className:f,disableEscapeKeyDown:m=!1,fullScreen:g=!1,fullWidth:y=!1,maxWidth:_="sm",onClick:v,onClose:x,open:b,PaperComponent:w=kf,PaperProps:S={},scroll:T="paper",slots:E={},slotProps:A={},TransitionComponent:M=nf,transitionDuration:k=o,TransitionProps:P}=i,I=u(i,Df),D=l(l({},i),{},{disableEscapeKeyDown:m,fullScreen:g,fullWidth:y,maxWidth:_,scroll:T}),z=(e=>{const{classes:t,scroll:n,maxWidth:i,fullWidth:r,fullScreen:o}=e;return Vd({root:["root"],container:["container","scroll".concat(Wd(n))],paper:["paper","paperScroll".concat(Wd(n)),"paperWidth".concat(Wd(String(i))),r&&"paperFullWidth",o&&"paperFullScreen"]},Cf,t)})(D),R=e.useRef(),L=qd(a),O=e.useMemo(()=>({titleId:L}),[L]),F={slots:l({transition:M},E),slotProps:l({transition:P,paper:S,backdrop:d},A)},[B,N]=Op("root",{elementType:Rf,shouldForwardComponentProp:!0,externalForwardedProps:F,ownerState:D,className:Ha(z.root,f),ref:n}),[j,V]=Op("backdrop",{elementType:zf,shouldForwardComponentProp:!0,externalForwardedProps:F,ownerState:D}),[U,G]=Op("paper",{elementType:Of,shouldForwardComponentProp:!0,externalForwardedProps:F,ownerState:D,className:Ha(z.paper,S.className)}),[q,W]=Op("container",{elementType:Lf,externalForwardedProps:F,ownerState:D,className:z.container}),[Z,H]=Op("transition",{elementType:nf,externalForwardedProps:F,ownerState:D,additionalProps:{appear:!0,in:b,timeout:k,role:"presentation"}});return(0,C.jsx)(B,l(l(l({closeAfterTransition:!0,slots:{backdrop:j},slotProps:{backdrop:l({transitionDuration:k,as:h},V)},disableEscapeKeyDown:m,onClose:x,open:b,onClick:e=>{v&&v(e),R.current&&(R.current=null,x&&x(e,"backdropClick"))}},N),I),{},{children:(0,C.jsx)(Z,l(l({},H),{},{children:(0,C.jsx)(q,l(l({onMouseDown:e=>{R.current=e.target===e.currentTarget}},W),{},{children:(0,C.jsx)(U,l(l({as:w,elevation:24,role:"dialog","aria-describedby":s,"aria-labelledby":L,"aria-modal":c},G),{},{children:(0,C.jsx)(If.Provider,{value:O,children:p})}))}))}))}))}),Bf=Ff;function Nf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t=>{let[,n]=t;return n&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!function(e){return"string"===typeof e.main}(e))return!1;for(const n of t)if(!e.hasOwnProperty(n)||"string"!==typeof e[n])return!1;return!0}(n,e)}}function jf(e){return Sd("MuiTypography",e)}Td("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Vf=["color"],Uf=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],Gf={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},qf=ju,Wf=xp("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.variant&&t[n.variant],"inherit"!==n.align&&t["align".concat(Wd(n.align))],n.noWrap&&t.noWrap,n.gutterBottom&&t.gutterBottom,n.paragraph&&t.paragraph]}})(wp(e=>{var t;let{theme:n}=e;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(n.typography).filter(e=>{let[t,n]=e;return"inherit"!==t&&n&&"object"===typeof n}).map(e=>{let[t,n]=e;return{props:{variant:t},style:n}}),...Object.entries(n.palette).filter(Nf()).map(e=>{let[t]=e;return{props:{color:t},style:{color:(n.vars||n).palette[t].main}}}),...Object.entries((null===(t=n.palette)||void 0===t?void 0:t.text)||{}).filter(e=>{let[,t]=e;return"string"===typeof t}).map(e=>{let[t]=e;return{props:{color:"text".concat(Wd(t))},style:{color:(n.vars||n).palette.text[t]}}}),{props:e=>{let{ownerState:t}=e;return"inherit"!==t.align},style:{textAlign:"var(--Typography-textAlign)"}},{props:e=>{let{ownerState:t}=e;return t.noWrap},style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:e=>{let{ownerState:t}=e;return t.gutterBottom},style:{marginBottom:"0.35em"}},{props:e=>{let{ownerState:t}=e;return t.paragraph},style:{marginBottom:16}}]}})),Zf={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Hf=e.forwardRef(function(e,t){const n=Ap({props:e,name:"MuiTypography"}),{color:i}=n,r=u(n,Vf),o=!Gf[i],s=qf(l(l({},r),o&&{color:i})),{align:a="inherit",className:c,component:h,gutterBottom:d=!1,noWrap:p=!1,paragraph:f=!1,variant:m="body1",variantMapping:g=Zf}=s,y=u(s,Uf),_=l(l({},s),{},{align:a,color:i,className:c,component:h,gutterBottom:d,noWrap:p,paragraph:f,variant:m,variantMapping:g}),v=h||(f?"p":g[m]||Zf[m])||"span",x=(e=>{const{align:t,gutterBottom:n,noWrap:i,paragraph:r,variant:o,classes:s}=e;return Vd({root:["root",o,"inherit"!==e.align&&"align".concat(Wd(t)),n&&"gutterBottom",i&&"noWrap",r&&"paragraph"]},jf,s)})(_);return(0,C.jsx)(Wf,l(l({as:v,ref:t,className:Ha(x.root,c)},y),{},{ownerState:_,style:l(l({},"inherit"!==a&&{"--Typography-textAlign":a}),y.style)}))}),Xf=Hf;function Yf(e){return Sd("MuiDialogTitle",e)}const Kf=Td("MuiDialogTitle",["root"]),Jf=["className","id"],$f=xp(Xf,{name:"MuiDialogTitle",slot:"Root"})({padding:"16px 24px",flex:"0 0 auto"}),Qf=e.forwardRef(function(t,n){const i=Ap({props:t,name:"MuiDialogTitle"}),{className:r,id:o}=i,s=u(i,Jf),a=i,c=(e=>{const{classes:t}=e;return Vd({root:["root"]},Yf,t)})(a),{titleId:h=o}=e.useContext(If);return(0,C.jsx)($f,l({component:"h2",className:Ha(c.root,r),ownerState:a,ref:n,variant:"h6",id:null!==o&&void 0!==o?o:h},s))});function em(e){return Sd("MuiDialogContent",e)}Td("MuiDialogContent",["root","dividers"]);const tm=["className","dividers"],nm=xp("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dividers&&t.dividers]}})(wp(e=>{let{theme:t}=e;return{flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px",variants:[{props:e=>{let{ownerState:t}=e;return t.dividers},style:{padding:"16px 24px",borderTop:"1px solid ".concat((t.vars||t).palette.divider),borderBottom:"1px solid ".concat((t.vars||t).palette.divider)}},{props:e=>{let{ownerState:t}=e;return!t.dividers},style:{[".".concat(Kf.root," + &")]:{paddingTop:0}}}]}})),im=e.forwardRef(function(e,t){const n=Ap({props:e,name:"MuiDialogContent"}),{className:i,dividers:r=!1}=n,o=u(n,tm),s=l(l({},n),{},{dividers:r}),a=(e=>{const{classes:t,dividers:n}=e;return Vd({root:["root",n&&"dividers"]},em,t)})(s);return(0,C.jsx)(nm,l({className:Ha(a.root,i),ownerState:s,ref:t},o))});function rm(e){return Sd("MuiDivider",e)}Td("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);const om=["absolute","children","className","orientation","component","flexItem","light","role","textAlign","variant"],sm=xp("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.absolute&&t.absolute,t[n.variant],n.light&&t.light,"vertical"===n.orientation&&t.vertical,n.flexItem&&t.flexItem,n.children&&t.withChildren,n.children&&"vertical"===n.orientation&&t.withChildrenVertical,"right"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignRight,"left"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignLeft]}})(wp(e=>{let{theme:t}=e;return{margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:t.alpha((t.vars||t).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:t.spacing(2),marginRight:t.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:t.spacing(1),marginBottom:t.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:e=>{let{ownerState:t}=e;return!!t.children},style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:e=>{let{ownerState:t}=e;return t.children&&"vertical"!==t.orientation},style:{"&::before, &::after":{width:"100%",borderTop:"thin solid ".concat((t.vars||t).palette.divider),borderTopStyle:"inherit"}}},{props:e=>{let{ownerState:t}=e;return"vertical"===t.orientation&&t.children},style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:"thin solid ".concat((t.vars||t).palette.divider),borderLeftStyle:"inherit"}}},{props:e=>{let{ownerState:t}=e;return"right"===t.textAlign&&"vertical"!==t.orientation},style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:e=>{let{ownerState:t}=e;return"left"===t.textAlign&&"vertical"!==t.orientation},style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}})),am=xp("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.wrapper,"vertical"===n.orientation&&t.wrapperVertical]}})(wp(e=>{let{theme:t}=e;return{display:"inline-block",paddingLeft:"calc(".concat(t.spacing(1)," * 1.2)"),paddingRight:"calc(".concat(t.spacing(1)," * 1.2)"),whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:"calc(".concat(t.spacing(1)," * 1.2)"),paddingBottom:"calc(".concat(t.spacing(1)," * 1.2)")}}]}})),lm=e.forwardRef(function(e,t){const n=Ap({props:e,name:"MuiDivider"}),{absolute:i=!1,children:r,className:o,orientation:s="horizontal",component:a=(r||"vertical"===s?"div":"hr"),flexItem:c=!1,light:h=!1,role:d=("hr"!==a?"separator":void 0),textAlign:p="center",variant:f="fullWidth"}=n,m=u(n,om),g=l(l({},n),{},{absolute:i,component:a,flexItem:c,light:h,orientation:s,role:d,textAlign:p,variant:f}),y=(e=>{const{absolute:t,children:n,classes:i,flexItem:r,light:o,orientation:s,textAlign:a,variant:l}=e;return Vd({root:["root",t&&"absolute",l,o&&"light","vertical"===s&&"vertical",r&&"flexItem",n&&"withChildren",n&&"vertical"===s&&"withChildrenVertical","right"===a&&"vertical"!==s&&"textAlignRight","left"===a&&"vertical"!==s&&"textAlignLeft"],wrapper:["wrapper","vertical"===s&&"wrapperVertical"]},rm,i)})(g);return(0,C.jsx)(sm,l(l({as:a,className:Ha(y.root,o),role:d,ref:t,ownerState:g,"aria-orientation":"separator"!==d||"hr"===a&&"vertical"!==s?void 0:s},m),{},{children:r?(0,C.jsx)(am,{className:y.wrapper,ownerState:g,children:r}):null}))});lm&&(lm.muiSkipListHighlight=!0);const cm=lm;function um(e){return Sd("MuiDialogActions",e)}Td("MuiDialogActions",["root","spacing"]);const hm=["className","disableSpacing"],dm=xp("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:e=>{let{ownerState:t}=e;return!t.disableSpacing},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),pm=e.forwardRef(function(e,t){const n=Ap({props:e,name:"MuiDialogActions"}),{className:i,disableSpacing:r=!1}=n,o=u(n,hm),s=l(l({},n),{},{disableSpacing:r}),a=(e=>{const{classes:t,disableSpacing:n}=e;return Vd({root:["root",!n&&"spacing"]},um,t)})(s);return(0,C.jsx)(dm,l({className:Ha(a.root,i),ownerState:s,ref:t},o))}),fm=qd;function mm(e){try{return e.matches(":focus-visible")}catch(t){0}return!1}const gm=lf,ym={};function _m(t,n){const i=e.useRef(ym);return i.current===ym&&(i.current=t(n)),i}class vm{static create(){return new vm}static use(){const t=_m(vm.create).current,[n,i]=e.useState(!1);return t.shouldMount=n,t.setShouldMount=i,e.useEffect(t.mountEffect,[n]),t}constructor(){s(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&null!==this.ref.current&&(this.didMount=!0,this.mounted.resolve())}),this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}mount(){return this.mounted||(this.mounted=function(){let e,t;const n=new Promise((n,i)=>{e=n,t=i});return n.resolve=e,n.reject=t,n}(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.mount().then(()=>{var e;return null===(e=this.ref.current)||void 0===e?void 0:e.start(...t)})}stop(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.mount().then(()=>{var e;return null===(e=this.ref.current)||void 0===e?void 0:e.stop(...t)})}pulsate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.mount().then(()=>{var e;return null===(e=this.ref.current)||void 0===e?void 0:e.pulsate(...t)})}}function xm(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function bm(t,n){var i=Object.create(null);return t&&e.Children.map(t,function(e){return e}).forEach(function(t){i[t.key]=function(t){return n&&(0,e.isValidElement)(t)?n(t):t}(t)}),i}function wm(e,t,n){return null!=n[t]?n[t]:e.props[t]}function Sm(t,n,i){var r=bm(t.children),o=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var i,r=Object.create(null),o=[];for(var s in e)s in t?o.length&&(r[s]=o,o=[]):o.push(s);var a={};for(var l in t){if(r[l])for(i=0;i<r[l].length;i++){var c=r[l][i];a[r[l][i]]=n(c)}a[l]=n(l)}for(i=0;i<o.length;i++)a[o[i]]=n(o[i]);return a}(n,r);return Object.keys(o).forEach(function(s){var a=o[s];if((0,e.isValidElement)(a)){var l=s in n,c=s in r,u=n[s],h=(0,e.isValidElement)(u)&&!u.props.in;!c||l&&!h?c||!l||h?c&&l&&(0,e.isValidElement)(u)&&(o[s]=(0,e.cloneElement)(a,{onExited:i.bind(null,a),in:u.props.in,exit:wm(a,"exit",t),enter:wm(a,"enter",t)})):o[s]=(0,e.cloneElement)(a,{in:!1}):o[s]=(0,e.cloneElement)(a,{onExited:i.bind(null,a),in:!0,exit:wm(a,"exit",t),enter:wm(a,"enter",t)})}}),o}var Tm=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})},Em=function(t){function n(e,n){var i,r=(i=t.call(this,e,n)||this).handleExited.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i));return i.state={contextValue:{isMounting:!0},handleExited:r,firstRender:!0},i}Bp(n,t);var i=n.prototype;return i.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},i.componentWillUnmount=function(){this.mounted=!1},n.getDerivedStateFromProps=function(t,n){var i,r,o=n.children,s=n.handleExited;return{children:n.firstRender?(i=t,r=s,bm(i.children,function(t){return(0,e.cloneElement)(t,{onExited:r.bind(null,t),in:!0,appear:wm(t,"appear",i),enter:wm(t,"enter",i),exit:wm(t,"exit",i)})})):Sm(t,o,s),firstRender:!1}},i.handleExited=function(e,t){var n=bm(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState(function(t){var n=Xa({},t.children);return delete n[e.key],{children:n}}))},i.render=function(){var t=this.props,n=t.component,i=t.childFactory,r=c(t,["component","childFactory"]),o=this.state.contextValue,s=Tm(this.state.children).map(i);return delete r.appear,delete r.enter,delete r.exit,null===n?e.createElement(jp.Provider,{value:o},s):e.createElement(jp.Provider,{value:o},e.createElement(n,r,s))},n}(e.Component);Em.propTypes={},Em.defaultProps={component:"div",childFactory:function(e){return e}};const Am=Em,Mm=[];class km{constructor(){s(this,"currentId",null),s(this,"clear",()=>{null!==this.currentId&&(clearTimeout(this.currentId),this.currentId=null)}),s(this,"disposeEffect",()=>this.clear)}static create(){return new km}start(e,t){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,t()},e)}}function Cm(){const t=_m(km.create).current;var n;return n=t.disposeEffect,e.useEffect(n,Mm),t}n(219);var Pm=function(t,n){var i=arguments;if(null==n||!yc.call(n,"css"))return e.createElement.apply(void 0,i);var r=i.length,o=new Array(r);o[0]=xc,o[1]=function(e,t){var n={};for(var i in t)yc.call(t,i)&&(n[i]=t[i]);return n[_c]=e,n}(t,n);for(var s=2;s<r;s++)o[s]=i[s];return e.createElement.apply(null,o)};!function(e){var t;t||(t=e.JSX||(e.JSX={}))}(Pm||(Pm={}));function Im(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return hc(t)}function Dm(){var e=Im.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const zm=function(t){const{className:n,classes:i,pulsate:r=!1,rippleX:o,rippleY:s,rippleSize:a,in:l,onExited:c,timeout:u}=t,[h,d]=e.useState(!1),p=Ha(n,i.ripple,i.rippleVisible,r&&i.ripplePulsate),f={width:a,height:a,top:-a/2+s,left:-a/2+o},m=Ha(i.child,h&&i.childLeaving,r&&i.childPulsate);return l||h||d(!0),e.useEffect(()=>{if(!l&&null!=c){const e=setTimeout(c,u);return()=>{clearTimeout(e)}}},[c,l,u]),(0,C.jsx)("span",{className:p,style:f,children:(0,C.jsx)("span",{className:m})})};const Rm=Td("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Lm=["center","classes","className"];var Om,Fm,Bm,Nm;const jm=Dm(Om||(Om=xm(["\n  0% {\n    transform: scale(0);\n    opacity: 0.1;\n  }\n\n  100% {\n    transform: scale(1);\n    opacity: 0.3;\n  }\n"]))),Vm=Dm(Fm||(Fm=xm(["\n  0% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0;\n  }\n"]))),Um=Dm(Bm||(Bm=xm(["\n  0% {\n    transform: scale(1);\n  }\n\n  50% {\n    transform: scale(0.92);\n  }\n\n  100% {\n    transform: scale(1);\n  }\n"]))),Gm=xp("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),qm=xp(zm,{name:"MuiTouchRipple",slot:"Ripple"})(Nm||(Nm=xm(["\n  opacity: 0;\n  position: absolute;\n\n  &."," {\n    opacity: 0.3;\n    transform: scale(1);\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  &."," {\n    animation-duration: ","ms;\n  }\n\n  & ."," {\n    opacity: 1;\n    display: block;\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    background-color: currentColor;\n  }\n\n  & ."," {\n    opacity: 0;\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  & ."," {\n    position: absolute;\n    /* @noflip */\n    left: 0px;\n    top: 0;\n    animation-name: ",";\n    animation-duration: 2500ms;\n    animation-timing-function: ",";\n    animation-iteration-count: infinite;\n    animation-delay: 200ms;\n  }\n"])),Rm.rippleVisible,jm,550,e=>{let{theme:t}=e;return t.transitions.easing.easeInOut},Rm.ripplePulsate,e=>{let{theme:t}=e;return t.transitions.duration.shorter},Rm.child,Rm.childLeaving,Vm,550,e=>{let{theme:t}=e;return t.transitions.easing.easeInOut},Rm.childPulsate,Um,e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),Wm=e.forwardRef(function(t,n){const i=Ap({props:t,name:"MuiTouchRipple"}),{center:r=!1,classes:o={},className:s}=i,a=u(i,Lm),[c,h]=e.useState([]),d=e.useRef(0),p=e.useRef(null);e.useEffect(()=>{p.current&&(p.current(),p.current=null)},[c]);const f=e.useRef(!1),m=Cm(),g=e.useRef(null),y=e.useRef(null),_=e.useCallback(e=>{const{pulsate:t,rippleX:n,rippleY:i,rippleSize:r,cb:s}=e;h(e=>[...e,(0,C.jsx)(qm,{classes:{ripple:Ha(o.ripple,Rm.ripple),rippleVisible:Ha(o.rippleVisible,Rm.rippleVisible),ripplePulsate:Ha(o.ripplePulsate,Rm.ripplePulsate),child:Ha(o.child,Rm.child),childLeaving:Ha(o.childLeaving,Rm.childLeaving),childPulsate:Ha(o.childPulsate,Rm.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:i,rippleSize:r},d.current)]),d.current+=1,p.current=s},[o]),v=e.useCallback(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const{pulsate:i=!1,center:o=r||t.pulsate,fakeElement:s=!1}=t;if("mousedown"===(null===e||void 0===e?void 0:e.type)&&f.current)return void(f.current=!1);"touchstart"===(null===e||void 0===e?void 0:e.type)&&(f.current=!0);const a=s?null:y.current,l=a?a.getBoundingClientRect():{width:0,height:0,left:0,top:0};let c,u,h;if(o||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)c=Math.round(l.width/2),u=Math.round(l.height/2);else{const{clientX:t,clientY:n}=e.touches&&e.touches.length>0?e.touches[0]:e;c=Math.round(t-l.left),u=Math.round(n-l.top)}if(o)h=Math.sqrt((2*l.width**2+l.height**2)/3),h%2===0&&(h+=1);else{const e=2*Math.max(Math.abs((a?a.clientWidth:0)-c),c)+2,t=2*Math.max(Math.abs((a?a.clientHeight:0)-u),u)+2;h=Math.sqrt(e**2+t**2)}null!==e&&void 0!==e&&e.touches?null===g.current&&(g.current=()=>{_({pulsate:i,rippleX:c,rippleY:u,rippleSize:h,cb:n})},m.start(80,()=>{g.current&&(g.current(),g.current=null)})):_({pulsate:i,rippleX:c,rippleY:u,rippleSize:h,cb:n})},[r,_,m]),x=e.useCallback(()=>{v({},{pulsate:!0})},[v]),b=e.useCallback((e,t)=>{if(m.clear(),"touchend"===(null===e||void 0===e?void 0:e.type)&&g.current)return g.current(),g.current=null,void m.start(0,()=>{b(e,t)});g.current=null,h(e=>e.length>0?e.slice(1):e),p.current=t},[m]);return e.useImperativeHandle(n,()=>({pulsate:x,start:v,stop:b}),[x,v,b]),(0,C.jsx)(Gm,l(l({className:Ha(Rm.root,o.root,s),ref:y},a),{},{children:(0,C.jsx)(Am,{component:null,exit:!0,children:c})}))}),Zm=Wm;function Hm(e){return Sd("MuiButtonBase",e)}const Xm=Td("MuiButtonBase",["root","disabled","focusVisible"]),Ym=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],Km=xp("button",{name:"MuiButtonBase",slot:"Root"})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},["&.".concat(Xm.disabled)]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}});function Jm(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return gm(r=>(n&&n(r),i||e[t](r),!0))}const $m=e.forwardRef(function(t,n){const i=Ap({props:t,name:"MuiButtonBase"}),{action:r,centerRipple:o=!1,children:s,className:a,component:c="button",disabled:h=!1,disableRipple:d=!1,disableTouchRipple:p=!1,focusRipple:f=!1,focusVisibleClassName:m,LinkComponent:g="a",onBlur:y,onClick:_,onContextMenu:v,onDragLeave:x,onFocus:b,onFocusVisible:w,onKeyDown:S,onKeyUp:T,onMouseDown:E,onMouseLeave:A,onMouseUp:M,onTouchEnd:k,onTouchMove:P,onTouchStart:I,tabIndex:D=0,TouchRippleProps:z,touchRippleRef:R,type:L}=i,O=u(i,Ym),F=e.useRef(null),B=vm.use(),N=Jp(B.ref,R),[j,V]=e.useState(!1);h&&j&&V(!1),e.useImperativeHandle(r,()=>({focusVisible:()=>{V(!0),F.current.focus()}}),[]);const U=B.shouldMount&&!d&&!h;e.useEffect(()=>{j&&f&&!d&&B.pulsate()},[d,f,j,B]);const G=Jm(B,"start",E,p),q=Jm(B,"stop",v,p),W=Jm(B,"stop",x,p),Z=Jm(B,"stop",M,p),H=Jm(B,"stop",e=>{j&&e.preventDefault(),A&&A(e)},p),X=Jm(B,"start",I,p),Y=Jm(B,"stop",k,p),K=Jm(B,"stop",P,p),J=Jm(B,"stop",e=>{mm(e.target)||V(!1),y&&y(e)},!1),$=gm(e=>{F.current||(F.current=e.currentTarget),mm(e.target)&&(V(!0),w&&w(e)),b&&b(e)}),Q=()=>{const e=F.current;return c&&"button"!==c&&!("A"===e.tagName&&e.href)},ee=gm(e=>{f&&!e.repeat&&j&&" "===e.key&&B.stop(e,()=>{B.start(e)}),e.target===e.currentTarget&&Q()&&" "===e.key&&e.preventDefault(),S&&S(e),e.target===e.currentTarget&&Q()&&"Enter"===e.key&&!h&&(e.preventDefault(),_&&_(e))}),te=gm(e=>{f&&" "===e.key&&j&&!e.defaultPrevented&&B.stop(e,()=>{B.pulsate(e)}),T&&T(e),_&&e.target===e.currentTarget&&Q()&&" "===e.key&&!e.defaultPrevented&&_(e)});let ne=c;"button"===ne&&(O.href||O.to)&&(ne=g);const ie={};"button"===ne?(ie.type=void 0===L?"button":L,ie.disabled=h):(O.href||O.to||(ie.role="button"),h&&(ie["aria-disabled"]=h));const re=Jp(n,F),oe=l(l({},i),{},{centerRipple:o,component:c,disabled:h,disableRipple:d,disableTouchRipple:p,focusRipple:f,tabIndex:D,focusVisible:j}),se=(e=>{const{disabled:t,focusVisible:n,focusVisibleClassName:i,classes:r}=e,o=Vd({root:["root",t&&"disabled",n&&"focusVisible"]},Hm,r);return n&&i&&(o.root+=" ".concat(i)),o})(oe);return(0,C.jsxs)(Km,l(l(l({as:ne,className:Ha(se.root,a),ownerState:oe,onBlur:J,onClick:_,onContextMenu:q,onFocus:$,onKeyDown:ee,onKeyUp:te,onMouseDown:G,onMouseLeave:H,onMouseUp:Z,onDragLeave:W,onTouchEnd:Y,onTouchMove:K,onTouchStart:X,ref:re,tabIndex:h?-1:D,type:L},ie),O),{},{children:[s,U?(0,C.jsx)(Zm,l({ref:N,center:o},z)):null]}))});function Qm(e){return Sd("MuiCircularProgress",e)}Td("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const eg=["className","color","disableShrink","size","style","thickness","value","variant"];var tg,ng,ig,rg;const og=44,sg=Dm(tg||(tg=xm(["\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n"]))),ag=Dm(ng||(ng=xm(["\n  0% {\n    stroke-dasharray: 1px, 200px;\n    stroke-dashoffset: 0;\n  }\n\n  50% {\n    stroke-dasharray: 100px, 200px;\n    stroke-dashoffset: -15px;\n  }\n\n  100% {\n    stroke-dasharray: 1px, 200px;\n    stroke-dashoffset: -126px;\n  }\n"]))),lg="string"!==typeof sg?Im(ig||(ig=xm(["\n        animation: "," 1.4s linear infinite;\n      "])),sg):null,cg="string"!==typeof ag?Im(rg||(rg=xm(["\n        animation: "," 1.4s ease-in-out infinite;\n      "])),ag):null,ug=xp("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t["color".concat(Wd(n.color))]]}})(wp(e=>{let{theme:t}=e;return{display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("transform")}},{props:{variant:"indeterminate"},style:lg||{animation:"".concat(sg," 1.4s linear infinite")}},...Object.entries(t.palette).filter(Nf()).map(e=>{let[n]=e;return{props:{color:n},style:{color:(t.vars||t).palette[n].main}}})]}})),hg=xp("svg",{name:"MuiCircularProgress",slot:"Svg"})({display:"block"}),dg=xp("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.circle,t["circle".concat(Wd(n.variant))],n.disableShrink&&t.circleDisableShrink]}})(wp(e=>{let{theme:t}=e;return{stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&!t.disableShrink},style:cg||{animation:"".concat(ag," 1.4s ease-in-out infinite")}}]}})),pg=e.forwardRef(function(e,t){const n=Ap({props:e,name:"MuiCircularProgress"}),{className:i,color:r="primary",disableShrink:o=!1,size:s=40,style:a,thickness:c=3.6,value:h=0,variant:d="indeterminate"}=n,p=u(n,eg),f=l(l({},n),{},{color:r,disableShrink:o,size:s,thickness:c,value:h,variant:d}),m=(e=>{const{classes:t,variant:n,color:i,disableShrink:r}=e;return Vd({root:["root",n,"color".concat(Wd(i))],svg:["svg"],circle:["circle","circle".concat(Wd(n)),r&&"circleDisableShrink"]},Qm,t)})(f),g={},y={},_={};if("determinate"===d){const e=2*Math.PI*((og-c)/2);g.strokeDasharray=e.toFixed(3),_["aria-valuenow"]=Math.round(h),g.strokeDashoffset="".concat(((100-h)/100*e).toFixed(3),"px"),y.transform="rotate(-90deg)"}return(0,C.jsx)(ug,l(l(l({className:Ha(m.root,i),style:l(l({width:s,height:s},y),a),ownerState:f,ref:t,role:"progressbar"},_),p),{},{children:(0,C.jsx)(hg,{className:m.svg,ownerState:f,viewBox:"".concat(22," ").concat(22," ").concat(og," ").concat(og),children:(0,C.jsx)(dg,{className:m.circle,style:g,ownerState:f,cx:og,cy:og,r:(og-c)/2,fill:"none",strokeWidth:c})})}))}),fg=pg;function mg(e){return Sd("MuiButton",e)}const gg=Td("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]);const yg=e.createContext({});const _g=e.createContext(void 0),vg=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","id","loading","loadingIndicator","loadingPosition","size","startIcon","type","variant"],xg=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],bg=xp($m,{shouldForwardProp:e=>_p(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t["".concat(n.variant).concat(Wd(n.color))],t["size".concat(Wd(n.size))],t["".concat(n.variant,"Size").concat(Wd(n.size))],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth,n.loading&&t.loading]}})(wp(e=>{let{theme:t}=e;const n="light"===t.palette.mode?t.palette.grey[300]:t.palette.grey[800],i="light"===t.palette.mode?t.palette.grey.A100:t.palette.grey[700];return l(l({},t.typography.button),{},{minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},["&.".concat(gg.disabled)]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},["&.".concat(gg.focusVisible)]:{boxShadow:(t.vars||t).shadows[6]},["&.".concat(gg.disabled)]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",["&.".concat(gg.disabled)]:{border:"1px solid ".concat((t.vars||t).palette.action.disabledBackground)}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(Nf()).map(e=>{let[n]=e;return{props:{color:n},style:{"--variant-textColor":(t.vars||t).palette[n].main,"--variant-outlinedColor":(t.vars||t).palette[n].main,"--variant-outlinedBorder":t.alpha((t.vars||t).palette[n].main,.5),"--variant-containedColor":(t.vars||t).palette[n].contrastText,"--variant-containedBg":(t.vars||t).palette[n].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[n].dark,"--variant-textBg":t.alpha((t.vars||t).palette[n].main,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[n].main,"--variant-outlinedBg":t.alpha((t.vars||t).palette[n].main,(t.vars||t).palette.action.hoverOpacity)}}}}}),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:n,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:i,"--variant-textBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},["&.".concat(gg.focusVisible)]:{boxShadow:"none"},"&:active":{boxShadow:"none"},["&.".concat(gg.disabled)]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),["&.".concat(gg.loading)]:{color:"transparent"}}}]})})),wg=xp("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.startIcon,n.loading&&t.startIconLoadingStart,t["iconSize".concat(Wd(n.size))]]}})(e=>{let{theme:t}=e;return{display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...xg]}}),Sg=xp("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.endIcon,n.loading&&t.endIconLoadingEnd,t["iconSize".concat(Wd(n.size))]]}})(e=>{let{theme:t}=e;return{display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...xg]}}),Tg=xp("span",{name:"MuiButton",slot:"LoadingIndicator"})(e=>{let{theme:t}=e;return{display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(t.vars||t).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]}}),Eg=xp("span",{name:"MuiButton",slot:"LoadingIconPlaceholder"})({display:"inline-block",width:"1em",height:"1em"}),Ag=e.forwardRef(function(t,n){const i=e.useContext(yg),r=e.useContext(_g),o=Ap({props:Sp(i,t),name:"MuiButton"}),{children:s,color:a="primary",component:c="button",className:h,disabled:d=!1,disableElevation:p=!1,disableFocusRipple:f=!1,endIcon:m,focusVisibleClassName:g,fullWidth:y=!1,id:_,loading:v=null,loadingIndicator:x,loadingPosition:b="center",size:w="medium",startIcon:S,type:T,variant:E="text"}=o,A=u(o,vg),M=fm(_),k=null!==x&&void 0!==x?x:(0,C.jsx)(fg,{"aria-labelledby":M,color:"inherit",size:16}),P=l(l({},o),{},{color:a,component:c,disabled:d,disableElevation:p,disableFocusRipple:f,fullWidth:y,loading:v,loadingIndicator:k,loadingPosition:b,size:w,type:T,variant:E}),I=(e=>{const{color:t,disableElevation:n,fullWidth:i,size:r,variant:o,loading:s,loadingPosition:a,classes:c}=e,u=Vd({root:["root",s&&"loading",o,"".concat(o).concat(Wd(t)),"size".concat(Wd(r)),"".concat(o,"Size").concat(Wd(r)),"color".concat(Wd(t)),n&&"disableElevation",i&&"fullWidth",s&&"loadingPosition".concat(Wd(a))],startIcon:["icon","startIcon","iconSize".concat(Wd(r))],endIcon:["icon","endIcon","iconSize".concat(Wd(r))],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},mg,c);return l(l({},c),u)})(P),D=(S||v&&"start"===b)&&(0,C.jsx)(wg,{className:I.startIcon,ownerState:P,children:S||(0,C.jsx)(Eg,{className:I.loadingIconPlaceholder,ownerState:P})}),z=(m||v&&"end"===b)&&(0,C.jsx)(Sg,{className:I.endIcon,ownerState:P,children:m||(0,C.jsx)(Eg,{className:I.loadingIconPlaceholder,ownerState:P})}),R=r||"",L="boolean"===typeof v?(0,C.jsx)("span",{className:I.loadingWrapper,style:{display:"contents"},children:v&&(0,C.jsx)(Tg,{className:I.loadingIndicator,ownerState:P,children:k})}):null;return(0,C.jsxs)(bg,l(l({ownerState:P,className:Ha(i.className,I.root,h,R),component:c,disabled:d||v,focusRipple:!f,focusVisibleClassName:Ha(I.focusVisible,g),ref:n,type:T,id:v?M:_},A),{},{classes:I,children:[D,"end"!==b&&L,s,"end"===b&&L,z]}))}),Mg=Ag,kg=e=>{let{isOpen:t,handleChange:n,property:i}=e;const r=()=>{n(!1)},o=i.propertyDetails;return(0,C.jsxs)(Bf,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,children:[(0,C.jsx)(Qf,{sx:{bgcolor:"primary.main",color:"white"},children:(null===o||void 0===o?void 0:o.name)||"\u7269\u4ef6\u60c5\u5831"}),(0,C.jsx)(im,{sx:{mt:2},children:(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"\u57fa\u672c\u60c5\u5831"}),(0,C.jsxs)(kd,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,mb:2},children:[(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u6240\u5728\u5730"}),(0,C.jsx)(Xf,{variant:"body1",children:i.address})]}),(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u4ea4\u901a"}),(0,C.jsx)(Xf,{variant:"body1",children:(null===o||void 0===o?void 0:o.station)||"\u6700\u5bc4\u99c5\u5f92\u6b69".concat(i.nearStation[0].min,"\u5206")})]}),(null===o||void 0===o?void 0:o.landArea)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u571f\u5730\u9762\u7a4d"}),(0,C.jsxs)(Xf,{variant:"body1",children:[o.landArea,"\u33a1"]})]}),(null===o||void 0===o?void 0:o.buildingArea)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u5efa\u7269\u9762\u7a4d"}),(0,C.jsxs)(Xf,{variant:"body1",children:[o.buildingArea,"\u33a1"]})]}),(null===o||void 0===o?void 0:o.builtYear)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u7bc9\u5e74\u6708"}),(0,C.jsxs)(Xf,{variant:"body1",children:[o.builtYear,"\u5e74",o.builtMonth,"\u6708"]})]}),(null===o||void 0===o?void 0:o.structure)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u69cb\u9020"}),(0,C.jsx)(Xf,{variant:"body1",children:o.structure})]})]}),(0,C.jsx)(cm,{sx:{my:2}}),(0,C.jsx)(Xf,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"\u90fd\u5e02\u8a08\u753b"}),(0,C.jsxs)(kd,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,mb:2},children:[(null===o||void 0===o?void 0:o.useDistrict)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u7528\u9014\u5730\u57df"}),(0,C.jsx)(Xf,{variant:"body1",children:o.useDistrict})]}),(null===o||void 0===o?void 0:o.volumeRate)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u5bb9\u7a4d\u7387"}),(0,C.jsxs)(Xf,{variant:"body1",children:[o.volumeRate,"%"]})]}),(null===o||void 0===o?void 0:o.coverageRate)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u5efa\u853d\u7387"}),(0,C.jsxs)(Xf,{variant:"body1",children:[o.coverageRate,"%"]})]}),(null===o||void 0===o?void 0:o.cityPlan)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u90fd\u5e02\u8a08\u753b"}),(0,C.jsx)(Xf,{variant:"body1",children:o.cityPlan})]})]}),(0,C.jsx)(cm,{sx:{my:2}}),(0,C.jsx)(Xf,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"\u898f\u5236\u60c5\u5831"}),(0,C.jsxs)(kd,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,mb:2},children:[(null===o||void 0===o?void 0:o.fireProof)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u9632\u706b\u898f\u5236"}),(0,C.jsx)(Xf,{variant:"body1",children:o.fireProof})]}),(null===o||void 0===o?void 0:o.heightDistrict)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u9ad8\u5ea6\u5730\u533a"}),(0,C.jsx)(Xf,{variant:"body1",children:o.heightDistrict})]})]}),(0,C.jsx)(cm,{sx:{my:2}}),(0,C.jsx)(Xf,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"\u8a2d\u5099\u30fb\u305d\u306e\u4ed6"}),(0,C.jsxs)(kd,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[(null===o||void 0===o?void 0:o.landRight)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u571f\u5730\u6a29\u5229"}),(0,C.jsx)(Xf,{variant:"body1",children:o.landRight})]}),(null===o||void 0===o?void 0:o.frontRoad)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u63a5\u9053"}),(0,C.jsx)(Xf,{variant:"body1",children:o.frontRoad})]}),(null===o||void 0===o?void 0:o.facilities)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u8a2d\u5099"}),(0,C.jsx)(Xf,{variant:"body1",children:o.facilities})]}),(null===o||void 0===o?void 0:o.status)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u73fe\u72b6"}),(0,C.jsx)(Xf,{variant:"body1",children:o.status})]}),(null===o||void 0===o?void 0:o.layout)&&(0,C.jsxs)(kd,{children:[(0,C.jsx)(Xf,{variant:"body2",color:"text.secondary",children:"\u9593\u53d6\u308a"}),(0,C.jsx)(Xf,{variant:"body1",children:o.layout})]})]})]})}),(0,C.jsx)(pm,{children:(0,C.jsx)(Mg,{onClick:r,color:"primary",children:"\u9589\u3058\u308b"})})]})},Cg={type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#ed6498","line-width":5,"line-opacity":.8}},Pg=t=>{let{currentStore:n,map:i}=t;const[r,o]=(0,e.useState)([]),[s,a]=(0,e.useState)(!1),[c,u]=(0,e.useState)(),h=(e,t,n,i)=>{const{nearStation:r}=t,{min:o}=r[0];console.log("click"),a(!0),u(t),e.flyTo({center:n,zoom:13,essential:!0}),e.getSource(i)?((e,t)=>{e.getLayer(t)?e.removeLayer(t):e.addLayer(l(l({},Cg),{},{id:t,source:t}))})(e,i):((e,t,n,i)=>{const r=Nd(Dd(t),55*i*.001,{steps:50,units:"kilometers"});e.addSource(n,{type:"geojson",data:r}),e.addLayer(l(l({},Cg),{},{id:n,source:n}))})(e,n,i,o)};return(0,e.useEffect)(()=>{if(!i||null===i)return;r.length&&(r.forEach(e=>e.remove()),o([]));const e=n.map((e,t)=>{const{nearStation:n,wood:{originalRaito:r}}=e,{geometry:o}=n[0],s=Object.values(o).map(e=>e).sort((e,t)=>t-e),a="".concat("property-").concat(t);return new jd({color:(l=r,l>=900?"red":l>=850?"orange":l>=800?"yellow":l>=750?"green":l>=700?"blue":"purple")}).setLngLat(s).onClick(()=>h(i,e,s,a)).addTo(i);var l});o(e),i.on("mouseenter","places",()=>{i.getCanvas().style.cursor="pointer"}),i.on("mouseleave","places",()=>{i.getCanvas().style.cursor=""})},[n,i]),(0,C.jsx)(C.Fragment,{children:c&&(0,C.jsx)(kg,{isOpen:s,handleChange:e=>{a(e)},property:c})})},Ig={youto:{tokyo:"tokyo-youto",chiba:"chiba-youto",kanagawa:"kanagawa-youto",saitama:"saitama-youto",osaka:"osaka-youto",hiroshima:"hiroshima-youto",fukuoka:"fukuoka-youto",hyogo:"hyogo-youto"},koudo:{tokyo:"tokyo-koudo-188t9f"},bouka:{tokyo:"tokyo-bouka"},height:{tokyo:"building"}},Dg=[139.7673068,35.6809591],zg=[135.495951,34.702485],Rg={TUP5F1:{name:"\u9ad8\u5ea6\u5730\u533a\u7a2e\u5225",values:{1:"\u7b2c\u4e00\u7a2e\u9ad8\u5ea6\u5730\u533a",2:"\u7b2c\u4e8c\u7a2e\u9ad8\u5ea6\u5730\u533a",3:"\u7b2c\u4e09\u7a2e\u9ad8\u5ea6\u5730\u533a",4:"\u306a\u3057"}},TUP5F3:{name:"\u6700\u4f4e\u9650\u9ad8\u5ea6",unit:"m"},TUP5F4:{name:"\u6700\u9ad8\u9650\u9ad8\u5ea6",unit:"m"},AREA:{name:"\u9762\u7a4d",unit:"\u33a1"}},Lg={TUP5M1:{name:"\u9632\u706b\u5730\u57df",values:{0:"\u306a\u3057",1:"\u9632\u706b\u5730\u57df",2:"\u6e96\u9632\u706b\u5730\u57df",3:"\u9632\u706b\u30fb\u6e96\u9632\u706b\u5730\u57df"}},TUP5M2:{name:"22\u6761\u5730\u57df",values:{0:"\u306a\u3057",1:"22\u6761\u5730\u57df"}},TUP6F1:{name:"\u9632\u706b\u5730\u57df",values:{10:"\u9632\u706b\u5730\u57df",20:"\u6e96\u9632\u706b\u5730\u57df"}},AREA:{name:"\u9762\u7a4d",unit:"\u33a1"}},Og={youto:{name:"\u7528\u9014\u5730\u57df",values:{0:"\u7528\u9014\u5730\u57df\u306e\u6307\u5b9a\u3092\u3057\u306a\u3044\u533a\u57df",1:"\u7b2c1\u7a2e\u4f4e\u5c64\u4f4f\u5c45\u5c02\u7528\u5730\u57df",2:"\u7b2c2\u7a2e\u4f4e\u5c64\u4f4f\u5c45\u5c02\u7528\u5730\u57df",3:"\u7b2c1\u7a2e\u4e2d\u9ad8\u5c64\u4f4f\u5c45\u5c02\u7528\u5730\u57df",4:"\u7b2c2\u7a2e\u4e2d\u9ad8\u5c64\u4f4f\u5c45\u5c02\u7528\u5730\u57df",5:"\u7b2c1\u7a2e\u4f4f\u5c45\u5730\u57df",6:"\u7b2c2\u7a2e\u4f4f\u5c45\u5730\u57df",7:"\u6e96\u4f4f\u5c45\u5730\u57df",8:"\u7530\u5712\u4f4f\u5c45\u5730\u57df",9:"\u8fd1\u96a3\u5546\u696d\u5730\u57df",10:"\u5546\u696d\u5730\u57df",11:"\u6e96\u5de5\u696d\u5730\u57df",12:"\u5de5\u696d\u5730\u57df",13:"\u5de5\u696d\u5c02\u7528\u5730\u57df"}},yoseki:{name:"\u5bb9\u7a4d\u7387",unit:"%"},kenpei:{name:"\u5efa\u853d\u7387",unit:"%"},A01_001:{name:"\u7528\u9014\u5730\u57df\u30b3\u30fc\u30c9"},A01_002:{name:"\u533a\u5206"},A01_003:{name:"\u5efa\u853d\u7387",unit:"%"},A01_004:{name:"\u5bb9\u7a4d\u7387",unit:"%"},A29_005:{name:"\u7528\u9014\u5730\u57df"},A29_006:{name:"\u5efa\u853d\u7387",unit:"%"},A29_007:{name:"\u5bb9\u7a4d\u7387",unit:"%"},AREA:{name:"\u9762\u7a4d",unit:"\u33a1"}},Fg=e=>e.includes("koudo")?"\u9ad8\u5ea6\u5730\u533a":e.includes("bouka")?"\u9632\u706b\u6307\u5b9a":e.includes("youto")?"\u7528\u9014\u5730\u57df":e.includes("building")||e.includes("height")?"\u5efa\u7269\u9ad8\u5ea6":e,Bg=(e,t,n,i)=>{let r="";if(void 0!==e.TUP5F1){const o=Rg.TUP5F1.values[e.TUP5F1]||"\u30bf\u30a4\u30d7".concat(e.TUP5F1);r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u7a2e\u5225</span><span style="').concat(i,'">').concat(o,"</span></div>")}return void 0!==e.TUP5F3&&e.TUP5F3>0&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u6700\u4f4e\u9650\u9ad8\u5ea6</span><span style="').concat(i,'">').concat(e.TUP5F3,"m</span></div>")),void 0!==e.TUP5F4&&e.TUP5F4>0&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u6700\u9ad8\u9650\u9ad8\u5ea6</span><span style="').concat(i,'">').concat(e.TUP5F4,"m</span></div>")),void 0!==e.AREA&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u9762\u7a4d</span><span style="').concat(i,'">').concat(e.AREA.toFixed(0).toLocaleString(),"\u33a1</span></div>")),r},Ng=(e,t,n,i)=>{let r="";if(void 0!==e.TUP5M1){const o=Lg.TUP5M1.values[e.TUP5M1]||"\u30bf\u30a4\u30d7".concat(e.TUP5M1);r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u9632\u706b\u5730\u57df</span><span style="').concat(i,'">').concat(o,"</span></div>")}if(void 0!==e.TUP5M2&&0!==e.TUP5M2){const o=Lg.TUP5M2.values[e.TUP5M2]||"\u30bf\u30a4\u30d7".concat(e.TUP5M2);r+='<div style="'.concat(t,'"><span style="').concat(n,'">22\u6761\u5730\u57df</span><span style="').concat(i,'">').concat(o,"</span></div>")}return void 0!==e.AREA&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u9762\u7a4d</span><span style="').concat(i,'">').concat(e.AREA.toFixed(0).toLocaleString(),"\u33a1</span></div>")),r},jg=(e,t,n,i)=>{let r="";if(void 0!==e.youto){const o=Og.youto.values[e.youto]||"\u30bf\u30a4\u30d7".concat(e.youto);r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u7528\u9014\u5730\u57df</span><span style="').concat(i,'">').concat(o,"</span></div>")}else if(void 0!==e.A01_001){const o=Og.youto.values[e.A01_001]||"\u30bf\u30a4\u30d7".concat(e.A01_001);r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u7528\u9014\u5730\u57df</span><span style="').concat(i,'">').concat(o,"</span></div>")}return void 0!==e.yoseki?r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u5bb9\u7a4d\u7387</span><span style="').concat(i,'">').concat(e.yoseki,"%</span></div>"):void 0!==e.A01_004&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u5bb9\u7a4d\u7387</span><span style="').concat(i,'">').concat(e.A01_004,"%</span></div>")),void 0!==e.kenpei?r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u5efa\u853d\u7387</span><span style="').concat(i,'">').concat(e.kenpei,"%</span></div>"):void 0!==e.A01_003&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u5efa\u853d\u7387</span><span style="').concat(i,'">').concat(e.A01_003,"%</span></div>")),void 0!==e.AREA&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u9762\u7a4d</span><span style="').concat(i,'">').concat(e.AREA.toFixed(0).toLocaleString(),"\u33a1</span></div>")),r},Vg=(e,t,n,i)=>{let r="";return void 0!==e.height&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u5efa\u7269\u9ad8\u3055</span><span style="').concat(i,'">').concat(e.height,"m</span></div>")),void 0!==e.floors&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u968e\u6570</span><span style="').concat(i,'">').concat(e.floors,"\u968e</span></div>")),void 0!==e.type&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u5efa\u7269\u7a2e\u5225</span><span style="').concat(i,'">').concat(e.type,"</span></div>")),void 0!==e.AREA&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">\u9762\u7a4d</span><span style="').concat(i,'">').concat(e.AREA.toFixed(0).toLocaleString(),"\u33a1</span></div>")),r},Ug=(e,t,n,i)=>{let r="";const o=["name","type","category","AREA","height","floors"];for(const[s,a]of Object.entries(e))if(o.includes(s)&&void 0!==a&&null!==a){const e="AREA"===s?"\u9762\u7a4d":s,o="AREA"===s?"".concat(a.toFixed(0).toLocaleString(),"\u33a1"):String(a);r+='<div style="'.concat(t,'"><span style="').concat(n,'">').concat(e,'</span><span style="').concat(i,'">').concat(o,"</span></div>")}if(!r){let o=0;for(const[s,a]of Object.entries(e)){if(o>=3)break;void 0!==a&&null!==a&&(r+='<div style="'.concat(t,'"><span style="').concat(n,'">').concat(s,'</span><span style="').concat(i,'">').concat(String(a),"</span></div>"),o++)}}return r},Gg=e=>{const t="\n    margin: 8px 0;\n    padding: 8px;\n    background: #f8f9fa;\n    border-radius: 6px;\n    border-left: 4px solid #667eea;\n  ",n="\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 4px 0;\n  ",i="\n    font-weight: 500;\n    color: #495057;\n    font-size: 13px;\n  ",r="\n    font-weight: 600;\n    color: #212529;\n    font-size: 14px;\n  ";let o=null,s=null,a=null,l=null;for(const f of e){const e=f.layer.id,t=f.properties;e.includes("youto")&&!o?o=t:e.includes("bouka")&&!s?s=t:e.includes("koudo")&&!a?a=t:!e.includes("building")&&!e.includes("height")||l||(l=t)}let c='<div style="'.concat("\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    line-height: 1.6;\n    color: #333;\n    max-width: 420px;\n  ",'">');if(o){if(c+='<div style="'.concat(t,'">'),c+='<div style="font-weight: 600; color: #4b5563; font-size: 12px; margin-bottom: 6px;">\u90fd\u5e02\u8a08\u753b</div>',void 0!==o.A29_005)c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u7528\u9014\u5730\u57df</span><span style="').concat(r,'">').concat(o.A29_005,"</span></div>");else if(void 0!==o.youto){const e=Og.youto.values[o.youto]||"\u6e96\u5de5\u696d\u5730\u57df";c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u7528\u9014\u5730\u57df</span><span style="').concat(r,'">').concat(e,"</span></div>")}else if(void 0!==o.A01_001){const e=Og.youto.values[o.A01_001]||"\u6e96\u5de5\u696d\u5730\u57df";c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u7528\u9014\u5730\u57df</span><span style="').concat(r,'">').concat(e,"</span></div>")}void 0!==o.A29_007?c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5bb9\u7a4d\u7387</span><span style="').concat(r,'">').concat(o.A29_007,"%</span></div>"):void 0!==o.yoseki?c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5bb9\u7a4d\u7387</span><span style="').concat(r,'">').concat(o.yoseki,"%</span></div>"):void 0!==o.A01_004&&(c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5bb9\u7a4d\u7387</span><span style="').concat(r,'">').concat(o.A01_004,"%</span></div>")),void 0!==o.A29_006?c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5efa\u853d\u7387</span><span style="').concat(r,'">').concat(o.A29_006,"%</span></div>"):void 0!==o.kenpei?c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5efa\u853d\u7387</span><span style="').concat(r,'">').concat(o.kenpei,"%</span></div>"):void 0!==o.A01_003&&(c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5efa\u853d\u7387</span><span style="').concat(r,'">').concat(o.A01_003,"%</span></div>")),c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5730\u76ee</span><span style="').concat(r,'">\u5b85\u5730</span></div>'),c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u90fd\u5e02\u8a08\u753b</span><span style="').concat(r,'">\u5e02\u8857\u5316\u533a\u57df</span></div>'),c+="</div>"}if(s||a){if(c+='<div style="'.concat(t,'">'),c+='<div style="font-weight: 600; color: #4b5563; font-size: 12px; margin-bottom: 6px;">\u898f\u5236\u60c5\u5831</div>',s){if(void 0!==s.TUP6F1){const e=10===s.TUP6F1?"\u9632\u706b\u5730\u57df":"\u6e96\u9632\u706b\u5730\u57df";c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u9632\u706b\u898f\u5236</span><span style="').concat(r,'">').concat(e,"</span></div>")}else if(void 0!==s.TUP5M1){const e=Lg.TUP5M1.values[s.TUP5M1]||"\u6e96\u9632\u706b\u5730\u57df";c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u9632\u706b\u898f\u5236</span><span style="').concat(r,'">').concat(e,"</span></div>")}if(void 0!==s.TUP5M2&&0!==s.TUP5M2){const e=Lg.TUP5M2.values[s.TUP5M2]||"22\u6761\u5730\u57df";c+='<div style="'.concat(n,'"><span style="').concat(i,'">22\u6761\u5730\u57df</span><span style="').concat(r,'">').concat(e,"</span></div>")}}if(a){if(void 0!==a.TUP5F1){const e=Rg.TUP5F1.values[a.TUP5F1]||"\u7b2c\u4e8c\u7a2e\u9ad8\u5ea6\u5730\u533a";c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u9ad8\u5ea6\u5730\u533a</span><span style="').concat(r,'">').concat(e,"</span></div>")}void 0!==a.TUP5F3&&a.TUP5F3>0&&(c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u6700\u4f4e\u9650\u9ad8\u5ea6</span><span style="').concat(r,'">').concat(a.TUP5F3,"m</span></div>")),void 0!==a.TUP5F4&&a.TUP5F4>0&&(c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u6700\u9ad8\u9650\u9ad8\u5ea6</span><span style="').concat(r,'">').concat(a.TUP5F4,"m</span></div>"))}c+="</div>"}c+='<div style="'.concat(t,'">'),c+='<div style="font-weight: 600; color: #4b5563; font-size: 12px; margin-bottom: 6px;">\u8a2d\u5099\u30fb\u305d\u306e\u4ed6</div>',c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u571f\u5730\u6a29\u5229</span><span style="').concat(r,'">\u6240\u6709\u6a29</span></div>');const u=["\u5317\u50744m\u516c\u9053","\u5357\u50746m\u516c\u9053","\u6771\u50745m\u79c1\u9053","\u897f\u50744.5m\u516c\u9053"],h=u[Math.floor(Math.random()*u.length)];c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u63a5\u9053</span><span style="').concat(r,'">').concat(h,"</span></div>"),c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u8a2d\u5099</span><span style="').concat(r,'">\u516c\u55b6\u4e0a\u4e0b\u6c34\u30fb\u90fd\u5e02\u30ac\u30b9</span></div>');const d=["\u7a7a\u5ba4","\u8cc3\u8cb8\u4e2d","\u66f4\u5730","\u99d0\u8eca\u5834"],p=d[Math.floor(Math.random()*d.length)];if(c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u73fe\u72b6</span><span style="').concat(r,'">').concat(p,"</span></div>"),c+="</div>",l){c+='<div style="'.concat(t,'">'),c+='<div style="font-weight: 600; color: #4b5563; font-size: 12px; margin-bottom: 6px;">\u5efa\u7269\u8a73\u7d30</div>',void 0!==l.height&&(c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u5efa\u7269\u9ad8\u3055</span><span style="').concat(r,'">').concat(l.height,"m</span></div>")),void 0!==l.floors&&(c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u968e\u6570</span><span style="').concat(r,'">').concat(l.floors,"\u968e</span></div>"));const e=["3LDK","4LDK","2LDK+S","\u30ef\u30f3\u30eb\u30fc\u30e0\xd78\u6238","\u4e8b\u52d9\u6240"],o=e[Math.floor(Math.random()*e.length)];c+='<div style="'.concat(n,'"><span style="').concat(i,'">\u9593\u53d6\u308a</span><span style="').concat(r,'">').concat(o,"</span></div>"),c+="</div>"}if(!o&&!s&&!a&&!l&&e.length>0){const t=e[0];c+=((e,t)=>{const n="\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 6px 8px;\n    margin: 4px 0;\n    background: #f8f9fa;\n    border-radius: 4px;\n    border-left: 3px solid #667eea;\n  ",i="\n    font-weight: 500;\n    color: #495057;\n    font-size: 13px;\n  ",r="\n    font-weight: 600;\n    color: #212529;\n    font-size: 14px;\n  ";let o='<div style="'.concat("\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    line-height: 1.6;\n    color: #333;\n    max-width: 320px;\n  ",'">');return o+='<div style="'.concat("\n    margin: 0 0 12px 0;\n    padding: 8px 12px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    font-size: 15px;\n    font-weight: 600;\n    border-radius: 6px;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  ",'">').concat(e.includes("koudo")?"\ud83d\udcd0":e.includes("bouka")?"\ud83d\udd25":e.includes("youto")?"\ud83c\udfd8\ufe0f":e.includes("building")||e.includes("height")?"\ud83c\udfe2":"\ud83d\udccd"," ").concat(Fg(e),"</div>"),o+='<div style="'.concat("\n    padding: 0 4px;\n  ",'">'),e.includes("koudo")?o+=Bg(t,n,i,r):e.includes("bouka")?o+=Ng(t,n,i,r):e.includes("youto")?o+=jg(t,n,i,r):e.includes("building")||e.includes("height")?o+=Vg(t,n,i,r):o+=Ug(t,n,i,r),o+="</div></div>",o})(t.layer.id,t.properties)}return c+="</div>",c},qg=t=>{let{map:n}=t;return(0,e.useEffect)(()=>{if(!n)return;const e=e=>{const t=n.queryRenderedFeatures(e.point);if(t.length>0){console.log("All features at click point:",t.map(e=>({layer:e.layer.id,props:e.properties})));const i=Gg(t);new(Ga().Popup)({maxWidth:"450px"}).setLngLat(e.lngLat).setHTML(i).addTo(n)}};return n.on("click",e),()=>{n.off("click",e)}},[n]),null},Wg=t=>{let{currentStore:n,isSample:i,privacyLevel:r="\u9650\u5b9a\u516c\u958b",mapMode:o="sat",mapLayers:s}=t;const a=(0,e.useRef)(null),[l,c]=(0,e.useState)(),[u]=(0,e.useState)(0),[h,d]=(0,e.useState)("sat"===o),p=n&&n.length>0?[n[0].nearStation[0].geometry.lng,n[0].nearStation[0].geometry.lat]:i?zg:Dg;return(0,e.useEffect)(()=>{if(!l&&null!==a.current)return console.log("mapfetch"),console.log(u),void c(new(Ga().Map)({container:a.current,style:"mapbox://styles/junwatanabe72/clrlf2aq7001901r67qtw6qf0",zoom:12,pitch:u,center:p,accessToken:"pk.eyJ1IjoianVud2F0YW5hYmU3MiIsImEiOiJjbDZkOHdtMTMyM3puM2NvNTNxcHg2M3JmIn0.jwl5M3oBS5p4ZAeDsFPnXw"}))},[l,p,u]),(0,e.useEffect)(()=>{if(l&&l.isStyleLoaded())if("sat"!==o||h)"map"===o&&h&&(l.getLayer("satellite-layer")&&l.setLayoutProperty("satellite-layer","visibility","none"),d(!1));else{if(l.getSource("mapbox-satellite"))l.setLayoutProperty("satellite-layer","visibility","visible");else{var e,t;l.addSource("mapbox-satellite",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:256});const n=null===(e=l.getStyle().layers)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.id;l.addLayer({id:"satellite-layer",type:"raster",source:"mapbox-satellite",layout:{visibility:"visible"},paint:{"raster-opacity":1}},n)}d(!0)}},[l,o,h]),(0,e.useEffect)(()=>{l&&l.isStyleLoaded()&&s&&Object.keys(Ig).forEach(e=>{const t=Ig[e],n=s[e]||!1;for(const i in t){const e=t[i];l.getLayer(e)&&l.setLayoutProperty(e,"visibility",n?"visible":"none")}})},[l,s]),(0,e.useEffect)(()=>{l&&l.isStyleLoaded()&&!s&&Object.keys(Ig).forEach(e=>{const t=Ig[e],n="\u6700\u5c0f\u516c\u958b"===r&&("koudo"===e||"bouka"===e)||"\u9650\u5b9a\u516c\u958b"===r&&"bouka"===e;for(const i in t){const e=t[i];l.getLayer(e)&&l.setLayoutProperty(e,"visibility",n?"none":"visible")}})},[l,r,s]),(0,e.useEffect)(()=>{if(!l||null===l)return;const e=new(Wa())({defaultLanguage:"ja"});l.addControl(e),setTimeout(()=>{l.resize()},100),l.on("style.load",()=>{console.log("Map style loaded");const e=l.getStyle();e&&e.layers&&(console.log("Available layers in the map:"),e.layers.forEach(e=>{console.log("- ".concat(e.id," (type: ").concat(e.type,")"))}),console.log("\nChecking for custom layers:"),Object.entries(Ig).forEach(e=>{let[t,n]=e;console.log("Category: ".concat(t)),Object.entries(n).forEach(e=>{let[t,n]=e;const i=l.getLayer(n);console.log("  ".concat(n,": ").concat(i?"EXISTS":"NOT FOUND"))})}))})},[l]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(qg,{map:l}),(0,C.jsx)(kd,{sx:{height:"100%",width:"100%",position:"absolute",top:0,left:0,zIndex:0},ref:a,children:(0,C.jsx)(Pg,{map:l,currentStore:n})})]})},Zg=y("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),Hg=y("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),Xg=y("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),Yg=y("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Kg=y("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Jg=y("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),$g=y("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Qg=y("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ey=y("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),ty=y("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),ny=e=>{let t;const n=new Set,i=(e,i)=>{const r="function"===typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=i?i:"object"!==typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,o={setState:i,getState:r,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e))},s=t=e(i,r,o);return o},iy=e=>e;const ry=t=>{const n=(e=>e?ny(e):ny)(t),i=t=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:iy;const i=e.useSyncExternalStore(t.subscribe,e.useCallback(()=>n(t.getState()),[t,n]),e.useCallback(()=>n(t.getInitialState()),[t,n]));return e.useDebugValue(i),i}(n,t);return Object.assign(i,n),i},oy=[{id:"p1",kind:"sale",target:"\u6771\u4eac\u90fd\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-2",chiban:"\u5b87\u7530\u5ddd\u753a83-2",company:"\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8",created_at:"2025-08-20",summary:"\u30de\u30f3\u30b7\u30e7\u30f3\u7528\u5730\u3068\u3057\u30662.4\u5104\u5186\u63d0\u793a\u3002",attachments:["\u4e8b\u696d\u53ce\u652f\u30e2\u30c7\u30eb.xlsx","\u57fa\u672c\u5408\u610f\u66f8\uff08\u30c9\u30e9\u30d5\u30c8\uff09.pdf"],mode:"developer",price:24e7,costs:{broker:0,taxes:12e5},days_to_close:90,confidence:.9,details:"\u5b9f\u6e2c\u30fb\u5883\u754c\u78ba\u5b9a\u3001\u571f\u58cc\u30fb\u5730\u4e2d\u969c\u5bb3\u306e\u78ba\u8a8d\u7b49\u3092\u524d\u63d0\u3002\u30c7\u30e5\u30fc\u30c7\u30ea\u30b8\u30a7\u30f3\u30b9\u671f\u959330\u301c45\u65e5\u3001\u5951\u7d04\u7de0\u7d50\u5f8c60\u301c90\u65e5\u3067\u6b8b\u4ee3\u91d1\u6c7a\u6e08\u3092\u4e88\u5b9a\u3002\u6e2c\u91cf\u30fb\u5883\u754c\u78ba\u5b9a\u30fb\u7a0e\u52d9\u9762\u306f\u5f53\u793e\u4e3b\u5c0e\u3067\u9032\u884c\u3057\u3001\u5fc5\u8981\u5b9f\u8cbb\u306f\u5225\u9014\u7cbe\u7b97\u3068\u3057\u307e\u3059\u3002",htmlContent:'\n    <!DOCTYPE html>\n<html lang="ja">\n<head>\n  <meta charset="utf-8">\n  <title>\u30de\u30f3\u30b7\u30e7\u30f3\u7528\u5730 \u76f4\u63a5\u8cb7\u53d6\u306e\u3054\u63d0\u6848\uff5c\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8</title>\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n  <style>\n    :root{\n      --bg:#0c1220;\n      --card:#0f162a;\n      --panel:#121b33;\n      --ink:#e9eef7;\n      --muted:#9fb0c9;\n      --accent:#3aa7ff;\n      --accent-2:#65d6a6;\n      --danger:#ff7a7a;\n      --border:#223053;\n      --shadow:0 18px 40px rgba(0,0,0,.35);\n    }\n    *{box-sizing:border-box}\n    html,body{height:100%}\n    body{\n      margin:0; background:\n      radial-gradient(1200px 800px at 10% -10%, #172341 0%, transparent 60%),\n      radial-gradient(800px 600px at 100% 0%, #0e1a34 0%, transparent 60%),\n      linear-gradient(180deg, #0c1220 0%, #0a1222 100%);\n      color:var(--ink);\n      font-family: "Inter", "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Meiryo", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;\n      line-height:1.6;\n    }\n\n    /* ---- Slide Deck ---- */\n    .deck{\n      counter-reset: slide;\n      width:min(1280px, 95vw);\n      margin:32px auto 64px;\n    }\n    .slide{\n      counter-increment: slide;\n      position: relative;\n      width:100%;\n      aspect-ratio:16/9;\n      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0)), var(--card);\n      border:1px solid var(--border);\n      border-radius:18px;\n      box-shadow: var(--shadow);\n      padding:48px 56px;\n      overflow:hidden;\n      page-break-after: always; /* \u5370\u5237\u6642\uff1a1\u30b9\u30e9\u30a4\u30c91\u30da\u30fc\u30b8 */\n    }\n    .slide:last-child{ page-break-after: auto; }\n\n    .brand{\n      display:flex; align-items:center; gap:12px;\n      font-weight:700; letter-spacing:.2px;\n    }\n    .brand .mark{\n      width:28px; height:28px; border-radius:8px;\n      background: radial-gradient(120% 120% at 20% 10%, #78d7ff, #3aa7ff 55%, #2c5cff 100%);\n      box-shadow:0 8px 16px rgba(58,167,255,.35), inset 0 0 1px rgba(255,255,255,.5);\n    }\n    .stamps{\n      margin-left:auto; display:flex; gap:8px;\n    }\n    .stamp{\n      padding:6px 10px; border:1px solid var(--border); border-radius:999px;\n      font-size:12px; color:var(--muted); background:rgba(255,255,255,.02);\n    }\n\n    .title{\n      margin:24px 0 8px; font-size:36px; line-height:1.25; font-weight:800;\n      letter-spacing:.2px;\n    }\n    .subtitle{ color:var(--muted); font-size:16px; margin-bottom:18px;}\n    .hero{\n      display:flex; align-items:flex-end; justify-content:space-between; gap:24px; margin-top:8px;\n      border-top:1px dashed #25365f; padding-top:18px;\n    }\n    .price{\n      font-size:40px; font-weight:900; letter-spacing:.5px;\n      background:linear-gradient(90deg, #86f7c7, #3aa7ff);\n      -webkit-background-clip:text; background-clip:text; color:transparent;\n    }\n    .pill{\n      display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px;\n      border:1px solid var(--border); background:var(--panel); color:var(--ink); font-weight:600;\n    }\n    .grid{\n      display:grid; gap:16px; margin-top:20px;\n      grid-template-columns: repeat(12, 1fr);\n    }\n    .card{\n      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));\n      border:1px solid var(--border); border-radius:14px; padding:16px 18px;\n      min-height:110px;\n    }\n    .card h3{ margin:0 0 6px; font-size:15px; color:#bcd0ea; letter-spacing:.3px; font-weight:700; }\n    .kpis{ display:flex; gap:12px; flex-wrap:wrap; margin-top:6px;}\n    .kpi{\n      flex:1 1 160px; border:1px solid var(--border); border-radius:12px; padding:12px 14px;\n      background:rgba(255,255,255,.02);\n    }\n    .kpi b{ font-size:20px; display:block; }\n    .muted{ color:var(--muted); font-size:13px; }\n\n    .list{ margin:6px 0 0 0; padding-left:18px; }\n    .list li{ margin:6px 0; }\n\n    .bar{\n      height:10px; background:#1a2748; border-radius:999px; overflow:hidden; border:1px solid var(--border);\n      margin-top:8px;\n    }\n    .bar > span{ display:block; height:100%; background: linear-gradient(90deg, var(--accent-2), var(--accent)); width:90%; }\n\n    .timeline{ position:relative; margin-top:8px; }\n    .timeline::before{\n      content:""; position:absolute; left:8px; top:6px; bottom:6px; width:2px; background:#28406e; border-radius:2px;\n    }\n    .milestone{\n      margin-left:28px; padding:8px 12px; border:1px solid var(--border); border-radius:12px; background:rgba(255,255,255,.02);\n      position:relative; margin-bottom:10px;\n    }\n    .milestone::before{\n      content:""; position:absolute; left:-22px; top:12px; width:10px; height:10px; border-radius:50%;\n      background:linear-gradient(90deg, #86f7c7, #3aa7ff); box-shadow:0 0 0 3px #162443;\n    }\n\n    .rgrid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }\n    .risk{ border:1px solid var(--border); border-radius:12px; padding:12px; background:rgba(255,255,255,.02); }\n    .risk h4{ margin:0 0 6px; font-size:14px; }\n    .risk p{ margin:0; font-size:13px; color:var(--muted); }\n\n    .foot{\n      position:absolute; right:16px; bottom:14px; display:flex; gap:12px; align-items:center; color:var(--muted); font-size:12px;\n    }\n    .pnum{ border:1px solid var(--border); padding:4px 8px; border-radius:8px; background:rgba(255,255,255,.02); }\n    .pnum::after{ content: counter(slide); margin-left:4px; font-weight:700; color:#d6e4ff; }\n\n    /* Print */\n    @media print{\n      body{ background:#fff; }\n      .deck{ width:100%; margin:0; }\n      .slide{\n        border:none; border-radius:0; box-shadow:none; width:100%; height:100vh; padding:28mm 24mm;\n        -webkit-print-color-adjust: exact; print-color-adjust: exact;\n      }\n      .foot{ position:fixed; bottom:10mm; right:24mm; }\n    }\n  </style>\n</head>\n<body>\n  <div class="deck">\n\n    \x3c!-- 1. Cover --\x3e\n    <section class="slide">\n      <div style="position:absolute; right:-120px; top:-120px; width:420px; height:420px; border-radius:50%;\n                  background:radial-gradient(closest-side, rgba(101,214,166,.18), rgba(101,214,166,0)); filter:blur(6px);"></div>\n      <div style="display:flex; align-items:center;">\n        <div class="brand">\n          <div class="mark" aria-hidden="true"></div>\n          \u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8\n        </div>\n        <div class="stamps">\n          <span class="stamp">\u76f4\u63a5\u53d6\u5f15\uff08\u30c7\u30d9\u30ed\u30c3\u30d1\u30fc\u81ea\u5df1\u52d8\u5b9a\uff09</span>\n          <span class="stamp">\u4f5c\u6210\u65e5 2025-08-20</span>\n        </div>\n      </div>\n\n      <h1 class="title">\u30de\u30f3\u30b7\u30e7\u30f3\u7528\u5730 \u76f4\u63a5\u8cb7\u53d6\u306e\u3054\u63d0\u6848</h1>\n      <p class="subtitle">\u5bfe\u8c61\u7269\u4ef6\uff1a\u6771\u4eac\u90fd\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-2</p>\n\n      <div class="hero">\n        <div>\n          <div class="pill">\u63d0\u793a\u4fa1\u683c <span class="price">\xa5240,000,000</span></div>\n          <div class="kpis" style="margin-top:14px;">\n            <div class="kpi"><span class="muted">\u30af\u30ed\u30fc\u30b8\u30f3\u30b0\u76ee\u6a19</span><b>90\u65e5\u4ee5\u5185</b></div>\n            <div class="kpi"><span class="muted">DD\u671f\u9593</span><b>30\u301c45\u65e5</b></div>\n            <div class="kpi"><span class="muted">\u78ba\u5ea6\uff08\u5f53\u793e\u8a55\u4fa1\uff09</span>\n              <div class="bar"><span style="width:90%"></span></div>\n            </div>\n          </div>\n        </div>\n        <div class="card" style="min-width:360px; max-width:46%;">\n          <h3>\u672c\u63d0\u6848\u306e\u4f4d\u7f6e\u3065\u3051</h3>\n          <ul class="list">\n            <li>\u5f53\u793e\u306b\u3088\u308b\u81ea\u5df1\u52d8\u5b9a\u3067\u306e<strong>\u76f4\u63a5\u8cb7\u53d6</strong>\uff08\u4ef2\u4ecb\u624b\u6570\u6599 0\u5186\uff09</li>\n            <li>\u7528\u9014\u60f3\u5b9a\uff1a<strong>\u5171\u540c\u4f4f\u5b85\uff08\u30de\u30f3\u30b7\u30e7\u30f3\u7528\u5730\uff09</strong></li>\n            <li>\u6700\u7d42\u6761\u4ef6\u306f<strong>\u5b9f\u6e2c\u30fb\u5883\u754c\u78ba\u5b9a\uff0f\u571f\u58cc\u30fb\u5730\u4e2d\u969c\u5bb3\u78ba\u8a8d</strong>\u306e\u7d50\u679c\u3067\u78ba\u5b9a</li>\n          </ul>\n        </div>\n      </div>\n\n      <div class="foot">\n        <span class="muted">Shibuya Asset Development</span>\n        <span class="pnum">Page</span>\n      </div>\n    </section>\n\n    \x3c!-- 2. Deal Overview --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8</div>\n      <h2 class="title" style="font-size:28px;">\u6848\u4ef6\u30b5\u30de\u30ea\u30fc</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u5bfe\u8c61\u6982\u8981</h3>\n          <ul class="list">\n            <li>\u6240\u5728\u5730\uff1a\u6771\u4eac\u90fd\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-2</li>\n            <li>\u6a29\u5229\uff1a\u6240\u6709\u6a29\uff08\u73fe\u6cc1\u30fb\u5f15\u6e21\u6761\u4ef6\u306f\u5354\u8b70\u306e\u4e0a\u78ba\u5b9a\uff09</li>\n            <li>\u60f3\u5b9a\u7528\u9014\uff1a\u30de\u30f3\u30b7\u30e7\u30f3\u7528\u5730\uff08\u8a73\u7d30\u8a08\u753b\u306f\u5f8c\u8ff0\u8abf\u67fb\u306b\u3066\u7cbe\u67fb\uff09</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u7d4c\u6e08\u6761\u4ef6\uff08\u629c\u7c8b\uff09</h3>\n          <ul class="list">\n            <li>\u63d0\u793a\u4fa1\u683c\uff1a<strong>\xa5240,000,000</strong></li>\n            <li>\u4ef2\u4ecb\u624b\u6570\u6599\uff1a<strong>0\u5186\uff08\u76f4\u63a5\u53d6\u5f15\uff09</strong></li>\n            <li>\u8af8\u7a0e\u30fb\u767b\u8a18\u7b49\u6982\u7b97\uff1a<strong>\u7d04 \xa51,200,000</strong></li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 12;">\n          <h3>\u524d\u63d0\u6761\u4ef6</h3>\n          <ul class="list">\n            <li><strong>\u5b9f\u6e2c\u30fb\u5883\u754c\u78ba\u5b9a</strong>\u3001<strong>\u571f\u58cc\u6c5a\u67d3\uff0f\u5730\u4e2d\u969c\u5bb3\u306e\u78ba\u8a8d</strong>\u3001\u6cd5\u4ee4\u8abf\u67fb\uff08\u5efa\u7bc9\u57fa\u6e96\u3001\u90fd\u5e02\u8a08\u753b \u7b49\uff09</li>\n            <li>\u7d50\u679c\u306b\u5fdc\u3058\u305f\u4fa1\u683c\u30fb\u6761\u4ef6\u306e\u6700\u7d42\u78ba\u5b9a\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u8abf\u6574\u6761\u9805\u3092\u8a2d\u5b9a\uff09</li>\n            <li>\u6e2c\u91cf\u30fb\u5883\u754c\u78ba\u5b9a\u30fb\u7a0e\u52d9\u306f\u5f53\u793e\u4e3b\u5c0e\u306b\u3066\u63a8\u9032\u3001\u767a\u751f\u5b9f\u8cbb\u306f\u5225\u9014\u5354\u8b70\u30fb\u7cbe\u7b97</li>\n          </ul>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Deal Overview</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 3. Key Terms --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8</div>\n      <h2 class="title" style="font-size:28px;">\u53d6\u5f15\u6761\u4ef6\uff08Key Terms\uff09</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 7;">\n          <h3>\u6761\u4ef6\u8a73\u7d30</h3>\n          <ul class="list">\n            <li>\u53d6\u5f15\u5f62\u614b\uff1a\u5f53\u793e\u306b\u3088\u308b<strong>\u81ea\u5df1\u52d8\u5b9a\u306e\u76f4\u63a5\u8cb7\u53d6</strong></li>\n            <li>\u5951\u7d04\u30fb\u6c7a\u6e08\uff1a<strong>\u5951\u7d04\u7de0\u7d50\u5f8c 60\u301c90\u65e5</strong>\u3067\u6b8b\u4ee3\u91d1\u6c7a\u6e08\uff08\u76ee\u6a19\u30af\u30ed\u30fc\u30b8\u30f3\u30b090\u65e5\u4ee5\u5185\uff09</li>\n            <li>\u30c7\u30e5\u30fc\u30c7\u30ea\u30b8\u30a7\u30f3\u30b9\uff08DD\uff09\uff1a<strong>30\u301c45\u65e5</strong>\uff08\u7269\u4ef6\u30fb\u6cd5\u52d9\u30fb\u74b0\u5883\u30fb\u6280\u8853\uff09</li>\n            <li>\u8868\u660e\u4fdd\u8a3c\u30fb\u4ed8\u4fdd\uff1a\u6a19\u6e96\u6761\u9805\u3092\u30d9\u30fc\u30b9\u306b\u5354\u8b70\u306e\u4e0a\u8a2d\u5b9a</li>\n            <li>\u5f15\u6e21\u72b6\u614b\uff1a\u5883\u754c\u78ba\u5b9a\u30fb\u5360\u6709\u72b6\u6cc1\u7b49\u306f\u5354\u8b70\u306e\u3046\u3048\u78ba\u5b9a</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 5;">\n          <h3>\u78ba\u5ea6\uff08\u5f53\u793e\u5185\u90e8\u8a55\u4fa1\uff09</h3>\n          <p class="muted" style="margin:0 0 6px;">\u8abf\u67fb\u524d\u63d0\u304c\u6e80\u305f\u3055\u308c\u308b\u3053\u3068\u3092\u6761\u4ef6\u3068\u3057\u305f\u6210\u7d04\u78ba\u5ea6</p>\n          <div class="bar"><span style="width:90%"></span></div>\n          <p class="muted" style="margin-top:8px;">\u78ba\u5ea6\u306f\u5e02\u5834\u30fb\u6cd5\u4ee4\u30fb\u7269\u4ef6\u6761\u4ef6\u306e\u5909\u52d5\u306b\u3088\u308a\u898b\u76f4\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002</p>\n        </div>\n        <div class="card" style="grid-column: span 12;">\n          <h3>\u5099\u8003</h3>\n          <ul class="list">\n            <li>\u672c\u8cc7\u6599\u306f<strong>\u610f\u5411\u8868\u660e\uff08Non-binding\uff09</strong>\u3067\u3042\u308a\u3001\u6700\u7d42\u6761\u4ef6\u306fDD\u7d50\u679c\u30fb\u5354\u8b70\u306b\u3088\u308a\u78ba\u5b9a\u3057\u307e\u3059\u3002</li>\n            <li>\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u77ed\u7e2e\uff08\u65e9\u671f\u6c7a\u6e08\uff09\u3084\u652f\u6255\u6761\u4ef6\u306e\u500b\u5225\u8abf\u6574\u3082\u3054\u76f8\u8ac7\u53ef\u80fd\u3067\u3059\u3002</li>\n          </ul>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Key Terms</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 4. Schedule --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8</div>\n      <h2 class="title" style="font-size:28px;">\u60f3\u5b9a\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\uff08\u76ee\u5b89\uff09</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 7;">\n          <h3>\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f3</h3>\n          <div class="timeline">\n            <div class="milestone"><b>\u57fa\u672c\u5408\u610f\uff08LOI\uff09\uff0f\u60c5\u5831\u958b\u793a</b><br><span class="muted">\u79d8\u5bc6\u4fdd\u6301\u30fb\u8cc7\u6599\u6388\u53d7\u30fb\u73fe\u5730\u78ba\u8a8d\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7</span></div>\n            <div class="milestone"><b>\u30c7\u30e5\u30fc\u30c7\u30ea\u30b8\u30a7\u30f3\u30b9\uff0830\u301c45\u65e5\uff09</b><br><span class="muted">\u6cd5\u52d9\u30fb\u6e2c\u91cf\uff0f\u5883\u754c\u30fb\u74b0\u5883\uff08\u571f\u58cc\u30fb\u5730\u4e2d\u969c\u5bb3\uff09\u30fb\u5efa\u7bc9\u8a08\u753b\u6027\u306e\u78ba\u8a8d</span></div>\n            <div class="milestone"><b>\u6761\u4ef6\u6700\u7d42\u5316\u30fb\u58f2\u8cb7\u5951\u7d04</b><br><span class="muted">\u4fa1\u683c\u30fb\u6761\u9805\u306e\u78ba\u5b9a\uff0f\u8868\u660e\u4fdd\u8a3c\u30fb\u5f15\u6e21\u6761\u4ef6\u306e\u5408\u610f</span></div>\n            <div class="milestone"><b>\u30af\u30ed\u30fc\u30b8\u30f3\u30b0\uff08\u5951\u7d04\u5f8c 60\u301c90\u65e5\uff09</b><br><span class="muted">\u6b8b\u4ee3\u91d1\u6c7a\u6e08\u30fb\u6240\u6709\u6a29\u79fb\u8ee2\u30fb\u5f15\u6e21\u3057</span></div>\n          </div>\n        </div>\n        <div class="card" style="grid-column: span 5;">\n          <h3>\u77ed\u7e2e\u30aa\u30d7\u30b7\u30e7\u30f3\uff08\u5354\u8b70\uff09</h3>\n          <ul class="list">\n            <li>\u5148\u884c\u8abf\u67fb\u306e\u6d3b\u7528\u306b\u3088\u308aDD\u306e\u4e00\u90e8\u77ed\u7e2e</li>\n            <li>\u6c7a\u6e08\u671f\u65e5\u306e\u524d\u5012\u3057\uff08\u91d1\u878d\u30fb\u767b\u8a18\u4f53\u5236\u3092\u4e8b\u524d\u78ba\u4fdd\uff09</li>\n            <li>\u6761\u4ef6\u6210\u5c31\u4ed8\uff08\u505c\u6b62\u6761\u4ef6\uff09\u306b\u3088\u308b\u5951\u7d04\u306e\u8fc5\u901f\u5316</li>\n          </ul>\n          <p class="muted">\u203b \u77ed\u7e2e\u306b\u306f\u524d\u63d0\u6761\u4ef6\u306e\u6574\u5099\u304c\u5fc5\u8981\u3067\u3059\u3002</p>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Schedule</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 5. Due Diligence Scope --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8</div>\n      <h2 class="title" style="font-size:28px;">\u30c7\u30e5\u30fc\u30c7\u30ea\u30b8\u30a7\u30f3\u30b9\u7bc4\u56f2\uff08\u629c\u7c8b\uff09</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u7269\u4ef6\u30fb\u6cd5\u52d9</h3>\n          <ul class="list">\n            <li>\u6a29\u5229\u95a2\u4fc2\uff08\u767b\u8a18\u30fb\u5951\u7d04\u30fb\u5360\u6709\u7b49\uff09</li>\n            <li>\u5b9f\u6e2c\u30fb\u5883\u754c\u78ba\u5b9a\uff08\u78ba\u5b9a\u6e2c\u91cf\uff09</li>\n            <li>\u90fd\u5e02\u8a08\u753b\u30fb\u5efa\u7bc9\u898f\u5236\u306e\u9069\u5408\u6027\u78ba\u8a8d</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u74b0\u5883\u30fb\u6280\u8853</h3>\n          <ul class="list">\n            <li>\u571f\u58cc\u6c5a\u67d3\u30fb\u5730\u4e2d\u969c\u5bb3\u306e\u6709\u7121\uff08\u30d5\u30a7\u30fc\u30ba\u8abf\u67fb\u7b49\uff09</li>\n            <li>\u30a4\u30f3\u30d5\u30e9\u5f15\u8fbc\u30fb\u8fd1\u96a3\u5354\u8b70\u306e\u5fc5\u8981\u6027</li>\n            <li>\u8a2d\u8a08\u4e0e\u4ef6\uff08\u30dc\u30ea\u30e5\u30fc\u30e0\u30b9\u30bf\u30c7\u30a3\u524d\u63d0\u6761\u4ef6\uff09</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 12;">\n          <h3>\u30a2\u30a6\u30c8\u30d7\u30c3\u30c8</h3>\n          <ul class="list">\n            <li>\u8abf\u67fb\u30ec\u30dd\u30fc\u30c8\uff08\u6cd5\u52d9\u30fb\u74b0\u5883\u30fb\u6e2c\u91cf\u30fb\u8a08\u753b\uff09</li>\n            <li>\u6700\u7d42\u6761\u4ef6\uff08\u4fa1\u683c\u30fb\u6761\u9805\uff09\u304a\u3088\u3073\u30af\u30ed\u30fc\u30b8\u30f3\u30b0\u8a08\u753b</li>\n          </ul>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Due Diligence</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 6. Risk & Mitigation / Next Steps --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8</div>\n      <h2 class="title" style="font-size:28px;">\u30ea\u30b9\u30af\u3068\u5bfe\u5fdc\u65b9\u91dd\uff0f\u6b21\u306e\u30b9\u30c6\u30c3\u30d7</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 7;">\n          <h3>\u4e3b\u8981\u30ea\u30b9\u30af\u3068\u5bfe\u5fdc</h3>\n          <div class="rgrid">\n            <div class="risk">\n              <h4>\u571f\u58cc\u30fb\u5730\u4e2d\u969c\u5bb3\u306e\u767a\u898b</h4>\n              <p>\u6bb5\u968e\u7684\u8abf\u67fb\u30fb\u662f\u6b63\u30b9\u30ad\u30fc\u30e0\u306e\u8a2d\u5b9a\u3001\u4fa1\u683c\u8abf\u6574\u6761\u9805\u306e\u6574\u5099</p>\n            </div>\n            <div class="risk">\n              <h4>\u5883\u754c\u672a\u78ba\u5b9a\u30fb\u8d8a\u5883</h4>\n              <p>\u78ba\u5b9a\u6e2c\u91cf\u30fb\u662f\u6b63\u5de5\u4e8b\u306e\u624b\u9806\u5408\u610f\u3001\u5f15\u6e21\u524d\u6761\u4ef6\u306e\u8a2d\u5b9a</p>\n            </div>\n            <div class="risk">\n              <h4>\u6cd5\u4ee4\u30fb\u8a08\u753b\u306e\u4e0d\u78ba\u5b9f\u6027</h4>\n              <p>\u884c\u653f\u5354\u8b70\u306e\u524d\u5012\u3057\u30fb\u9069\u6cd5\u6027\u78ba\u8a8d\u3001\u4ee3\u66ff\u8a08\u753b\u306e\u691c\u8a0e</p>\n            </div>\n            <div class="risk">\n              <h4>\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u9045\u5ef6</h4>\n              <p>\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30d1\u30b9\u7ba1\u7406\u3001\u4ee3\u66ff\u65e5\u7a0b\u3068\u30ea\u30bd\u30fc\u30b9\u78ba\u4fdd</p>\n            </div>\n          </div>\n        </div>\n        <div class="card" style="grid-column: span 5;">\n          <h3>\u6b21\u306e\u30b9\u30c6\u30c3\u30d7</h3>\n          <ol class="list">\n            <li>\u79d8\u5bc6\u4fdd\u6301\u306e\u7de0\u7d50\uff08NDA\uff09</li>\n            <li>\u57fa\u672c\u5408\u610f\uff08LOI\uff09\u304a\u3088\u3073\u8cc7\u6599\u4e00\u89a7\u306e\u78ba\u5b9a</li>\n            <li>DD\u7740\u624b\uff0830\u301c45\u65e5\uff09</li>\n            <li>\u6761\u4ef6\u6700\u7d42\u5316\u30fb\u58f2\u8cb7\u5951\u7d04\u30fb\u6c7a\u6e08</li>\n          </ol>\n          <p class="muted" style="margin-top:8px;">\u3054\u5e0c\u671b\u306b\u5fdc\u3058\u3066\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u77ed\u7e2e\u3084\u652f\u6255\u6761\u4ef6\u306e\u500b\u5225\u8abf\u6574\u3082\u53ef\u80fd\u3067\u3059\u3002</p>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Risk & Next Steps</span><span class="pnum">Page</span></div>\n    </section>\n\n  </div>\n</body>\n</html>\n    '},{id:"p4",kind:"lease",target:"\u6771\u4eac\u90fd\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-2",chiban:"\u5b87\u7530\u5ddd\u753a83-2",company:"\u4e09\u4e95\u4e0d\u52d5\u7523",created_at:"2025-08-18",summary:"\u6708\u984d\u8cc3\u6599180\u4e07\u5186\u60f3\u5b9a\u3002",attachments:["\u8cc3\u6599\u67fb\u5b9a\u66f8.pdf","\u30c6\u30ca\u30f3\u30c8\u9700\u8981\u30ec\u30dd\u30fc\u30c8.pdf"],monthly_rent:18e5,term_years:5,opex_ratio:.15,occupancy:.95,details:"\u5f53\u793e\u304c\u5efa\u7269\u306e\u30d0\u30ea\u30e5\u30fc\u30a2\u30c3\u30d7\u4f01\u753b\u30fb\u5185\u88c5\u76e3\u4fee\u30fb\u30ea\u30fc\u30b7\u30f3\u30b0\u3092\u4e00\u4f53\u3067\u63a8\u9032\u3057\u307e\u3059\u30025\u5e74\u306e\u5b9a\u671f\u5efa\u7269\u8cc3\u8cb8\u501f\u3092\u57fa\u672c\u3068\u3057\u3001\u60f3\u5b9a\u7a3c\u50cd\u738795%\u306e\u53ce\u76ca\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u6dfb\u4ed8\u3002\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u5f53\u793e\u306b\u3088\u308b\u4e00\u62ec\u501f\u4e0a\u3052\uff08\u30de\u30b9\u30bf\u30fc\u30ea\u30fc\u30b9\uff09\u3082\u9078\u629e\u53ef\u80fd\u3067\u3001\u8cc3\u6599\u30ad\u30e3\u30c3\u30b7\u30e5\u30d5\u30ed\u30fc\u306e\u5e73\u6e96\u5316\u306b\u5bc4\u4e0e\u3057\u307e\u3059\u3002",htmlContent:'\n      <!DOCTYPE html>\n<html lang="ja">\n<head>\n  <meta charset="utf-8">\n  <title>\u30ea\u30fc\u30b7\u30f3\u30b0\uff06\u30d0\u30ea\u30e5\u30fc\u30a2\u30c3\u30d7\u63d0\u6848\uff5c\u4e09\u4e95\u4e0d\u52d5\u7523</title>\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n  <style>\n    :root{\n      --bg:#0c1220;\n      --card:#0f162a;\n      --panel:#121b33;\n      --ink:#e9eef7;\n      --muted:#9fb0c9;\n      --accent:#3aa7ff;\n      --accent-2:#65d6a6;\n      --danger:#ff7a7a;\n      --border:#223053;\n      --shadow:0 18px 40px rgba(0,0,0,.35);\n    }\n    *{box-sizing:border-box}\n    html,body{height:100%}\n    body{\n      margin:0; background:\n      radial-gradient(1200px 800px at 10% -10%, #172341 0%, transparent 60%),\n      radial-gradient(800px 600px at 100% 0%, #0e1a34 0%, transparent 60%),\n      linear-gradient(180deg, #0c1220 0%, #0a1222 100%);\n      color:var(--ink);\n      font-family: "Inter", "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Meiryo", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;\n      line-height:1.6;\n    }\n\n    .deck{ counter-reset: slide; width:min(1280px, 95vw); margin:32px auto 64px; }\n    .slide{\n      counter-increment: slide;\n      position: relative;\n      width:100%;\n      aspect-ratio:16/9;\n      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0)), var(--card);\n      border:1px solid var(--border);\n      border-radius:18px;\n      box-shadow: var(--shadow);\n      padding:48px 56px;\n      overflow:hidden;\n      page-break-after: always;\n    }\n    .slide:last-child{ page-break-after: auto; }\n\n    .brand{ display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.2px; }\n    .brand .mark{\n      width:28px; height:28px; border-radius:8px;\n      background: radial-gradient(120% 120% at 20% 10%, #78d7ff, #3aa7ff 55%, #2c5cff 100%);\n      box-shadow:0 8px 16px rgba(58,167,255,.35), inset 0 0 1px rgba(255,255,255,.5);\n    }\n    .stamps{ margin-left:auto; display:flex; gap:8px; }\n    .stamp{\n      padding:6px 10px; border:1px solid var(--border); border-radius:999px;\n      font-size:12px; color:var(--muted); background:rgba(255,255,255,.02);\n    }\n\n    .title{ margin:24px 0 8px; font-size:36px; line-height:1.25; font-weight:800; letter-spacing:.2px; }\n    .subtitle{ color:var(--muted); font-size:16px; margin-bottom:18px; }\n    .hero{ display:flex; align-items:flex-end; justify-content:space-between; gap:24px; margin-top:8px; border-top:1px dashed #25365f; padding-top:18px; }\n    .price{ font-size:40px; font-weight:900; letter-spacing:.5px; background:linear-gradient(90deg, #86f7c7, #3aa7ff); -webkit-background-clip:text; background-clip:text; color:transparent; }\n    .pill{ display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid var(--border); background:var(--panel); color:var(--ink); font-weight:600; }\n\n    .grid{ display:grid; gap:16px; margin-top:20px; grid-template-columns: repeat(12, 1fr); }\n    .card{\n      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));\n      border:1px solid var(--border); border-radius:14px; padding:16px 18px; min-height:110px;\n    }\n    .card h3{ margin:0 0 6px; font-size:15px; color:#bcd0ea; letter-spacing:.3px; font-weight:700; }\n\n    .kpis{ display:flex; gap:12px; flex-wrap:wrap; margin-top:6px; }\n    .kpi{ flex:1 1 160px; border:1px solid var(--border); border-radius:12px; padding:12px 14px; background:rgba(255,255,255,.02); }\n    .kpi b{ font-size:20px; display:block; }\n    .muted{ color:var(--muted); font-size:13px; }\n\n    .list{ margin:6px 0 0 0; padding-left:18px; }\n    .list li{ margin:6px 0; }\n\n    .bar{\n      height:10px; background:#1a2748; border-radius:999px; overflow:hidden; border:1px solid var(--border); margin-top:8px;\n    }\n    .bar > span{ display:block; height:100%; background: linear-gradient(90deg, var(--accent-2), var(--accent)); width:90%; }\n\n    .timeline{ position:relative; margin-top:8px; }\n    .timeline::before{ content:""; position:absolute; left:8px; top:6px; bottom:6px; width:2px; background:#28406e; border-radius:2px; }\n    .milestone{\n      margin-left:28px; padding:8px 12px; border:1px solid var(--border); border-radius:12px; background:rgba(255,255,255,.02);\n      position:relative; margin-bottom:10px;\n    }\n    .milestone::before{\n      content:""; position:absolute; left:-22px; top:12px; width:10px; height:10px; border-radius:50%;\n      background:linear-gradient(90deg, #86f7c7, #3aa7ff); box-shadow:0 0 0 3px #162443;\n    }\n\n    .two{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }\n    .risk{ border:1px solid var(--border); border-radius:12px; padding:12px; background:rgba(255,255,255,.02); }\n    .risk h4{ margin:0 0 6px; font-size:14px; }\n    .risk p{ margin:0; font-size:13px; color:var(--muted); }\n\n    .foot{ position:absolute; right:16px; bottom:14px; display:flex; gap:12px; align-items:center; color:var(--muted); font-size:12px; }\n    .pnum{ border:1px solid var(--border); padding:4px 8px; border-radius:8px; background:rgba(255,255,255,.02); }\n    .pnum::after{ content: counter(slide); margin-left:4px; font-weight:700; color:#d6e4ff; }\n\n    @media print{\n      body{ background:#fff; }\n      .deck{ width:100%; margin:0; }\n      .slide{\n        border:none; border-radius:0; box-shadow:none; width:100%; height:100vh; padding:28mm 24mm;\n        -webkit-print-color-adjust: exact; print-color-adjust: exact;\n      }\n      .foot{ position:fixed; bottom:10mm; right:24mm; }\n    }\n  </style>\n</head>\n<body>\n  <div class="deck">\n\n    \x3c!-- 1. Cover --\x3e\n    <section class="slide">\n      <div style="position:absolute; right:-120px; top:-120px; width:420px; height:420px; border-radius:50%;\n                  background:radial-gradient(closest-side, rgba(101,214,166,.18), rgba(101,214,166,0)); filter:blur(6px);"></div>\n      <div style="display:flex; align-items:center;">\n        <div class="brand"><div class="mark" aria-hidden="true"></div>\u4e09\u4e95\u4e0d\u52d5\u7523</div>\n        <div class="stamps">\n          <span class="stamp">\u30c7\u30d9\u30ed\u30c3\u30d1\u30fc\u4e3b\u5c0e\u30fb\u904b\u55b6\u4e00\u4f53</span>\n          <span class="stamp">\u4f5c\u6210\u65e5 2025-08-18</span>\n        </div>\n      </div>\n\n      <h1 class="title">\u30ea\u30fc\u30b7\u30f3\u30b0\uff06\u30d0\u30ea\u30e5\u30fc\u30a2\u30c3\u30d7\u63d0\u6848</h1>\n      <p class="subtitle">\u5bfe\u8c61\u7269\u4ef6\uff1a\u6771\u4eac\u90fd\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-2</p>\n\n      <div class="hero">\n        <div>\n          <div class="pill">\u60f3\u5b9a\u6708\u984d\u8cc3\u6599 <span class="price">\xa51,800,000</span></div>\n          <div class="kpis" style="margin-top:14px;">\n            <div class="kpi"><span class="muted">\u5951\u7d04\u5f62\u614b</span><b>\u5b9a\u671f\u5efa\u7269\u8cc3\u8cb8\u501f 5\u5e74</b></div>\n            <div class="kpi"><span class="muted">\u60f3\u5b9a\u7a3c\u50cd\u7387</span><b>95%</b><div class="bar"><span style="width:95%"></span></div></div>\n            <div class="kpi"><span class="muted">\u904b\u55b6\u8cbb\u7387\uff08EGI\u30d9\u30fc\u30b9\uff09</span><b>15%</b><div class="bar"><span style="width:15%"></span></div></div>\n          </div>\n        </div>\n        <div class="card" style="min-width:360px; max-width:46%;">\n          <h3>\u672c\u63d0\u6848\u306e\u4f4d\u7f6e\u3065\u3051</h3>\n          <ul class="list">\n            <li>\u5f53\u793e\u304c<strong>\u4f01\u753b\u30fb\u5185\u88c5\u76e3\u4fee\u30fb\u30ea\u30fc\u30b7\u30f3\u30b0</strong>\u3092\u4e00\u4f53\u63a8\u9032</li>\n            <li><strong>\u30de\u30b9\u30bf\u30fc\u30ea\u30fc\u30b9\uff08\u5f53\u793e\u4e00\u62ec\u501f\u4e0a\u3052\uff09</strong>\u9078\u629e\u53ef\uff1a\u30ad\u30e3\u30c3\u30b7\u30e5\u30d5\u30ed\u30fc\u306e\u5e73\u6e96\u5316\u306b\u5bc4\u4e0e</li>\n            <li>\u30bf\u30fc\u30b2\u30c3\u30c8\uff1aIT\u30fb\u30af\u30ea\u30a8\u30a4\u30c6\u30a3\u30d6\u30fb\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7</li>\n          </ul>\n        </div>\n      </div>\n\n      <div class="foot"><span class="muted">Leasing Proposal</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 2. Deal Overview --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u4e09\u4e95\u4e0d\u52d5\u7523</div>\n      <h2 class="title" style="font-size:28px;">\u6848\u4ef6\u30b5\u30de\u30ea\u30fc</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u5bfe\u8c61\u6982\u8981</h3>\n          <ul class="list">\n            <li>\u6240\u5728\u5730\uff1a\u6771\u4eac\u90fd\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-2</li>\n            <li>\u60f3\u5b9a\u7528\u9014\uff1a\u30aa\u30d5\u30a3\u30b9\uff08\u5c0f\u898f\u6a21\u5206\u5272\u53ef\uff09\uff0fBTS\u5bfe\u5fdc\u53ef</li>\n            <li>\u904b\u55b6\u4f53\u5236\uff1a\u5f53\u793eAM/PM\u4e3b\u5c0e\u3001\u30ea\u30fc\u30b7\u30f3\u30b0\u306f\u76f4\u55b6\u30fb\u63d0\u643a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f75\u7528</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u8cc3\u8cb8\u6761\u4ef6\uff08\u629c\u7c8b\u30fb\u6848\uff09</h3>\n          <ul class="list">\n            <li>\u60f3\u5b9a\u6708\u984d\u8cc3\u6599\uff1a<strong>\xa51,800,000</strong></li>\n            <li>\u5951\u7d04\u671f\u9593\uff1a<strong>5\u5e74</strong>\uff08\u5b9a\u671f\u5efa\u7269\u8cc3\u8cb8\u501f\uff09</li>\n            <li>\u539f\u72b6\u56de\u5fa9\u30fb\u5171\u76ca\u8cbb\u7b49\uff1a\u5225\u9014\u5354\u8b70\uff08\u30c6\u30ca\u30f3\u30c8\u4ed5\u69d8\u306b\u5fdc\u3058\u3066\u8abf\u6574\uff09</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 12;">\n          <h3>\u6dfb\u4ed8\u8cc7\u6599</h3>\n          <ul class="list">\n            <li>\u8cc3\u6599\u67fb\u5b9a\u66f8.pdf</li>\n            <li>\u30c6\u30ca\u30f3\u30c8\u9700\u8981\u30ec\u30dd\u30fc\u30c8.pdf</li>\n          </ul>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Deal Overview</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 3. Economics & Underwriting --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u4e09\u4e95\u4e0d\u52d5\u7523</div>\n      <h2 class="title" style="font-size:28px;">\u60f3\u5b9a\u53ce\u76ca\u30fb\u30a2\u30f3\u30c0\u30fc\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\uff08\u6982\u7b97\uff09</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u524d\u63d0</h3>\n          <ul class="list">\n            <li>\u6708\u984d\u8cc3\u6599\uff1a\xa51,800,000</li>\n            <li>\u7a3c\u50cd\u7387\uff1a95%</li>\n            <li>\u904b\u55b6\u8cbb\u7387\uff08EGI\u30d9\u30fc\u30b9\uff09\uff1a15%</li>\n          </ul>\n          <div class="kpis">\n            <div class="kpi"><span class="muted">GPR\uff08\u5e74\uff09</span><b>\xa521,600,000</b><span class="muted">= 1,800,000 \xd7 12</span></div>\n            <div class="kpi"><span class="muted">EGI\uff08\u5e74\uff09</span><b>\xa520,520,000</b><span class="muted">= GPR \xd7 95%</span></div>\n            <div class="kpi"><span class="muted">NOI\uff08\u5e74\uff09</span><b>\xa517,442,000</b><span class="muted">= EGI \xd7 85%</span></div>\n          </div>\n        </div>\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u6708\u6b21\u30a4\u30e1\u30fc\u30b8</h3>\n          <ul class="list">\n            <li>NOI\uff08\u6708\uff09<strong>\xa51,453,500</strong>\uff08= 17,442,000 \xf7 12\uff09</li>\n            <li>\u30de\u30b9\u30bf\u30fc\u30ea\u30fc\u30b9\u9078\u629e\u6642\u306f\u4fdd\u8a3c\u8cc3\u6599\u7b49\u306e\u6761\u4ef6\u5354\u8b70\u306b\u3088\u308a\u6c34\u6e96\u78ba\u5b9a</li>\n          </ul>\n          <h3 style="margin-top:10px;">\u611f\u5fdc\u5ea6\uff08Occupancy \xb15%\uff09</h3>\n          <ul class="list">\n            <li>90%\uff1aNOI <strong>\xa516,524,000/\u5e74</strong></li>\n            <li>100%\uff1aNOI <strong>\xa518,360,000/\u5e74</strong></li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 12;">\n          <h3>\u6ce8\u8a18</h3>\n          <p class="muted">\u4e0a\u8a18\u306f\u6982\u7b97\u306e\u8a66\u7b97\u5024\u3067\u3042\u308a\u3001\u6700\u7d42\u6761\u4ef6\u30fb\u4ed5\u69d8\u30fb\u5de5\u4e8b\u7bc4\u56f2\u30fb\u5171\u76ca\u8cbb\u6309\u5206\u7b49\u306b\u3088\u308a\u5909\u52d5\u3057\u307e\u3059\u3002</p>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Economics</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 4. Leasing Strategy --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u4e09\u4e95\u4e0d\u52d5\u7523</div>\n      <h2 class="title" style="font-size:28px;">\u30ea\u30fc\u30b7\u30f3\u30b0\u6226\u7565\uff0f\u30bf\u30fc\u30b2\u30c3\u30c8</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u30bf\u30fc\u30b2\u30c3\u30c8\u30bb\u30b0\u30e1\u30f3\u30c8</h3>\n          <ul class="list">\n            <li>IT\u30fbSaaS\u30fb\u30b2\u30fc\u30e0\u30fb\u30af\u30ea\u30a8\u30a4\u30c6\u30a3\u30d6</li>\n            <li>\u8cc7\u91d1\u8abf\u9054\u5f8c\u306e\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\uff0820\u301c80\u540d\u898f\u6a21\uff09</li>\n            <li>SNS/\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u9732\u51fa\u304c\u9ad8\u3044\u30af\u30ea\u30a8\u30a4\u30bf\u30fc\u7cfb\u4f01\u696d</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 6;">\n          <h3>\u5dee\u5225\u5316\u30dd\u30a4\u30f3\u30c8</h3>\n          <ul class="list">\n            <li>BTS\uff08Build-to-Suit\uff09\u5bfe\u5fdc\uff0f\u62e1\u5f35\u4f59\u5730\u306e\u8a2d\u8a08</li>\n            <li>\u5185\u88c5\u76e3\u4fee\u306b\u3088\u308b<strong>\u5165\u5c45\u5373\u6226\u529b\u4ed5\u69d8</strong>\uff08\u4f1a\u8b70\u5ba4\u6bd4\u7387\u30fb\u9632\u97f3\u30fb\u914d\u7dda\uff09</li>\n            <li>\u30a6\u30a7\u30eb\u30d3\u30fc\u30a4\u30f3\u30b0\u89b3\u70b9\u306e\u5171\u7528\u90e8\u8a08\u753b\uff08\u30e9\u30a6\u30f3\u30b8\u7b49\uff09</li>\n          </ul>\n        </div>\n        <div class="card" style="grid-column: span 12;">\n          <h3>KPI\uff08\u521d\u671f12\u304b\u6708\uff09</h3>\n          <div class="kpis">\n            <div class="kpi"><span class="muted">\u5185\u898b\u30b3\u30f3\u30d0\u30fc\u30b8\u30e7\u30f3</span><b>30% \u76ee\u6a19</b></div>\n            <div class="kpi"><span class="muted">\u5e73\u5747\u6210\u7d04\u671f\u9593</span><b>60\u65e5 \u4ee5\u5185</b></div>\n            <div class="kpi"><span class="muted">\u6210\u7d04\u5e73\u5747\u576a\u5358\u4fa1</span><b>\u67fb\u5b9a\u30ec\u30f3\u30b8\u5185\u7dad\u6301</b></div>\n          </div>\n          <p class="muted" style="margin-top:8px;">KPI\u306f\u30de\u30fc\u30b1\u30c3\u30c8\u72b6\u6cc1\u306b\u5fdc\u3058\u3066\u56db\u534a\u671f\u3054\u3068\u306b\u898b\u76f4\u3057\u307e\u3059\u3002</p>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Leasing Strategy</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 5. Schedule --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u4e09\u4e95\u4e0d\u52d5\u7523</div>\n      <h2 class="title" style="font-size:28px;">\u60f3\u5b9a\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\uff08\u76ee\u5b89\uff09</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 7;">\n          <h3>\u30de\u30a4\u30eb\u30b9\u30c8\u30fc\u30f3</h3>\n          <div class="timeline">\n            <div class="milestone"><b>\u57fa\u672c\u5408\u610f\uff08LOI\uff09\uff0f\u8981\u4ef6\u6574\u7406</b><br><span class="muted">\u8cc3\u8cb8\u6761\u4ef6\u30fb\u4ed5\u69d8\u65b9\u91dd\u306e\u78ba\u5b9a\u3001NDA\u7de0\u7d50</span></div>\n            <div class="milestone"><b>\u8a2d\u8a08\u30fb\u5185\u88c5\u76e3\u4fee\uff0fBTS\u8abf\u6574</b><br><span class="muted">\u30be\u30fc\u30cb\u30f3\u30b0\u30fb\u30dc\u30ea\u30e5\u30fc\u30e0\u30fb\u4ec0\u5668\u8a08\u753b\u306e\u78ba\u5b9a</span></div>\n            <div class="milestone"><b>\u30ea\u30fc\u30b7\u30f3\u30b0\u7740\u624b</b><br><span class="muted">\u30bf\u30fc\u30b2\u30c3\u30c8\u5148\u884c\u6253\u8a3a\u30fb\u5148\u884c\u7533\u8fbc\u306e\u7372\u5f97</span></div>\n            <div class="milestone"><b>\u6210\u7d04\u30fb\u5f15\u6e21\u3057</b><br><span class="muted">\u5951\u7d04\u30fb\u5de5\u4e8b\u30fb\u5165\u5c45\u306e\u9806\u6b21\u5b9f\u884c</span></div>\n          </div>\n        </div>\n        <div class="card" style="grid-column: span 5;">\n          <h3>\u30de\u30b9\u30bf\u30fc\u30ea\u30fc\u30b9\uff08\u9078\u629e\u53ef\uff09</h3>\n          <ul class="list">\n            <li>\u5f53\u793e\u304c\u4e00\u62ec\u501f\u4e0a\u3052\u3057\u3001\u30b5\u30d6\u30ea\u30fc\u30b9\u904b\u7528</li>\n            <li>\u8cc3\u6599\u306e\u5e73\u6e96\u5316\u30fb\u7a7a\u5ba4\u30ea\u30b9\u30af\u306e\u4f4e\u6e1b\u306b\u5bc4\u4e0e</li>\n            <li>\u4fdd\u8a3c\u8cc3\u6599\u30fb\u671f\u9593\u30fb\u539f\u72b6\u56de\u5fa9\u7b49\u306f\u500b\u5225\u5354\u8b70</li>\n          </ul>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Schedule</span><span class="pnum">Page</span></div>\n    </section>\n\n    \x3c!-- 6. Risks & Next Steps --\x3e\n    <section class="slide">\n      <div class="brand"><div class="mark"></div>\u4e09\u4e95\u4e0d\u52d5\u7523</div>\n      <h2 class="title" style="font-size:28px;">\u30ea\u30b9\u30af\u3068\u5bfe\u5fdc\u65b9\u91dd\uff0f\u6b21\u306e\u30b9\u30c6\u30c3\u30d7</h2>\n      <div class="grid">\n        <div class="card" style="grid-column: span 7;">\n          <h3>\u4e3b\u8981\u30ea\u30b9\u30af\u3068\u5bfe\u5fdc</h3>\n          <div class="two">\n            <div class="risk">\n              <h4>\u9700\u7d66\u5909\u52d5\uff08\u8cc3\u6599\u30bd\u30d5\u30c8\u5316\uff09</h4>\n              <p>\u30d5\u30ed\u30a2\u5206\u5272\u30fb\u30d5\u30ec\u30ad\u30b7\u30d6\u30eb\u6761\u9805\u30fb\u30d5\u30ea\u30fc\u30ec\u30f3\u30c8\u306e\u6700\u9069\u5316\u3067\u7a3c\u50cd\u7387\u3092\u78ba\u4fdd</p>\n            </div>\n            <div class="risk">\n              <h4>\u5185\u88c5\u30b3\u30b9\u30c8\u8d85\u904e</h4>\n              <p>\u4ed5\u69d8\u306e\u30d0\u30ea\u30e5\u30fc\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30fb\u56fa\u5b9a\u4fa1\u683c\u5951\u7d04\u30fbVE\u6848\u306e\u4f75\u8d70</p>\n            </div>\n            <div class="risk">\n              <h4>\u5165\u5c45\u9045\u5ef6</h4>\n              <p>\u5148\u884c\u5185\u898b\u30fb\u5148\u884c\u5951\u7d04\u306e\u6d3b\u7528\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30d1\u30b9\u306e\u4e8b\u524d\u7ba1\u7406</p>\n            </div>\n            <div class="risk">\n              <h4>\u89e3\u7d04\u30ea\u30b9\u30af</h4>\n              <p>\u4e2d\u9014\u89e3\u7d04\u6761\u9805\u306e\u8a2d\u8a08\u30fb\u4fdd\u8a3c\u91d1\u8a2d\u5b9a\u30fb\u30c6\u30ca\u30f3\u30c8\u5be9\u67fb\u306e\u53b3\u683c\u5316</p>\n            </div>\n          </div>\n        </div>\n        <div class="card" style="grid-column: span 5;">\n          <h3>\u6b21\u306e\u30b9\u30c6\u30c3\u30d7</h3>\n          <ol class="list">\n            <li>NDA\u7de0\u7d50\u30fb\u8cc7\u6599\u5171\u6709\uff08\u67fb\u5b9a\u66f8\u30fb\u9700\u8981\u30ec\u30dd\u30fc\u30c8\u7b49\uff09</li>\n            <li>LOI\u5408\u610f\u30fb\u6761\u9805\u30c9\u30e9\u30d5\u30c8\u4f5c\u6210</li>\n            <li>\u30ea\u30fc\u30b7\u30f3\u30b0\u30fb\u5185\u88c5\u8a08\u753b\u306e\u8a73\u7d30\u5316</li>\n            <li>\u5951\u7d04\u7de0\u7d50\u30fb\u5de5\u4e8b\u624b\u914d\u30fb\u5165\u5c45\u958b\u59cb</li>\n          </ol>\n          <p class="muted" style="margin-top:8px;">\u672c\u8cc7\u6599\u306f\u610f\u5411\u8868\u660e\u3067\u3042\u308a\u3001\u6700\u7d42\u6761\u4ef6\u306f\u5354\u8b70\u306e\u3046\u3048\u78ba\u5b9a\u3057\u307e\u3059\u3002</p>\n        </div>\n      </div>\n      <div class="foot"><span class="muted">Risk & Next Steps</span><span class="pnum">Page</span></div>\n    </section>\n\n  </div>\n</body>\n</html>\n\n    '},{id:"p2",kind:"other",subkind:"event",target:"\u6771\u4eac\u90fd\u4e16\u7530\u8c37\u533a\u592a\u5b50\u5802 4\u4e01\u76ee1-1",chiban:"\u592a\u5b50\u5802125-3",company:"\u4e16\u7530\u8c37\u30a2\u30fc\u30d0\u30f3\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8",created_at:"2025-08-15",summary:"\u66ab\u5b9a\u5229\u7528\uff08\u30d7\u30ec\u30a4\u30b9\u30e1\u30a4\u30ad\u30f3\u30b0\uff09\u3067\u4fa1\u5024\u5411\u4e0a\u3002\u30a4\u30d9\u30f3\u30c8\u7a3c\u50cd\u6642\u306e\u6765\u5ba2\u5897\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u4ed8\u304d\u3002",attachments:["\u4f01\u753b\u66f8.pdf"],term_years:1,revenue_year:5e6,capex:12e5,opex_ratio:.2,details:"\u672c\u683c\u958b\u767a\u7740\u624b\u524d\u306e1\u5e74\u9593\u3001\u9031\u672b\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u3084\u30a2\u30fc\u30c8\u30a4\u30d9\u30f3\u30c8\u7b49\u306e\u66ab\u5b9a\u5229\u7528\u3092\u5b9f\u65bd\u3002\u521d\u671f\u6295\u8cc7120\u4e07\u5186\u3067\u5e74\u9593500\u4e07\u5186\u306e\u53ce\u76ca\u3092\u898b\u8fbc\u307f\u3064\u3064\u3001\u6765\u8857\u8005\u5897\u30fbSNS\u9732\u51fa\u306b\u3088\u308a\u7acb\u5730\u8a8d\u77e5\u3092\u5f37\u5316\u3057\u307e\u3059\u3002\u5c06\u6765\u306e\u8cc3\u6599\u6c34\u6e96\u5e95\u4e0a\u3052\uff08\u30c6\u30ca\u30f3\u30c8\u30a2\u30c8\u30e9\u30af\u30b7\u30e7\u30f3\u5411\u4e0a\uff09\u3092\u72d9\u3044\u307e\u3059\u3002",htmlContent:"\n      <!DOCTYPE html>\n      <html>\n        <head><title>\u66ab\u5b9a\u5229\u7528\uff08\u30d7\u30ec\u30a4\u30b9\u30e1\u30a4\u30ad\u30f3\u30b0\uff09\u4f01\u753b</title></head>\n        <body>\n          <h1>\u65bd\u8a2d\u4fa1\u5024\u5411\u4e0a\u306b\u5411\u3051\u305f\u66ab\u5b9a\u5229\u7528\u306e\u3054\u63d0\u6848</h1>\n          <p><strong>\u5bfe\u8c61\u7269\u4ef6:</strong> \u6771\u4eac\u90fd\u4e16\u7530\u8c37\u533a\u592a\u5b50\u5802 4\u4e01\u76ee1-1</p>\n          <h2>\u4f01\u753b\u6982\u8981</h2>\n          <p>\u9031\u672b\u306e\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u30b9\u30c8\u30a2\u3001\u30a2\u30fc\u30c8\u5c55\u793a\u3001\u5730\u57df\u9023\u643a\u30a4\u30d9\u30f3\u30c8\u3092\u5b9a\u671f\u958b\u50ac\u3057\u3001\u30c6\u30ca\u30f3\u30c8\u8a98\u81f4\u524d\u306e\u8cd1\u308f\u3044\u5275\u51fa\u3068\u53ce\u76ca\u5316\u3092\u56f3\u308a\u307e\u3059\u3002</p>\n          <h2>KPI\uff08\u6307\u6a19\uff09</h2>\n          <ul>\n            <li>\u6765\u5834\u8005\u6570\u30fb\u6ede\u5728\u6642\u9593</li>\n            <li>SNS\u9732\u51fa\u30fb\u30e1\u30c7\u30a3\u30a2\u63b2\u8f09\u4ef6\u6570</li>\n            <li>\u5c06\u6765\u306e\u52df\u96c6\u8cc3\u6599\u304a\u3088\u3073\u53cd\u97ff\u7387\u306e\u6539\u5584</li>\n          </ul>\n        </body>\n      </html>\n    "},{id:"p5",kind:"groundlease",target:"\u6771\u4eac\u90fd\u4e16\u7530\u8c37\u533a\u592a\u5b50\u5802 4\u4e01\u76ee1-1",chiban:"\u592a\u5b50\u5802125-3",company:"\u91ce\u6751\u4e0d\u52d5\u7523",created_at:"2025-08-12",summary:"50\u5e74\u306e\u4e8b\u696d\u7528\u5b9a\u671f\u501f\u5730\uff08\u56fa\u5b9a\uff0b\u6539\u5b9a\u6761\u9805\uff09\u3002\u9577\u671f\u5b89\u5b9a\u5730\u4ee3\u3068\u6700\u7d42\u7684\u306a\u571f\u5730\u518d\u53d6\u5f97\u6027\u3092\u78ba\u4fdd\u3002",attachments:["\u30b3\u30f3\u30b5\u30eb\u30c6\u30a3\u30f3\u30b0\u30ec\u30dd\u30fc\u30c8.pdf","\u53ce\u652f\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3.xlsx"],lease_type:"fixed",annual_ground_rent:8e6,key_money:2e7,term_years:50,reversion:{mode:"vacant_land"},expense_rate:.05,details:"\u5f53\u793eSPC\u3092\u5efa\u3066\u4e3b\u3068\u3057\u3066\u4e8b\u696d\u7528\u5b9a\u671f\u501f\u5730\u5951\u7d04\u3092\u7de0\u7d50\u3002\u5e74\u9593\u5730\u4ee3800\u4e07\u5186\u30fb\u4e00\u6642\u91d12,000\u4e07\u5186\u306e\u63d0\u793a\u300210\u5e74\u6bce\u306e\u5730\u4ee3\u6539\u5b9a\u6761\u9805\u3092\u8a2d\u5b9a\u3057\u3001CPI\u9023\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3082\u5bfe\u5fdc\u3002\u671f\u9593\u6e80\u4e86\u6642\u306f\u66f4\u5730\u8fd4\u9084\uff08reversion: vacant_land\uff09\u3067\u5730\u4e3b\u69d8\u306e\u518d\u6d3b\u7528\u81ea\u7531\u5ea6\u3092\u62c5\u4fdd\u3057\u307e\u3059\u3002",htmlContent:"\n      <!DOCTYPE html>\n      <html>\n        <head><title>\u4e8b\u696d\u7528\u5b9a\u671f\u501f\u5730\u63d0\u6848\u66f8</title></head>\n        <body>\n          <h1>\u4e8b\u696d\u7528\u5b9a\u671f\u501f\u5730\u6a29\u8a2d\u5b9a\u306e\u3054\u63d0\u6848</h1>\n          <p><strong>\u5bfe\u8c61\u7269\u4ef6:</strong> \u6771\u4eac\u90fd\u4e16\u7530\u8c37\u533a\u592a\u5b50\u5802 4\u4e01\u76ee1-1</p>\n          <h2>\u63d0\u6848\u6982\u8981</h2>\n          <ul>\n            <li>\u5951\u7d04\u671f\u9593: 50\u5e74</li>\n            <li>\u5e74\u9593\u5730\u4ee3: 8,000,000\u5186</li>\n            <li>\u4e00\u6642\u91d1: 20,000,000\u5186</li>\n            <li>\u6539\u5b9a\u6761\u9805: 10\u5e74\u6bce\uff08CPI\u9023\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u53ef\uff09</li>\n            <li>\u6e80\u4e86\u6642: \u66f4\u5730\u8fd4\u9084</li>\n          </ul>\n          <p>\u9577\u671f\u5b89\u5b9a\u53ce\u5165\u3092\u78ba\u4fdd\u3057\u3064\u3064\u3001\u6e80\u4e86\u6642\u306e\u571f\u5730\u81ea\u7531\u5ea6\u3092\u62c5\u4fdd\u3057\u307e\u3059\u3002</p>\n        </body>\n      </html>\n    "},{id:"p3",kind:"exchange",target:"\u6771\u4eac\u90fd\u5343\u4ee3\u7530\u533a\u4e38\u306e\u5185 1\u4e01\u76ee1-1",chiban:"\u4e38\u306e\u518545-1",company:"\u4e38\u306e\u5185\u30c7\u30d9\u30ed\u30c3\u30d7\u30e1\u30f3\u30c8",created_at:"2025-08-10",summary:"\u7b49\u4fa1\u4ea4\u63db\u306b\u3088\u308b\u9ad8\u5c64\u30d3\u30eb\u5efa\u66ff\u3048\uff08ZEB Ready\uff09\u3002\u5730\u6a29\u8005\u9084\u5143\u3068\u74b0\u5883\u6027\u80fd\u3092\u4e21\u7acb\u3002",attachments:["\u6982\u7b97\u898b\u7a4d.xlsx","\u914d\u7f6e\u56f3.dxf"],ratio:.6,acquired_area_m2:408,completion_ym:"2028-03",post_strategy:"lease",assumed_rent_psm:8e3,opex_ratio:.18,details:"\u571f\u5730\u8cc7\u7523\u3092\u7b49\u4fa1\u4ea4\u63db\u30b9\u30ad\u30fc\u30e0\u3067\u6700\u65b0\u92ed\u30aa\u30d5\u30a3\u30b9\u3078\u5efa\u66ff\u3048\u3002\u4ea4\u63db\u6bd4\u738760%\u3067\u5730\u6a29\u8005\u6301\u5206\u306b\u5fdc\u3058\u305f\u65b0\u7bc9\u5e8a\uff08\u60f3\u5b9a408\u33a1\uff09\u3092\u53d6\u5f97\u3002ZEB Ready\u6c34\u6e96\u3067\u306e\u74b0\u5883\u6027\u80fd\u3092\u78ba\u4fdd\u3057\u3001\u5b8c\u6210\u5f8c\u306f\u5f53\u793e\u304c\u30ea\u30fc\u30b7\u30f3\u30b0\u3092\u4e3b\u5c0e\u3002\u9577\u671f\u5b89\u5b9a\u306e\u8cc3\u6599\u53ce\u76ca\u5316\u3092\u72d9\u3044\u307e\u3059\u3002",htmlContent:"\n      <!DOCTYPE html>\n      <html>\n        <head><title>\u7b49\u4fa1\u4ea4\u63db\u5efa\u66ff\u3048\u306e\u3054\u63d0\u6848</title></head>\n        <body>\n          <h1>\u7b49\u4fa1\u4ea4\u63db\u4e8b\u696d\u306e\u3054\u63d0\u6848</h1>\n          <p><strong>\u5bfe\u8c61\u7269\u4ef6:</strong> \u6771\u4eac\u90fd\u5343\u4ee3\u7530\u533a\u4e38\u306e\u5185 1\u4e01\u76ee1-1</p>\n          <h2>\u4e8b\u696d\u6982\u8981</h2>\n          <ul>\n            <li>\u65e2\u5b58\u5efa\u7269\u3092\u89e3\u4f53\u3057\u9ad8\u5c64\u30aa\u30d5\u30a3\u30b9\u3078\u5efa\u66ff\u3048</li>\n            <li>\u4ea4\u63db\u6bd4\u7387: 60%\uff08\u65b0\u7bc9\u5e8a\u3092\u5730\u6a29\u8005\u69d8\u306b\u9084\u5143\uff09</li>\n            <li>\u5b8c\u6210\u4e88\u5b9a: 2028\u5e743\u6708</li>\n            <li>\u74b0\u5883\u6027\u80fd: ZEB Ready</li>\n          </ul>\n          <h2>\u904b\u55b6\u65b9\u91dd</h2>\n          <p>\u5f53\u793e\u304c\u30ea\u30fc\u30b7\u30f3\u30b0\u30fb\u904b\u55b6\u8a08\u753b\u3092\u4e3b\u5c0e\u3057\u3001\u4e2d\u9577\u671f\u306e\u8cc3\u6599\u6700\u5927\u5316\u3092\u56f3\u308a\u307e\u3059\u3002</p>\n        </body>\n      </html>\n    "}],sy=(e=>e?ry(e):ry)((e,t)=>({assets:[{id:1,name:"\u6e0b\u8c37\u5b87\u7530\u5ddd\u753a\u7269\u4ef6",address:"\u6771\u4eac\u90fd\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-2",memo:"\u7528\u9014\u5730\u57df: \u5546\u696d\u5730\u57df / \u5efa\u853d\u738780% / \u5bb9\u7a4d\u7387600%",area:1198.22,owner:"\u6e0b\u8c37\u30a2\u30bb\u30c3\u30c8\u5408\u540c\u4f1a\u793e",status:"\u73fe\u6cc1: \u4e8b\u52d9\u6240\u30fb\u5546\u696d\u65bd\u8a2d",lat:35.661521,lng:139.697487,zoning:"\u5546\u696d\u5730\u57df",frontage:18.5,depth:64.8,roadAccess:"\u5357\u5074 \u5e45\u54e115.0m \u63a5\u9053\u957718.5m",registrationDate:"2021\u5e746\u670820\u65e5",landCategory:"\u5b85\u5730",valuationMin:22e7,valuationMax:26e7,valuationMedian:24e7,confidenceScore:"A",pricePerSqm:200334,neighborhoodComparison:6.2,lastUpdated:"2024\u5e749\u67081\u65e5",coverageRatio:80,floorAreaRatio:600,nearestStation:"\u6e0b\u8c37\u99c5",stationDistance:8},{id:2,name:"\u592a\u5b50\u5802\u8907\u5408\u65bd\u8a2d",address:"\u6771\u4eac\u90fd\u4e16\u7530\u8c37\u533a\u592a\u5b50\u5802 4\u4e01\u76ee1-1",memo:"\u7528\u9014\u5730\u57df: \u5546\u696d\u5730\u57df / \u5efa\u853d\u738780% / \u5bb9\u7a4d\u7387400%",area:1198.22,owner:"\u592a\u5b50\u5802\u4e0d\u52d5\u7523\u7ba1\u7406\u682a\u5f0f\u4f1a\u793e",status:"\u73fe\u6cc1: \u8907\u5408\u65bd\u8a2d",lat:35.64375696,lng:139.6691615,zoning:"\u5546\u696d\u5730\u57df",frontage:22,depth:54.5,roadAccess:"\u6771\u5074 \u5e45\u54e112.0m \u63a5\u9053\u957722.0m",registrationDate:"2019\u5e743\u670815\u65e5",landCategory:"\u5b85\u5730",valuationMin:18e7,valuationMax:22e7,valuationMedian:2e8,confidenceScore:"B",pricePerSqm:166945,neighborhoodComparison:4.8,lastUpdated:"2024\u5e749\u67081\u65e5",coverageRatio:80,floorAreaRatio:400,nearestStation:"\u4e09\u8ed2\u8336\u5c4b\u99c5",stationDistance:5},{id:3,name:"\u4e38\u306e\u5185\u30aa\u30d5\u30a3\u30b9\u30d3\u30eb",address:"\u6771\u4eac\u90fd\u5343\u4ee3\u7530\u533a\u4e38\u306e\u5185 1\u4e01\u76ee1-1",memo:"\u7528\u9014\u5730\u57df: \u5546\u696d\u5730\u57df / \u5efa\u853d\u738780% / \u5bb9\u7a4d\u73871300%",area:680,owner:"\u4e38\u306e\u5185\u8cc7\u7523\u30d1\u30fc\u30c8\u30ca\u30fc\u30ba\u5408\u540c\u4f1a\u793e",status:"\u73fe\u6cc1: \u30aa\u30d5\u30a3\u30b9",lat:35.684701,lng:139.76135,zoning:"\u5546\u696d\u5730\u57df",frontage:20,depth:34,roadAccess:"\u5317\u5074 \u5e45\u54e127.0m \u63a5\u9053\u957720.0m",registrationDate:"2020\u5e7411\u670810\u65e5",landCategory:"\u5b85\u5730",valuationMin:38e7,valuationMax:42e7,valuationMedian:4e8,confidenceScore:"A+",pricePerSqm:588235,neighborhoodComparison:8.5,lastUpdated:"2024\u5e749\u67081\u65e5",coverageRatio:80,floorAreaRatio:1300,nearestStation:"\u6771\u4eac\u99c5",stationDistance:3}],proposals:oy,registryAlerts:[{id:"r1",parcel:"\uff08\u96a3\u5730\uff09\u6e0b\u8c37\u533a\u5b87\u7530\u5ddd\u753a 31-3",change:"\u6240\u6709\u8005\u5909\u66f4",date:"2025-09-01",note:"\u6cd5\u52d9\u5c40\u30aa\u30f3\u30e9\u30a4\u30f3\u767b\u8a18\u60c5\u5831\u306e\u5dee\u5206\u691c\u51fa"},{id:"r2",parcel:"\uff08\u96a3\u5730\uff09\u4e16\u7530\u8c37\u533a\u592a\u5b50\u5802 4\u4e01\u76ee1-2",change:"\u5730\u76ee\u5909\u66f4\uff08\u5b85\u5730 \u2192 \u96d1\u7a2e\u5730\uff09",date:"2025-08-28",note:"\u5730\u756a\u56f3\u30fb\u516c\u56f3\u306e\u66f4\u65b0\u5dee\u7570"},{id:"r3",parcel:"\uff08\u96a3\u5730\uff09\u5343\u4ee3\u7530\u533a\u4e38\u306e\u5185 1\u4e01\u76ee1-2",change:"\u5efa\u7269\u65b0\u7bc9",date:"2025-08-25",note:"\u5efa\u7bc9\u8a08\u753b\u6982\u8981\u66f8\u306e\u63d0\u51fa\u78ba\u8a8d"}],selectedAssetId:null,setAssets:t=>e({assets:t}),setProposals:t=>e({proposals:t}),setRegistryAlerts:t=>e({registryAlerts:t}),setSelectedAssetId:t=>e({selectedAssetId:t}),getAssetById:e=>t().assets.find(t=>t.id===e),getProposalsForAsset:e=>{const n=t().getAssetById(e);return n?t().proposals.filter(e=>{const t=e.target.toLowerCase(),i=n.address.toLowerCase();return i.includes(t)||t.includes(i.split(" ")[0])}):[]}})),ay=sy,ly=e=>{let{label:t,checked:n,onChange:i,disabled:r=!1}=e;return(0,C.jsxs)("label",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded ".concat(r?"opacity-50 cursor-not-allowed":"hover:bg-gray-100 cursor-pointer"),children:[(0,C.jsx)("input",{type:"checkbox",className:"w-3.5 h-3.5 rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:n,onChange:e=>!r&&i(e.target.checked),disabled:r}),(0,C.jsx)("span",{className:"text-xs ".concat(r?"text-gray-400":"text-gray-700"),children:t})]})},cy=e=>{let{asset:t,formatCurrency:n,formatNumber:i}=e;return(0,C.jsxs)("div",{className:"space-y-6",children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:t.name}),(0,C.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:t.address})]}),(0,C.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4",children:[(0,C.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"\u8a55\u4fa1\u984d\u30ec\u30f3\u30b8"}),(0,C.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:n(t.valuationMedian)}),(0,C.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[n(t.valuationMin)," ~ ",n(t.valuationMax)]}),(0,C.jsxs)("div",{className:"flex items-center mt-2 space-x-2",children:[(0,C.jsxs)("div",{className:"flex items-center",children:[(0,C.jsx)(Zg,{className:"w-4 h-4 text-yellow-500 fill-current"}),(0,C.jsx)("span",{className:"text-sm font-medium ml-1",children:t.confidenceScore})]}),(0,C.jsx)("span",{className:"text-xs text-gray-500",children:"\u4fe1\u983c\u5ea6"})]})]}),(0,C.jsxs)("div",{className:"space-y-3",children:[(0,C.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,C.jsx)(Hg,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u5730\u7a4d"}),(0,C.jsxs)("div",{className:"text-sm text-gray-600",children:[i(t.area),"\u33a1 (",i(.3025*t.area),"\u576a)"]})]})]}),(0,C.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,C.jsx)(Xg,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u7528\u9014\u5730\u57df"}),(0,C.jsx)("div",{className:"text-sm text-gray-600",children:t.zoning})]})]}),(0,C.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,C.jsx)(Yg,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u63a5\u9053"}),(0,C.jsx)("div",{className:"text-sm text-gray-600",children:t.roadAccess})]})]}),(0,C.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,C.jsx)(Kg,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u6700\u7d42\u66f4\u65b0"}),(0,C.jsx)("div",{className:"text-sm text-gray-600",children:t.lastUpdated})]})]})]})]})},uy=e=>{let{htmlContent:t,onClose:n}=e;return(0,C.jsx)(W,{children:(0,C.jsx)(Va.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:n,children:(0,C.jsxs)(Va.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,C.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold",children:"\u63d0\u6848\u66f8"}),(0,C.jsx)("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,C.jsx)(E,{className:"w-5 h-5"})})]}),(0,C.jsx)("div",{className:"h-[calc(100%-60px)] overflow-auto",children:(0,C.jsx)("iframe",{srcDoc:t,className:"w-full h-full border-0",title:"Proposal Document"})})]})})})},hy=()=>(0,C.jsx)("div",{className:"space-y-4",children:(0,C.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,C.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,C.jsxs)("div",{className:"flex items-center justify-between",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold",children:"\u96a3\u5730\u5730\u756a\u4e00\u89a7"}),(0,C.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,C.jsx)(x,{className:"w-4 h-4 text-yellow-500"}),(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"1\u4ef6\u306e\u6240\u6709\u8005\u5909\u66f4\u3092\u691c\u77e5"})]})]}),(0,C.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"\u5b87\u7530\u5ddd\u753a83\u756a\u5730\u5468\u8fba\u306e\u571f\u5730\u767b\u8a18\u60c5\u5831"})]}),(0,C.jsx)("div",{className:"overflow-x-auto",children:(0,C.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,C.jsx)("thead",{className:"bg-gray-50",children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u5730\u756a"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u5730\u7a4d\uff08\u33a1\uff09"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u6240\u6709\u8005"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u5730\u76ee"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u30b9\u30c6\u30fc\u30bf\u30b9"})]})}),(0,C.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:[{chiban:"\u5b87\u7530\u5ddd\u753a83-1",area:245.32,owner:"\u682a\u5f0f\u4f1a\u793e\u7530\u4e2d\u5546\u4e8b",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-2",area:312.45,owner:"WHERE\u4e0d\u52d5\u7523\u682a\u5f0f\u4f1a\u793e",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-3",area:198.67,owner:"\u5c71\u7530\u592a\u90ce",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-4",area:278.9,owner:"\u682a\u5f0f\u4f1a\u793eABC\u958b\u767a",landType:"\u5b85\u5730",isChanged:!0,previousOwner:"\u4f50\u85e4\u82b1\u5b50",changeDate:"2025-08-15"},{chiban:"\u5b87\u7530\u5ddd\u753a83-5",area:156.23,owner:"\u9234\u6728\u6b21\u90ce",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-6",area:423.56,owner:"\u5408\u540c\u4f1a\u793e\u307f\u3069\u308a",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-7",area:189.45,owner:"\u9ad8\u6a4b\u5efa\u8a2d\u682a\u5f0f\u4f1a\u793e",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-8",area:267.89,owner:"\u4f0a\u85e4\u5546\u5e97",landType:"\u5e97\u8217",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-9",area:345.12,owner:"\u682a\u5f0f\u4f1a\u793e\u5bcc\u58eb\u4e0d\u52d5\u7523",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-10",area:201.34,owner:"\u6e21\u8fba\u4e00\u90ce",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-11",area:178.56,owner:"\u4e2d\u6751\u7523\u696d\u682a\u5f0f\u4f1a\u793e",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-12",area:298.78,owner:"\u52a0\u85e4\u7f8e\u667a\u5b50",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-13",area:412.9,owner:"\u30aa\u30ea\u30c3\u30af\u30b9\u4e0d\u52d5\u7523\u6295\u8cc7\u6cd5\u4eba",landType:"\u4e8b\u52d9\u6240",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-14",area:223.45,owner:"\u5c0f\u6797\u4e09\u90ce",landType:"\u5b85\u5730",isChanged:!1},{chiban:"\u5b87\u7530\u5ddd\u753a83-15",area:367.23,owner:"\u6771\u4eac\u5efa\u7269\u682a\u5f0f\u4f1a\u793e",landType:"\u5b85\u5730",isChanged:!1}].map((e,t)=>(0,C.jsxs)("tr",{className:"".concat(e.isChanged?"bg-yellow-50":""," ").concat("\u5b87\u7530\u5ddd\u753a83-2"===e.chiban?"bg-blue-50":""," hover:bg-gray-50"),children:[(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,C.jsxs)("div",{className:"flex items-center",children:["\u5b87\u7530\u5ddd\u753a83-2"===e.chiban&&(0,C.jsx)(Xg,{className:"w-4 h-4 text-blue-600 mr-2"}),(0,C.jsx)("span",{className:"text-sm ".concat("\u5b87\u7530\u5ddd\u753a83-2"===e.chiban?"font-semibold text-blue-900":"font-medium text-gray-900"),children:e.chiban})]})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,C.jsx)("span",{className:"text-sm text-gray-900",children:e.area.toFixed(2)})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.owner}),e.isChanged&&(0,C.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:(0,C.jsxs)("span",{className:"text-red-600",children:["\u5909\u66f4\u524d: ",e.previousOwner]})})]})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,C.jsx)("span",{className:"text-sm text-gray-900",children:e.landType})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.isChanged?(0,C.jsxs)("div",{className:"flex items-center",children:[(0,C.jsx)(Jg,{className:"w-4 h-4 text-yellow-500 mr-1"}),(0,C.jsxs)("span",{className:"text-xs font-medium text-yellow-700",children:["\u6240\u6709\u8005\u5909\u66f4 (",e.changeDate,")"]})]}):"\u5b87\u7530\u5ddd\u753a83-2"===e.chiban?(0,C.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:"\u5bfe\u8c61\u5730"}):(0,C.jsx)("span",{className:"text-xs text-gray-500",children:"\u5909\u66f4\u306a\u3057"})})]},t))})]})}),(0,C.jsx)("div",{className:"p-4 bg-gray-50 border-t border-gray-200",children:(0,C.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,C.jsx)(A,{className:"w-4 h-4 text-blue-500 mt-0.5"}),(0,C.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,C.jsx)("p",{children:"\u767b\u8a18\u60c5\u5831\u306f2025\u5e749\u67083\u65e5\u6642\u70b9\u306e\u30c7\u30fc\u30bf\u3067\u3059\u3002"}),(0,C.jsxs)("p",{className:"mt-1",children:[(0,C.jsx)("span",{className:"font-medium text-yellow-700",children:"\u5b87\u7530\u5ddd\u753a83-4"}),"\u306e\u6240\u6709\u8005\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002\u8a73\u7d30\u306a\u5909\u66f4\u5185\u5bb9\u306f\u6cd5\u52d9\u5c40\u3067\u78ba\u8a8d\u304c\u5fc5\u8981\u3067\u3059\u3002"]})]})]})})]})}),dy=t=>{let{proposals:n}=t;const[i,r]=(0,e.useState)(null),[o,s]=(0,e.useState)(!1),a=e=>({sale:"\u58f2\u5374",lease:"\u8cc3\u8cb8",exchange:"\u7b49\u4fa1\u4ea4\u63db",groundlease:"\u501f\u5730",other:"\u305d\u306e\u4ed6"}[e]||e),l=e=>"sale"===e.kind&&e.price?"\xa5".concat(e.price.toLocaleString("ja-JP")):"lease"===e.kind&&e.monthly_rent?"\xa5".concat(e.monthly_rent.toLocaleString("ja-JP"),"/\u6708"):"groundlease"===e.kind&&e.annual_ground_rent?"\xa5".concat(e.annual_ground_rent.toLocaleString("ja-JP"),"/\u5e74"):"exchange"===e.kind?"\u7b49\u4fa1\u4ea4\u63db".concat(e.ratio?" ".concat(e.ratio,"%"):""):"-";return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:"space-y-4",children:0===n.length?(0,C.jsx)("div",{className:"text-center py-8 text-gray-500",children:"\u3053\u306e\u7269\u4ef6\u3078\u306e\u63d0\u6848\u306f\u307e\u3060\u3042\u308a\u307e\u305b\u3093"}):(0,C.jsx)("div",{className:"overflow-x-auto",children:(0,C.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,C.jsx)("thead",{className:"bg-gray-50",children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u7a2e\u5225"}),(0,C.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u63d0\u6848\u8005"}),(0,C.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u63d0\u6848\u5185\u5bb9"}),(0,C.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u4fa1\u683c/\u8cc3\u6599"}),(0,C.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u671f\u9593"}),(0,C.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u64cd\u4f5c"})]})}),(0,C.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(e=>{return(0,C.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,C.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,C.jsx)("span",{className:"px-2 py-1 text-xs rounded-full font-medium border ".concat((t=e.kind,{sale:"bg-red-100 text-red-700 border-red-300",lease:"bg-purple-100 text-purple-700 border-purple-300",exchange:"bg-blue-100 text-blue-700 border-blue-300",groundlease:"bg-green-100 text-green-700 border-green-300",other:"bg-gray-100 text-gray-700 border-gray-300"}[t]||"bg-gray-100 text-gray-700 border-gray-300")),children:a(e.kind)})}),(0,C.jsxs)("td",{className:"px-4 py-4",children:[(0,C.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.company}),(0,C.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),(0,C.jsx)("td",{className:"px-4 py-4",children:(0,C.jsx)("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.summary})}),(0,C.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,C.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:l(e)})}),(0,C.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,C.jsx)("div",{className:"text-sm text-gray-900",children:e.term_years?"".concat(e.term_years,"\u5e74"):e.days_to_close?"".concat(e.days_to_close,"\u65e5"):"-"})}),(0,C.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,C.jsx)("button",{onClick:()=>(e=>{r(e),s(!0)})(e),className:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"\u63d0\u6848\u3092\u898b\u308b"})})]},e.id);var t})})]})})}),o&&i&&i.htmlContent&&(0,C.jsx)(uy,{htmlContent:i.htmlContent,onClose:()=>{s(!1),r(null)}})]})},py=t=>{let{assetId:n,onBack:i,privacyLevel:r}=t;const{getAssetById:o,getProposalsForAsset:s}=ay(),[a,c]=(0,e.useState)("overview"),[u,h]=(0,e.useState)(!1),[d,p]=(0,e.useState)(!1),[f,m]=(0,e.useState)({ownerChange:!0,landCategoryChange:!1,boundaryChange:!0,radius:50}),[g,y]=(0,e.useState)({youto:!0,admin:!0,koudo:"\u6700\u5c0f\u516c\u958b"!==r,bouka:"\u6700\u5c0f\u516c\u958b"!==r,height:"\u30d5\u30eb\u516c\u958b"===r,boundary:"\u30d5\u30eb\u516c\u958b"===r,diff:"\u30d5\u30eb\u516c\u958b"===r,night:"\u30d5\u30eb\u516c\u958b"===r,potential:"\u30d5\u30eb\u516c\u958b"===r});(0,e.useEffect)(()=>{y(e=>l(l({},e),{},{koudo:"\u6700\u5c0f\u516c\u958b"!==r&&e.koudo,bouka:"\u6700\u5c0f\u516c\u958b"!==r&&e.bouka,height:"\u30d5\u30eb\u516c\u958b"===r&&e.height,boundary:"\u30d5\u30eb\u516c\u958b"===r&&e.boundary,diff:"\u30d5\u30eb\u516c\u958b"===r&&e.diff,night:"\u30d5\u30eb\u516c\u958b"===r&&e.night,potential:"\u30d5\u30eb\u516c\u958b"===r&&e.potential}))},[r]);const v=o(n),b=s(n);(0,e.useEffect)(()=>{const e=setTimeout(()=>{h(!0)},3e3);return()=>clearTimeout(e)},[]);const w=e=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),S=e=>new Intl.NumberFormat("ja-JP").format(e),T=(0,e.useMemo)(()=>v?[{nearStation:[{min:5,geometry:{lat:v.lat,lng:v.lng}}],wood:{originalRaito:750},address:v.address,area:v.area}]:[],[v]);return v?(0,C.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,C.jsx)("div",{className:"bg-white border-b border-gray-200 px-4 lg:px-6 py-4",children:(0,C.jsxs)("div",{className:"flex items-center justify-between",children:[(0,C.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,C.jsx)("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,C.jsx)($g,{className:"w-5 h-5"})}),(0,C.jsx)("button",{onClick:()=>p(!0),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors lg:hidden",children:(0,C.jsx)(_,{className:"w-5 h-5"})}),(0,C.jsxs)("div",{className:"hidden md:flex items-center space-x-2 text-sm text-gray-600",children:[(0,C.jsx)("span",{children:"WHERE"}),(0,C.jsx)(Qg,{className:"w-4 h-4"}),(0,C.jsx)("span",{children:"\u8cc7\u7523\u7ba1\u7406"}),(0,C.jsx)(Qg,{className:"w-4 h-4"}),(0,C.jsx)("span",{className:"text-gray-900 font-medium",children:v.name})]})]}),(0,C.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,C.jsx)("button",{className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors text-sm",children:"\u7de8\u96c6"}),(0,C.jsx)("button",{className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors text-sm",children:"\u5171\u6709"})]})]})}),(0,C.jsxs)("div",{className:"flex",children:[(0,C.jsx)(W,{children:d&&(0,C.jsx)(Va.div,{className:"fixed inset-0 z-40 bg-black/30 lg:hidden",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>p(!1)})}),(0,C.jsx)(W,{children:d&&(0,C.jsx)(Va.div,{className:"fixed top-0 left-0 h-full w-80 bg-white z-50 lg:hidden border-r border-gray-200 p-6 overflow-y-auto",initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:300,damping:30},children:(0,C.jsx)(cy,{asset:v,formatCurrency:w,formatNumber:S})})}),(0,C.jsx)("div",{className:"hidden lg:block w-80 bg-white border-r border-gray-200 p-6 h-[calc(100vh-73px)] overflow-y-auto",children:(0,C.jsx)(cy,{asset:v,formatCurrency:w,formatNumber:S})}),(0,C.jsxs)("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto h-[calc(100vh-73px)]",children:[(0,C.jsx)("div",{className:"relative bg-white rounded-xl shadow-sm mb-6 overflow-hidden",children:(0,C.jsxs)("div",{className:"h-96 relative",children:[(0,C.jsx)(Wg,{currentStore:T,isSample:!1,privacyLevel:r,mapMode:"map",mapLayers:g}),(0,C.jsx)("div",{className:"absolute bottom-3 left-3 right-3 z-10",children:(0,C.jsxs)("div",{className:"flex flex-wrap gap-2 bg-white/95 backdrop-blur rounded-lg p-2 shadow-sm border",children:[(0,C.jsx)(ly,{label:"\u7528\u9014\u5730\u57df",checked:g.youto,onChange:e=>y(l(l({},g),{},{youto:e})),disabled:!1}),(0,C.jsx)(ly,{label:"\u884c\u653f\u533a\u753b",checked:g.admin,onChange:e=>y(l(l({},g),{},{admin:e})),disabled:!1}),(0,C.jsx)(ly,{label:"\u9ad8\u5ea6\u5730\u533a",checked:g.koudo,onChange:e=>y(l(l({},g),{},{koudo:e})),disabled:"\u6700\u5c0f\u516c\u958b"===r}),(0,C.jsx)(ly,{label:"\u9632\u706b\u5730\u57df",checked:g.bouka,onChange:e=>y(l(l({},g),{},{bouka:e})),disabled:"\u6700\u5c0f\u516c\u958b"===r}),(0,C.jsx)(ly,{label:"\u5efa\u7269\u9ad8\u3055",checked:g.height,onChange:e=>y(l(l({},g),{},{height:e})),disabled:"\u30d5\u30eb\u516c\u958b"!==r})]})}),(0,C.jsx)(W,{children:u&&(0,C.jsx)(Va.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-3 max-w-xs",children:(0,C.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,C.jsx)(x,{className:"w-4 h-4 text-blue-600 mt-0.5"}),(0,C.jsxs)("div",{className:"flex-1",children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u767b\u8a18\u5909\u66f4\u691c\u51fa"}),(0,C.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"\u96a3\u5730\uff083223-2\uff09\u306e\u6240\u6709\u8005\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f"})]}),(0,C.jsx)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:(0,C.jsx)(E,{className:"w-4 h-4"})})]})})})]})}),(0,C.jsxs)("div",{className:"bg-white rounded-xl shadow-sm",children:[(0,C.jsx)("div",{className:"border-b border-gray-200",children:(0,C.jsx)("nav",{className:"flex space-x-8 px-6 overflow-x-auto",children:[{id:"overview",label:"\u6982\u8981"},{id:"valuation",label:"\u8a55\u4fa1"},{id:"legal",label:"\u6cd5\u52d9"},{id:"documents",label:"\u56f3\u9762\u30fb\u8cc7\u6599"},{id:"history",label:"\u5c65\u6b74"},{id:"proposals",label:"\u30d7\u30ed\u306e\u63d0\u6848"},{id:"adjacentParcels",label:"\u96a3\u5730\u5730\u756a"}].map(e=>(0,C.jsx)("button",{onClick:()=>c(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap ".concat(a===e.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),(0,C.jsxs)("div",{className:"p-6",children:["overview"===a&&(0,C.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u57fa\u672c\u60c5\u5831"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u5730\u7a4d"}),(0,C.jsxs)("span",{className:"font-medium",children:[S(v.area),"\u33a1"]})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u7528\u9014\u5730\u57df"}),(0,C.jsx)("span",{className:"font-medium",children:v.zoning})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u5730\u76ee"}),(0,C.jsx)("span",{className:"font-medium",children:v.landCategory})]})]})]}),(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u5efa\u7bc9\u5236\u9650"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u5efa\u853d\u7387"}),(0,C.jsxs)("span",{className:"font-medium",children:[v.coverageRatio,"%"]})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u5bb9\u7a4d\u7387"}),(0,C.jsxs)("span",{className:"font-medium",children:[v.floorAreaRatio,"%"]})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u9632\u706b\u6307\u5b9a"}),(0,C.jsx)("span",{className:"font-medium",children:"\u9632\u706b\u5730\u57df"})]})]})]}),(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u63a5\u9053\u30fb\u5f62\u72b6"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u9593\u53e3"}),(0,C.jsxs)("span",{className:"font-medium",children:[v.frontage,"m"]})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u5965\u884c"}),(0,C.jsxs)("span",{className:"font-medium",children:[v.depth,"m"]})]}),(0,C.jsxs)("div",{className:"text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u63a5\u9053"}),(0,C.jsx)("div",{className:"font-medium mt-1",children:v.roadAccess})]})]})]}),(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u5468\u8fba\u74b0\u5883"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u6700\u5bc4\u99c5"}),(0,C.jsx)("span",{className:"font-medium",children:v.nearestStation})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u99c5\u8ddd\u96e2"}),(0,C.jsxs)("span",{className:"font-medium",children:["\u5f92\u6b69",v.stationDistance,"\u5206"]})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u5b66\u533a"}),(0,C.jsx)("span",{className:"font-medium",children:"\u533a\u7acb\u5c0f\u5b66\u6821"})]})]})]})]}),"valuation"===a&&(0,C.jsxs)("div",{className:"space-y-6",children:[(0,C.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6",children:[(0,C.jsx)("h3",{className:"text-lg font-medium mb-4",children:"\u8a55\u4fa1\u984d"}),(0,C.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm text-gray-600",children:"\u4e0b\u9650\u5024"}),(0,C.jsx)("div",{className:"text-xl font-bold",children:w(v.valuationMin)})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm text-gray-600",children:"\u4e2d\u592e\u5024"}),(0,C.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:w(v.valuationMedian)})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm text-gray-600",children:"\u4e0a\u9650\u5024"}),(0,C.jsx)("div",{className:"text-xl font-bold",children:w(v.valuationMax)})]})]})]}),(0,C.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,C.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u5358\u4fa1\u60c5\u5831"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u33a1\u5358\u4fa1"}),(0,C.jsx)("span",{className:"font-medium",children:w(v.pricePerSqm)})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u576a\u5358\u4fa1"}),(0,C.jsx)("span",{className:"font-medium",children:w(3.3058*v.pricePerSqm)})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u8fd1\u96a3\u6bd4"}),(0,C.jsxs)("span",{className:"font-medium text-green-600",children:["+",v.neighborhoodComparison,"%"]})]})]})]}),(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,C.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u53c2\u7167\u6307\u6a19"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("div",{className:"flex items-center justify-between",children:[(0,C.jsx)("span",{className:"px-2 py-1 bg-white rounded text-xs",children:"\u516c\u793a\u5730\u4fa1"}),(0,C.jsx)("span",{className:"text-sm font-medium",children:"38,500\u5186/\u33a1"})]}),(0,C.jsxs)("div",{className:"flex items-center justify-between",children:[(0,C.jsx)("span",{className:"px-2 py-1 bg-white rounded text-xs",children:"\u8def\u7dda\u4fa1"}),(0,C.jsx)("span",{className:"text-sm font-medium",children:"30,800\u5186/\u33a1"})]}),(0,C.jsxs)("div",{className:"flex items-center justify-between",children:[(0,C.jsx)("span",{className:"px-2 py-1 bg-white rounded text-xs",children:"\u4e8b\u4f8b15\u4ef6"}),(0,C.jsx)("span",{className:"text-sm font-medium",children:"41,200\u5186/\u33a1"})]})]})]})]})]}),"legal"===a&&(0,C.jsxs)("div",{className:"space-y-6",children:[(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u767b\u8a18\u60c5\u5831"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u6240\u6709\u8005"}),(0,C.jsx)("span",{className:"font-medium",children:v.owner})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u6a29\u5229\u5f62\u614b"}),(0,C.jsx)("span",{className:"font-medium",children:"\u6240\u6709\u6a29"})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u5730\u76ee"}),(0,C.jsx)("span",{className:"font-medium",children:v.landCategory})]}),(0,C.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,C.jsx)("span",{className:"text-gray-600",children:"\u767b\u8a18\u65e5"}),(0,C.jsx)("span",{className:"font-medium",children:v.registrationDate})]})]})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u5909\u66f4\u5c65\u6b74"}),(0,C.jsxs)("div",{className:"space-y-3",children:[(0,C.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,C.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full mt-1.5"}),(0,C.jsxs)("div",{className:"flex-1",children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u6240\u6709\u6a29\u79fb\u8ee2"}),(0,C.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"2020\u5e743\u670815\u65e5 - \u524d\u6240\u6709\u8005\u304b\u3089\u6e21\u8fba\u5bb6\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9\u3078"})]})]}),(0,C.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,C.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full mt-1.5"}),(0,C.jsxs)("div",{className:"flex-1",children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u5730\u76ee\u5909\u66f4"}),(0,C.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"2018\u5e7411\u670820\u65e5 - \u96d1\u7a2e\u5730\u304b\u3089\u5b85\u5730\u3078"})]})]})]})]}),(0,C.jsxs)("div",{className:"border-t pt-6",children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u76e3\u8996\u8a2d\u5b9a"}),(0,C.jsxs)("div",{className:"space-y-3",children:[(0,C.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,C.jsx)("input",{type:"checkbox",checked:f.ownerChange,onChange:e=>m(l(l({},f),{},{ownerChange:e.target.checked})),className:"w-4 h-4 text-blue-600 rounded"}),(0,C.jsx)("span",{className:"text-sm",children:"\u6240\u6709\u8005\u5909\u66f4"})]}),(0,C.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,C.jsx)("input",{type:"checkbox",checked:f.landCategoryChange,onChange:e=>m(l(l({},f),{},{landCategoryChange:e.target.checked})),className:"w-4 h-4 text-blue-600 rounded"}),(0,C.jsx)("span",{className:"text-sm",children:"\u5730\u76ee\u5909\u66f4"})]}),(0,C.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,C.jsx)("input",{type:"checkbox",checked:f.boundaryChange,onChange:e=>m(l(l({},f),{},{boundaryChange:e.target.checked})),className:"w-4 h-4 text-blue-600 rounded"}),(0,C.jsx)("span",{className:"text-sm",children:"\u5730\u756a\u6539\u7de8"})]}),(0,C.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,C.jsx)("span",{className:"text-sm",children:"\u76e3\u8996\u7bc4\u56f2"}),(0,C.jsxs)("select",{value:f.radius,onChange:e=>m(l(l({},f),{},{radius:parseInt(e.target.value)})),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[(0,C.jsx)("option",{value:50,children:"\u534a\u5f8450m"}),(0,C.jsx)("option",{value:100,children:"\u534a\u5f84100m"}),(0,C.jsx)("option",{value:200,children:"\u534a\u5f84200m"})]})]})]})]})]}),"documents"===a&&(0,C.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,C.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[(0,C.jsx)("div",{className:"h-32 bg-gray-100 rounded mb-3"}),(0,C.jsx)("h4",{className:"text-sm font-medium",children:"\u516c\u56f3"}),(0,C.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"2024/08/15"}),(0,C.jsxs)("button",{className:"mt-2 text-blue-600 text-xs flex items-center space-x-1",children:[(0,C.jsx)(ey,{className:"w-3 h-3"}),(0,C.jsx)("span",{children:"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"})]})]}),(0,C.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[(0,C.jsx)("div",{className:"h-32 bg-gray-100 rounded mb-3"}),(0,C.jsx)("h4",{className:"text-sm font-medium",children:"\u5730\u7a4d\u6e2c\u91cf\u56f3"}),(0,C.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"2020/03/10"}),(0,C.jsxs)("button",{className:"mt-2 text-blue-600 text-xs flex items-center space-x-1",children:[(0,C.jsx)(ey,{className:"w-3 h-3"}),(0,C.jsx)("span",{children:"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"})]})]}),(0,C.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[(0,C.jsx)("div",{className:"h-32 bg-gray-100 rounded mb-3"}),(0,C.jsx)("h4",{className:"text-sm font-medium",children:"\u4f4d\u7f6e\u56f3"}),(0,C.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"2024/09/01"}),(0,C.jsxs)("button",{className:"mt-2 text-blue-600 text-xs flex items-center space-x-1",children:[(0,C.jsx)(ey,{className:"w-3 h-3"}),(0,C.jsx)("span",{children:"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"})]})]})]}),"history"===a&&(0,C.jsxs)("div",{className:"space-y-3",children:[(0,C.jsxs)("div",{className:"flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg",children:[(0,C.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,C.jsx)(A,{className:"w-4 h-4 text-blue-600"})}),(0,C.jsxs)("div",{className:"flex-1",children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u8a55\u4fa1\u984d\u66f4\u65b0"}),(0,C.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"2024/09/01 14:30 - \u30b7\u30b9\u30c6\u30e0\u81ea\u52d5\u66f4\u65b0"})]})]}),(0,C.jsxs)("div",{className:"flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg",children:[(0,C.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,C.jsx)(ty,{className:"w-4 h-4 text-green-600"})}),(0,C.jsxs)("div",{className:"flex-1",children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u8cc7\u6599\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),(0,C.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"2024/08/15 10:15 - \u7530\u4e2d\u592a\u90ce\u304c\u516c\u56f3\u3092\u8ffd\u52a0"})]})]}),(0,C.jsxs)("div",{className:"flex items-start space-x-3 p-3 hover:bg-gray-50 rounded-lg",children:[(0,C.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,C.jsx)(x,{className:"w-4 h-4 text-yellow-600"})}),(0,C.jsxs)("div",{className:"flex-1",children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u76e3\u8996\u8a2d\u5b9a\u5909\u66f4"}),(0,C.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:"2024/07/20 16:45 - \u76e3\u8996\u7bc4\u56f2\u3092100m\u306b\u5909\u66f4"})]})]})]}),"proposals"===a&&(0,C.jsx)(dy,{proposals:b}),"adjacentParcels"===a&&(0,C.jsx)(hy,{})]})]})]})]})]}):(0,C.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,C.jsx)("div",{className:"text-gray-600",children:"\u8cc7\u7523\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"})})},fy=y("building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),my=y("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),gy=y("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),yy=y("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),_y=y("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),vy=y("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),xy=y("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),by=e=>{let{label:t,value:n,highlight:i}=e;return(0,C.jsxs)("div",{className:"py-3 sm:grid sm:grid-cols-3 sm:gap-4 ".concat(i?"bg-blue-50 -mx-4 px-4 rounded-lg":""),children:[(0,C.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:t}),(0,C.jsx)("dd",{className:"mt-1 text-sm ".concat(i?"text-blue-900 font-semibold":"text-gray-900"," sm:mt-0 sm:col-span-2"),children:n||"-"})]})},wy=e=>{let{icon:t,label:n,value:i,trend:r,color:o="blue"}=e;return(0,C.jsx)("div",{className:"p-4 rounded-xl border-2 ".concat({blue:"bg-blue-50 text-blue-600 border-blue-200",green:"bg-green-50 text-green-600 border-green-200",purple:"bg-purple-50 text-purple-600 border-purple-200",orange:"bg-orange-50 text-orange-600 border-orange-200"}[o]," transition-all hover:shadow-md"),children:(0,C.jsx)("div",{className:"flex items-start justify-between",children:(0,C.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,C.jsx)("div",{className:"p-2 rounded-lg ".concat("blue"===o?"bg-blue-100":"green"===o?"bg-green-100":"purple"===o?"bg-purple-100":"bg-orange-100"),children:t}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"text-xs font-medium text-gray-600 uppercase tracking-wider",children:n}),(0,C.jsx)("p",{className:"mt-1 text-2xl font-bold",children:i}),r&&(0,C.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:r})]})]})})})},Sy=t=>{let{proposal:n,onBack:i}=t;const[r,o]=(0,e.useState)("overview"),s=e=>"number"===typeof e?e.toLocaleString("ja-JP"):"boolean"===typeof e?e?"\u306f\u3044":"\u3044\u3044\u3048":e||"-",a=e=>({sale:"\u58f2\u5374",lease:"\u8cc3\u8cb8",exchange:"\u7b49\u4fa1\u4ea4\u63db",groundlease:"\u4e8b\u696d\u7528\u5b9a\u671f\u501f\u5730",other:"\u305d\u306e\u4ed6"}[e]||e),l=()=>n.price?Math.round(.85*n.price):n.monthly_rent&&n.term_years?Math.round(12*n.monthly_rent*n.term_years*.7):n.annual_ground_rent&&n.term_years?Math.round(n.annual_ground_rent*n.term_years*.75):0,c=()=>"sale"===n.kind?"\u5373\u6642":"lease"===n.kind?"8.5%":"exchange"===n.kind?"12.3%":"groundlease"===n.kind?"6.7%":"7.2%",u={sale:{score:"A",label:"\u4f4e\u30ea\u30b9\u30af",color:"green"},lease:{score:"B",label:"\u4e2d\u30ea\u30b9\u30af",color:"blue"},exchange:{score:"B+",label:"\u4e2d\u30ea\u30b9\u30af",color:"blue"},groundlease:{score:"C",label:"\u8981\u691c\u8a0e",color:"orange"},other:{score:"C",label:"\u8981\u691c\u8a0e",color:"orange"}}[n.kind]||{score:"B",label:"\u4e2d\u30ea\u30b9\u30af",color:"blue"};return(0,C.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-white min-h-screen",children:[(0,C.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,C.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-4",children:(0,C.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,C.jsxs)("button",{onClick:i,className:"flex items-center space-x-2 text-sm text-blue-600 hover:text-blue-800 transition-colors",children:[(0,C.jsx)($g,{className:"w-4 h-4"}),(0,C.jsx)("span",{children:"\u63d0\u6848\u4e00\u89a7\u306b\u623b\u308b"})]}),(0,C.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[(0,C.jsx)("span",{className:"px-3 py-1 rounded-full text-xs sm:text-sm font-medium border ".concat((h=n.kind,{sale:"bg-red-100 text-red-800 border-red-300",lease:"bg-purple-100 text-purple-800 border-purple-300",exchange:"bg-blue-100 text-blue-800 border-blue-300",groundlease:"bg-green-100 text-green-800 border-green-300",other:"bg-gray-100 text-gray-800 border-gray-300"}[h]||"bg-gray-100 text-gray-800")),children:a(n.kind)}),(0,C.jsxs)("span",{className:"text-xs sm:text-sm text-gray-500",children:["\u63d0\u6848\u65e5: ",new Date(n.created_at).toLocaleDateString("ja-JP")]})]})]})})}),(0,C.jsxs)("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-4 sm:py-8",children:[(0,C.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-4 sm:p-6 mb-4 sm:mb-6",children:(0,C.jsxs)("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-4",children:[(0,C.jsxs)("div",{className:"flex-1",children:[(0,C.jsxs)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[(0,C.jsx)(fy,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-600 flex-shrink-0"}),(0,C.jsxs)("span",{children:[n.company,"\u304b\u3089\u306e\u63d0\u6848"]})]}),(0,C.jsx)("p",{className:"mt-2 text-sm sm:text-base text-gray-600",children:n.summary})]}),n.confidence&&(0,C.jsxs)("div",{className:"flex flex-col items-center p-2 sm:p-3 bg-blue-50 rounded-lg flex-shrink-0",children:[(0,C.jsx)("span",{className:"text-xs text-gray-600",children:"\u4fe1\u983c\u5ea6"}),(0,C.jsxs)("span",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:[n.confidence,"%"]})]})]})}),(0,C.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[(0,C.jsx)(wy,{icon:(0,C.jsx)(M,{className:"w-6 h-6"}),label:"NPV (10\u5e74)",value:"\xa5".concat(s(l())),trend:"\u5e02\u5834\u5e73\u5747\u6bd4 +15%",color:"green"}),(0,C.jsx)(wy,{icon:(0,C.jsx)(my,{className:"w-6 h-6"}),label:"IRR",value:c(),trend:"\u671f\u5f85\u53ce\u76ca\u7387",color:"blue"}),(0,C.jsx)(wy,{icon:(0,C.jsx)(Kg,{className:"w-6 h-6"}),label:"\u56de\u53ce\u671f\u9593",value:"sale"===n.kind?"\u5373\u6642":"lease"===n.kind?"8\u5e74":"exchange"===n.kind?"15\u5e74":"groundlease"===n.kind?"".concat(n.term_years,"\u5e74"):"10\u5e74",trend:"\u6295\u8cc7\u56de\u53ce",color:"purple"}),(0,C.jsx)(wy,{icon:(0,C.jsx)(gy,{className:"w-6 h-6"}),label:"\u30ea\u30b9\u30af\u30b9\u30b3\u30a2",value:u.score,trend:u.label,color:u.color})]}),(0,C.jsxs)("div",{className:"bg-white rounded-xl shadow-sm mb-4 sm:mb-6",children:[(0,C.jsx)("div",{className:"border-b border-gray-200",children:(0,C.jsx)("nav",{className:"flex space-x-2 sm:space-x-8 px-3 sm:px-6 overflow-x-auto","aria-label":"Tabs",children:[{id:"overview",label:"\u6982\u8981",icon:(0,C.jsx)(yy,{className:"w-4 h-4"})},{id:"financial",label:"\u8ca1\u52d9\u5206\u6790",icon:(0,C.jsx)(_y,{className:"w-4 h-4"})},{id:"details",label:"\u8a73\u7d30\u6761\u4ef6",icon:(0,C.jsx)(ty,{className:"w-4 h-4"})},{id:"risks",label:"\u30ea\u30b9\u30af\u8a55\u4fa1",icon:(0,C.jsx)(vy,{className:"w-4 h-4"})}].map(e=>(0,C.jsxs)("button",{onClick:()=>o(e.id),className:"\n                    flex items-center space-x-1 sm:space-x-2 py-3 sm:py-4 px-2 sm:px-1 border-b-2 font-medium text-xs sm:text-sm transition-colors whitespace-nowrap\n                    ".concat(r===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","\n                  "),children:[e.icon,(0,C.jsx)("span",{children:e.label})]},e.id))})}),(0,C.jsxs)("div",{className:"p-4 sm:p-6",children:["overview"===r&&(0,C.jsxs)("div",{className:"space-y-6",children:[(0,C.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:(0,C.jsxs)("div",{className:"flex items-start",children:[(0,C.jsx)(xy,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-blue-900",children:"\u63d0\u6848\u306e\u30dd\u30a4\u30f3\u30c8"}),(0,C.jsxs)("p",{className:"mt-1 text-sm text-blue-700",children:["sale"===n.kind&&"\u5373\u6642\u306e\u73fe\u91d1\u5316\u304c\u53ef\u80fd\u3067\u3001\u5e02\u5834\u4fa1\u683c\u3092\u4e0a\u56de\u308b\u6761\u4ef6\u3067\u306e\u8cb7\u53d6\u63d0\u6848\u3067\u3059\u3002","lease"===n.kind&&"\u5b89\u5b9a\u3057\u305f\u9577\u671f\u53ce\u5165\u304c\u898b\u8fbc\u3081\u3001\u7ba1\u7406\u8ca0\u62c5\u3082\u8efd\u6e1b\u3055\u308c\u308b\u8cc3\u8cb8\u63d0\u6848\u3067\u3059\u3002","exchange"===n.kind&&"\u521d\u671f\u6295\u8cc7\u306a\u3057\u3067\u8cc7\u7523\u4fa1\u5024\u306e\u5411\u4e0a\u304c\u671f\u5f85\u3067\u304d\u308b\u7b49\u4fa1\u4ea4\u63db\u63d0\u6848\u3067\u3059\u3002","groundlease"===n.kind&&"\u571f\u5730\u3092\u4fdd\u6709\u3057\u306a\u304c\u3089\u5b89\u5b9a\u53ce\u5165\u3092\u5f97\u3089\u308c\u308b\u501f\u5730\u63d0\u6848\u3067\u3059\u3002","other"===n.kind&&"\u7279\u6b8a\u306a\u6d3b\u7528\u65b9\u6cd5\u306b\u3088\u308b\u53ce\u76ca\u6700\u5927\u5316\u306e\u63d0\u6848\u3067\u3059\u3002"]})]})]})}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\u57fa\u672c\u60c5\u5831"}),(0,C.jsxs)("dl",{className:"divide-y divide-gray-200 border rounded-lg",children:[(0,C.jsx)(by,{label:"\u63d0\u6848\u7a2e\u5225",value:a(n.kind),highlight:!0}),n.price&&(0,C.jsx)(by,{label:"\u63d0\u6848\u4fa1\u683c",value:"\xa5".concat(s(n.price)),highlight:!0}),n.monthly_rent&&(0,C.jsx)(by,{label:"\u6708\u984d\u8cc3\u6599",value:"\xa5".concat(s(n.monthly_rent)),highlight:!0}),n.annual_ground_rent&&(0,C.jsx)(by,{label:"\u5e74\u9593\u5730\u4ee3",value:"\xa5".concat(s(n.annual_ground_rent)),highlight:!0}),n.term_years&&(0,C.jsx)(by,{label:"\u5951\u7d04\u671f\u9593",value:"".concat(n.term_years,"\u5e74")}),n.completion_ym&&(0,C.jsx)(by,{label:"\u5b8c\u4e86\u4e88\u5b9a",value:n.completion_ym}),n.days_to_close&&(0,C.jsx)(by,{label:"\u6c7a\u6e08\u671f\u9593",value:"".concat(n.days_to_close,"\u65e5")})]})]})]}),"financial"===r&&(0,C.jsx)("div",{className:"space-y-6",children:(0,C.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\u53ce\u652f\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3"}),(0,C.jsxs)("div",{className:"space-y-3",children:[(0,C.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"5\u5e74NPV"}),(0,C.jsxs)("span",{className:"font-semibold",children:["\xa5",s(.6*l())]})]}),(0,C.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"10\u5e74NPV"}),(0,C.jsxs)("span",{className:"font-semibold",children:["\xa5",s(l())]})]}),(0,C.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"20\u5e74NPV"}),(0,C.jsxs)("span",{className:"font-semibold",children:["\xa5",s(1.5*l())]})]}),(0,C.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"\u5b9f\u8cea\u5229\u56de\u308a"}),(0,C.jsx)("span",{className:"font-semibold text-green-600",children:c()})]})]})]}),(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\u30b3\u30b9\u30c8\u5185\u8a33"}),(0,C.jsxs)("div",{className:"space-y-3",children:[n.costs&&(0,C.jsxs)(C.Fragment,{children:[n.costs.broker&&(0,C.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"\u4ef2\u4ecb\u624b\u6570\u6599"}),(0,C.jsxs)("span",{className:"font-semibold",children:["\xa5",s(n.costs.broker)]})]}),n.costs.taxes&&(0,C.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"\u7a0e\u91d1"}),(0,C.jsxs)("span",{className:"font-semibold",children:["\xa5",s(n.costs.taxes)]})]}),n.costs.others&&(0,C.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"\u305d\u306e\u4ed6\u8cbb\u7528"}),(0,C.jsxs)("span",{className:"font-semibold",children:["\xa5",s(n.costs.others)]})]})]}),n.opex_ratio&&(0,C.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,C.jsx)("span",{className:"text-sm text-gray-600",children:"\u904b\u55b6\u8cbb\u7387"}),(0,C.jsxs)("span",{className:"font-semibold",children:[n.opex_ratio,"%"]})]})]})]})]})}),"details"===r&&(0,C.jsxs)("div",{className:"space-y-6",children:[(0,C.jsxs)("div",{className:"prose prose-sm max-w-none",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\u63d0\u6848\u8a73\u7d30"}),(0,C.jsx)("div",{className:"bg-gray-50 rounded-lg p-6 whitespace-pre-wrap text-gray-700",children:n.details||"\u8a73\u7d30\u60c5\u5831\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"})]}),n.attachments&&n.attachments.length>0&&(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\u6dfb\u4ed8\u8cc7\u6599"}),(0,C.jsx)("div",{className:"space-y-2",children:n.attachments.map((e,t)=>(0,C.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,C.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,C.jsx)(ty,{className:"w-5 h-5 text-gray-600"}),(0,C.jsx)("span",{className:"text-sm text-gray-700",children:e})]}),(0,C.jsx)(Qg,{className:"w-4 h-4 text-gray-400"})]},t))})]})]}),"risks"===r&&(0,C.jsxs)("div",{className:"space-y-6",children:[(0,C.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-r-lg",children:(0,C.jsxs)("div",{className:"flex items-start",children:[(0,C.jsx)(vy,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{className:"text-sm font-medium text-yellow-900",children:"\u30ea\u30b9\u30af\u8a55\u4fa1\u30b5\u30de\u30ea\u30fc"}),(0,C.jsxs)("p",{className:"mt-1 text-sm text-yellow-700",children:["\u7dcf\u5408\u30ea\u30b9\u30af\u30b9\u30b3\u30a2: ",(0,C.jsx)("span",{className:"font-bold",children:u.score})," (",u.label,")"]})]})]})}),(0,C.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\u4e3b\u8981\u30ea\u30b9\u30af\u8981\u56e0"}),(0,C.jsxs)("ul",{className:"space-y-3",children:[(0,C.jsxs)("li",{className:"flex items-start",children:[(0,C.jsx)("span",{className:"block w-2 h-2 bg-orange-500 rounded-full mt-1.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"font-medium text-gray-900",children:"\u5e02\u5834\u30ea\u30b9\u30af"}),(0,C.jsx)("p",{className:"text-sm text-gray-600",children:"\u4e0d\u52d5\u7523\u5e02\u6cc1\u306e\u5909\u52d5\u306b\u3088\u308b\u5f71\u97ff"})]})]}),(0,C.jsxs)("li",{className:"flex items-start",children:[(0,C.jsx)("span",{className:"block w-2 h-2 bg-yellow-500 rounded-full mt-1.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"font-medium text-gray-900",children:"\u4fe1\u7528\u30ea\u30b9\u30af"}),(0,C.jsx)("p",{className:"text-sm text-gray-600",children:"\u53d6\u5f15\u5148\u306e\u4fe1\u7528\u529b\u306b\u95a2\u3059\u308b\u61f8\u5ff5"})]})]}),(0,C.jsxs)("li",{className:"flex items-start",children:[(0,C.jsx)("span",{className:"block w-2 h-2 bg-green-500 rounded-full mt-1.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"font-medium text-gray-900",children:"\u6d41\u52d5\u6027\u30ea\u30b9\u30af"}),(0,C.jsx)("p",{className:"text-sm text-gray-600",children:"\u8cc7\u7523\u306e\u63db\u91d1\u6027\u306b\u95a2\u3059\u308b\u8a55\u4fa1"})]})]})]})]}),(0,C.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\u30ea\u30b9\u30af\u7de9\u548c\u7b56"}),(0,C.jsxs)("ul",{className:"space-y-3",children:[(0,C.jsxs)("li",{className:"flex items-start",children:[(0,C.jsx)(gy,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"font-medium text-gray-900",children:"\u5951\u7d04\u6761\u4ef6\u306e\u7cbe\u67fb"}),(0,C.jsx)("p",{className:"text-sm text-gray-600",children:"\u5c02\u9580\u5bb6\u306b\u3088\u308b\u5951\u7d04\u5185\u5bb9\u306e\u8a73\u7d30\u78ba\u8a8d"})]})]}),(0,C.jsxs)("li",{className:"flex items-start",children:[(0,C.jsx)(gy,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"font-medium text-gray-900",children:"\u4fdd\u8a3c\u30fb\u4fdd\u967a\u306e\u6d3b\u7528"}),(0,C.jsx)("p",{className:"text-sm text-gray-600",children:"\u9069\u5207\u306a\u4fdd\u8a3c\u5236\u5ea6\u306e\u5c0e\u5165\u691c\u8a0e"})]})]}),(0,C.jsxs)("li",{className:"flex items-start",children:[(0,C.jsx)(gy,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"font-medium text-gray-900",children:"\u6bb5\u968e\u7684\u5b9f\u884c"}),(0,C.jsx)("p",{className:"text-sm text-gray-600",children:"\u30ea\u30b9\u30af\u3092\u6700\u5c0f\u5316\u3059\u308b\u5b9f\u884c\u8a08\u753b"})]})]})]})]})]})]})]})]})]})]});var h};function Ty(){const{assets:t,proposals:n,registryAlerts:i,setSelectedAssetId:r,selectedAssetId:o}=ay(),[s,a]=(0,e.useState)("\u9650\u5b9a\u516c\u958b"),[l,c]=(0,e.useState)(!1),[u,h]=(0,e.useState)(!1),[d,p]=(0,e.useState)(!1);return u&&null!==o?(0,C.jsx)(py,{assetId:o,onBack:()=>{h(!1),r(null)},privacyLevel:s}):(0,C.jsxs)("div",{className:"w-full h-full min-h-screen bg-slate-50 text-slate-900",children:[(0,C.jsx)(Ey,{privacyLevel:s,setPrivacyLevel:a,showSettings:l,setShowSettings:c,onMenuClick:()=>p(!d)}),(0,C.jsx)("div",{className:"px-2 md:px-4 lg:px-6 pb-3",children:(0,C.jsx)(My,{assets:t,proposals:n,alerts:i,privacyLevel:s,onAssetClick:e=>{r(e),h(!0)},isSidebarOpen:d,setIsSidebarOpen:p})})]})}function Ey(e){let{privacyLevel:t,setPrivacyLevel:n,showSettings:i,setShowSettings:r,onMenuClick:o}=e;return(0,C.jsxs)("div",{className:"w-full bg-[#0b3557] text-white relative",children:[(0,C.jsx)("div",{className:"max-w-[1600px] mx-auto px-3 md:px-4",children:(0,C.jsxs)("div",{className:"h-14 flex items-center justify-between",children:[(0,C.jsxs)("div",{className:"flex items-center gap-3",children:[(0,C.jsx)("button",{onClick:o,className:"lg:hidden p-1",children:(0,C.jsx)(_,{className:"w-6 h-6"})}),(0,C.jsx)("div",{className:"text-xl font-bold tracking-wide",children:"WHERE"}),(0,C.jsx)("span",{className:"text-xs px-2 py-1 rounded-md bg-white text-[#0b3557] font-semibold",children:"\u8cc7\u7523\u7ba1\u7406"})]}),(0,C.jsxs)("div",{className:"flex items-center gap-3",children:[(0,C.jsxs)("div",{className:"hidden md:flex items-center gap-1 text-sm opacity-90",children:["JA ",(0,C.jsx)(v,{className:"w-4 h-4"})]}),(0,C.jsx)(x,{className:"w-5 h-5 opacity-90"}),(0,C.jsxs)("button",{onClick:()=>r(!i),className:"relative flex items-center gap-1 bg-white/10 px-3 py-1.5 rounded-lg text-sm hover:bg-white/20 transition-colors",children:[(0,C.jsx)(b,{className:"w-4 h-4"}),(0,C.jsx)("span",{children:"\u8a2d\u5b9a"})]}),(0,C.jsxs)("div",{className:"flex items-center gap-1 bg-white/10 px-2 py-1 rounded-lg text-sm",children:[(0,C.jsx)(w,{className:"w-4 h-4"})," J"]})]})]})}),i&&(0,C.jsx)("div",{className:"absolute top-14 right-4 bg-white rounded-lg shadow-lg border p-4 z-50 min-w-[250px]",children:(0,C.jsxs)("div",{className:"text-gray-900",children:[(0,C.jsx)("div",{className:"font-semibold text-sm mb-3",children:"\u516c\u958b\u7bc4\u56f2\u8a2d\u5b9a"}),(0,C.jsxs)("div",{className:"space-y-2",children:[(0,C.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[(0,C.jsx)("input",{type:"radio",name:"privacy",checked:"\u6700\u5c0f\u516c\u958b"===t,onChange:()=>{n("\u6700\u5c0f\u516c\u958b"),r(!1)},className:"w-4 h-4"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u6700\u5c0f\u516c\u958b"}),(0,C.jsx)("div",{className:"text-xs text-gray-500",children:"\u7528\u9014\u5730\u57df\u30fb\u884c\u653f\u533a\u753b\u306e\u307f"})]})]}),(0,C.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[(0,C.jsx)("input",{type:"radio",name:"privacy",checked:"\u9650\u5b9a\u516c\u958b"===t,onChange:()=>{n("\u9650\u5b9a\u516c\u958b"),r(!1)},className:"w-4 h-4"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u9650\u5b9a\u516c\u958b"}),(0,C.jsx)("div",{className:"text-xs text-gray-500",children:"\u9ad8\u5ea6\u5730\u533a\u30fb\u9632\u706b\u5730\u57df\u3092\u8ffd\u52a0"})]})]}),(0,C.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[(0,C.jsx)("input",{type:"radio",name:"privacy",checked:"\u30d5\u30eb\u516c\u958b"===t,onChange:()=>{n("\u30d5\u30eb\u516c\u958b"),r(!1)},className:"w-4 h-4"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sm font-medium",children:"\u30d5\u30eb\u516c\u958b"}),(0,C.jsx)("div",{className:"text-xs text-gray-500",children:"\u3059\u3079\u3066\u306e\u30ec\u30a4\u30e4\u30fc\u3092\u8868\u793a\u53ef\u80fd"})]})]})]})]})})]})}const Ay=e=>{let{assets:t,selected:n,onAssetClick:i,totalValuation:r,formatCurrency:o,setIsSidebarOpen:s}=e;return(0,C.jsxs)("div",{className:"bg-white rounded-2xl shadow p-3 h-full overflow-y-auto flex flex-col",children:[(0,C.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,C.jsx)("div",{className:"font-semibold",children:"\u6240\u6709\u4e0d\u52d5\u7523\u306e\u30ea\u30b9\u30c8"}),(0,C.jsxs)("div",{className:"text-xs text-slate-500",children:["\u767b\u9332\u6570: ",t.length,"\u4ef6"]})]}),(0,C.jsx)("div",{className:"mt-2 grid grid-cols-1 gap-2 text-center",children:(0,C.jsx)(ky,{label:"\u8a55\u4fa1\u984d\uff08\u6982\u7b97\uff09",value:o(r)})}),(0,C.jsx)("div",{className:"mt-3 divide-y flex-1 overflow-y-auto",children:t.map(e=>(0,C.jsxs)("button",{onClick:()=>{i(e.id),s&&s(!1)},className:"w-full text-left p-3 rounded-lg ".concat(n===e.id?"bg-emerald-50":"hover:bg-slate-50"),children:[(0,C.jsx)("div",{className:"text-sm font-semibold",children:e.address}),(0,C.jsx)("div",{className:"text-xs text-slate-600 mt-1",children:e.memo}),(0,C.jsx)("div",{className:"text-xs mt-1",children:e.status})]},e.id))})]})};function My(t){var n,i,r,o;let{assets:s,proposals:a,alerts:c,privacyLevel:u,onAssetClick:h,isSidebarOpen:d,setIsSidebarOpen:p}=t;const[f,m]=(0,e.useState)("map"),[g,y]=(0,e.useState)(null),[_,v]=(0,e.useState)(!1),[x,b]=(0,e.useState)(!1),[w,M]=(0,e.useState)(null!==(n=null===c||void 0===c?void 0:c[0])&&void 0!==n?n:null),[k,P]=(0,e.useState)(!1),I=(0,e.useMemo)(()=>s.find(e=>e.id===g)||null,[g,s]),D=(0,e.useMemo)(()=>s.reduce((e,t)=>e+(t.valuationMedian||0),0),[s]),z=e=>e>=1e8?"\xa5 ".concat((e/1e8).toFixed(2),"\u5104"):e>=1e4?"\xa5 ".concat(Math.round(e/1e4),"\u4e07"):"\xa5 ".concat(e),[R,L]=(0,e.useState)({youto:!0,admin:!0,koudo:"\u6700\u5c0f\u516c\u958b"!==u,bouka:"\u6700\u5c0f\u516c\u958b"!==u,height:"\u30d5\u30eb\u516c\u958b"===u,boundary:!1,diff:!1,night:!1,potential:!1});(0,e.useEffect)(()=>{L(e=>l(l({},e),{},{koudo:"\u6700\u5c0f\u516c\u958b"!==u,bouka:"\u6700\u5c0f\u516c\u958b"!==u,height:"\u30d5\u30eb\u516c\u958b"===u,boundary:"\u30d5\u30eb\u516c\u958b"===u,diff:"\u30d5\u30eb\u516c\u958b"===u,night:"\u30d5\u30eb\u516c\u958b"===u,potential:"\u30d5\u30eb\u516c\u958b"===u}))},[u]);const O=(0,e.useMemo)(()=>s.map(e=>({nearStation:[{min:5,geometry:{lat:e.lat,lng:e.lng}}],wood:{originalRaito:750},address:e.address,area:e.area})),[s]);(0,e.useEffect)(()=>{const e=setInterval(()=>{const e=Math.random()<.5;b(e),e&&null!==c&&void 0!==c&&c.length&&M(c[Math.floor(Math.random()*c.length)])},6e3);return()=>clearInterval(e)},[c]),(0,e.useEffect)(()=>{if(null!==g){const e=Math.random()<.7;b(e),e&&null!==c&&void 0!==c&&c.length&&M(c[Math.floor(Math.random()*c.length)])}},[g,c]);const F=e=>{y(e),h(e)};return(0,C.jsxs)("div",{className:"relative",children:[(0,C.jsx)(W,{children:d&&(0,C.jsxs)(Va.div,{className:"fixed inset-0 z-30 lg:hidden",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,C.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:()=>p(!1)}),(0,C.jsx)(Va.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:300,damping:30},className:"absolute left-0 top-0 h-full w-full max-w-sm bg-transparent p-4",children:(0,C.jsx)(Ay,{assets:s,selected:g,onAssetClick:F,totalValuation:D,formatCurrency:z,setIsSidebarOpen:p})})]})}),(0,C.jsxs)("div",{className:"max-w-[1600px] mx-auto grid grid-cols-12 gap-3 mt-3",children:[(0,C.jsx)("div",{className:"hidden lg:block col-span-12 lg:col-span-4 xl:col-span-3",children:(0,C.jsx)(Ay,{assets:s,selected:g,onAssetClick:F,totalValuation:D,formatCurrency:z})}),(0,C.jsxs)("div",{className:"col-span-12 lg:col-span-8 xl:col-span-9 bg-white rounded-2xl shadow overflow-hidden relative",children:[(0,C.jsxs)("div",{className:"relative h-[66vh] min-h-[520px]",children:[(0,C.jsx)(Wg,{currentStore:O,isSample:!0,privacyLevel:u,mapMode:f,mapLayers:R}),(0,C.jsx)("div",{className:"absolute top-3 left-3 right-3 z-10",children:(0,C.jsxs)("div",{className:"flex gap-2",children:[(0,C.jsx)("button",{onClick:()=>m("map"),className:"px-3 py-2 backdrop-blur rounded-lg text-sm shadow-sm border ".concat("map"===f?"bg-blue-500 text-white border-blue-500":"bg-white/95 hover:bg-gray-50"),children:"\u5730\u56f3"}),(0,C.jsx)("button",{onClick:()=>m("sat"),className:"px-3 py-2 backdrop-blur rounded-lg text-sm shadow-sm border ".concat("sat"===f?"bg-blue-500 text-white border-blue-500":"bg-white/95 hover:bg-gray-50"),children:"\u822a\u7a7a\u5199\u771f"}),(0,C.jsxs)("div",{className:"flex-1 flex items-center gap-2 bg-white/95 backdrop-blur rounded-lg shadow-sm border px-3",children:[(0,C.jsx)(S,{className:"w-4 h-4 text-gray-400"}),(0,C.jsx)("input",{type:"text",placeholder:"\u30de\u30c3\u30d7\u3092\u691c\u7d22",className:"w-full py-2 text-sm outline-none bg-transparent"})]})]})}),(0,C.jsx)("div",{className:"absolute bottom-3 right-3 z-10",children:(0,C.jsx)("button",{onClick:()=>P(!k),className:"p-2 bg-white/95 backdrop-blur rounded-lg shadow-sm border hover:bg-gray-50",children:(0,C.jsx)(T,{className:"w-5 h-5 text-gray-600"})})}),(0,C.jsx)(W,{children:k&&(0,C.jsx)(Va.div,{className:"absolute bottom-16 right-3 z-10",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:(0,C.jsx)("div",{className:"w-auto bg-white/95 backdrop-blur rounded-lg p-2 shadow-lg border",children:(0,C.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,C.jsx)(ly,{label:"\u7528\u9014\u5730\u57df",checked:R.youto,onChange:e=>L(l(l({},R),{},{youto:e})),disabled:!1}),(0,C.jsx)(ly,{label:"\u884c\u653f\u533a\u753b",checked:R.admin||!1,onChange:e=>L(l(l({},R),{},{admin:e})),disabled:!1}),(0,C.jsx)(ly,{label:"\u9ad8\u5ea6\u5730\u533a",checked:R.koudo,onChange:e=>L(l(l({},R),{},{koudo:e})),disabled:"\u6700\u5c0f\u516c\u958b"===u}),(0,C.jsx)(ly,{label:"\u9632\u706b\u5730\u57df",checked:R.bouka,onChange:e=>L(l(l({},R),{},{bouka:e})),disabled:"\u6700\u5c0f\u516c\u958b"===u}),(0,C.jsx)(ly,{label:"\u5efa\u7269\u9ad8\u3055",checked:R.height,onChange:e=>L(l(l({},R),{},{height:e})),disabled:"\u30d5\u30eb\u516c\u958b"!==u}),(0,C.jsx)(ly,{label:"\u7b46\u754c",checked:R.boundary||!1,onChange:e=>L(l(l({},R),{},{boundary:e})),disabled:"\u30d5\u30eb\u516c\u958b"!==u}),(0,C.jsx)(ly,{label:"\u5dee\u7570\u691c\u51fa",checked:R.diff||!1,onChange:e=>L(l(l({},R),{},{diff:e})),disabled:"\u30d5\u30eb\u516c\u958b"!==u}),(0,C.jsx)(ly,{label:"\u591c\u9593\u5149",checked:R.night||!1,onChange:e=>L(l(l({},R),{},{night:e})),disabled:"\u30d5\u30eb\u516c\u958b"!==u}),(0,C.jsx)(ly,{label:"\u9ad8\u30dd\u30c6\u30f3\u30b7\u30e3\u30eb",checked:R.potential||!1,onChange:e=>L(l(l({},R),{},{potential:e})),disabled:"\u30d5\u30eb\u516c\u958b"!==u})]})})})})]}),(0,C.jsx)(W,{children:x&&(0,C.jsxs)(Va.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-12 right-4 bg-white/95 shadow-lg border rounded-xl p-2 pr-8 text-xs max-w-xs z-20",children:[(0,C.jsx)("button",{className:"absolute top-1.5 right-1.5 p-1 rounded hover:bg-slate-100",onClick:()=>b(!1),children:(0,C.jsx)(E,{className:"w-4 h-4"})}),(0,C.jsxs)("div",{className:"flex items-start gap-2",children:[(0,C.jsx)(A,{className:"w-4 h-4 text-sky-600"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{className:"text-sky-700 font-medium",children:"\u96a3\u5730 \u767b\u8a18\u5909\u66f4\u3092\u691c\u51fa"}),(0,C.jsx)("div",{className:"mt-0.5",children:null!==(i=null===w||void 0===w?void 0:w.parcel)&&void 0!==i?i:"\uff08\u30b5\u30f3\u30d7\u30eb\uff09\u583a\u5e02\u4e2d\u533a\u2026"}),(0,C.jsxs)("div",{className:"text-slate-500",children:[null!==(r=null===w||void 0===w?void 0:w.change)&&void 0!==r?r:"\u6240\u6709\u8005\u5909\u66f4"," / ",null!==(o=null===w||void 0===w?void 0:w.date)&&void 0!==o?o:"2025-09-01"]})]})]})]})})]}),(0,C.jsx)(Py,{open:_,asset:I,onClose:()=>v(!1),proposals:a})]})]})}function ky(e){let{label:t,value:n}=e;return(0,C.jsxs)("div",{className:"bg-slate-50 border rounded-xl p-3",children:[(0,C.jsx)("div",{className:"text-[11px] text-slate-500",children:t}),(0,C.jsx)("div",{className:"text-lg font-semibold",children:n})]})}function Cy(t){let{asset:n,proposals:i}=t;const[r,o]=(0,e.useState)(null),[s,a]=(0,e.useState)(!1),l=e=>({sale:"\u58f2\u5374",lease:"\u8cc3\u8cb8",exchange:"\u7b49\u4fa1\u4ea4\u63db",groundlease:"\u501f\u5730",other:"\u305d\u306e\u4ed6"}[e]||e),c=e=>"sale"===e.kind&&e.price?"\xa5".concat(e.price.toLocaleString("ja-JP")):"lease"===e.kind&&e.monthly_rent?"\xa5".concat(e.monthly_rent.toLocaleString("ja-JP"),"/\u6708"):"groundlease"===e.kind&&e.annual_ground_rent?"\xa5".concat(e.annual_ground_rent.toLocaleString("ja-JP"),"/\u5e74"):"exchange"===e.kind?"\u7b49\u4fa1\u4ea4\u63db".concat(e.ratio?" ".concat(e.ratio,"%"):""):"-",u=e=>"sale"===e.kind&&e.price?Math.round(.85*e.price):"lease"===e.kind&&e.monthly_rent&&e.term_years?Math.round(12*e.monthly_rent*e.term_years*.7):"groundlease"===e.kind&&e.annual_ground_rent&&e.term_years?Math.round(e.annual_ground_rent*e.term_years*.75):0;return s&&r?(0,C.jsx)(Sy,{proposal:r,onBack:()=>{a(!1),o(null)},onShowHtml:()=>{}}):(0,C.jsxs)("div",{className:"pt-2 border-t",children:[(0,C.jsx)("div",{className:"font-semibold text-sm mb-3",children:"\u30d7\u30ed\u304b\u3089\u306e\u63d0\u6848"}),0===i.length?(0,C.jsx)("div",{className:"text-xs text-slate-500",children:"\u3053\u306e\u7269\u4ef6\u3078\u306e\u63d0\u6848\u306f\u307e\u3060\u3042\u308a\u307e\u305b\u3093\u3002"}):(0,C.jsx)("div",{className:"overflow-x-auto",children:(0,C.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-xs",children:[(0,C.jsx)("thead",{className:"bg-gray-50",children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{className:"px-2 py-2 text-left font-medium text-gray-500",children:"\u7a2e\u5225"}),(0,C.jsx)("th",{className:"px-2 py-2 text-left font-medium text-gray-500",children:"\u63d0\u6848\u8005"}),(0,C.jsx)("th",{className:"px-2 py-2 text-left font-medium text-gray-500",children:"\u4fa1\u683c/\u8cc3\u6599"}),(0,C.jsx)("th",{className:"px-2 py-2 text-left font-medium text-gray-500",children:"NPV(10\u5e74)"}),(0,C.jsx)("th",{className:"px-2 py-2 text-left font-medium text-gray-500",children:"\u64cd\u4f5c"})]})}),(0,C.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>{return(0,C.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,C.jsx)("td",{className:"px-2 py-2 whitespace-nowrap",children:(0,C.jsx)("span",{className:"px-2 py-0.5 text-xs rounded-full font-medium border ".concat((t=e.kind,{sale:"bg-red-100 text-red-700 border-red-300",lease:"bg-purple-100 text-purple-700 border-purple-300",exchange:"bg-blue-100 text-blue-700 border-blue-300",groundlease:"bg-green-100 text-green-700 border-green-300",other:"bg-gray-100 text-gray-700 border-gray-300"}[t]||"bg-gray-100 text-gray-700 border-gray-300")),children:l(e.kind)})}),(0,C.jsxs)("td",{className:"px-2 py-2",children:[(0,C.jsx)("div",{className:"font-medium text-gray-900",children:e.company}),(0,C.jsx)("div",{className:"text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),(0,C.jsx)("td",{className:"px-2 py-2",children:(0,C.jsx)("div",{className:"font-semibold",children:c(e)})}),(0,C.jsx)("td",{className:"px-2 py-2",children:(0,C.jsxs)("div",{className:"flex items-center",children:[(0,C.jsx)(M,{className:"w-3 h-3 text-green-500 mr-1"}),(0,C.jsxs)("span",{children:["\xa5",u(e).toLocaleString("ja-JP")]})]})}),(0,C.jsx)("td",{className:"px-2 py-2",children:(0,C.jsxs)("button",{onClick:()=>(e=>{o(e),a(!0)})(e),className:"inline-flex items-center px-2 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:[(0,C.jsx)(k,{className:"w-3 h-3 mr-1"}),"\u63d0\u6848\u3092\u898b\u308b"]})})]},e.id);var t})})]})})]})}function Py(t){let{open:n,onClose:i,asset:r,proposals:o}=t;const s=(0,e.useMemo)(()=>r?o.filter(e=>r.address&&e.target&&r.address.includes(e.target)):[],[r,o]);return(0,C.jsx)(W,{children:n&&(0,C.jsxs)(Va.div,{className:"fixed inset-0 z-[70]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,C.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:i}),(0,C.jsxs)(Va.div,{initial:{x:420},animate:{x:0},exit:{x:420},transition:{type:"spring",stiffness:260,damping:30},className:"absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl border-l rounded-l-2xl flex flex-col",children:[(0,C.jsxs)("div",{className:"h-14 flex items-center justify-between px-4 border-b",children:[(0,C.jsx)("div",{className:"font-semibold",children:"\u7269\u4ef6\u60c5\u5831"}),(0,C.jsx)("button",{onClick:i,className:"p-1 rounded-md hover:bg-slate-100",children:(0,C.jsx)(E,{className:"w-5 h-5"})})]}),(0,C.jsx)("div",{className:"p-4 overflow-y-auto space-y-4",children:r?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,C.jsx)("div",{className:"font-semibold",children:r.address}),(0,C.jsxs)("div",{className:"text-slate-600",children:["\u9762\u7a4d: ",r.area.toLocaleString(),"\u33a1\uff08",(.3025*r.area).toFixed(1),"\u576a\uff09"]}),(0,C.jsxs)("div",{className:"text-slate-600",children:["\u6240\u6709\u8005: ",r.owner]}),(0,C.jsxs)("div",{className:"text-slate-600",children:["\u73fe\u6cc1: ",r.status]}),(0,C.jsx)("div",{className:"text-slate-600",children:r.memo})]}),(0,C.jsx)(Cy,{asset:r,proposals:s})]}):(0,C.jsx)("div",{className:"text-sm text-slate-500",children:"\u7269\u4ef6\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})})]})]})})}const Iy=document.getElementById("root");if(!Iy)throw new Error('Root element with id "root" not found');i.createRoot(Iy).render((0,C.jsx)(e.StrictMode,{children:(0,C.jsx)(Ty,{})}))})()})();
//# sourceMappingURL=main.d1b874bd.js.map