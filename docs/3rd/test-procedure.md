# Phase 3 テスト手順書

## テスト環境
- Node.js: v18以上
- React: v18
- TypeScript: v5

## テスト項目

### 1. ビルドテスト

#### 1.1 TypeScript型チェック
```bash
npx tsc --noEmit
```

**期待結果**: エラーなくコンパイルが成功すること

#### 1.2 開発サーバー起動テスト
```bash
npm start
```

**期待結果**: 
- 開発サーバーが正常に起動すること
- ブラウザでアプリケーションが表示されること
- コンポーネントが正しくレンダリングされること

#### 1.3 プロダクションビルドテスト
```bash
npm run build
```

**期待結果**: エラーなくビルドが成功すること

### 2. カスタムフックの動作テスト

#### 2.1 useAssetManagementフック
**テスト手順**:
1. アプリケーションを起動
2. 資産リストが表示されることを確認
3. 資産を選択して詳細画面に遷移
4. プライバシーレベルを変更
5. 詳細画面から戻る

**期待結果**:
- [ ] 資産データが正しく取得される
- [ ] 選択状態が正しく管理される
- [ ] プライバシーレベルの変更が反映される
- [ ] 画面遷移が正しく動作する
- [ ] 評価額の合計が正しく計算される

#### 2.2 useInfoTipフック
**テスト手順**:
1. アプリケーションを起動
2. 6秒待機してアラート表示を確認
3. アラートの×ボタンをクリック
4. 資産を選択してアラート表示の変化を確認

**期待結果**:
- [ ] 定期的にアラートが表示される
- [ ] アラートの内容がランダムに変わる
- [ ] 閉じるボタンが動作する
- [ ] 資産選択時にアラート表示が更新される

#### 2.3 useMapLayersフック
**テスト手順**:
1. 地図のレイヤーボタンをクリック
2. 各レイヤーのトグルを操作
3. プライバシーレベルを変更
4. レイヤーの制限を確認

**期待結果**:
- [ ] レイヤーの表示/非表示が切り替わる
- [ ] プライバシーレベルに応じて制限される
- [ ] デフォルト設定が正しく適用される

### 3. コンポーネント統合テスト

#### 3.1 App.tsxの動作確認
**テスト手順**:
1. アプリケーションを起動
2. 各機能を操作

**期待結果**:
- [ ] 全体的な動作に問題がない
- [ ] カスタムフックが正しく動作
- [ ] 状態管理が適切に行われる

#### 3.2 AssetViewコンポーネント
**テスト手順**:
1. サイドバーの表示/非表示
2. 地図の操作
3. アラート表示の確認

**期待結果**:
- [ ] フックによる最適化後も正常動作
- [ ] パフォーマンスの低下がない
- [ ] メモリリークがない

### 4. パフォーマンステスト

#### 4.1 React Developer Toolsでの確認
**テスト手順**:
1. React Developer Toolsを開く
2. Profilerタブで記録開始
3. 各操作を実行
4. レンダリング時間を確認

**期待結果**:
- [ ] 不要な再レンダリングがない
- [ ] レンダリング時間が適切
- [ ] メモ化が効いている

#### 4.2 メモリ使用量の確認
**テスト手順**:
1. Chrome DevToolsのMemoryタブを開く
2. ヒープスナップショットを取得
3. 操作を繰り返す
4. メモリリークがないか確認

**期待結果**:
- [ ] メモリ使用量が安定
- [ ] リークが発生しない

### 5. リグレッションテスト

#### 5.1 既存機能の動作確認
以下の機能が正常に動作することを確認：

- [ ] 地図の表示と操作
- [ ] 資産リストの表示と選択
- [ ] プライバシーレベルの切り替え
- [ ] レイヤーのトグル機能
- [ ] 資産詳細画面への遷移と復帰
- [ ] 提案情報の表示
- [ ] レスポンシブ表示
- [ ] モバイルメニューの動作

### 6. コンソールエラーチェック

#### 6.1 ブラウザコンソール確認
**テスト手順**:
1. ブラウザの開発者ツールを開く
2. Consoleタブを確認
3. 各操作を実行
4. エラーや警告を確認

**期待結果**:
- [ ] エラーが表示されない
- [ ] 重要な警告が表示されない
- [ ] フックに関するエラーがない

## テスト実行コマンド一覧

```bash
# TypeScript型チェック
npx tsc --noEmit

# 開発サーバー起動
npm start

# プロダクションビルド
npm run build

# ビルドサイズ確認
ls -lh build/static/js/
```

## トラブルシューティング

### よくあるエラーと対処法

#### 1. フック関連のエラー
- Rules of Hooksに違反していないか確認
- 条件付きでフックを呼んでいないか確認
- カスタムフック内でのみフックを使用

#### 2. 型エラー
- カスタムフックの戻り値の型を確認
- インポートパスが正しいか確認

#### 3. レンダリングの問題
- 依存配列が正しく設定されているか確認
- 無限ループが発生していないか確認

## 合格基準

以下の条件を全て満たした場合、Phase 3のテストは合格とします：

1. TypeScript型チェックがエラーなく完了
2. 開発サーバーが正常に起動
3. プロダクションビルドが成功
4. カスタムフックが正しく動作
5. 既存機能にデグレードがない
6. パフォーマンスの低下がない
7. コンソールにエラーが表示されない

## パフォーマンス指標

### 目標値
- **初回レンダリング**: < 200ms
- **再レンダリング**: < 50ms
- **バンドルサイズ**: 前回比±5%以内
- **メモリ使用量**: 安定していること

### 測定方法
1. React Developer Tools Profilerを使用
2. Chrome DevTools Performanceタブを使用
3. Lighthouseでパフォーマンススコアを確認

## テスト完了後の作業

1. テスト結果を記録
2. パフォーマンス指標を記録
3. 問題があった場合は修正を実施
4. 全てのテストが合格したらcommit & pushを実行